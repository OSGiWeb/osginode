if (window.performance && window.performance.mark) { window.performance.mark('startLoadBundleInner-view'); }
// Copyright (C) Microsoft Corporation. All rights reserved.
var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};define("Gallery/Client/Controls/AcquireItemWizardError/AcquireItemWizardError.View",["require","exports","VSS/Adapters/Knockout"],function(n,t,i){var r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(i.TemplateControl);t.AcquireItemWizardErrorView=r});
define("Gallery/Client/Controls/AcquireItemWizardError/AcquireItemWizardError.ViewModel",["require","exports","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","VSS/Adapters/Knockout"],function(n,t,i,r){var u=function(n){function t(t){n.call(this);this._errorMessage="";this._header=i.SomethingGoneWrong;this._errorMessage=t.message}return __extends(t,n),t}(r.TemplateViewModel);t.AcquireItemWizardErrorViewModel=u});
define("VSS/Events/Action",["require","exports","VSS/Diag","VSS/Service"],function(n,t,i,r){function f(){return r.getLocalService(o)}var e=Math.pow(2,32),o=function(){function n(){this._actionWorkers={}}return n.prototype.registerActionWorker=function(n,t,r){r!==undefined;var u=this._actionWorkers[n];u||(this._actionWorkers[n]=u=[]);u.push({worker:t,order:r||(r===0?0:100)});u.sort(function(n,t){return n.order-t.order})},n.prototype.unregisterActionWorker=function(n,t){var r,u;r=this._actionWorkers[n];r&&(u=-1,$.each(r,function(n,i){if(i.worker===t)return u=n,!1}),u>-1&&r.splice(u,1),r.length===0&&delete this._actionWorkers[n])},n.prototype.performAction=function(n,t){function u(n){var t=r&&r[f++];if(t)return t.worker.call(this,n,u)}var r=this._actionWorkers[n],f=0;return u(t)},n.prototype.clearActionWorkers=function(){this._actionWorkers={}},n.MaxOrder=e,n}(),u;t.ActionService=o,function(n){n.ACTION_WINDOW_OPEN="window-open";n.ACTION_WINDOW_NAVIGATE="window-navigate";n.ACTION_WINDOW_RELOAD="window-reload";n.ACTION_WINDOW_UNLOAD="window-unload"}(u=t.CommonActions||(t.CommonActions={}));t.getService=f;f().registerActionWorker(u.ACTION_WINDOW_OPEN,function(n){typeof n.features!="undefined"?window.open(n.url,n.target||"_blank",n.features).opener=null:window.open(n.url,n.target||"_blank").opener=null});f().registerActionWorker(u.ACTION_WINDOW_NAVIGATE,function(n){window.location.href=n.url});f().registerActionWorker(u.ACTION_WINDOW_RELOAD,function(){window.location.reload()})});
define("Gallery/Client/Pages/Common/ItemContext",["require","exports","VSS/Serialization","VSS/Gallery/Contracts"],function(n,t,i,r){function u(){var t=i.deserializeJsonIsland($(".vss-extension"),r.TypeInfo.PublishedExtension),n;return t?(n=function(n){var t=$(n);return t.length>0?t.html():null},{extension:t,extensionToken:i.deserializeJsonIsland($(".vss-extension-token"),null),offerDetails:i.deserializeJsonIsland($(".vss-extension-offer"),null),offerMeterPrices:i.deserializeJsonIsland($(".vss-extension-offer-meter-price"),null),overviewMarkdown:n(".vss-item-overview"),itemProperties:n(".vss-item-properties"),pricingMarkdown:n(".vss-item-pricing"),licenseMarkdown:n(".vss-item-license"),projectCollections:i.deserializeJsonIsland($(".vss-project-collections"),null)}):null}t.getVSSJsonDataProviderInitOptions=u});
define("VSS/Events/Handlers",["require","exports","VSS/Utils/Array"],function(n,t,i){function u(n,t,r,u){var e,f,o;if(n&&n.length>0)for(e=i.clone(n),f=e.length-1;f>=0;f--)if(o=e[f](t,r),u&&u(o))break}var o=function(){function n(){this._namedHandlers={}}return n.prototype.subscribe=function(n,t){this._getOrCreateHandlerList(n).subscribe(t)},n.prototype.unsubscribe=function(n,t){this._getOrCreateHandlerList(n).unsubscribe(t)},n.prototype.invokeHandlers=function(n,t,i,r){var f=this._namedHandlers[(n||"").toUpperCase()];f&&u(f.getHandlers(),t,i,r)},n.prototype._getOrCreateHandlerList=function(n){var t=this._namedHandlers[(n||"").toUpperCase()];return t||(t=new r,this._namedHandlers[(n||"").toUpperCase()]=t),t},n}(),f,r,e;t.NamedEventCollection=o;f=function(){function n(){}return n.prototype.getHandlers=function(){return this._handlers||(this._handlers=new r),this._handlers},n.prototype.invokeHandlers=function(n,t,i){this._handlers&&u(this._handlers.getHandlers(),n,t,i)},n}();t.Event=f;r=function(){function n(n){this._handlers=n}return n.prototype.subscribe=function(n){this._handlers||(this._handlers=[]);n&&this._handlers.push(n)},n.prototype.unsubscribe=function(n){this._handlers&&(this._handlers=this._handlers.filter(function(t){return t!==n}))},n.prototype.getHandlers=function(){return this._handlers||[]},n}();t.EventHandlerList=r;e=function(){function n(n,t,i){this._commandName=n;this._commandArgument=t;this._commandSource=i}return n.prototype.get_commandName=function(){return this._commandName},n.prototype.get_commandArgument=function(){return this._commandArgument},n.prototype.get_commandSource=function(){return this._commandSource},n}();t.CommandEventArgs=e});
define("VSS/Events/Services",["require","exports","VSS/Events/Handlers","VSS/Service"],function(n,t,i,r){function f(){return r.getLocalService(u)}var u=function(){function n(){}return n.prototype.fire=function(n,t,i){return this._fireEvent(n,t,i)},n.prototype.attachEvent=function(n,t){this._events||(this._events=new i.NamedEventCollection);this._events.subscribe(n,t)},n.prototype.detachEvent=function(n,t){this._events&&this._events.unsubscribe(n,t)},n.prototype._fireEvent=function(n,t,i){if(this._events){var r;if(this._events.invokeHandlers(n,t,i,function(n){if(n===!1)return r=!0,!0}),r)return!1}},n}();t.EventService=u;t.getService=f});
define("VSS/Controls/StatusIndicator",["require","exports","VSS/Controls","VSS/Diag","VSS/Locations","VSS/Resources/VSS.Resources.Platform","VSS/Utils/Core","VSS/Utils/String","VSS/Utils/UI","VSS/LoaderPlugins/Css!VSS.Controls"],function(n,t,i,r,u,f,e,o,s){var c=e.delegate,y=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({coreCssClass:"status-indicator"},t))},t.prototype.initialize=function(){n.prototype.initialize.call(this);this._options.center===!0&&this.getElement().addClass("center");this._throttleMinTime=this._options.throttleMinTime||100;this._bindEvents()},t.prototype._dispose=function(){this._clearTimeout();n.prototype._dispose.call(this)},t.prototype.start=function(n){this._clearTimeout();$.extend(this._options,n);this._start()},t.prototype.delayStart=function(n){this._delayStart&&this._delayStart.cancel();this._delayStart=e.delay(this,n,this._start)},t.prototype.complete=function(){this._delayStart&&(this._delayStart.cancel(),this._delayStart=null);this._clearTimeout();this.hideElement()},t.prototype.error=function(n){this._lastError=n;this._clearTimeout();this.hideElement()},t.prototype.setMessage=function(n){var t=this.getElement().find("#indicator_message");t.text(n)},t.prototype.showElement=function(){this.getElement().css("display","")},t.prototype.hideElement=function(){this.getElement().css("display","none")},t.prototype._draw=function(){var n=this.getElement(),t;if(this.hideElement(),n.empty(),this._statusDiv=$("<div />").appendTo(n).addClass("status"),this._options.center){var r=$("<table />").appendTo(this._statusDiv),u=$("<tr />").appendTo(r),i=$("<td />").appendTo(u);this._image=$("<span />").appendTo(i);t=i}else this._statusDiv.addClass("status-inline"),n.addClass("inline"),this._image=$("<span />").appendTo(n),t=n;this._setImageClass();this._options.message&&$("<span id='indicator_message' />").appendTo(t).text(this._options.message)},t.prototype._start=function(){this._statusDiv?this._setImageClass():this._draw();this.showElement()},t.prototype._onClick=function(){this._lastError&&alert(this._lastError)},t.prototype._setImageClass=function(){this._image.removeClass();this._options.imageClass?(this._image.addClass("icon"),this._image.addClass(this._options.imageClass)):this._image.addClass("status-progress")},t.prototype._bindEvents=function(){var n=this._options.eventTarget||window;this._options.statusStartEvent&&this._bind(n,this._options.statusStartEvent,c(this,this._startHandler),!0);this._options.statusCompleteEvent&&this._bind(n,this._options.statusCompleteEvent,c(this,this.complete),!0);this._options.statusErrorEvent&&this._bind(n,this._options.statusErrorEvent,c(this,this.error),!0);this._bind("click",c(this,this._onClick))},t.prototype._error=function(n,t,i,r){this._lastError=r;this.hideElement()},t.prototype._startHandler=function(n,t){this.delayExecute("start",this._throttleMinTime,!0,function(){this.start(n,t)})},t.prototype._clearTimeout=function(){this.cancelDelayedFunction("start")},t.enhancementTypeName="tfs.statusIndicator",t}(i.Control),a,p,h,v,l;t.StatusIndicatorO=y;a=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(y);t.StatusIndicator=a;i.Enhancement.registerJQueryWidget(a,"statusIndicator");p=function(){function n(n,t){this._$rootElement=$(n);this._options=t||{};this._initialize()}return n.prototype.beginOperation=function(n){var t=this.getCancellableOperation();this._cancelable=t;$.isFunction(this._options.beginOperationCallback)&&this._options.beginOperationCallback();this._waitControl.startWait(t);e.delay(this,100,function(){n(t)})},n.prototype.createWaitControl=function(n){return i.create(l,this._$rootElement[0]._element,n)},n.prototype.getCancellableOperation=function(){return new e.Cancelable(this)},n.prototype.getWaitControl=function(){return this._waitControl},n.prototype.endOperation=function(){this._waitControl.endWait();$.isFunction(this._options.endOperationCallback)&&this._options.endOperationCallback()},n.prototype.isCancelled=function(){return this._cancelled},n.prototype.cancelOperation=function(){this._options&&this._options.cancellable&&(this._cancelled=!0);this.endOperation()},n.prototype._initialize=function(){this._state={message:this._options&&this._options.message?this._options.message:f.DefaultWaitMessage,target:this._$rootElement[0]._element,cancellable:this._options&&this._options.cancellable,showDelay:this._options&&this._options.showDelay!==null?this._options.showDelay:null};this._waitControl=this.createWaitControl(this._state)},n}();t.LongRunningOperation=p,function(n){n[n.NotStarted=0]="NotStarted";n[n.Waiting=1]="Waiting";n[n.Ending=2]="Ending";n[n.Ended=3]="Ended";n[n.Cancelling=4]="Cancelling";n[n.Cancelled=5]="Cancelled"}(t.WaitingState||(t.WaitingState={}));h=t.WaitingState;v=function(n){function t(t){n.call(this,t);this._state=h.NotStarted}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({image:u.urlHelper.getVersionedContentUrl("big-progress.gif"),showDelay:l.DefaultShowDelay},t))},t.prototype.initialize=function(){n.prototype.initialize.call(this)},t.prototype.startWait=function(n){this._canStartWait()&&(this._context={instanceId:"waitControl_"+l._instanceIdSeed++,cancellable:n,options:{wait:this._options}},this._startWait())},t.prototype.endWait=function(){this._canEndWait()&&(this._state=h.Ending,this._tryEndWait())},t.prototype.cancelWait=function(){this._canCancelWait()&&(this._state=h.Cancelling,this._tryCancelWait())},t.prototype.setMessage=function(n){if(this._context){var t=this._context.options.wait;t.messageElement&&(t.messageElement.find(".wait-message-text").text(n),this._resizeWait(),t.cancellable&&s.tryFocus(t.messageElement.find("#"+t.cancelLinkId)))}},t.prototype.isCancelled=function(){return this._state===h.Cancelled},t.prototype._canStartWait=function(){return this._state===h.NotStarted||this._state===h.Ended||this._state===h.Cancelled},t.prototype._canEndWait=function(){return this._context&&(this._state===h.Waiting||this._state===h.Ending)},t.prototype._canCancelWait=function(){return this._context&&this._context.options.wait.cancellable&&(this._state===h.Waiting||this._state===h.Cancelling)},t.prototype._startWait=function(){var n=this._context.options.wait;this._state=h.Waiting;n.showDelay===null&&(n.showDelay=l.DefaultShowDelay);n.target||(n.entireWindow=!0,n.target=$("body"),n.extraStyles="height:100%; width:100%;");n.target.children(".wait-element").hide();n.target.children(".wait-box").hide();n.showDelay?this._context.showTimer=e.delay(this,n.showDelay,this._showWait):this._showWait()},t.prototype._tryEndWait=function(){var n=this._context.options.wait;this._state!==h.Ending||n.minLifeSpanBlocking||(this._state=h.Ended,this._reset())},t.prototype._tryCancelWait=function(){var t=this._context.options.wait,i=t.cancelCallback,n=this._context.cancellable;this._state!==h.Cancelling||t.minLifeSpanBlocking||(this._state=h.Cancelled,this._reset(),i&&i(),n&&n.cancel&&$.isFunction(n.cancel)&&n.cancel())},t.prototype._reset=function(){this._unbindKeydownEvent();this._removeWaitElement();this._originalFocusElement&&(this._originalFocusElement.focus(),this._originalFocusElement=null);this._removeShowTimer();this._context=null},t.prototype.updateWaitElements=function(n){n.messageElement=n.target.children(".wait-box").first()},t.prototype._showWait=function(){var t="",n=this._context.options.wait,f=n.extraStyles||"",i=this,u;n.image&&(t+=o.format('<img class="wait-image" src="{0}" />',n.image));u=this._getWaitMessage(n);u&&(t+=o.format('<div class="wait-message">{0}<\/div>',u));t.length>0&&(n.target.prepend(o.format('<div class="wait-box">{0}<\/div>',t)),this.updateWaitElements(n));n.backgroundColor&&(f+=o.format("background-color:{0};",n.backgroundColor));n.target.prepend(o.format('<div class="wait-element" style="{0}"><\/div>',f));n.element=n.target.children(".wait-element").first();this._resizeWait();$(window).bind(this._getResizeEventId(this._context.instanceId),c(this,this._resizeWait));n.cancellable&&(this._bindKeydownEvent(n.cancelLinkId),$("#"+n.cancelLinkId).click(c(this,this._handleCancelEvent)),this._originalFocusElement=$(document.activeElement),$("#"+n.cancelLinkId).focus());n.minLifetime||(n.minLifetime=l.MinLifeTime);n.minLifeSpanBlocking=!0;e.delay(this,n.minLifetime,function(){n.minLifeSpanBlocking=!1;i._state===h.Ending?i._tryEndWait():i._state===h.Cancelling&&i._tryCancelWait()})},t.prototype.getWaitingState=function(){return this._state},t.prototype.getWaitingContext=function(){return this._context},t.prototype._resizeWait=function(){var n,t,i;if(n=this._context.options.wait,n.entireWindow||(n.element.css("margin-top",-parseInt(n.target.css("padding-top"),10)),n.element.css("margin-left",-parseInt(n.target.css("padding-left"),10)),n.element.height(n.target.outerHeight()-2),n.element.width(n.target.outerWidth()-2)),n.messageElement){t=parseInt(n.element.css("margin-top"),10);i=parseInt(n.element.css("margin-left"),10);(!t||isNaN(t))&&(t=0);(!i||isNaN(i))&&(i=0);var e=n.element.outerHeight(),f=n.element.outerWidth(),o=n.messageElement.outerHeight(),u=n.messageElement.outerWidth();u>f&&(u=f-4,n.messageElement.outerWidth(u));n.messageElement.css("top",n.element.position().top+(e-o)/2+t);n.messageElement.css("left",n.element.position().left+(f-u)/2+i)}},t.prototype._onKeyDown=function(n){var t=s.KeyCode;if(n.keyCode===t.ESCAPE)return this._handleCancelEvent(n),!1},t.prototype._handleCancelEvent=function(){return this._unbindKeydownEvent(),this.cancelWait(),!1},t.prototype._bindKeydownEvent=function(n){this._keyDownEventHandler||(this._keyDownEventHandler=c(this,this._onKeyDown),$("#"+n).keydown(this._keyDownEventHandler))},t.prototype._unbindKeydownEvent=function(){if(this._context){var n=this._context.options.wait;this._keyDownEventHandler&&n.cancelLinkId&&($("#"+n.cancelLinkId).unbind("keydown",this._keyDownEventHandler),this._keyDownEventHandler=null)}},t.prototype._removeWaitElement=function(){function t(n){n.element&&(n.element.remove(),n.element=null)}function i(n){n.messageElement&&(n.messageElement.remove(),n.messageElement=null)}if(this._context){var n=this._context.options.wait;n.element&&(n.fade!==!1?(n.element.fadeOut("fast",function(){t(n)}),n.messageElement.fadeOut("fast",function(){i(n)})):(t(n),i(n)),$(window).unbind(this._getResizeEventId(this._context.instanceId)))}},t.prototype._removeShowTimer=function(){this._context&&this._context.showTimer&&(this._context.showTimer.cancel(),delete this._context.showTimer)},t.prototype._getResizeEventId=function(n){return"resize."+n},t.prototype._getWaitMessage=function(n){var i,t;return i="",n.cancellable&&(n.cancelLinkId="cancelLink_"+this._context.instanceId,i=o.format(n.cancelTextFormat||f.CancelWaitAdvice,o.format('<a href="" class="wait-link" tabindex="0" id="{0}">ESC<\/a>',n.cancelLinkId))),t="",n.message?(t=o.format('<span class="wait-message-text">{0}<\/span>',n.message),t=n.cancellable?o.format(this.getWaitMessageFormatString(),t,i):t):n.cancellable&&(t=i),t},t.prototype.getWaitMessageFormatString=function(){return this._options.messageFormat||"{0}({1})"},t._instanceIdSeed=1,t.DefaultShowDelay=250,t.MinLifeTime=100,t}(i.Control);t.WaitControlO=v;l=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(v);t.WaitControl=l});
define("VSS/Controls/Panels",["require","exports","VSS/Ajax","VSS/Controls","VSS/Diag","VSS/Resources/VSS.Resources.Platform","VSS/Controls/StatusIndicator","VSS/Utils/Core","VSS/Utils/UI","VSS/VSS","VSS/LoaderPlugins/Css!VSS.Controls"],function(n,t,i,r,u,f,e,o,s,h){var c=s.domElem,y=h.getErrorMessage,l=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({collapsed:!0,iconCss:"icon",iconCollapseCss:"bowtie-icon bowtie-toggle-tree-collapsed",iconExpandCss:"bowtie-icon bowtie-toggle-tree-expanded"},t))},t.prototype._swapDefaultToggleIconForCustom=function(n){this._$toggleIcon.remove();this._$toggleIcon=n;this._header.addClass(t._defaultToggleIconOverrideClass)},t.prototype._createControl=function(){var t=this,n=this._options;return this._isDisabled=!1,n.hoverCss&&this.getElement().hover(function(){$(this).addClass(n.hoverCss)},function(){$(this).removeClass(n.hoverCss)}),this._header=$(c("div","tfs-collapsible-header")).attr("tabindex","0"),n.headerCss&&this._header.addClass(n.headerCss),this._header.bind("click.CollapsiblePanel",function(){return t.toggleExpandedState()}),this._header.bind("keydown",function(n){if(n.keyCode===s.KeyCode.ENTER&&!s.KeyUtils.isModifierKey(n))return t.toggleExpandedState()}),this._header.bind("mouseenter focus",function(n){return n.preventDefault(),t._header.addClass("focus"),!1}),this._header.bind("mouseleave blur",function(n){return n.preventDefault(),t._header.removeClass("focus"),!1}),this._$toggleIcon=$(c("span","tfs-collapsible-collapse")).addClass(n.iconCss).addClass(n.collapsed?n.iconCollapseCss:n.iconExpandCss),n.collapseCss&&this._$toggleIcon.addClass(n.collapseCss),this._header.append(this._$toggleIcon),this.getElement().append(this._header),this._content=$(c("div","tfs-collapsible-content")),n.contentCss&&this._content.addClass(n.contentCss),n.collapsed&&this._content.hide(),this.getElement().append(this._content),this.getElement()},t.prototype._createIn=function(t){n.prototype._createIn.call(this,t);this._createControl()},t.prototype._enhance=function(n){if(this._options.collapsed=n.hasClass("collapsed"),this._createElement(),this._createControl(),n.after(this.getElement()),this.appendContent(n),this._options.headerText)this.appendHeaderText(this._options.headerText);else if(this._options.headerContent)this.appendHeader(this._options.headerContent),this._options.customToggleIcon&&this._swapDefaultToggleIconForCustom(this._options.customToggleIcon);else{var t=n.attr("title");t&&(n.hasClass("header")&&(n.removeClass("header"),this._header.addClass("header")),this.appendHeader(t))}},t.prototype.replaceHeaderTextIfPresent=function(n){return $("span.tfs-collapsible-text",this._header).text(n)},t.prototype.appendHeaderText=function(n){return this._header.attr("title",n),this.appendHeader($("<span>").text(n).addClass("tfs-collapsible-text"))},t.prototype.appendHeader=function(n){return this._header.append(n),this},t.prototype.appendContent=function(n){var i=this._options,t;return $.isFunction(n)?i.collapsed?(this._dynamicContents||(this._dynamicContents=[]),this._dynamicContents.push(n)):t=n.call(this):t=n,t&&(this._content.append(t),this.getElement().removeClass("collapsed")),this},t.prototype.isExpanded=function(){return this._options.collapsed?!1:!0},t.prototype.expand=function(){this.isExpanded()||this.toggleExpandedState()},t.prototype.collapse=function(){this.isExpanded()&&this.toggleExpandedState()},t.prototype.toggleExpandedState=function(){var i,o,n=this._options,r,u=this._content,f=this._dynamicContents,e;if(this._isDisabled)return!1;if(n.collapsed=!n.collapsed,r=this._$toggleIcon,r.removeClass(n.iconCollapseCss+" "+n.iconExpandCss),r.addClass(n.collapsed?n.iconCollapseCss:n.iconExpandCss),n.collapsed)u.hide(),n.expandCss&&this.getElement().removeClass(n.expandCss),this._fire(t.EVENT_CONTENT_COLLAPSED);else{if(f){for(i=0,o=f.length;i<o;i++)e=f[i],$.isFunction(e)&&u.append(e.apply());this._dynamicContents=null}u.show();n.expandCss&&this.getElement().addClass(n.expandCss);this._fire(t.EVENT_CONTENT_EXPANDED)}if(this._options.onToggleCallback&&$.isFunction(this._options.onToggleCallback))this._options.onToggleCallback(this.isExpanded());return!1},t.prototype.setDisabled=function(n){this._isDisabled!=n&&(n?(this._header.addClass("disabled"),this._$toggleIcon.hide(),this._header.removeAttr("tabindex")):(this._header.removeClass("disabled"),this._$toggleIcon.show(),this._header.attr("tabindex","0")),this._isDisabled=n)},t.prototype.isCollapsiblePanelDisabled=function(){return this._isDisabled},t.EVENT_CONTENT_EXPANDED="collapsible-panel-expanded",t.EVENT_CONTENT_COLLAPSED="collapsible-panel-collapsed",t.enhancementTypeName="tfs.collapsiblepanel",t._defaultToggleIconOverrideClass="custom-toggle-icon",t}(r.Control),a,v;t.CollapsiblePanel=l;r.Enhancement.registerJQueryWidget(l,"collapsible");r.Enhancement.registerEnhancement(l,".tfs-collapsible");a=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({cssClass:"ajax-panel",replaceContent:!0,cache:!0},t))},t.prototype.initialize=function(){var t=this._options.url;n.prototype.initialize.call(this);t&&this.beginLoad(t,this._options.urlParams,this._options.success,this._options.error)},t.prototype._dispose=function(){this._cancelPendingLoad();n.prototype._dispose.call(this)},t.prototype.beginLoad=function(n,t,s,h){var c=this,l,a;u.logTracePoint("AjaxPanel.beginLoad.start");this._cancelPendingLoad();l=new o.Cancelable(this);this._cancelable=l;this.getElement().empty();this._options.showStatusIndicator!==!1&&(a=r.BaseControl.createIn(e.StatusIndicator,this.getElement(),{center:!0,imageClass:"big-status-progress",message:f.Loading}),a.start());i.issueRequest(n,{type:"GET",data:t,dataType:"html",traditional:!0,cache:this._options.cache}).then(l.wrap(function(n){c.onLoadCompleted(n);$.isFunction(s)&&s.call(c,n)}),l.wrap(function(n){var t;$.isFunction(h)&&(t=h.call(c,n)===!0);c.onLoadError(n,t)}))},t.prototype.onLoadCompleted=function(n){this.getElement()&&this._options.replaceContent&&(this.getElement().empty(),this.getElement().html(n),r.Enhancement.ensureEnhancements(this.getElement()));u.logTracePoint("AjaxPanel.beginLoad.complete")},t.prototype.onLoadError=function(n,t){t||this.showError(n);u.logTracePoint("AjaxPanel.beginLoad.complete")},t.prototype.showError=function(n){this.getElement().empty();$(c("div","error")).appendTo(this.getElement()).text(y(n))},t.prototype._cancelPendingLoad=function(){this._cancelable&&(this._cancelable.cancel(),this._cancelable=null)},t.enhancementTypeName="tfs.ajaxPanel",t}(r.Control);t.AjaxPanelO=a;v=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(a);t.AjaxPanel=v});
/*!
 * jQuery UI Button 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/button/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/button",["jquery", "./core", "./widget"], n) : n(jQuery) })(function (n) { var t, i = "ui-button ui-widget ui-state-default ui-corner-all", r = "ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only", f = function () { var t = n(this); setTimeout(function () { t.find(":ui-button").button("refresh") }, 1) }, u = function (t) { var i = t.name, r = t.form, u = n([]); return i && (i = i.replace(/'/g, "\\'"), u = r ? n(r).find("[name='" + i + "'][type=radio]") : n("[name='" + i + "'][type=radio]", t.ownerDocument).filter(function () { return !this.form })), u }; return n.widget("ui.button", { version: "1.11.4", defaultElement: "<button>", options: { disabled: null, text: !0, label: null, icons: { primary: null, secondary: null } }, _create: function () { this.element.closest("form").unbind("reset" + this.eventNamespace).bind("reset" + this.eventNamespace, f); typeof this.options.disabled != "boolean" ? this.options.disabled = !!this.element.prop("disabled") : this.element.prop("disabled", this.options.disabled); this._determineButtonType(); this.hasTitle = !!this.buttonElement.attr("title"); var e = this, r = this.options, o = this.type === "checkbox" || this.type === "radio", s = o ? "" : "ui-state-active"; r.label === null && (r.label = this.type === "input" ? this.buttonElement.val() : this.buttonElement.html()); this._hoverable(this.buttonElement); this.buttonElement.addClass(i).attr("role", "button").bind("mouseenter" + this.eventNamespace, function () { r.disabled || this === t && n(this).addClass("ui-state-active") }).bind("mouseleave" + this.eventNamespace, function () { r.disabled || n(this).removeClass(s) }).bind("click" + this.eventNamespace, function (n) { r.disabled && (n.preventDefault(), n.stopImmediatePropagation()) }); this._on({ focus: function () { this.buttonElement.addClass("ui-state-focus") }, blur: function () { this.buttonElement.removeClass("ui-state-focus") } }); o && this.element.bind("change" + this.eventNamespace, function () { e.refresh() }); this.type === "checkbox" ? this.buttonElement.bind("click" + this.eventNamespace, function () { if (r.disabled) return !1 }) : this.type === "radio" ? this.buttonElement.bind("click" + this.eventNamespace, function () { if (r.disabled) return !1; n(this).addClass("ui-state-active"); e.buttonElement.attr("aria-pressed", "true"); var t = e.element[0]; u(t).not(t).map(function () { return n(this).button("widget")[0] }).removeClass("ui-state-active").attr("aria-pressed", "false") }) : (this.buttonElement.bind("mousedown" + this.eventNamespace, function () { if (r.disabled) return !1; n(this).addClass("ui-state-active"); t = this; e.document.one("mouseup", function () { t = null }) }).bind("mouseup" + this.eventNamespace, function () { if (r.disabled) return !1; n(this).removeClass("ui-state-active") }).bind("keydown" + this.eventNamespace, function (t) { if (r.disabled) return !1; (t.keyCode === n.ui.keyCode.SPACE || t.keyCode === n.ui.keyCode.ENTER) && n(this).addClass("ui-state-active") }).bind("keyup" + this.eventNamespace + " blur" + this.eventNamespace, function () { n(this).removeClass("ui-state-active") }), this.buttonElement.is("a") && this.buttonElement.keyup(function (t) { t.keyCode === n.ui.keyCode.SPACE && n(this).click() })); this._setOption("disabled", r.disabled); this._resetButton() }, _determineButtonType: function () { var n, t, i; this.type = this.element.is("[type=checkbox]") ? "checkbox" : this.element.is("[type=radio]") ? "radio" : this.element.is("input") ? "input" : "button"; this.type === "checkbox" || this.type === "radio" ? (n = this.element.parents().last(), t = "label[for='" + this.element.attr("id") + "']", this.buttonElement = n.find(t), this.buttonElement.length || (n = n.length ? n.siblings() : this.element.siblings(), this.buttonElement = n.filter(t), this.buttonElement.length || (this.buttonElement = n.find(t))), this.element.addClass("ui-helper-hidden-accessible"), i = this.element.is(":checked"), i && this.buttonElement.addClass("ui-state-active"), this.buttonElement.prop("aria-pressed", i)) : this.buttonElement = this.element }, widget: function () { return this.buttonElement }, _destroy: function () { this.element.removeClass("ui-helper-hidden-accessible"); this.buttonElement.removeClass(i + " ui-state-active " + r).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()); this.hasTitle || this.buttonElement.removeAttr("title") }, _setOption: function (n, t) { if (this._super(n, t), n === "disabled") { this.widget().toggleClass("ui-state-disabled", !!t); this.element.prop("disabled", !!t); t && (this.type === "checkbox" || this.type === "radio" ? this.buttonElement.removeClass("ui-state-focus") : this.buttonElement.removeClass("ui-state-focus ui-state-active")); return } this._resetButton() }, refresh: function () { var t = this.element.is("input, button") ? this.element.is(":disabled") : this.element.hasClass("ui-button-disabled"); t !== this.options.disabled && this._setOption("disabled", t); this.type === "radio" ? u(this.element[0]).each(function () { n(this).is(":checked") ? n(this).button("widget").addClass("ui-state-active").attr("aria-pressed", "true") : n(this).button("widget").removeClass("ui-state-active").attr("aria-pressed", "false") }) : this.type === "checkbox" && (this.element.is(":checked") ? this.buttonElement.addClass("ui-state-active").attr("aria-pressed", "true") : this.buttonElement.removeClass("ui-state-active").attr("aria-pressed", "false")) }, _resetButton: function () { if (this.type === "input") { this.options.label && this.element.val(this.options.label); return } var i = this.buttonElement.removeClass(r), e = n("<span><\/span>", this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(i.empty()).text(), t = this.options.icons, f = t.primary && t.secondary, u = []; t.primary || t.secondary ? (this.options.text && u.push("ui-button-text-icon" + (f ? "s" : t.primary ? "-primary" : "-secondary")), t.primary && i.prepend("<span class='ui-button-icon-primary ui-icon " + t.primary + "'><\/span>"), t.secondary && i.append("<span class='ui-button-icon-secondary ui-icon " + t.secondary + "'><\/span>"), this.options.text || (u.push(f ? "ui-button-icons-only" : "ui-button-icon-only"), this.hasTitle || i.attr("title", n.trim(e)))) : u.push("ui-button-text-only"); i.addClass(u.join(" ")) } }), n.widget("ui.buttonset", { version: "1.11.4", options: { items: "button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)" }, _create: function () { this.element.addClass("ui-buttonset") }, _init: function () { this.refresh() }, _setOption: function (n, t) { n === "disabled" && this.buttons.button("option", n, t); this._super(n, t) }, refresh: function () { var i = this.element.css("direction") === "rtl", t = this.element.find(this.options.items), r = t.filter(":ui-button"); t.not(":ui-button").button(); r.button("refresh"); this.buttons = t.map(function () { return n(this).button("widget")[0] }).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(i ? "ui-corner-right" : "ui-corner-left").end().filter(":last").addClass(i ? "ui-corner-left" : "ui-corner-right").end().end() }, _destroy: function () { this.element.removeClass("ui-buttonset"); this.buttons.map(function () { return n(this).button("widget")[0] }).removeClass("ui-corner-left ui-corner-right").end().button("destroy") } }), n.ui.button });
/*!
 * jQuery UI Draggable 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/draggable/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/draggable",["jquery", "./core", "./mouse", "./widget"], n) : n(jQuery) })(function (n) { return n.widget("ui.draggable", n.ui.mouse, { version: "1.11.4", widgetEventPrefix: "drag", options: { addClasses: !0, appendTo: "parent", axis: !1, connectToSortable: !1, containment: !1, cursor: "auto", cursorAt: !1, grid: !1, handle: !1, helper: "original", iframeFix: !1, opacity: !1, refreshPositions: !1, revert: !1, revertDuration: 500, scope: "default", scroll: !0, scrollSensitivity: 20, scrollSpeed: 20, snap: !1, snapMode: "both", snapTolerance: 20, stack: !1, zIndex: !1, drag: null, start: null, stop: null }, _create: function () { this.options.helper === "original" && this._setPositionRelative(); this.options.addClasses && this.element.addClass("ui-draggable"); this.options.disabled && this.element.addClass("ui-draggable-disabled"); this._setHandleClassName(); this._mouseInit() }, _setOption: function (n, t) { this._super(n, t); n === "handle" && (this._removeHandleClassName(), this._setHandleClassName()) }, _destroy: function () { if ((this.helper || this.element).is(".ui-draggable-dragging")) { this.destroyOnClear = !0; return } this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"); this._removeHandleClassName(); this._mouseDestroy() }, _mouseCapture: function (t) { var i = this.options; return (this._blurActiveElement(t), this.helper || i.disabled || n(t.target).closest(".ui-resizable-handle").length > 0) ? !1 : (this.handle = this._getHandle(t), !this.handle) ? !1 : (this._blockFrames(i.iframeFix === !0 ? "iframe" : i.iframeFix), !0) }, _blockFrames: function (t) { this.iframeBlocks = this.document.find(t).map(function () { var t = n(this); return n("<div>").css("position", "absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0] }) }, _unblockFrames: function () { this.iframeBlocks && (this.iframeBlocks.remove(), delete this.iframeBlocks) }, _blurActiveElement: function (t) { var i = this.document[0]; if (this.handleElement.is(t.target)) try { i.activeElement && i.activeElement.nodeName.toLowerCase() !== "body" && n(i.activeElement).blur() } catch (r) { } }, _mouseStart: function (t) { var i = this.options; return (this.helper = this._createHelper(t), this.helper.addClass("ui-draggable-dragging"), this._cacheHelperProportions(), n.ui.ddmanager && (n.ui.ddmanager.current = this), this._cacheMargins(), this.cssPosition = this.helper.css("position"), this.scrollParent = this.helper.scrollParent(!0), this.offsetParent = this.helper.offsetParent(), this.hasFixedAncestor = this.helper.parents().filter(function () { return n(this).css("position") === "fixed" }).length > 0, this.positionAbs = this.element.offset(), this._refreshOffsets(t), this.originalPosition = this.position = this._generatePosition(t, !1), this.originalPageX = t.pageX, this.originalPageY = t.pageY, i.cursorAt && this._adjustOffsetFromHelper(i.cursorAt), this._setContainment(), this._trigger("start", t) === !1) ? (this._clear(), !1) : (this._cacheHelperProportions(), n.ui.ddmanager && !i.dropBehaviour && n.ui.ddmanager.prepareOffsets(this, t), this._normalizeRightBottom(), this._mouseDrag(t, !0), n.ui.ddmanager && n.ui.ddmanager.dragStart(this, t), !0) }, _refreshOffsets: function (n) { this.offset = { top: this.positionAbs.top - this.margins.top, left: this.positionAbs.left - this.margins.left, scroll: !1, parent: this._getParentOffset(), relative: this._getRelativeOffset() }; this.offset.click = { left: n.pageX - this.offset.left, top: n.pageY - this.offset.top } }, _mouseDrag: function (t, i) { if (this.hasFixedAncestor && (this.offset.parent = this._getParentOffset()), this.position = this._generatePosition(t, !0), this.positionAbs = this._convertPositionTo("absolute"), !i) { var r = this._uiHash(); if (this._trigger("drag", t, r) === !1) return this._mouseUp({}), !1; this.position = r.position } return this.helper[0].style.left = this.position.left + "px", this.helper[0].style.top = this.position.top + "px", n.ui.ddmanager && n.ui.ddmanager.drag(this, t), !1 }, _mouseStop: function (t) { var r = this, i = !1; return n.ui.ddmanager && !this.options.dropBehaviour && (i = n.ui.ddmanager.drop(this, t)), this.dropped && (i = this.dropped, this.dropped = !1), this.options.revert === "invalid" && !i || this.options.revert === "valid" && i || this.options.revert === !0 || n.isFunction(this.options.revert) && this.options.revert.call(this.element, i) ? n(this.helper).animate(this.originalPosition, parseInt(this.options.revertDuration, 10), function () { r._trigger("stop", t) !== !1 && r._clear() }) : this._trigger("stop", t) !== !1 && this._clear(), !1 }, _mouseUp: function (t) { return this._unblockFrames(), n.ui.ddmanager && n.ui.ddmanager.dragStop(this, t), this.handleElement.is(t.target) && this.element.focus(), n.ui.mouse.prototype._mouseUp.call(this, t) }, cancel: function () { return this.helper.is(".ui-draggable-dragging") ? this._mouseUp({}) : this._clear(), this }, _getHandle: function (t) { return this.options.handle ? !!n(t.target).closest(this.element.find(this.options.handle)).length : !0 }, _setHandleClassName: function () { this.handleElement = this.options.handle ? this.element.find(this.options.handle) : this.element; this.handleElement.addClass("ui-draggable-handle") }, _removeHandleClassName: function () { this.handleElement.removeClass("ui-draggable-handle") }, _createHelper: function (t) { var r = this.options, u = n.isFunction(r.helper), i = u ? n(r.helper.apply(this.element[0], [t])) : r.helper === "clone" ? this.element.clone().removeAttr("id") : this.element; return i.parents("body").length || i.appendTo(r.appendTo === "parent" ? this.element[0].parentNode : r.appendTo), u && i[0] === this.element[0] && this._setPositionRelative(), i[0] === this.element[0] || /(fixed|absolute)/.test(i.css("position")) || i.css("position", "absolute"), i }, _setPositionRelative: function () { /^(?:r|a|f)/.test(this.element.css("position")) || (this.element[0].style.position = "relative") }, _adjustOffsetFromHelper: function (t) { typeof t == "string" && (t = t.split(" ")); n.isArray(t) && (t = { left: +t[0], top: +t[1] || 0 }); "left" in t && (this.offset.click.left = t.left + this.margins.left); "right" in t && (this.offset.click.left = this.helperProportions.width - t.right + this.margins.left); "top" in t && (this.offset.click.top = t.top + this.margins.top); "bottom" in t && (this.offset.click.top = this.helperProportions.height - t.bottom + this.margins.top) }, _isRootNode: function (n) { return /(html|body)/i.test(n.tagName) || n === this.document[0] }, _getParentOffset: function () { var t = this.offsetParent.offset(), i = this.document[0]; return this.cssPosition === "absolute" && this.scrollParent[0] !== i && n.contains(this.scrollParent[0], this.offsetParent[0]) && (t.left += this.scrollParent.scrollLeft(), t.top += this.scrollParent.scrollTop()), this._isRootNode(this.offsetParent[0]) && (t = { top: 0, left: 0 }), { top: t.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0), left: t.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0) } }, _getRelativeOffset: function () { if (this.cssPosition !== "relative") return { top: 0, left: 0 }; var n = this.element.position(), t = this._isRootNode(this.scrollParent[0]); return { top: n.top - (parseInt(this.helper.css("top"), 10) || 0) + (t ? 0 : this.scrollParent.scrollTop()), left: n.left - (parseInt(this.helper.css("left"), 10) || 0) + (t ? 0 : this.scrollParent.scrollLeft()) } }, _cacheMargins: function () { this.margins = { left: parseInt(this.element.css("marginLeft"), 10) || 0, top: parseInt(this.element.css("marginTop"), 10) || 0, right: parseInt(this.element.css("marginRight"), 10) || 0, bottom: parseInt(this.element.css("marginBottom"), 10) || 0 } }, _cacheHelperProportions: function () { this.helperProportions = { width: this.helper.outerWidth(), height: this.helper.outerHeight() } }, _setContainment: function () { var f, t, i, r = this.options, u = this.document[0]; if (this.relativeContainer = null, !r.containment) { this.containment = null; return } if (r.containment === "window") { this.containment = [n(window).scrollLeft() - this.offset.relative.left - this.offset.parent.left, n(window).scrollTop() - this.offset.relative.top - this.offset.parent.top, n(window).scrollLeft() + n(window).width() - this.helperProportions.width - this.margins.left, n(window).scrollTop() + (n(window).height() || u.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]; return } if (r.containment === "document") { this.containment = [0, 0, n(u).width() - this.helperProportions.width - this.margins.left, (n(u).height() || u.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]; return } if (r.containment.constructor === Array) { this.containment = r.containment; return } (r.containment === "parent" && (r.containment = this.helper[0].parentNode), t = n(r.containment), i = t[0], i) && (f = /(scroll|auto)/.test(t.css("overflow")), this.containment = [(parseInt(t.css("borderLeftWidth"), 10) || 0) + (parseInt(t.css("paddingLeft"), 10) || 0), (parseInt(t.css("borderTopWidth"), 10) || 0) + (parseInt(t.css("paddingTop"), 10) || 0), (f ? Math.max(i.scrollWidth, i.offsetWidth) : i.offsetWidth) - (parseInt(t.css("borderRightWidth"), 10) || 0) - (parseInt(t.css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left - this.margins.right, (f ? Math.max(i.scrollHeight, i.offsetHeight) : i.offsetHeight) - (parseInt(t.css("borderBottomWidth"), 10) || 0) - (parseInt(t.css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top - this.margins.bottom], this.relativeContainer = t) }, _convertPositionTo: function (n, t) { t || (t = this.position); var i = n === "absolute" ? 1 : -1, r = this._isRootNode(this.scrollParent[0]); return { top: t.top + this.offset.relative.top * i + this.offset.parent.top * i - (this.cssPosition === "fixed" ? -this.offset.scroll.top : r ? 0 : this.offset.scroll.top) * i, left: t.left + this.offset.relative.left * i + this.offset.parent.left * i - (this.cssPosition === "fixed" ? -this.offset.scroll.left : r ? 0 : this.offset.scroll.left) * i } }, _generatePosition: function (n, t) { var i, s, u, f, r = this.options, h = this._isRootNode(this.scrollParent[0]), e = n.pageX, o = n.pageY; return h && this.offset.scroll || (this.offset.scroll = { top: this.scrollParent.scrollTop(), left: this.scrollParent.scrollLeft() }), t && (this.containment && (this.relativeContainer ? (s = this.relativeContainer.offset(), i = [this.containment[0] + s.left, this.containment[1] + s.top, this.containment[2] + s.left, this.containment[3] + s.top]) : i = this.containment, n.pageX - this.offset.click.left < i[0] && (e = i[0] + this.offset.click.left), n.pageY - this.offset.click.top < i[1] && (o = i[1] + this.offset.click.top), n.pageX - this.offset.click.left > i[2] && (e = i[2] + this.offset.click.left), n.pageY - this.offset.click.top > i[3] && (o = i[3] + this.offset.click.top)), r.grid && (u = r.grid[1] ? this.originalPageY + Math.round((o - this.originalPageY) / r.grid[1]) * r.grid[1] : this.originalPageY, o = i ? u - this.offset.click.top >= i[1] || u - this.offset.click.top > i[3] ? u : u - this.offset.click.top >= i[1] ? u - r.grid[1] : u + r.grid[1] : u, f = r.grid[0] ? this.originalPageX + Math.round((e - this.originalPageX) / r.grid[0]) * r.grid[0] : this.originalPageX, e = i ? f - this.offset.click.left >= i[0] || f - this.offset.click.left > i[2] ? f : f - this.offset.click.left >= i[0] ? f - r.grid[0] : f + r.grid[0] : f), r.axis === "y" && (e = this.originalPageX), r.axis === "x" && (o = this.originalPageY)), { top: o - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + (this.cssPosition === "fixed" ? -this.offset.scroll.top : h ? 0 : this.offset.scroll.top), left: e - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + (this.cssPosition === "fixed" ? -this.offset.scroll.left : h ? 0 : this.offset.scroll.left) } }, _clear: function () { this.helper.removeClass("ui-draggable-dragging"); this.helper[0] === this.element[0] || this.cancelHelperRemoval || this.helper.remove(); this.helper = null; this.cancelHelperRemoval = !1; this.destroyOnClear && this.destroy() }, _normalizeRightBottom: function () { this.options.axis !== "y" && this.helper.css("right") !== "auto" && (this.helper.width(this.helper.width()), this.helper.css("right", "auto")); this.options.axis !== "x" && this.helper.css("bottom") !== "auto" && (this.helper.height(this.helper.height()), this.helper.css("bottom", "auto")) }, _trigger: function (t, i, r) { return r = r || this._uiHash(), n.ui.plugin.call(this, t, [i, r, this], !0), /^(drag|start|stop)/.test(t) && (this.positionAbs = this._convertPositionTo("absolute"), r.offset = this.positionAbs), n.Widget.prototype._trigger.call(this, t, i, r) }, plugins: {}, _uiHash: function () { return { helper: this.helper, position: this.position, originalPosition: this.originalPosition, offset: this.positionAbs } } }), n.ui.plugin.add("draggable", "connectToSortable", { start: function (t, i, r) { var u = n.extend({}, i, { item: r.element }); r.sortables = []; n(r.options.connectToSortable).each(function () { var i = n(this).sortable("instance"); i && !i.options.disabled && (r.sortables.push(i), i.refreshPositions(), i._trigger("activate", t, u)) }) }, stop: function (t, i, r) { var u = n.extend({}, i, { item: r.element }); r.cancelHelperRemoval = !1; n.each(r.sortables, function () { var n = this; n.isOver ? (n.isOver = 0, r.cancelHelperRemoval = !0, n.cancelHelperRemoval = !1, n._storedCSS = { position: n.placeholder.css("position"), top: n.placeholder.css("top"), left: n.placeholder.css("left") }, n._mouseStop(t), n.options.helper = n.options._helper) : (n.cancelHelperRemoval = !0, n._trigger("deactivate", t, u)) }) }, drag: function (t, i, r) { n.each(r.sortables, function () { var f = !1, u = this; u.positionAbs = r.positionAbs; u.helperProportions = r.helperProportions; u.offset.click = r.offset.click; u._intersectsWith(u.containerCache) && (f = !0, n.each(r.sortables, function () { return this.positionAbs = r.positionAbs, this.helperProportions = r.helperProportions, this.offset.click = r.offset.click, this !== u && this._intersectsWith(this.containerCache) && n.contains(u.element[0], this.element[0]) && (f = !1), f })); f ? (u.isOver || (u.isOver = 1, r._parent = i.helper.parent(), u.currentItem = i.helper.appendTo(u.element).data("ui-sortable-item", !0), u.options._helper = u.options.helper, u.options.helper = function () { return i.helper[0] }, t.target = u.currentItem[0], u._mouseCapture(t, !0), u._mouseStart(t, !0, !0), u.offset.click.top = r.offset.click.top, u.offset.click.left = r.offset.click.left, u.offset.parent.left -= r.offset.parent.left - u.offset.parent.left, u.offset.parent.top -= r.offset.parent.top - u.offset.parent.top, r._trigger("toSortable", t), r.dropped = u.element, n.each(r.sortables, function () { this.refreshPositions() }), r.currentItem = r.element, u.fromOutside = r), u.currentItem && (u._mouseDrag(t), i.position = u.position)) : u.isOver && (u.isOver = 0, u.cancelHelperRemoval = !0, u.options._revert = u.options.revert, u.options.revert = !1, u._trigger("out", t, u._uiHash(u)), u._mouseStop(t, !0), u.options.revert = u.options._revert, u.options.helper = u.options._helper, u.placeholder && u.placeholder.remove(), i.helper.appendTo(r._parent), r._refreshOffsets(t), i.position = r._generatePosition(t, !0), r._trigger("fromSortable", t), r.dropped = !1, n.each(r.sortables, function () { this.refreshPositions() })) }) } }), n.ui.plugin.add("draggable", "cursor", { start: function (t, i, r) { var u = n("body"), f = r.options; u.css("cursor") && (f._cursor = u.css("cursor")); u.css("cursor", f.cursor) }, stop: function (t, i, r) { var u = r.options; u._cursor && n("body").css("cursor", u._cursor) } }), n.ui.plugin.add("draggable", "opacity", { start: function (t, i, r) { var u = n(i.helper), f = r.options; u.css("opacity") && (f._opacity = u.css("opacity")); u.css("opacity", f.opacity) }, stop: function (t, i, r) { var u = r.options; u._opacity && n(i.helper).css("opacity", u._opacity) } }), n.ui.plugin.add("draggable", "scroll", { start: function (n, t, i) { i.scrollParentNotHidden || (i.scrollParentNotHidden = i.helper.scrollParent(!1)); i.scrollParentNotHidden[0] !== i.document[0] && i.scrollParentNotHidden[0].tagName !== "HTML" && (i.overflowOffset = i.scrollParentNotHidden.offset()) }, drag: function (t, i, r) { var u = r.options, o = !1, e = r.scrollParentNotHidden[0], f = r.document[0]; e !== f && e.tagName !== "HTML" ? (u.axis && u.axis === "x" || (r.overflowOffset.top + e.offsetHeight - t.pageY < u.scrollSensitivity ? e.scrollTop = o = e.scrollTop + u.scrollSpeed : t.pageY - r.overflowOffset.top < u.scrollSensitivity && (e.scrollTop = o = e.scrollTop - u.scrollSpeed)), u.axis && u.axis === "y" || (r.overflowOffset.left + e.offsetWidth - t.pageX < u.scrollSensitivity ? e.scrollLeft = o = e.scrollLeft + u.scrollSpeed : t.pageX - r.overflowOffset.left < u.scrollSensitivity && (e.scrollLeft = o = e.scrollLeft - u.scrollSpeed))) : (u.axis && u.axis === "x" || (t.pageY - n(f).scrollTop() < u.scrollSensitivity ? o = n(f).scrollTop(n(f).scrollTop() - u.scrollSpeed) : n(window).height() - (t.pageY - n(f).scrollTop()) < u.scrollSensitivity && (o = n(f).scrollTop(n(f).scrollTop() + u.scrollSpeed))), u.axis && u.axis === "y" || (t.pageX - n(f).scrollLeft() < u.scrollSensitivity ? o = n(f).scrollLeft(n(f).scrollLeft() - u.scrollSpeed) : n(window).width() - (t.pageX - n(f).scrollLeft()) < u.scrollSensitivity && (o = n(f).scrollLeft(n(f).scrollLeft() + u.scrollSpeed)))); o !== !1 && n.ui.ddmanager && !u.dropBehaviour && n.ui.ddmanager.prepareOffsets(r, t) } }), n.ui.plugin.add("draggable", "snap", { start: function (t, i, r) { var u = r.options; r.snapElements = []; n(u.snap.constructor !== String ? u.snap.items || ":data(ui-draggable)" : u.snap).each(function () { var t = n(this), i = t.offset(); this !== r.element[0] && r.snapElements.push({ item: this, width: t.outerWidth(), height: t.outerHeight(), top: i.top, left: i.left }) }) }, drag: function (t, i, r) { for (var e, o, s, h, c, a, l, v, w, b = r.options, f = b.snapTolerance, y = i.offset.left, k = y + r.helperProportions.width, p = i.offset.top, d = p + r.helperProportions.height, u = r.snapElements.length - 1; u >= 0; u--) { if (c = r.snapElements[u].left - r.margins.left, a = c + r.snapElements[u].width, l = r.snapElements[u].top - r.margins.top, v = l + r.snapElements[u].height, k < c - f || y > a + f || d < l - f || p > v + f || !n.contains(r.snapElements[u].item.ownerDocument, r.snapElements[u].item)) { r.snapElements[u].snapping && r.options.snap.release && r.options.snap.release.call(r.element, t, n.extend(r._uiHash(), { snapItem: r.snapElements[u].item })); r.snapElements[u].snapping = !1; continue } b.snapMode !== "inner" && (e = Math.abs(l - d) <= f, o = Math.abs(v - p) <= f, s = Math.abs(c - k) <= f, h = Math.abs(a - y) <= f, e && (i.position.top = r._convertPositionTo("relative", { top: l - r.helperProportions.height, left: 0 }).top), o && (i.position.top = r._convertPositionTo("relative", { top: v, left: 0 }).top), s && (i.position.left = r._convertPositionTo("relative", { top: 0, left: c - r.helperProportions.width }).left), h && (i.position.left = r._convertPositionTo("relative", { top: 0, left: a }).left)); w = e || o || s || h; b.snapMode !== "outer" && (e = Math.abs(l - p) <= f, o = Math.abs(v - d) <= f, s = Math.abs(c - y) <= f, h = Math.abs(a - k) <= f, e && (i.position.top = r._convertPositionTo("relative", { top: l, left: 0 }).top), o && (i.position.top = r._convertPositionTo("relative", { top: v - r.helperProportions.height, left: 0 }).top), s && (i.position.left = r._convertPositionTo("relative", { top: 0, left: c }).left), h && (i.position.left = r._convertPositionTo("relative", { top: 0, left: a - r.helperProportions.width }).left)); !r.snapElements[u].snapping && (e || o || s || h || w) && r.options.snap.snap && r.options.snap.snap.call(r.element, t, n.extend(r._uiHash(), { snapItem: r.snapElements[u].item })); r.snapElements[u].snapping = e || o || s || h || w } } }), n.ui.plugin.add("draggable", "stack", { start: function (t, i, r) { var f, e = r.options, u = n.makeArray(n(e.stack)).sort(function (t, i) { return (parseInt(n(t).css("zIndex"), 10) || 0) - (parseInt(n(i).css("zIndex"), 10) || 0) }); u.length && (f = parseInt(n(u[0]).css("zIndex"), 10) || 0, n(u).each(function (t) { n(this).css("zIndex", f + t) }), this.css("zIndex", f + u.length)) } }), n.ui.plugin.add("draggable", "zIndex", { start: function (t, i, r) { var u = n(i.helper), f = r.options; u.css("zIndex") && (f._zIndex = u.css("zIndex")); u.css("zIndex", f.zIndex) }, stop: function (t, i, r) { var u = r.options; u._zIndex && n(i.helper).css("zIndex", u._zIndex) } }), n.ui.draggable });
/*!
 * jQuery UI Mouse 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/mouse/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/mouse",["jquery", "./widget"], n) : n(jQuery) })(function (n) { var t = !1; return n(document).mouseup(function () { t = !1 }), n.widget("ui.mouse", { version: "1.11.4", options: { cancel: "input,textarea,button,select,option", distance: 1, delay: 0 }, _mouseInit: function () { var t = this; this.element.bind("mousedown." + this.widgetName, function (n) { return t._mouseDown(n) }).bind("click." + this.widgetName, function (i) { if (!0 === n.data(i.target, t.widgetName + ".preventClickEvent")) return n.removeData(i.target, t.widgetName + ".preventClickEvent"), i.stopImmediatePropagation(), !1 }); this.started = !1 }, _mouseDestroy: function () { this.element.unbind("." + this.widgetName); this._mouseMoveDelegate && this.document.unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate) }, _mouseDown: function (i) { if (!t) { this._mouseMoved = !1; this._mouseStarted && this._mouseUp(i); this._mouseDownEvent = i; var r = this, u = i.which === 1, f = typeof this.options.cancel == "string" && i.target.nodeName ? n(i.target).closest(this.options.cancel).length : !1; return !u || f || !this._mouseCapture(i) ? !0 : (this.mouseDelayMet = !this.options.delay, this.mouseDelayMet || (this._mouseDelayTimer = setTimeout(function () { r.mouseDelayMet = !0 }, this.options.delay)), this._mouseDistanceMet(i) && this._mouseDelayMet(i) && (this._mouseStarted = this._mouseStart(i) !== !1, !this._mouseStarted)) ? (i.preventDefault(), !0) : (!0 === n.data(i.target, this.widgetName + ".preventClickEvent") && n.removeData(i.target, this.widgetName + ".preventClickEvent"), this._mouseMoveDelegate = function (n) { return r._mouseMove(n) }, this._mouseUpDelegate = function (n) { return r._mouseUp(n) }, this.document.bind("mousemove." + this.widgetName, this._mouseMoveDelegate).bind("mouseup." + this.widgetName, this._mouseUpDelegate), i.preventDefault(), t = !0, !0) } }, _mouseMove: function (t) { return this._mouseMoved && (n.ui.ie && (!document.documentMode || document.documentMode < 9) && !t.button || !t.which) ? this._mouseUp(t) : ((t.which || t.button) && (this._mouseMoved = !0), this._mouseStarted) ? (this._mouseDrag(t), t.preventDefault()) : (this._mouseDistanceMet(t) && this._mouseDelayMet(t) && (this._mouseStarted = this._mouseStart(this._mouseDownEvent, t) !== !1, this._mouseStarted ? this._mouseDrag(t) : this._mouseUp(t)), !this._mouseStarted) }, _mouseUp: function (i) { return this.document.unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate), this._mouseStarted && (this._mouseStarted = !1, i.target === this._mouseDownEvent.target && n.data(i.target, this.widgetName + ".preventClickEvent", !0), this._mouseStop(i)), t = !1, !1 }, _mouseDistanceMet: function (n) { return Math.max(Math.abs(this._mouseDownEvent.pageX - n.pageX), Math.abs(this._mouseDownEvent.pageY - n.pageY)) >= this.options.distance }, _mouseDelayMet: function () { return this.mouseDelayMet }, _mouseStart: function () { }, _mouseDrag: function () { }, _mouseStop: function () { }, _mouseCapture: function () { return !0 } }) });
/*!
 * jQuery UI Position 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/position/
 */
(function(n){typeof define=="function"&&define.amd?define("jQueryUI/position",["jquery"],n):n(jQuery)})(function(n){return function(){function a(n,t,i){return[parseFloat(n[0])*(l.test(n[0])?t/100:1),parseFloat(n[1])*(l.test(n[1])?i/100:1)]}function r(t,i){return parseInt(n.css(t,i),10)||0}function y(t){var i=t[0];return i.nodeType===9?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:n.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}n.ui=n.ui||{};var u,f,i=Math.max,t=Math.abs,e=Math.round,o=/left|center|right/,s=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,l=/%$/,v=n.fn.position;n.position={scrollbarWidth:function(){if(u!==undefined)return u;var r,i,t=n("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'><\/div><\/div>"),f=t.children()[0];return n("body").append(t),r=f.offsetWidth,t.css("overflow","scroll"),i=f.offsetWidth,r===i&&(i=t[0].clientWidth),t.remove(),u=r-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),r=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),u=i==="scroll"||i==="auto"&&t.width<t.element[0].scrollWidth,f=r==="scroll"||r==="auto"&&t.height<t.element[0].scrollHeight;return{width:f?n.position.scrollbarWidth():0,height:u?n.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=n(t||window),r=n.isWindow(i[0]),u=!!i[0]&&i[0].nodeType===9;return{element:i,isWindow:r,isDocument:u,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:r||u?i.width():i.outerWidth(),height:r||u?i.height():i.outerHeight()}}};n.fn.position=function(u){if(!u||!u.of)return v.apply(this,arguments);u=n.extend({},u);var k,l,p,b,w,g,nt=n(u.of),it=n.position.getWithinInfo(u.within),rt=n.position.getScrollInfo(it),d=(u.collision||"flip").split(" "),tt={};return g=y(nt),nt[0].preventDefault&&(u.at="left top"),l=g.width,p=g.height,b=g.offset,w=n.extend({},b),n.each(["my","at"],function(){var n=(u[this]||"").split(" "),t,i;n.length===1&&(n=o.test(n[0])?n.concat(["center"]):s.test(n[0])?["center"].concat(n):["center","center"]);n[0]=o.test(n[0])?n[0]:"center";n[1]=s.test(n[1])?n[1]:"center";t=h.exec(n[0]);i=h.exec(n[1]);tt[this]=[t?t[0]:0,i?i[0]:0];u[this]=[c.exec(n[0])[0],c.exec(n[1])[0]]}),d.length===1&&(d[1]=d[0]),u.at[0]==="right"?w.left+=l:u.at[0]==="center"&&(w.left+=l/2),u.at[1]==="bottom"?w.top+=p:u.at[1]==="center"&&(w.top+=p/2),k=a(tt.at,l,p),w.left+=k[0],w.top+=k[1],this.each(function(){var y,g,s=n(this),h=s.outerWidth(),c=s.outerHeight(),ut=r(this,"marginLeft"),ft=r(this,"marginTop"),et=h+ut+r(this,"marginRight")+rt.width,ot=c+ft+r(this,"marginBottom")+rt.height,o=n.extend({},w),v=a(tt.my,s.outerWidth(),s.outerHeight());u.my[0]==="right"?o.left-=h:u.my[0]==="center"&&(o.left-=h/2);u.my[1]==="bottom"?o.top-=c:u.my[1]==="center"&&(o.top-=c/2);o.left+=v[0];o.top+=v[1];f||(o.left=e(o.left),o.top=e(o.top));y={marginLeft:ut,marginTop:ft};n.each(["left","top"],function(t,i){n.ui.position[d[t]]&&n.ui.position[d[t]][i](o,{targetWidth:l,targetHeight:p,elemWidth:h,elemHeight:c,collisionPosition:y,collisionWidth:et,collisionHeight:ot,offset:[k[0]+v[0],k[1]+v[1]],my:u.my,at:u.at,within:it,elem:s})});u.using&&(g=function(n){var r=b.left-o.left,a=r+l-h,f=b.top-o.top,v=f+p-c,e={target:{element:nt,left:b.left,top:b.top,width:l,height:p},element:{element:s,left:o.left,top:o.top,width:h,height:c},horizontal:a<0?"left":r>0?"right":"center",vertical:v<0?"top":f>0?"bottom":"middle"};l<h&&t(r+a)<l&&(e.horizontal="center");p<c&&t(f+v)<p&&(e.vertical="middle");e.important=i(t(r),t(a))>i(t(f),t(v))?"horizontal":"vertical";u.using.call(this,n,e)});s.offset(n.extend(o,{using:g}))})};n.ui.position={fit:{left:function(n,t){var e=t.within,u=e.isWindow?e.scrollLeft:e.offset.left,o=e.width,s=n.left-t.collisionPosition.marginLeft,r=u-s,f=s+t.collisionWidth-o-u,h;t.collisionWidth>o?r>0&&f<=0?(h=n.left+r+t.collisionWidth-o-u,n.left+=r-h):n.left=f>0&&r<=0?u:r>f?u+o-t.collisionWidth:u:r>0?n.left+=r:f>0?n.left-=f:n.left=i(n.left-s,n.left)},top:function(n,t){var o=t.within,u=o.isWindow?o.scrollTop:o.offset.top,e=t.within.height,s=n.top-t.collisionPosition.marginTop,r=u-s,f=s+t.collisionHeight-e-u,h;t.collisionHeight>e?r>0&&f<=0?(h=n.top+r+t.collisionHeight-e-u,n.top+=r-h):n.top=f>0&&r<=0?u:r>f?u+e-t.collisionHeight:u:r>0?n.top+=r:f>0?n.top-=f:n.top=i(n.top-s,n.top)}},flip:{left:function(n,i){var r=i.within,y=r.offset.left+r.scrollLeft,c=r.width,o=r.isWindow?r.scrollLeft:r.offset.left,l=n.left-i.collisionPosition.marginLeft,a=l-o,v=l+i.collisionWidth-c-o,u=i.my[0]==="left"?-i.elemWidth:i.my[0]==="right"?i.elemWidth:0,f=i.at[0]==="left"?i.targetWidth:i.at[0]==="right"?-i.targetWidth:0,e=-2*i.offset[0],s,h;a<0?(s=n.left+u+f+e+i.collisionWidth-c-y,(s<0||s<t(a))&&(n.left+=u+f+e)):v>0&&(h=n.left-i.collisionPosition.marginLeft+u+f+e-o,(h>0||t(h)<v)&&(n.left+=u+f+e))},top:function(n,i){var r=i.within,y=r.offset.top+r.scrollTop,c=r.height,o=r.isWindow?r.scrollTop:r.offset.top,l=n.top-i.collisionPosition.marginTop,a=l-o,v=l+i.collisionHeight-c-o,p=i.my[1]==="top",u=p?-i.elemHeight:i.my[1]==="bottom"?i.elemHeight:0,f=i.at[1]==="top"?i.targetHeight:i.at[1]==="bottom"?-i.targetHeight:0,e=-2*i.offset[1],s,h;a<0?(h=n.top+u+f+e+i.collisionHeight-c-y,(h<0||h<t(a))&&(n.top+=u+f+e)):v>0&&(s=n.top-i.collisionPosition.marginTop+u+f+e-o,(s>0||t(s)<v)&&(n.top+=u+f+e))}},flipfit:{left:function(){n.ui.position.flip.left.apply(this,arguments);n.ui.position.fit.left.apply(this,arguments)},top:function(){n.ui.position.flip.top.apply(this,arguments);n.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,r,u,e,o=document.getElementsByTagName("body")[0],s=document.createElement("div");t=document.createElement(o?"div":"body");r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};o&&n.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(e in r)t.style[e]=r[e];t.appendChild(s);i=o||document.documentElement;i.insertBefore(t,i.firstChild);s.style.cssText="position: absolute; left: 10.7432222px;";u=n(s).offset().left;f=u>10&&u<11;t.innerHTML="";i.removeChild(t)}()}(),n.ui.position});
/*!
 * jQuery UI Resizable 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/resizable/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/resizable",["jquery", "./core", "./mouse", "./widget"], n) : n(jQuery) })(function (n) { return n.widget("ui.resizable", n.ui.mouse, { version: "1.11.4", widgetEventPrefix: "resize", options: { alsoResize: !1, animate: !1, animateDuration: "slow", animateEasing: "swing", aspectRatio: !1, autoHide: !1, containment: !1, ghost: !1, grid: !1, handles: "e,s,se", helper: !1, maxHeight: null, maxWidth: null, minHeight: 10, minWidth: 10, zIndex: 90, resize: null, start: null, stop: null }, _num: function (n) { return parseInt(n, 10) || 0 }, _isNumber: function (n) { return !isNaN(parseInt(n, 10)) }, _hasScroll: function (t, i) { if (n(t).css("overflow") === "hidden") return !1; var r = i && i === "left" ? "scrollLeft" : "scrollTop", u = !1; return t[r] > 0 ? !0 : (t[r] = 1, u = t[r] > 0, t[r] = 0, u) }, _create: function () { var e, f, u, i, o, r = this, t = this.options; if (this.element.addClass("ui-resizable"), n.extend(this, { _aspectRatio: !!t.aspectRatio, aspectRatio: t.aspectRatio, originalElement: this.element, _proportionallyResizeElements: [], _helper: t.helper || t.ghost || t.animate ? t.helper || "ui-resizable-helper" : null }), this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i) && (this.element.wrap(n("<div class='ui-wrapper' style='overflow: hidden;'><\/div>").css({ position: this.element.css("position"), width: this.element.outerWidth(), height: this.element.outerHeight(), top: this.element.css("top"), left: this.element.css("left") })), this.element = this.element.parent().data("ui-resizable", this.element.resizable("instance")), this.elementIsWrapper = !0, this.element.css({ marginLeft: this.originalElement.css("marginLeft"), marginTop: this.originalElement.css("marginTop"), marginRight: this.originalElement.css("marginRight"), marginBottom: this.originalElement.css("marginBottom") }), this.originalElement.css({ marginLeft: 0, marginTop: 0, marginRight: 0, marginBottom: 0 }), this.originalResizeStyle = this.originalElement.css("resize"), this.originalElement.css("resize", "none"), this._proportionallyResizeElements.push(this.originalElement.css({ position: "static", zoom: 1, display: "block" })), this.originalElement.css({ margin: this.originalElement.css("margin") }), this._proportionallyResize()), this.handles = t.handles || (n(".ui-resizable-handle", this.element).length ? { n: ".ui-resizable-n", e: ".ui-resizable-e", s: ".ui-resizable-s", w: ".ui-resizable-w", se: ".ui-resizable-se", sw: ".ui-resizable-sw", ne: ".ui-resizable-ne", nw: ".ui-resizable-nw" } : "e,s,se"), this._handles = n(), this.handles.constructor === String) for (this.handles === "all" && (this.handles = "n,e,s,w,se,sw,ne,nw"), e = this.handles.split(","), this.handles = {}, f = 0; f < e.length; f++) u = n.trim(e[f]), o = "ui-resizable-" + u, i = n("<div class='ui-resizable-handle " + o + "'><\/div>"), i.css({ zIndex: t.zIndex }), "se" === u && i.addClass("ui-icon ui-icon-gripsmall-diagonal-se"), this.handles[u] = ".ui-resizable-" + u, this.element.append(i); this._renderAxis = function (t) { var i, u, f, e; t = t || this.element; for (i in this.handles) this.handles[i].constructor === String ? this.handles[i] = this.element.children(this.handles[i]).first().show() : (this.handles[i].jquery || this.handles[i].nodeType) && (this.handles[i] = n(this.handles[i]), this._on(this.handles[i], { mousedown: r._mouseDown })), this.elementIsWrapper && this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i) && (u = n(this.handles[i], this.element), e = /sw|ne|nw|se|n|s/.test(i) ? u.outerHeight() : u.outerWidth(), f = ["padding", /ne|nw|n/.test(i) ? "Top" : /se|sw|s/.test(i) ? "Bottom" : /^e$/.test(i) ? "Right" : "Left"].join(""), t.css(f, e), this._proportionallyResize()), this._handles = this._handles.add(this.handles[i]) }; this._renderAxis(this.element); this._handles = this._handles.add(this.element.find(".ui-resizable-handle")); this._handles.disableSelection(); this._handles.mouseover(function () { r.resizing || (this.className && (i = this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)), r.axis = i && i[1] ? i[1] : "se") }); t.autoHide && (this._handles.hide(), n(this.element).addClass("ui-resizable-autohide").mouseenter(function () { t.disabled || (n(this).removeClass("ui-resizable-autohide"), r._handles.show()) }).mouseleave(function () { t.disabled || r.resizing || (n(this).addClass("ui-resizable-autohide"), r._handles.hide()) })); this._mouseInit() }, _destroy: function () { this._mouseDestroy(); var t, i = function (t) { n(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove() }; return this.elementIsWrapper && (i(this.element), t = this.element, this.originalElement.css({ position: t.css("position"), width: t.outerWidth(), height: t.outerHeight(), top: t.css("top"), left: t.css("left") }).insertAfter(t), t.remove()), this.originalElement.css("resize", this.originalResizeStyle), i(this.originalElement), this }, _mouseCapture: function (t) { var r, i, u = !1; for (r in this.handles) i = n(this.handles[r])[0], (i === t.target || n.contains(i, t.target)) && (u = !0); return !this.options.disabled && u }, _mouseStart: function (t) { var u, f, e, r = this.options, i = this.element; return this.resizing = !0, this._renderProxy(), u = this._num(this.helper.css("left")), f = this._num(this.helper.css("top")), r.containment && (u += n(r.containment).scrollLeft() || 0, f += n(r.containment).scrollTop() || 0), this.offset = this.helper.offset(), this.position = { left: u, top: f }, this.size = this._helper ? { width: this.helper.width(), height: this.helper.height() } : { width: i.width(), height: i.height() }, this.originalSize = this._helper ? { width: i.outerWidth(), height: i.outerHeight() } : { width: i.width(), height: i.height() }, this.sizeDiff = { width: i.outerWidth() - i.width(), height: i.outerHeight() - i.height() }, this.originalPosition = { left: u, top: f }, this.originalMousePosition = { left: t.pageX, top: t.pageY }, this.aspectRatio = typeof r.aspectRatio == "number" ? r.aspectRatio : this.originalSize.width / this.originalSize.height || 1, e = n(".ui-resizable-" + this.axis).css("cursor"), n("body").css("cursor", e === "auto" ? this.axis + "-resize" : e), i.addClass("ui-resizable-resizing"), this._propagate("start", t), !0 }, _mouseDrag: function (t) { var i, r, u = this.originalMousePosition, e = this.axis, o = t.pageX - u.left || 0, s = t.pageY - u.top || 0, f = this._change[e]; return (this._updatePrevProperties(), !f) ? !1 : (i = f.apply(this, [t, o, s]), this._updateVirtualBoundaries(t.shiftKey), (this._aspectRatio || t.shiftKey) && (i = this._updateRatio(i, t)), i = this._respectSize(i, t), this._updateCache(i), this._propagate("resize", t), r = this._applyChanges(), !this._helper && this._proportionallyResizeElements.length && this._proportionallyResize(), n.isEmptyObject(r) || (this._updatePrevProperties(), this._trigger("resize", t, this.ui()), this._applyChanges()), !1) }, _mouseStop: function (t) { this.resizing = !1; var r, u, f, e, o, s, h, c = this.options, i = this; return this._helper && (r = this._proportionallyResizeElements, u = r.length && /textarea/i.test(r[0].nodeName), f = u && this._hasScroll(r[0], "left") ? 0 : i.sizeDiff.height, e = u ? 0 : i.sizeDiff.width, o = { width: i.helper.width() - e, height: i.helper.height() - f }, s = parseInt(i.element.css("left"), 10) + (i.position.left - i.originalPosition.left) || null, h = parseInt(i.element.css("top"), 10) + (i.position.top - i.originalPosition.top) || null, c.animate || this.element.css(n.extend(o, { top: h, left: s })), i.helper.height(i.size.height), i.helper.width(i.size.width), this._helper && !c.animate && this._proportionallyResize()), n("body").css("cursor", "auto"), this.element.removeClass("ui-resizable-resizing"), this._propagate("stop", t), this._helper && this.helper.remove(), !1 }, _updatePrevProperties: function () { this.prevPosition = { top: this.position.top, left: this.position.left }; this.prevSize = { width: this.size.width, height: this.size.height } }, _applyChanges: function () { var n = {}; return this.position.top !== this.prevPosition.top && (n.top = this.position.top + "px"), this.position.left !== this.prevPosition.left && (n.left = this.position.left + "px"), this.size.width !== this.prevSize.width && (n.width = this.size.width + "px"), this.size.height !== this.prevSize.height && (n.height = this.size.height + "px"), this.helper.css(n), n }, _updateVirtualBoundaries: function (n) { var r, u, f, e, t, i = this.options; t = { minWidth: this._isNumber(i.minWidth) ? i.minWidth : 0, maxWidth: this._isNumber(i.maxWidth) ? i.maxWidth : Infinity, minHeight: this._isNumber(i.minHeight) ? i.minHeight : 0, maxHeight: this._isNumber(i.maxHeight) ? i.maxHeight : Infinity }; (this._aspectRatio || n) && (r = t.minHeight * this.aspectRatio, f = t.minWidth / this.aspectRatio, u = t.maxHeight * this.aspectRatio, e = t.maxWidth / this.aspectRatio, r > t.minWidth && (t.minWidth = r), f > t.minHeight && (t.minHeight = f), u < t.maxWidth && (t.maxWidth = u), e < t.maxHeight && (t.maxHeight = e)); this._vBoundaries = t }, _updateCache: function (n) { this.offset = this.helper.offset(); this._isNumber(n.left) && (this.position.left = n.left); this._isNumber(n.top) && (this.position.top = n.top); this._isNumber(n.height) && (this.size.height = n.height); this._isNumber(n.width) && (this.size.width = n.width) }, _updateRatio: function (n) { var t = this.position, i = this.size, r = this.axis; return this._isNumber(n.height) ? n.width = n.height * this.aspectRatio : this._isNumber(n.width) && (n.height = n.width / this.aspectRatio), r === "sw" && (n.left = t.left + (i.width - n.width), n.top = null), r === "nw" && (n.top = t.top + (i.height - n.height), n.left = t.left + (i.width - n.width)), n }, _respectSize: function (n) { var t = this._vBoundaries, i = this.axis, r = this._isNumber(n.width) && t.maxWidth && t.maxWidth < n.width, u = this._isNumber(n.height) && t.maxHeight && t.maxHeight < n.height, f = this._isNumber(n.width) && t.minWidth && t.minWidth > n.width, e = this._isNumber(n.height) && t.minHeight && t.minHeight > n.height, o = this.originalPosition.left + this.originalSize.width, s = this.position.top + this.size.height, h = /sw|nw|w/.test(i), c = /nw|ne|n/.test(i); return f && (n.width = t.minWidth), e && (n.height = t.minHeight), r && (n.width = t.maxWidth), u && (n.height = t.maxHeight), f && h && (n.left = o - t.minWidth), r && h && (n.left = o - t.maxWidth), e && c && (n.top = s - t.minHeight), u && c && (n.top = s - t.maxHeight), n.width || n.height || n.left || !n.top ? n.width || n.height || n.top || !n.left || (n.left = null) : n.top = null, n }, _getPaddingPlusBorderDimensions: function (n) { for (var t = 0, i = [], r = [n.css("borderTopWidth"), n.css("borderRightWidth"), n.css("borderBottomWidth"), n.css("borderLeftWidth")], u = [n.css("paddingTop"), n.css("paddingRight"), n.css("paddingBottom"), n.css("paddingLeft")]; t < 4; t++) i[t] = parseInt(r[t], 10) || 0, i[t] += parseInt(u[t], 10) || 0; return { height: i[0] + i[2], width: i[1] + i[3] } }, _proportionallyResize: function () { if (this._proportionallyResizeElements.length) for (var n, t = 0, i = this.helper || this.element; t < this._proportionallyResizeElements.length; t++) n = this._proportionallyResizeElements[t], this.outerDimensions || (this.outerDimensions = this._getPaddingPlusBorderDimensions(n)), n.css({ height: i.height() - this.outerDimensions.height || 0, width: i.width() - this.outerDimensions.width || 0 }) }, _renderProxy: function () { var t = this.element, i = this.options; this.elementOffset = t.offset(); this._helper ? (this.helper = this.helper || n("<div style='overflow:hidden;'><\/div>"), this.helper.addClass(this._helper).css({ width: this.element.outerWidth() - 1, height: this.element.outerHeight() - 1, position: "absolute", left: this.elementOffset.left + "px", top: this.elementOffset.top + "px", zIndex: ++i.zIndex }), this.helper.appendTo("body").disableSelection()) : this.helper = this.element }, _change: { e: function (n, t) { return { width: this.originalSize.width + t } }, w: function (n, t) { var i = this.originalSize, r = this.originalPosition; return { left: r.left + t, width: i.width - t } }, n: function (n, t, i) { var r = this.originalSize, u = this.originalPosition; return { top: u.top + i, height: r.height - i } }, s: function (n, t, i) { return { height: this.originalSize.height + i } }, se: function (t, i, r) { return n.extend(this._change.s.apply(this, arguments), this._change.e.apply(this, [t, i, r])) }, sw: function (t, i, r) { return n.extend(this._change.s.apply(this, arguments), this._change.w.apply(this, [t, i, r])) }, ne: function (t, i, r) { return n.extend(this._change.n.apply(this, arguments), this._change.e.apply(this, [t, i, r])) }, nw: function (t, i, r) { return n.extend(this._change.n.apply(this, arguments), this._change.w.apply(this, [t, i, r])) } }, _propagate: function (t, i) { n.ui.plugin.call(this, t, [i, this.ui()]); t !== "resize" && this._trigger(t, i, this.ui()) }, plugins: {}, ui: function () { return { originalElement: this.originalElement, element: this.element, helper: this.helper, position: this.position, size: this.size, originalSize: this.originalSize, originalPosition: this.originalPosition } } }), n.ui.plugin.add("resizable", "animate", { stop: function (t) { var i = n(this).resizable("instance"), u = i.options, r = i._proportionallyResizeElements, f = r.length && /textarea/i.test(r[0].nodeName), s = f && i._hasScroll(r[0], "left") ? 0 : i.sizeDiff.height, h = f ? 0 : i.sizeDiff.width, c = { width: i.size.width - h, height: i.size.height - s }, e = parseInt(i.element.css("left"), 10) + (i.position.left - i.originalPosition.left) || null, o = parseInt(i.element.css("top"), 10) + (i.position.top - i.originalPosition.top) || null; i.element.animate(n.extend(c, o && e ? { top: o, left: e } : {}), { duration: u.animateDuration, easing: u.animateEasing, step: function () { var u = { width: parseInt(i.element.css("width"), 10), height: parseInt(i.element.css("height"), 10), top: parseInt(i.element.css("top"), 10), left: parseInt(i.element.css("left"), 10) }; r && r.length && n(r[0]).css({ width: u.width, height: u.height }); i._updateCache(u); i._propagate("resize", t) } }) } }), n.ui.plugin.add("resizable", "containment", { start: function () { var r, f, e, o, s, h, c, t = n(this).resizable("instance"), l = t.options, a = t.element, u = l.containment, i = u instanceof n ? u.get(0) : /parent/.test(u) ? a.parent().get(0) : u; i && (t.containerElement = n(i), /document/.test(u) || u === document ? (t.containerOffset = { left: 0, top: 0 }, t.containerPosition = { left: 0, top: 0 }, t.parentData = { element: n(document), left: 0, top: 0, width: n(document).width(), height: n(document).height() || document.body.parentNode.scrollHeight }) : (r = n(i), f = [], n(["Top", "Right", "Left", "Bottom"]).each(function (n, i) { f[n] = t._num(r.css("padding" + i)) }), t.containerOffset = r.offset(), t.containerPosition = r.position(), t.containerSize = { height: r.innerHeight() - f[3], width: r.innerWidth() - f[1] }, e = t.containerOffset, o = t.containerSize.height, s = t.containerSize.width, h = t._hasScroll(i, "left") ? i.scrollWidth : s, c = t._hasScroll(i) ? i.scrollHeight : o, t.parentData = { element: i, left: e.left, top: e.top, width: h, height: c })) }, resize: function (t) { var o, s, h, c, i = n(this).resizable("instance"), v = i.options, r = i.containerOffset, l = i.position, f = i._aspectRatio || t.shiftKey, e = { top: 0, left: 0 }, a = i.containerElement, u = !0; a[0] !== document && /static/.test(a.css("position")) && (e = r); l.left < (i._helper ? r.left : 0) && (i.size.width = i.size.width + (i._helper ? i.position.left - r.left : i.position.left - e.left), f && (i.size.height = i.size.width / i.aspectRatio, u = !1), i.position.left = v.helper ? r.left : 0); l.top < (i._helper ? r.top : 0) && (i.size.height = i.size.height + (i._helper ? i.position.top - r.top : i.position.top), f && (i.size.width = i.size.height * i.aspectRatio, u = !1), i.position.top = i._helper ? r.top : 0); h = i.containerElement.get(0) === i.element.parent().get(0); c = /relative|absolute/.test(i.containerElement.css("position")); h && c ? (i.offset.left = i.parentData.left + i.position.left, i.offset.top = i.parentData.top + i.position.top) : (i.offset.left = i.element.offset().left, i.offset.top = i.element.offset().top); o = Math.abs(i.sizeDiff.width + (i._helper ? i.offset.left - e.left : i.offset.left - r.left)); s = Math.abs(i.sizeDiff.height + (i._helper ? i.offset.top - e.top : i.offset.top - r.top)); o + i.size.width >= i.parentData.width && (i.size.width = i.parentData.width - o, f && (i.size.height = i.size.width / i.aspectRatio, u = !1)); s + i.size.height >= i.parentData.height && (i.size.height = i.parentData.height - s, f && (i.size.width = i.size.height * i.aspectRatio, u = !1)); u || (i.position.left = i.prevPosition.left, i.position.top = i.prevPosition.top, i.size.width = i.prevSize.width, i.size.height = i.prevSize.height) }, stop: function () { var t = n(this).resizable("instance"), r = t.options, u = t.containerOffset, f = t.containerPosition, e = t.containerElement, i = n(t.helper), o = i.offset(), s = i.outerWidth() - t.sizeDiff.width, h = i.outerHeight() - t.sizeDiff.height; t._helper && !r.animate && /relative/.test(e.css("position")) && n(this).css({ left: o.left - f.left - u.left, width: s, height: h }); t._helper && !r.animate && /static/.test(e.css("position")) && n(this).css({ left: o.left - f.left - u.left, width: s, height: h }) } }), n.ui.plugin.add("resizable", "alsoResize", { start: function () { var t = n(this).resizable("instance"), i = t.options; n(i.alsoResize).each(function () { var t = n(this); t.data("ui-resizable-alsoresize", { width: parseInt(t.width(), 10), height: parseInt(t.height(), 10), left: parseInt(t.css("left"), 10), top: parseInt(t.css("top"), 10) }) }) }, resize: function (t, i) { var r = n(this).resizable("instance"), e = r.options, u = r.originalSize, f = r.originalPosition, o = { height: r.size.height - u.height || 0, width: r.size.width - u.width || 0, top: r.position.top - f.top || 0, left: r.position.left - f.left || 0 }; n(e.alsoResize).each(function () { var t = n(this), u = n(this).data("ui-resizable-alsoresize"), r = {}, f = t.parents(i.originalElement[0]).length ? ["width", "height"] : ["width", "height", "top", "left"]; n.each(f, function (n, t) { var i = (u[t] || 0) + (o[t] || 0); i && i >= 0 && (r[t] = i || null) }); t.css(r) }) }, stop: function () { n(this).removeData("resizable-alsoresize") } }), n.ui.plugin.add("resizable", "ghost", { start: function () { var t = n(this).resizable("instance"), i = t.options, r = t.size; t.ghost = t.originalElement.clone(); t.ghost.css({ opacity: .25, display: "block", position: "relative", height: r.height, width: r.width, margin: 0, left: 0, top: 0 }).addClass("ui-resizable-ghost").addClass(typeof i.ghost == "string" ? i.ghost : ""); t.ghost.appendTo(t.helper) }, resize: function () { var t = n(this).resizable("instance"); t.ghost && t.ghost.css({ position: "relative", height: t.size.height, width: t.size.width }) }, stop: function () { var t = n(this).resizable("instance"); t.ghost && t.helper && t.helper.get(0).removeChild(t.ghost.get(0)) } }), n.ui.plugin.add("resizable", "grid", { resize: function () { var h, t = n(this).resizable("instance"), i = t.options, y = t.size, o = t.originalSize, s = t.originalPosition, c = t.axis, l = typeof i.grid == "number" ? [i.grid, i.grid] : i.grid, f = l[0] || 1, e = l[1] || 1, a = Math.round((y.width - o.width) / f) * f, v = Math.round((y.height - o.height) / e) * e, r = o.width + a, u = o.height + v, p = i.maxWidth && i.maxWidth < r, w = i.maxHeight && i.maxHeight < u, b = i.minWidth && i.minWidth > r, k = i.minHeight && i.minHeight > u; i.grid = l; b && (r += f); k && (u += e); p && (r -= f); w && (u -= e); /^(se|s|e)$/.test(c) ? (t.size.width = r, t.size.height = u) : /^(ne)$/.test(c) ? (t.size.width = r, t.size.height = u, t.position.top = s.top - v) : /^(sw)$/.test(c) ? (t.size.width = r, t.size.height = u, t.position.left = s.left - a) : ((u - e <= 0 || r - f <= 0) && (h = t._getPaddingPlusBorderDimensions(this)), u - e > 0 ? (t.size.height = u, t.position.top = s.top - v) : (u = e - h.height, t.size.height = u, t.position.top = s.top + o.height - u), r - f > 0 ? (t.size.width = r, t.position.left = s.left - a) : (r = f - h.width, t.size.width = r, t.position.left = s.left + o.width - r)) } }), n.ui.resizable });
/*!
 * jQuery UI Dialog 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/dialog/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/dialog",["jquery", "./core", "./widget", "./button", "./draggable", "./mouse", "./position", "./resizable"], n) : n(jQuery) })(function (n) { return n.widget("ui.dialog", { version: "1.11.4", options: { appendTo: "body", autoOpen: !0, buttons: [], closeOnEscape: !0, closeText: "Close", dialogClass: "", draggable: !0, hide: null, height: "auto", maxHeight: null, maxWidth: null, minHeight: 150, minWidth: 150, modal: !1, position: { my: "center", at: "center", of: window, collision: "fit", using: function (t) { var i = n(this).css(t).offset().top; i < 0 && n(this).css("top", t.top - i) } }, resizable: !0, show: null, title: null, width: 300, beforeClose: null, close: null, drag: null, dragStart: null, dragStop: null, focus: null, open: null, resize: null, resizeStart: null, resizeStop: null }, sizeRelatedOptions: { buttons: !0, height: !0, maxHeight: !0, maxWidth: !0, minHeight: !0, minWidth: !0, width: !0 }, resizableRelatedOptions: { maxHeight: !0, maxWidth: !0, minHeight: !0, minWidth: !0 }, _create: function () { this.originalCss = { display: this.element[0].style.display, width: this.element[0].style.width, minHeight: this.element[0].style.minHeight, maxHeight: this.element[0].style.maxHeight, height: this.element[0].style.height }; this.originalPosition = { parent: this.element.parent(), index: this.element.parent().children().index(this.element) }; this.originalTitle = this.element.attr("title"); this.options.title = this.options.title || this.originalTitle; this._createWrapper(); this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog); this._createTitlebar(); this._createButtonPane(); this.options.draggable && n.fn.draggable && this._makeDraggable(); this.options.resizable && n.fn.resizable && this._makeResizable(); this._isOpen = !1; this._trackFocus() }, _init: function () { this.options.autoOpen && this.open() }, _appendTo: function () { var t = this.options.appendTo; return t && (t.jquery || t.nodeType) ? n(t) : this.document.find(t || "body").eq(0) }, _destroy: function () { var n, t = this.originalPosition; this._untrackInstance(); this._destroyOverlay(); this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(); this.uiDialog.stop(!0, !0).remove(); this.originalTitle && this.element.attr("title", this.originalTitle); n = t.parent.children().eq(t.index); n.length && n[0] !== this.element[0] ? n.before(this.element) : t.parent.append(this.element) }, widget: function () { return this.uiDialog }, disable: n.noop, enable: n.noop, close: function (t) { var i, r = this; if (this._isOpen && this._trigger("beforeClose", t) !== !1) { if (this._isOpen = !1, this._focusedElement = null, this._destroyOverlay(), this._untrackInstance(), !this.opener.filter(":focusable").focus().length) try { i = this.document[0].activeElement; i && i.nodeName.toLowerCase() !== "body" && n(i).blur() } catch (u) { } this._hide(this.uiDialog, this.options.hide, function () { r._trigger("close", t) }) } }, isOpen: function () { return this._isOpen }, moveToTop: function () { this._moveToTop() }, _moveToTop: function (t, i) { var r = !1, f = this.uiDialog.siblings(".ui-front:visible").map(function () { return +n(this).css("z-index") }).get(), u = Math.max.apply(null, f); return u >= +this.uiDialog.css("z-index") && (this.uiDialog.css("z-index", u + 1), r = !0), r && !i && this._trigger("focus", t), r }, open: function () { var t = this; if (this._isOpen) { this._moveToTop() && this._focusTabbable(); return } this._isOpen = !0; this.opener = n(this.document[0].activeElement); this._size(); this._position(); this._createOverlay(); this._moveToTop(null, !0); this.overlay && this.overlay.css("z-index", this.uiDialog.css("z-index") - 1); this._show(this.uiDialog, this.options.show, function () { t._focusTabbable(); t._trigger("focus") }); this._makeFocusTarget(); this._trigger("open") }, _focusTabbable: function () { var n = this._focusedElement; n || (n = this.element.find("[autofocus]")); n.length || (n = this.element.find(":tabbable")); n.length || (n = this.uiDialogButtonPane.find(":tabbable")); n.length || (n = this.uiDialogTitlebarClose.filter(":tabbable")); n.length || (n = this.uiDialog); n.eq(0).focus() }, _keepFocus: function (t) { function i() { var t = this.document[0].activeElement, i = this.uiDialog[0] === t || n.contains(this.uiDialog[0], t); i || this._focusTabbable() } t.preventDefault(); i.call(this); this._delay(i) }, _createWrapper: function () { this.uiDialog = n("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front " + this.options.dialogClass).hide().attr({ tabIndex: -1, role: "dialog" }).appendTo(this._appendTo()); this._on(this.uiDialog, { keydown: function (t) { if (this.options.closeOnEscape && !t.isDefaultPrevented() && t.keyCode && t.keyCode === n.ui.keyCode.ESCAPE) { t.preventDefault(); this.close(t); return } if (t.keyCode === n.ui.keyCode.TAB && !t.isDefaultPrevented()) { var i = this.uiDialog.find(":tabbable"), r = i.filter(":first"), u = i.filter(":last"); t.target !== u[0] && t.target !== this.uiDialog[0] || t.shiftKey ? (t.target === r[0] || t.target === this.uiDialog[0]) && t.shiftKey && (this._delay(function () { u.focus() }), t.preventDefault()) : (this._delay(function () { r.focus() }), t.preventDefault()) } }, mousedown: function (n) { this._moveToTop(n) && this._focusTabbable() } }); this.element.find("[aria-describedby]").length || this.uiDialog.attr({ "aria-describedby": this.element.uniqueId().attr("id") }) }, _createTitlebar: function () { var t; this.uiDialogTitlebar = n("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog); this._on(this.uiDialogTitlebar, { mousedown: function (t) { n(t.target).closest(".ui-dialog-titlebar-close") || this.uiDialog.focus() } }); this.uiDialogTitlebarClose = n("<button type='button'><\/button>").button({ label: this.options.closeText, icons: { primary: "ui-icon-closethick" }, text: !1 }).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar); this._on(this.uiDialogTitlebarClose, { click: function (n) { n.preventDefault(); this.close(n) } }); t = n("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar); this._title(t); this.uiDialog.attr({ "aria-labelledby": t.attr("id") }) }, _title: function (n) { this.options.title || n.html("&#160;"); n.text(this.options.title) }, _createButtonPane: function () { this.uiDialogButtonPane = n("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"); this.uiButtonSet = n("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane); this._createButtons() }, _createButtons: function () { var i = this, t = this.options.buttons; if (this.uiDialogButtonPane.remove(), this.uiButtonSet.empty(), n.isEmptyObject(t) || n.isArray(t) && !t.length) { this.uiDialog.removeClass("ui-dialog-buttons"); return } n.each(t, function (t, r) { var u, f; r = n.isFunction(r) ? { click: r, text: t } : r; r = n.extend({ type: "button" }, r); u = r.click; r.click = function () { u.apply(i.element[0], arguments) }; f = { icons: r.icons, text: r.showText }; delete r.icons; delete r.showText; n("<button><\/button>", r).button(f).appendTo(i.uiButtonSet) }); this.uiDialog.addClass("ui-dialog-buttons"); this.uiDialogButtonPane.appendTo(this.uiDialog) }, _makeDraggable: function () { function i(n) { return { position: n.position, offset: n.offset } } var t = this, r = this.options; this.uiDialog.draggable({ cancel: ".ui-dialog-content, .ui-dialog-titlebar-close", handle: ".ui-dialog-titlebar", containment: "document", start: function (r, u) { n(this).addClass("ui-dialog-dragging"); t._blockFrames(); t._trigger("dragStart", r, i(u)) }, drag: function (n, r) { t._trigger("drag", n, i(r)) }, stop: function (u, f) { var e = f.offset.left - t.document.scrollLeft(), o = f.offset.top - t.document.scrollTop(); r.position = { my: "left top", at: "left" + (e >= 0 ? "+" : "") + e + " top" + (o >= 0 ? "+" : "") + o, of: t.window }; n(this).removeClass("ui-dialog-dragging"); t._unblockFrames(); t._trigger("dragStop", u, i(f)) } }) }, _makeResizable: function () { function r(n) { return { originalPosition: n.originalPosition, originalSize: n.originalSize, position: n.position, size: n.size } } var t = this, i = this.options, u = i.resizable, f = this.uiDialog.css("position"), e = typeof u == "string" ? u : "n,e,s,w,se,sw,ne,nw"; this.uiDialog.resizable({ cancel: ".ui-dialog-content", containment: "document", alsoResize: this.element, maxWidth: i.maxWidth, maxHeight: i.maxHeight, minWidth: i.minWidth, minHeight: this._minHeight(), handles: e, start: function (i, u) { n(this).addClass("ui-dialog-resizing"); t._blockFrames(); t._trigger("resizeStart", i, r(u)) }, resize: function (n, i) { t._trigger("resize", n, r(i)) }, stop: function (u, f) { var e = t.uiDialog.offset(), o = e.left - t.document.scrollLeft(), s = e.top - t.document.scrollTop(); i.height = t.uiDialog.height(); i.width = t.uiDialog.width(); i.position = { my: "left top", at: "left" + (o >= 0 ? "+" : "") + o + " top" + (s >= 0 ? "+" : "") + s, of: t.window }; n(this).removeClass("ui-dialog-resizing"); t._unblockFrames(); t._trigger("resizeStop", u, r(f)) } }).css("position", f) }, _trackFocus: function () { this._on(this.widget(), { focusin: function (t) { this._makeFocusTarget(); this._focusedElement = n(t.target) } }) }, _makeFocusTarget: function () { this._untrackInstance(); this._trackingInstances().unshift(this) }, _untrackInstance: function () { var t = this._trackingInstances(), i = n.inArray(this, t); i !== -1 && t.splice(i, 1) }, _trackingInstances: function () { var n = this.document.data("ui-dialog-instances"); return n || (n = [], this.document.data("ui-dialog-instances", n)), n }, _minHeight: function () { var n = this.options; return n.height === "auto" ? n.minHeight : Math.min(n.minHeight, n.height) }, _position: function () { var n = this.uiDialog.is(":visible"); n || this.uiDialog.show(); this.uiDialog.position(this.options.position); n || this.uiDialog.hide() }, _setOptions: function (t) { var i = this, r = !1, u = {}; n.each(t, function (n, t) { i._setOption(n, t); n in i.sizeRelatedOptions && (r = !0); n in i.resizableRelatedOptions && (u[n] = t) }); r && (this._size(), this._position()); this.uiDialog.is(":data(ui-resizable)") && this.uiDialog.resizable("option", u) }, _setOption: function (n, t) { var u, r, i = this.uiDialog; (n === "dialogClass" && i.removeClass(this.options.dialogClass).addClass(t), n !== "disabled") && (this._super(n, t), n === "appendTo" && this.uiDialog.appendTo(this._appendTo()), n === "buttons" && this._createButtons(), n === "closeText" && this.uiDialogTitlebarClose.button({ label: "" + t }), n === "draggable" && (u = i.is(":data(ui-draggable)"), u && !t && i.draggable("destroy"), !u && t && this._makeDraggable()), n === "position" && this._position(), n === "resizable" && (r = i.is(":data(ui-resizable)"), r && !t && i.resizable("destroy"), r && typeof t == "string" && i.resizable("option", "handles", t), r || t === !1 || this._makeResizable()), n === "title" && this._title(this.uiDialogTitlebar.find(".ui-dialog-title"))) }, _size: function () { var t, i, r, n = this.options; this.element.show().css({ width: "auto", minHeight: 0, maxHeight: "none", height: 0 }); n.minWidth > n.width && (n.width = n.minWidth); t = this.uiDialog.css({ height: "auto", width: n.width }).outerHeight(); i = Math.max(0, n.minHeight - t); r = typeof n.maxHeight == "number" ? Math.max(0, n.maxHeight - t) : "none"; n.height === "auto" ? this.element.css({ minHeight: i, maxHeight: r, height: "auto" }) : this.element.height(Math.max(0, n.height - t)); this.uiDialog.is(":data(ui-resizable)") && this.uiDialog.resizable("option", "minHeight", this._minHeight()) }, _blockFrames: function () { this.iframeBlocks = this.document.find("iframe").map(function () { var t = n(this); return n("<div>").css({ position: "absolute", width: t.outerWidth(), height: t.outerHeight() }).appendTo(t.parent()).offset(t.offset())[0] }) }, _unblockFrames: function () { this.iframeBlocks && (this.iframeBlocks.remove(), delete this.iframeBlocks) }, _allowInteraction: function (t) { return n(t.target).closest(".ui-dialog").length ? !0 : !!n(t.target).closest(".ui-datepicker").length }, _createOverlay: function () { if (this.options.modal) { var t = !0; this._delay(function () { t = !1 }); this.document.data("ui-dialog-overlays") || this._on(this.document, { focusin: function (n) { t || this._allowInteraction(n) || (n.preventDefault(), this._trackingInstances()[0]._focusTabbable()) } }); this.overlay = n("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()); this._on(this.overlay, { mousedown: "_keepFocus" }); this.document.data("ui-dialog-overlays", (this.document.data("ui-dialog-overlays") || 0) + 1) } }, _destroyOverlay: function () { if (this.options.modal && this.overlay) { var n = this.document.data("ui-dialog-overlays") - 1; n ? this.document.data("ui-dialog-overlays", n) : this.document.unbind("focusin").removeData("ui-dialog-overlays"); this.overlay.remove(); this.overlay = null } } }) });
// Copyright (C) Microsoft Corporation. All rights reserved.
define("VSS/Controls/Dialogs",["require","exports","VSS/Controls","VSS/Diag","VSS/Events/Services","VSS/Controls/Panels","VSS/Resources/VSS.Resources.Platform","VSS/Utils/Core","VSS/Utils/String","VSS/Utils/UI","VSS/VSS","q","jQueryUI/core","jQueryUI/button","jQueryUI/dialog","VSS/LoaderPlugins/Css!VSS.Controls"],function(n,t,i,r,u,f,e,o,s,h,c,l){function g(n,t){t&&h.BrowserCheckUtils.isEdge()&&$.each(t,function(t,i){var r=i.click;r&&(i.click=function(t){t&&!$(t.currentTarget).is(":disabled")&&r.apply(n[0],arguments)})})}function nt(n,t){var r=t||"",i;return i=typeof n=="string"?n.split(" "):n,r.split(" ").concat(i).filter(function(n,t,i){return i.indexOf(n)===t}).join(" ")}function ut(n,t){return v.show(n,t)}function et(n,t){return y.showMessageDialog(n,t)}var a=o.delegate,ft=h.domElem,p,v,w,b,k,tt,it,d,y,rt;t.preventClickingDisabledButtons=g;p=function(n){function t(t){n.call(this,t);this._resizeDelegate=a(this,this._onWindowResize)}return __extends(t,n),t.beginExecuteDialogAction=function(n){v._dialogActionInProgress||(v._dialogActionInProgress=!0,n(function(){v._dialogActionInProgress=!1}))},t.create=function(n,t){var f=t&&t.content||$("<div />"),r,u;return t&&t.contentText&&f.text(t.contentText),r=i.Enhancement.enhance(n,f,t),u=this._getNextDialogZIndex(),r._element.parent().css("z-index",u),r._options.modal&&r._element.parent().next("div.ui-widget-overlay").css("z-index",u-1),r._element.parent().children("div.ui-icon-gripsmall-diagonal-se").addClass("ui-icon-grip-diagonal-se"),r},t._getNextDialogZIndex=function(){var t,n,i=0;return $("div.ui-dialog").each(function(){t=Number($(this).css("z-index"));!isNaN(t)&&t>i&&(i=t)}),i<1001?n=1002:(n=i+2,n%2!=0&&n++),n},t.show=function(n,t){return this.create(n,$.extend({autoOpen:!0},t))},t.prototype.initializeOptions=function(t){var i,r,u,f;this._options=this._options||{};n.prototype.initializeOptions.call(this,$.extend({coreCssClass:"dialog",widthPct:.8,heightPct:.8,modal:!0,draggable:!0,resizable:!0,autoOpen:!1,dynamicSize:!0,disposeOnClose:!0,closeText:e.CloseButtonLabelText},t));i=this._options;r=$(window);i.height==="auto"&&(i.height=null);i.minWidth=Math.max(240,parseInt(i.minWidth,10)||0);i.minHeight=Math.max(192,parseInt(i.minHeight,10)||0);this._ensureCtaButton();i.dynamicSize?(i.width=r.width()*i.widthPct,i.height=r.height()*i.heightPct):!i.useLegacyStyle&&i.height&&(u=66,i.subtitle&&(u+=22),f=typeof i.height=="number"?i.height:parseInt(i.height,10),f+=u,i.height=f);i.height&&!isNaN(i.height)&&(i.height=Math.min(i.height,r.height()));i.width&&!isNaN(i.width)&&(i.width=Math.min(i.width,r.width()));i.hideCloseButton&&(i.dialogClass=nt("no-close",i.dialogClass));this._options.useLegacyStyle&&(i.dialogClass=nt("ui-dialog-legacy",i.dialogClass))},t.prototype.initialize=function(){var o=this,f,e;n.prototype.initialize.call(this);var t=this,s=$(window),i=$.extend({},this._options);i.title=this.getTitle();i.close=function(n){t._options.close&&t._options.close.call(this,n);t.onClose(n)};i.open=function(n){t._options.open&&t._options.open.call(this,n);t.onOpen(n)};this._bind("dialogdragstart",function(){u.getService().fire("dialog-move",t)});this._options.attachResize&&this._bind("dialogresizestop",a(this,this.onDialogResize));this._options.resizable&&this._bind("dialogresize",a(this,this._onDialogResizing));i.dynamicSize&&(u.getService().attachEvent("window-resize",this._resizeDelegate),this._bind("dialogclose",function(){var n=u.getService();n.fire("dialog-close",t);n.detachEvent("window-resize",t._resizeDelegate)}));i.url||r.logTracePoint("Dialog.initialize.complete");g(this.getElement(),i.buttons);this._options.contentMargin===!1&&this.getElement().addClass("no-margin");this.getElement().dialog(i);this._options.useLegacyStyle||(f=this.getElement().parent(),e=f.find(".ui-dialog-titlebar"),e.addClass("bowtie").append($("<div />").addClass("ui-dialog-subtitle")),e.attr("title",this.getTitle()),f.find(".ui-dialog-buttonpane").addClass("bowtie"),f.find("button.ui-dialog-titlebar-close .ui-button-icon-primary").addClass("bowtie-icon bowtie-navigate-close"),(this._options.useBowtieStyle||this._options.bowtieVersion>0)&&f.addClass("bowtie-style"));this.setSubtitle(this.getSubtitle());this.getElement().keydown(function(n){var r,u,i;if(n.keyCode===$.ui.keyCode.ENTER){if(i=$(n.target),(!n.shiftKey&&i.is("input[type='text']")||i.is("textarea")&&n.ctrlKey)&&t._options.defaultButton&&t._options.buttons)return r=t._options.buttons[t._options.defaultButton],r&&(u=$("#"+r.id).button("option"),u.disabled||r.click.apply(this,[n])),!1;if(!i.is("textarea")&&!i.is("a")&&!i.hasClass("propagate-keydown-event"))return!1}});setTimeout(function(){o._autoSizeAndPosition()},0);v._dialogActionInProgress=!1},t.prototype._autoSizeAndPosition=function(){var n=this.getElement(),t=this._options;n&&n.length>0&&$.contains(document.body,n[0])&&(t.position&&n.dialog("option","position",t.position),t.height?n.dialog("option","height",t.height):n.dialog("option","height","auto"),n.show())},t.prototype._ensureCtaButton=function(){var n=this._options,r,u,t,i;n.noAutoCta!==!0&&(r=/(^cta$)|(^cta\ )|(\ cta\ )|( cta$)/,u=/(^warning$)|(^warning\ )|(\ warning\ )|( warning$)/,$.isArray(n.buttons)&&n.buttons.length>0&&!n.buttons.some(function(n){return r.test(n.class)})&&!n.buttons.some(function(n){return u.test(n.class)})?(i=n.buttons[0].class||"",n.buttons[0].class=i+" cta"):n.buttons&&typeof n.buttons=="object"&&(t=Object.keys(n.buttons),t.length>0&&(t.some(function(t){return r.test(n.buttons[t].class)})||t.some(function(t){return u.test(n.buttons[t].class)})||(i=n.buttons[t[0]].class||"",n.buttons[t[0]].class=i+" cta"))))},t.prototype.onLoadCompleted=function(t){n.prototype.onLoadCompleted.call(this,t);this.setInitialFocus();r.logTracePoint("Dialog.initialize.complete")},t.prototype.setInitialFocus=function(){var n=this._options.initialFocusSelector||":visible:tabbable";this.getElement().find(n).first().focus()},t.prototype.setFormFocusDelayed=function(n){o.delay(this,300,function(){n.eq(0).focus().select()})},t.prototype.setTitle=function(n){this._title=n;this._updateTitle()},t.prototype.getTitle=function(){return this._title||this._options.title||this.getElement().attr("title")||""},t.prototype.setSubtitle=function(n){this._subtitle=n;this._updateSubtitle()},t.prototype.getSubtitle=function(){var n=this._subtitle;return(n===null||n===undefined)&&(n=this._options.subtitle),n||""},t.prototype.centerDialog=function(){this.getElement().dialog("option","position",{my:"center",at:"center",of:window})},t.prototype.getDialogResult=function(){return this._dialogResult},t.prototype.setDialogResult=function(n){this._dialogResult=n},t.prototype.show=function(){this.getElement().dialog("open")},t.prototype.onOpen=function(){if(!this._options||this._options.hasProgressElement!==!1){var n=$("<div />").addClass("ui-dialog-titlebar-progress-container").appendTo(this.getElement().parent().find(".ui-dialog-titlebar"));this._progressElement=$("<div />").addClass("ui-dialog-titlebar-progress-element").appendTo(n);c.globalProgressIndicator.registerProgressElement(this._progressElement)}u.getService().fire("dialog-open",this)},t.prototype.onClose=function(){u.getService().fire("dialog-close",this);this._progressElement&&c.globalProgressIndicator.unRegisterProgressElement(this._progressElement);this._options.disposeOnClose&&this.dispose();var n=$(".ui-dialog").slice(-1);n.length&&!this._options.noFocusOnClose&&n.focus()},t.prototype.close=function(){this.getElement()&&this.getElement().dialog("close")},t.prototype._updateSubtitle=function(){if(this._initialized&&this.getElement()){var n=this.getElement().parent().find(".ui-dialog-subtitle"),t=this.getSubtitle()||"";n.text(t);n.toggle(t.length>0)}},t.prototype.onDialogResize=function(){},t.prototype._updateTitle=function(){this._initialized&&this.getElement()&&this.getElement().dialog("option","title",this.getTitle())},t.prototype._onWindowResize=function(){var t=$(window),n=this._options;this.getElement().dialog("option",{width:t.width()*n.widthPct,height:t.height()*n.heightPct});this.getElement().dialog("option",{position:n.position})},t.prototype._onDialogResizing=function(n,t){var u=$(window),i,r;t&&t.position&&t.size&&(i=Math.min(t.size.height,u.height()-t.position.top),r=Math.min(t.size.width,u.width()-t.position.left),(i!==t.size.height||r!==t.size.width)&&this.getElement().dialog("option",{width:r,height:i}))},t.enhancementTypeName="tfs.dialog",t._dialogActionInProgress=!1,t}(f.AjaxPanelO);t.DialogO=p;v=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(p);t.Dialog=v;w=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({coreCssClass:"dialog modal-dialog",modal:!0,dynamicSize:!1,width:500,height:"auto",defaultButton:"ok",buttons:{ok:{id:"ok",text:t&&t.okText||e.ModalDialogOkButton,click:a(this,this.onOkClick),"class":"cta",disabled:"disabled"},cancel:{id:"cancel",text:t&&t.cancelText||e.ModalDialogCancelButton,click:a(this,this.onCancelClick)}}},t))},t.prototype.initialize=function(){this._bind(b.EVENT_BUTTON_STATUS_CHANGE,a(this,this.onButtonStatusChange));this._bind("resultReady",a(this,this.onResultReady));n.prototype.initialize.call(this)},t.prototype.updateOkButton=function(n){this.getElement()&&this.getElement().trigger(b.EVENT_BUTTON_STATUS_CHANGE,{enabled:n===!0})},t.prototype.processResult=function(n){var t=this._options.okCallback;n&&($.isFunction(t)&&(t.call(this,n),r.logTracePoint(this.getTypeName()+".callback-complete")),this.close())},t.prototype.onOkClick=function(){r.logTracePoint(this.getTypeName()+".OkClicked");this.processResult(this.getDialogResult())},t.prototype.onResultReady=function(n,t){this.processResult(t)},t.prototype.onCancelClick=function(){$.isFunction(this._options.cancelCallback)&&this._options.cancelCallback();this.close()},t.prototype.onButtonStatusChange=function(n,t){this.getElement().siblings(".ui-dialog-buttonpane").find("#"+(t.button||"ok")).button("option","disabled",t.enabled?"":"disabled")},t.enhancementTypeName="tfs.modaldialog",t.EVENT_BUTTON_STATUS_CHANGE="buttonStatusChange",t}(p);t.ModalDialogO=w;b=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(w);t.ModalDialog=b;k=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({width:400,height:200,resizable:!1,cssClass:"confirmation-dialog"},t))},t.prototype.initialize=function(){n.prototype.initialize.call(this);this.$errorContainer=$(ft("div")).addClass("confirmation-dialog-error").prependTo(this.getElement()).hide();this.updateOkButton(!0)},t.prototype._onSuccess=function(){this._fire("resultReady",!0);var n=this._options.successCallback;$.isFunction(n)&&(n.apply(this,arguments),r.logTracePoint(this.getTypeName()+".callback-complete"))},t.prototype._onError=function(n){this.$errorContainer.text(n.message).show()},t.prototype.onOkClick=function(t){this.updateOkButton(!1);n.prototype.onOkClick.call(this,t)},t}(w);t.ConfirmationDialogO=k;tt=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(k);t.ConfirmationDialog=tt;it=function(){function n(n){this.button=n}return n.prototype.toString=function(){return"MessageDialogResult: Button: "+(this.button?this.button.id:"?")+" ("+c.ErrorHandler.ignoreRejectedPromiseTag+")"},n}();d=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.initializeOptions=function(t){var u=this,i=$.extend({width:500,height:"auto",hideCloseButton:!0,coreCssClass:"dialog modal-dialog message-dialog",modal:!0,dynamicSize:!1},t),r;i.buttons instanceof Array&&i.buttons.length>0&&(r={},i.buttons.forEach(function(n){r[n.id]=u.getButtonOptions(n)}),i.defaultButton=i.buttons[0].id,this.setDialogResult(i.buttons[i.buttons.length-1]),i.buttons=r);t.escapeButton&&this.setDialogResult(t.escapeButton);n.prototype.initializeOptions.call(this,i)},t.prototype.initialize=function(){var i,t;n.prototype.initialize.call(this);this._options.requiredTypedConfirmation&&this.initializeTypedConfirmation();for(i in this._options.buttons)t=this._options.buttons[i],t.style&&$("#"+t.id).addClass("button-"+t.style)},t.prototype.initializeTypedConfirmation=function(){var u=this,f=this.getElement(),n=$("<input type='text' class='textbox message-dialog-confirm-textbox no-match' />"),t=$(),i,r;for(i in this._options.buttons)this._options.buttons[i].reject||(t=t.add($("#"+this._options.buttons[i].id)));r=function(){s.ignoreCaseComparer(n.val(),u._options.requiredTypedConfirmation)==0?(n.removeClass("no-match").addClass("match"),t.button("option","disabled","")):(n.addClass("no-match").removeClass("match"),t.button("option","disabled","disabled"))};n.bind("input keyup",r);f.append($("<div class='message-dialog-confirm'><\/div>").append(n));r(null);o.delay(this,100,function(){n.focus();n.select()})},t.prototype.getPromise=function(){return this._deferred||(this._deferred=l.defer()),this._deferred.promise},t.showMessageDialog=function(n,t){var i,r;return t=t||{},i=$.extend({buttons:[y.buttons.ok,y.buttons.cancel],useBowtieStyle:!0,minWidth:t.width,minHeight:t.height,title:e.Confirm},t),i.content=typeof n=="string"?$("<div />").text(n):n,r=ut(y,i),r.getPromise()},t.prototype.onClose=function(t){if(this._deferred){var i=new it(this.getDialogResult());i.button.reject?this._deferred.reject(i):this._deferred.resolve(i)}return n.prototype.onClose.call(this,t)},t.prototype.getButtonOptions=function(n){var t=this;return $.extend({click:function(){t.setDialogResult(n);t.close()}},n)},t.buttons={ok:{id:"ok",text:e.ModalDialogOkButton,reject:!1},cancel:{id:"cancel",text:e.ModalDialogCancelButton,reject:!0},yes:{id:"yes",text:e.ModalDialogYesButton,reject:!1},no:{id:"no",text:e.ModalDialogNoButton,reject:!0},close:{id:"close",text:e.CloseButtonLabelText,reject:!0}},t}(p);t.MessageDialogO=d;y=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(d);t.MessageDialog=y;rt=function(n){function t(t){n.call(this,t)}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({width:t.width||600,minWidth:400,height:t.height||450,minHeight:200,attachResize:!0,defaultButton:"close",buttons:[{id:"close",text:e.CloseButtonLabelText,click:a(this,this.close)}]},t))},t.prototype.initialize=function(){n.prototype.initialize.call(this);this.setTitle(e.CopyContentDialogTitle);this._decorate()},t.prototype._decorate=function(){var r=this.getElement(),n,i=$("<div>").text(this._options.dialogLabel||this._getDefaultLabelText()),t;this._options.dialogLabelExtend&&i.append(this._options.dialogLabelExtend);t=$("<div class='copy-dialog-container'>").append(i).append($("<p>"));this._options.excludeTextPanel||(n=$("<div>"),t.append(n),this._options.copyAsHtml?this._initializeRichEditor(n):(this._initializeTextPanel(n),o.delay(this,100,function(){this._$textArea.focus();this._$textArea.select()})),this._bind("dialogresize",function(){n.css("height",t.height()-i.height()-40+"px")}));r.append(t);this._options.excludeTextPanel||n.css("height",t.height()-i.height()-40+"px")},t.prototype._getDefaultLabelText=function(){return h.BrowserCheckUtils.isMacintosh()?e.CopyContentMacintoshHelpText:e.CopyContentPcHelpText},t.prototype._initializeRichEditor=function(n){var t=this;c.using(["VSS/Controls/RichEditor"],function(r){var u=i.BaseControl.createIn(r.RichEditor,n,{noToolbar:!0,height:"100%",pageHtml:t._options.pageHtml,internal:!0});u.ready(function(){u.setValue(t._options.data);u.bindOnCopy(a(t,function(){o.delay(this,0,function(){this.close()})}));o.delay(t,100,function(){u.selectText();u.setEnabled(!1)})})})},t.prototype._initializeTextPanel=function(n){var t="copy-content-textarea";this._options.textAreaCopyClass&&(t=this._options.textAreaCopyClass);this._$textArea=$("<textarea/>").addClass(t).text(this._options.data);this._$textArea[0].oncopy=a(this,function(){o.delay(this,0,function(){this.close()})});n.append(this._$textArea)},t.enhancementTypeName="CopyContentDialog",t}(w);t.CopyContentDialog=rt;t.show=ut;t.showMessageDialog=et});
define("VSS/Navigation/Services",["require","exports","VSS/Service","VSS/Utils/String","VSS/Events/Handlers"],function(n,t,i,r,u){function f(n,t){var i={};return t&&(n=n||t._a||t.action,i=$.extend(i,t),delete i.action,delete i._a),n&&(i.action=n),i}function o(){return i.getLocalService(e)}var e=function(){function n(){this._namedEvents=new u.NamedEventCollection;window.history.pushState&&(this._usePushState=!0)}return n.prototype.getCurrentFragment=function(){return this._usePushState?n.serializeState(this.getCurrentState()):this.getCurrentHashString()},n.prototype.getCurrentHashString=function(){var n=window.location.hash;return n&&n[0]==="#"&&(n=n.substr(1)),n},n.prototype.getCurrentQueryString=function(){var n=window.location.search;return n&&n[0]==="?"&&(n=n.substr(1)),n},n.prototype.getFragmentActionLink=function(t,i){return"#"+n.serializeState(f(t,i))},n.prototype.getCurrentState=function(){return $.extend(this._ignoreQueryString?{}:n.deserializeState(this.getCurrentQueryString()),n.deserializeState(this.getCurrentHashString()))},n.prototype.replaceHistoryPoint=function(n,t,i,r){this.updateHistoryEntry(n,t,!0,!1,i,r)},n.prototype.addHistoryPoint=function(n,t,i,r){this.updateHistoryEntry(n,t,!1,!0,i,r)},n.prototype.updateHistoryEntry=function(t,i,r,u,e,o){var s={},h,c;u?(s=this.getCurrentState(),$.each(f(t,i),function(n,t){t===null||typeof t=="undefined"?delete s[n]:s[n]=t})):$.each(f(t,i),function(n,t){t!==null&&typeof t!="undefined"&&t!==""&&(s[n]=t)});h="";c="";this._usePushState?c=n.serializeState(s):h=n.serializeState(s);(h!==this.getCurrentHashString()||c!==this.getCurrentQueryString())&&(this._suppressNavigate=o===!0,this._usePushState?(r?window.history.replaceState(null,null,"?"+c):window.history.pushState(null,null,"?"+c),this._onNavigate()):r?window.location.replace("#"+h):window.location.hash=h);e&&(document.title=e)},n.serializeState=function(n){var t=[];return $.each(n,function(n,i){if(i!==null&&typeof i!="undefined"){var r=n==="action"?"_a":n;t.push(r+"="+encodeURIComponent(i))}}),t.join("&")},n.deserializeState=function(n){var t={},i=(n||"").split("&");return i.forEach(function(n){var r=n.split("=",2),i,u;if(r.length===2){i=r[0];i==="_a"&&(i="action");u=r[1].replace(/\+/g,"%20");try{t[i]=decodeURIComponent(u)}catch(f){t[i]=u}}}),t},n.prototype.attachNavigate=function(n,t,i){if($.isFunction(n)){this.attachNavigate(null,n,t||i);return}if(t&&(this._initialized||(this._initialized=!0,this._suppressNavigate=!1,this._setLastNavigateState(),$(window).bind("hashchange",this._onHashChanged.bind(this)),this._usePushState&&$(window).bind("popstate",this._onPopState.bind(this)),this._usePushState&&this._moveHashStateToQueryParams()),this._namedEvents.subscribe(n?n.toString():"*",t),i)){var u=this.getCurrentState();(!n||u.action&&r.equals(u.action,n.toString(),!0))&&(this._setLastNavigateState(),t(this,u))}},n.prototype.detachNavigate=function(n,t){this._initialized&&($.isFunction(n)?this._namedEvents.unsubscribe("*",n):t&&n&&this._namedEvents.unsubscribe(n.toString(),n))},n.prototype._moveHashStateToQueryParams=function(){var n=this.getCurrentHashString();n&&window.history.replaceState(null,null,"?"+n)},n.prototype._onHashChanged=function(){this._usePushState?this._moveHashStateToQueryParams():this._ignoreQueryString=!0;this._onNavigate()},n.prototype._onPopState=function(){this._moveHashStateToQueryParams();this._onNavigate()},n.prototype._onNavigate=function(){if(this._suppressNavigate)this._suppressNavigate=!1,this._setLastNavigateState();else if(this.getCurrentHashString()!==this._lastNavigatedHashString||this.getCurrentQueryString()!==this._lastNavigatedQueryString){this._setLastNavigateState();var n=this.getCurrentState();n.action&&this._namedEvents.invokeHandlers(n.action,this,n);this._namedEvents.invokeHandlers("*",this,n)}},n.prototype._setLastNavigateState=function(){this._lastNavigatedHashString=this.getCurrentHashString();this._lastNavigatedQueryString=this.getCurrentQueryString()},n}();t.HistoryService=e;t.getHistoryService=o});
define("VSS/Locations/Contracts",["require","exports"],function(n,t){"use strict";var i,r,u;(function(n){n[n.None=0]="None";n[n.Deployment=1]="Deployment";n[n.Account=2]="Account";n[n.Collection=4]="Collection";n[n.All=7]="All"})(t.InheritLevel||(t.InheritLevel={}));i=t.InheritLevel,function(n){n[n.Context=0]="Context";n[n.WebApplication=2]="WebApplication";n[n.FullyQualified=3]="FullyQualified"}(t.RelativeToSetting||(t.RelativeToSetting={}));r=t.RelativeToSetting,function(n){n[n.Assigned=0]="Assigned";n[n.Active=1]="Active";n[n.Moving=2]="Moving"}(t.ServiceStatus||(t.ServiceStatus={}));u=t.ServiceStatus;t.TypeInfo={ConnectionData:{},InheritLevel:{enumValues:{none:0,deployment:1,account:2,collection:4,all:7}},LocationServiceData:{},RelativeToSetting:{enumValues:{context:0,webApplication:2,fullyQualified:3}},ServiceDefinition:{},ServiceStatus:{enumValues:{assigned:0,active:1,moving:2}}};t.TypeInfo.ConnectionData.fields={lastUserAccess:{isDate:!0},locationServiceData:{typeInfo:t.TypeInfo.LocationServiceData}};t.TypeInfo.LocationServiceData.fields={serviceDefinitions:{isArray:!0,typeInfo:t.TypeInfo.ServiceDefinition}};t.TypeInfo.ServiceDefinition.fields={inheritLevel:{enumType:t.TypeInfo.InheritLevel},relativeToSetting:{enumType:t.TypeInfo.RelativeToSetting},status:{enumType:t.TypeInfo.ServiceStatus}}});
define("VSS/Locations/RestClient",["require","exports","VSS/Locations/Contracts","VSS/WebApi/RestClient"],function(n,t,i,r){"use strict";var u=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t.prototype.updateServiceDefinitions=function(n){return this._beginRequest({httpMethod:"PATCH",httpResponseType:"html",area:"Location",locationId:"d810a47d-f4f4-4a62-a03f-fa1860585c4c",resource:"ServiceDefinitions",routeTemplate:"_apis/{resource}/{serviceType}/{identifier}",apiVersion:this.serviceDefinitionsApiVersion,data:n})},t.prototype.getServiceDefinitions=function(n){return this._beginRequest({httpMethod:"GET",area:"Location",locationId:"d810a47d-f4f4-4a62-a03f-fa1860585c4c",resource:"ServiceDefinitions",routeTemplate:"_apis/{resource}/{serviceType}/{identifier}",responseType:i.TypeInfo.ServiceDefinition,responseIsCollection:!0,routeValues:{serviceType:n},apiVersion:this.serviceDefinitionsApiVersion})},t.prototype.getServiceDefinition=function(n,t,r){var u={allowFaultIn:r};return this._beginRequest({httpMethod:"GET",area:"Location",locationId:"d810a47d-f4f4-4a62-a03f-fa1860585c4c",resource:"ServiceDefinitions",routeTemplate:"_apis/{resource}/{serviceType}/{identifier}",responseType:i.TypeInfo.ServiceDefinition,routeValues:{serviceType:n,identifier:t},queryParams:u,apiVersion:this.serviceDefinitionsApiVersion})},t.prototype.deleteServiceDefinition=function(n,t){return this._beginRequest({httpMethod:"DELETE",httpResponseType:"html",area:"Location",locationId:"d810a47d-f4f4-4a62-a03f-fa1860585c4c",resource:"ServiceDefinitions",routeTemplate:"_apis/{resource}/{serviceType}/{identifier}",routeValues:{serviceType:n,identifier:t},apiVersion:this.serviceDefinitionsApiVersion})},t.prototype.getConnectionData=function(n,t,r){var u={connectOptions:n,lastChangeId:t,lastChangeId64:r};return this._beginRequest({httpMethod:"GET",area:"Location",locationId:"00d9565f-ed9c-4a06-9a50-00e7896ccab4",resource:"ConnectionData",routeTemplate:"_apis/{resource}",responseType:i.TypeInfo.ConnectionData,queryParams:u,apiVersion:this.connectionDataApiVersion})},t}(r.VssHttpClient),f,e,o,s,h,c;t.CommonMethods2To3=u;f=function(n){function t(t,i){n.call(this,t,i);this.connectionDataApiVersion=this.serviceDefinitionsApiVersion="3.0-preview.1"}return __extends(t,n),t}(u);t.LocationsHttpClient3=f;e=function(n){function t(t,i){n.call(this,t,i);this.connectionDataApiVersion=this.serviceDefinitionsApiVersion="2.3-preview.1"}return __extends(t,n),t}(u);t.LocationsHttpClient2_3=e;o=function(n){function t(t,i){n.call(this,t,i);this.connectionDataApiVersion=this.serviceDefinitionsApiVersion="2.2-preview.1"}return __extends(t,n),t}(u);t.LocationsHttpClient2_2=o;s=function(n){function t(t,i){n.call(this,t,i);this.connectionDataApiVersion=this.serviceDefinitionsApiVersion="2.1-preview.1"}return __extends(t,n),t}(u);t.LocationsHttpClient2_1=s;h=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t}(u);t.LocationsHttpClient2=h;c=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t}(f);t.LocationsHttpClient=c});
define("VSS/Contributions/Contracts",["require","exports"],function(n,t){"use strict";var i,r,u,f,e,o,s,h;(function(n){n[n.None=0]="None";n[n.Me=1]="Me";n[n.All=2]="All"})(t.AcquisitionAssignmentType||(t.AcquisitionAssignmentType={}));i=t.AcquisitionAssignmentType,function(n){n[n.Disallow=0]="Disallow";n[n.Allow=1]="Allow";n[n.Completed=3]="Completed"}(t.AcquisitionOperationState||(t.AcquisitionOperationState={}));r=t.AcquisitionOperationState,function(n){n[n.Get=0]="Get";n[n.Install=1]="Install";n[n.Buy=2]="Buy";n[n.Try=3]="Try";n[n.Request=4]="Request";n[n.None=5]="None"}(t.AcquisitionOperationType||(t.AcquisitionOperationType={}));u=t.AcquisitionOperationType,function(n){n[n.Unknown=0]="Unknown";n[n.String=1]="String";n[n.Uri=2]="Uri";n[n.Guid=4]="Guid";n[n.Boolean=8]="Boolean";n[n.Integer=16]="Integer";n[n.Double=32]="Double";n[n.DateTime=64]="DateTime";n[n.Dictionary=128]="Dictionary";n[n.Array=256]="Array";n[n.Object=512]="Object"}(t.ContributionPropertyType||(t.ContributionPropertyType={}));f=t.ContributionPropertyType,function(n){n[n.BuiltIn=1]="BuiltIn";n[n.Trusted=2]="Trusted"}(t.ExtensionFlags||(t.ExtensionFlags={}));e=t.ExtensionFlags,function(n){n[n.Open=0]="Open";n[n.Accepted=1]="Accepted";n[n.Rejected=2]="Rejected"}(t.ExtensionRequestState||(t.ExtensionRequestState={}));o=t.ExtensionRequestState,function(n){n[n.None=0]="None";n[n.Disabled=1]="Disabled";n[n.BuiltIn=2]="BuiltIn";n[n.MultiVersion=4]="MultiVersion";n[n.UnInstalled=8]="UnInstalled";n[n.VersionCheckError=16]="VersionCheckError";n[n.Trusted=32]="Trusted";n[n.Error=64]="Error";n[n.NeedsReauthorization=128]="NeedsReauthorization";n[n.AutoUpgradeError=256]="AutoUpgradeError";n[n.Warning=512]="Warning"}(t.ExtensionStateFlags||(t.ExtensionStateFlags={}));s=t.ExtensionStateFlags,function(n){n[n.Warning=0]="Warning";n[n.Error=1]="Error"}(t.InstalledExtensionStateIssueType||(t.InstalledExtensionStateIssueType={}));h=t.InstalledExtensionStateIssueType;t.TypeInfo={AcquisitionAssignmentType:{enumValues:{none:0,me:1,all:2}},AcquisitionOperation:{},AcquisitionOperationState:{enumValues:{disallow:0,allow:1,completed:3}},AcquisitionOperationType:{enumValues:{get:0,install:1,buy:2,"try":3,request:4,none:5}},AcquisitionOptions:{},ContributionPropertyDescription:{},ContributionPropertyType:{enumValues:{unknown:0,string:1,uri:2,guid:4,boolean:8,integer:16,double:32,dateTime:64,dictionary:128,array:256,object:512}},ContributionType:{},ExtensionAcquisitionRequest:{},ExtensionAuditLog:{},ExtensionAuditLogEntry:{},ExtensionFlags:{enumValues:{builtIn:1,trusted:2}},ExtensionManifest:{},ExtensionRequest:{},ExtensionRequestState:{enumValues:{open:0,accepted:1,rejected:2}},ExtensionState:{},ExtensionStateFlags:{enumValues:{none:0,disabled:1,builtIn:2,multiVersion:4,unInstalled:8,versionCheckError:16,trusted:32,error:64,needsReauthorization:128,autoUpgradeError:256,warning:512}},InstalledExtension:{},InstalledExtensionState:{},InstalledExtensionStateIssue:{},InstalledExtensionStateIssueType:{enumValues:{warning:0,error:1}},RequestedExtension:{}};t.TypeInfo.AcquisitionOperation.fields={operationState:{enumType:t.TypeInfo.AcquisitionOperationState},operationType:{enumType:t.TypeInfo.AcquisitionOperationType}};t.TypeInfo.AcquisitionOptions.fields={defaultOperation:{typeInfo:t.TypeInfo.AcquisitionOperation},operations:{isArray:!0,typeInfo:t.TypeInfo.AcquisitionOperation}};t.TypeInfo.ContributionPropertyDescription.fields={type:{enumType:t.TypeInfo.ContributionPropertyType}};t.TypeInfo.ContributionType.fields={properties:{isDictionary:!0,dictionaryValueTypeInfo:t.TypeInfo.ContributionPropertyDescription}};t.TypeInfo.ExtensionAcquisitionRequest.fields={assignmentType:{enumType:t.TypeInfo.AcquisitionAssignmentType},operationType:{enumType:t.TypeInfo.AcquisitionOperationType}};t.TypeInfo.ExtensionAuditLog.fields={entries:{isArray:!0,typeInfo:t.TypeInfo.ExtensionAuditLogEntry}};t.TypeInfo.ExtensionAuditLogEntry.fields={auditDate:{isDate:!0}};t.TypeInfo.ExtensionManifest.fields={contributionTypes:{isArray:!0,typeInfo:t.TypeInfo.ContributionType}};t.TypeInfo.ExtensionRequest.fields={requestDate:{isDate:!0},requestState:{enumType:t.TypeInfo.ExtensionRequestState},resolveDate:{isDate:!0}};t.TypeInfo.ExtensionState.fields={flags:{enumType:t.TypeInfo.ExtensionStateFlags},installationIssues:{isArray:!0,typeInfo:t.TypeInfo.InstalledExtensionStateIssue},lastUpdated:{isDate:!0},lastVersionCheck:{isDate:!0}};t.TypeInfo.InstalledExtension.fields={contributionTypes:{isArray:!0,typeInfo:t.TypeInfo.ContributionType},flags:{enumType:t.TypeInfo.ExtensionFlags},installState:{typeInfo:t.TypeInfo.InstalledExtensionState},lastPublished:{isDate:!0}};t.TypeInfo.InstalledExtensionState.fields={flags:{enumType:t.TypeInfo.ExtensionStateFlags},installationIssues:{isArray:!0,typeInfo:t.TypeInfo.InstalledExtensionStateIssue},lastUpdated:{isDate:!0}};t.TypeInfo.InstalledExtensionStateIssue.fields={type:{enumType:t.TypeInfo.InstalledExtensionStateIssueType}};t.TypeInfo.RequestedExtension.fields={extensionRequests:{isArray:!0,typeInfo:t.TypeInfo.ExtensionRequest}}});
define("VSS/ExtensionManagement/RestClient",["require","exports","VSS/Contributions/Contracts","VSS/Gallery/Contracts","VSS/Service","VSS/WebApi/RestClient"],function(n,t,i,r,u,f){"use strict";function w(n){return window.VSS&&window.VSS.VssSDKRestVersion&&y[window.VSS.VssSDKRestVersion]?u.getClient(y[window.VSS.VssSDKRestVersion],undefined,undefined,undefined,n):u.getClient(h,undefined,undefined,undefined,n)}var c=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t.prototype.getToken=function(){return this._beginRequest({httpMethod:"GET",area:"ExtensionManagement",locationId:"3a2e24ed-1d6f-4cb2-9f3b-45a96bbfaf50",resource:"Token",routeTemplate:"_apis/{area}/{resource}",apiVersion:this.tokenApiVersion})},t.prototype.requestExtension=function(n,t,r){return this._beginRequest({httpMethod:"POST",area:"ExtensionManagement",locationId:"f5afca1e-a728-4294-aa2d-4af0173431b5",resource:"RequestedExtensions",routeTemplate:"_apis/{area}/{resource}/{publisherName}/{extensionName}/requests/me",responseType:i.TypeInfo.RequestedExtension,routeValues:{publisherName:n,extensionName:t},apiVersion:this.requestedExtensionsApiVersion,data:r})},t.prototype.deleteRequest=function(n,t){return this._beginRequest({httpMethod:"DELETE",httpResponseType:"html",area:"ExtensionManagement",locationId:"f5afca1e-a728-4294-aa2d-4af0173431b5",resource:"RequestedExtensions",routeTemplate:"_apis/{area}/{resource}/{publisherName}/{extensionName}/requests/me",routeValues:{publisherName:n,extensionName:t},apiVersion:this.requestedExtensionsApiVersion})},t.prototype.resolveAllRequests=function(n,t,i,r){var u={state:r};return this._beginRequest({httpMethod:"PATCH",area:"ExtensionManagement",locationId:"ba93e1f3-511c-4364-8b9c-eb98818f2e0b",resource:"RequestedExtensions",routeTemplate:"_apis/{area}/{resource}/{publisherName}/{extensionName}",routeValues:{publisherName:t,extensionName:i},queryParams:u,apiVersion:this.requestedExtensionsApiVersion_ba93e1f3,data:n})},t.prototype.getRequests=function(){return this._beginRequest({httpMethod:"GET",area:"ExtensionManagement",locationId:"216b978f-b164-424e-ada2-b77561e842b7",resource:"RequestedExtensions",routeTemplate:"_apis/{area}/{resource}",responseType:i.TypeInfo.RequestedExtension,responseIsCollection:!0,apiVersion:this.requestedExtensionsApiVersion_216b978f})},t.prototype.resolveRequest=function(n,t,i,r,u){var f={state:u};return this._beginRequest({httpMethod:"PATCH",area:"ExtensionManagement",locationId:"aa93e1f3-511c-4364-8b9c-eb98818f2e0b",resource:"RequestedExtensions",routeTemplate:"_apis/{area}/{resource}/{publisherName}/{extensionName}/requests/{requesterId}",routeValues:{publisherName:t,extensionName:i,requesterId:r},queryParams:f,apiVersion:this.requestedExtensionsApiVersion_aa93e1f3,data:n})},t.prototype.updateInstalledExtension=function(n){return this._beginRequest({httpMethod:"PATCH",area:"ExtensionManagement",locationId:"275424d0-c844-4fe2-bda6-04933a1357d8",resource:"InstalledExtensions",routeTemplate:"_apis/{area}/{resource}/{extensionId}",requestType:i.TypeInfo.InstalledExtension,responseType:i.TypeInfo.InstalledExtension,apiVersion:this.installedExtensionsApiVersion,data:n})},t.prototype.getInstalledExtensions=function(n,t,r,u){var f={includeDisabledExtensions:n,includeErrors:t,assetTypes:r&&r.join(":"),includeInstallationIssues:u};return this._beginRequest({httpMethod:"GET",area:"ExtensionManagement",locationId:"275424d0-c844-4fe2-bda6-04933a1357d8",resource:"InstalledExtensions",routeTemplate:"_apis/{area}/{resource}/{extensionId}",responseType:i.TypeInfo.InstalledExtension,responseIsCollection:!0,queryParams:f,apiVersion:this.installedExtensionsApiVersion})},t.serviceInstanceId="00000028-0000-8888-8000-000000000000",t}(f.VssHttpClient),o,e,s,l,h,a,v,p,y;t.CommonMethods2To3=c;o=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t.prototype.uninstallExtensionByName=function(n,t,i,r){var u={reason:i,reasonCode:r};return this._beginRequest({httpMethod:"DELETE",httpResponseType:"html",area:"ExtensionManagement",locationId:"fb0da285-f23e-4b56-8b53-3ef5f9f6de66",resource:"InstalledExtensionsByName",routeTemplate:"_apis/{area}/{resource}/{publisherName}/{extensionName}/{version}",routeValues:{publisherName:n,extensionName:t},queryParams:u,apiVersion:this.installedExtensionsByNameApiVersion})},t.prototype.installExtensionByName=function(n,t,r){return this._beginRequest({httpMethod:"POST",area:"ExtensionManagement",locationId:"fb0da285-f23e-4b56-8b53-3ef5f9f6de66",resource:"InstalledExtensionsByName",routeTemplate:"_apis/{area}/{resource}/{publisherName}/{extensionName}/{version}",responseType:i.TypeInfo.InstalledExtension,routeValues:{publisherName:n,extensionName:t,version:r},apiVersion:this.installedExtensionsByNameApiVersion})},t.prototype.getInstalledExtensionByName=function(n,t,r){var u={assetTypes:r&&r.join(":")};return this._beginRequest({httpMethod:"GET",area:"ExtensionManagement",locationId:"fb0da285-f23e-4b56-8b53-3ef5f9f6de66",resource:"InstalledExtensionsByName",routeTemplate:"_apis/{area}/{resource}/{publisherName}/{extensionName}/{version}",responseType:i.TypeInfo.InstalledExtension,routeValues:{publisherName:n,extensionName:t},queryParams:u,apiVersion:this.installedExtensionsByNameApiVersion})},t.prototype.queryExtensions=function(n){return this._beginRequest({httpMethod:"POST",area:"ExtensionManagement",locationId:"046c980f-1345-4ce2-bf85-b46d10ff4cfd",resource:"InstalledExtensionQuery",routeTemplate:"_apis/{area}/{resource}",responseType:i.TypeInfo.InstalledExtension,responseIsCollection:!0,apiVersion:this.installedExtensionQueryApiVersion,data:n})},t.prototype.getStates=function(n,t,r){var u={includeDisabled:n,includeErrors:t,includeInstallationIssues:r};return this._beginRequest({httpMethod:"GET",area:"ExtensionManagement",locationId:"92755d3d-9a8a-42b3-8a4d-87359fe5aa93",resource:"ExtensionStates",routeTemplate:"_apis/{area}/{resource}",responseType:i.TypeInfo.ExtensionState,responseIsCollection:!0,queryParams:u,apiVersion:this.extensionStatesApiVersion})},t.prototype.updateDocumentByName=function(n,t,i,r,u,f){return this._beginRequest({httpMethod:"PATCH",area:"ExtensionManagement",locationId:"bbe06c18-1c8b-4fcd-b9c6-1535aaab8749",resource:"Data",routeTemplate:"_apis/{area}/InstalledExtensions/{publisherName}/{extensionName}/{resource}/Scopes/{scopeType}/{scopeValue}/Collections/{collectionName}/Documents/{documentId}",routeValues:{publisherName:t,extensionName:i,scopeType:r,scopeValue:u,collectionName:f},apiVersion:this.dataApiVersion,data:n})},t.prototype.setDocumentByName=function(n,t,i,r,u,f){return this._beginRequest({httpMethod:"PUT",area:"ExtensionManagement",locationId:"bbe06c18-1c8b-4fcd-b9c6-1535aaab8749",resource:"Data",routeTemplate:"_apis/{area}/InstalledExtensions/{publisherName}/{extensionName}/{resource}/Scopes/{scopeType}/{scopeValue}/Collections/{collectionName}/Documents/{documentId}",routeValues:{publisherName:t,extensionName:i,scopeType:r,scopeValue:u,collectionName:f},apiVersion:this.dataApiVersion,data:n})},t.prototype.getDocumentsByName=function(n,t,i,r,u){return this._beginRequest({httpMethod:"GET",area:"ExtensionManagement",locationId:"bbe06c18-1c8b-4fcd-b9c6-1535aaab8749",resource:"Data",routeTemplate:"_apis/{area}/InstalledExtensions/{publisherName}/{extensionName}/{resource}/Scopes/{scopeType}/{scopeValue}/Collections/{collectionName}/Documents/{documentId}",responseIsCollection:!0,routeValues:{publisherName:n,extensionName:t,scopeType:i,scopeValue:r,collectionName:u},apiVersion:this.dataApiVersion})},t.prototype.getDocumentByName=function(n,t,i,r,u,f){return this._beginRequest({httpMethod:"GET",area:"ExtensionManagement",locationId:"bbe06c18-1c8b-4fcd-b9c6-1535aaab8749",resource:"Data",routeTemplate:"_apis/{area}/InstalledExtensions/{publisherName}/{extensionName}/{resource}/Scopes/{scopeType}/{scopeValue}/Collections/{collectionName}/Documents/{documentId}",routeValues:{publisherName:n,extensionName:t,scopeType:i,scopeValue:r,collectionName:u,documentId:f},apiVersion:this.dataApiVersion})},t.prototype.deleteDocumentByName=function(n,t,i,r,u,f){return this._beginRequest({httpMethod:"DELETE",httpResponseType:"html",area:"ExtensionManagement",locationId:"bbe06c18-1c8b-4fcd-b9c6-1535aaab8749",resource:"Data",routeTemplate:"_apis/{area}/InstalledExtensions/{publisherName}/{extensionName}/{resource}/Scopes/{scopeType}/{scopeValue}/Collections/{collectionName}/Documents/{documentId}",routeValues:{publisherName:n,extensionName:t,scopeType:i,scopeValue:r,collectionName:u,documentId:f},apiVersion:this.dataApiVersion})},t.prototype.createDocumentByName=function(n,t,i,r,u,f){return this._beginRequest({httpMethod:"POST",area:"ExtensionManagement",locationId:"bbe06c18-1c8b-4fcd-b9c6-1535aaab8749",resource:"Data",routeTemplate:"_apis/{area}/InstalledExtensions/{publisherName}/{extensionName}/{resource}/Scopes/{scopeType}/{scopeValue}/Collections/{collectionName}/Documents/{documentId}",routeValues:{publisherName:t,extensionName:i,scopeType:r,scopeValue:u,collectionName:f},apiVersion:this.dataApiVersion,data:n})},t}(c);t.CommonMethods2_1To3=o;e=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t.prototype.getPolicies=function(n){return this._beginRequest({httpMethod:"GET",area:"ExtensionManagement",locationId:"e5cc8c09-407b-4867-8319-2ae3338cbf6f",resource:"Policies",routeTemplate:"_apis/{area}/{resource}/{userId}",responseType:r.TypeInfo.UserExtensionPolicy,routeValues:{userId:n},apiVersion:this.policiesApiVersion})},t.prototype.queryCollectionsByName=function(n,t,i){return this._beginRequest({httpMethod:"POST",area:"ExtensionManagement",locationId:"56c331f1-ce53-4318-adfd-4db5c52a7a2e",resource:"ExtensionDataCollectionQuery",routeTemplate:"_apis/{area}/InstalledExtensions/{publisherName}/{extensionName}/{resource}",responseIsCollection:!0,routeValues:{publisherName:t,extensionName:i},apiVersion:this.extensionDataCollectionQueryApiVersion,data:n})},t}(o);t.CommonMethods2_2To3=e;s=function(n){function t(t,i){n.call(this,t,i);this.dataApiVersion=this.extensionDataCollectionQueryApiVersion=this.extensionStatesApiVersion=this.installedExtensionQueryApiVersion=this.installedExtensionsApiVersion=this.installedExtensionsByNameApiVersion=this.policiesApiVersion=this.requestedExtensionsApiVersion=this.requestedExtensionsApiVersion_ba93e1f3=this.requestedExtensionsApiVersion_216b978f=this.requestedExtensionsApiVersion_aa93e1f3=this.tokenApiVersion="3.0-preview.1"}return __extends(t,n),t.prototype.getAcquisitionOptions=function(n,t,r){var u={itemId:n,testCommerce:t,isFreeOrTrialInstall:r};return this._beginRequest({httpMethod:"GET",area:"ExtensionManagement",locationId:"288dff58-d13b-468e-9671-0fb754e9398c",resource:"AcquisitionOptions",routeTemplate:"_apis/{area}/{resource}",responseType:i.TypeInfo.AcquisitionOptions,queryParams:u,apiVersion:"3.0-preview.1"})},t.prototype.requestAcquisition=function(n){return this._beginRequest({httpMethod:"POST",area:"ExtensionManagement",locationId:"da616457-eed3-4672-92d7-18d21f5c1658",resource:"AcquisitionRequests",routeTemplate:"_apis/{area}/{resource}",requestType:i.TypeInfo.ExtensionAcquisitionRequest,responseType:i.TypeInfo.ExtensionAcquisitionRequest,apiVersion:"3.0-preview.1",data:n})},t.prototype.registerAuthorization=function(n,t,i){return this._beginRequest({httpMethod:"PUT",area:"ExtensionManagement",locationId:"f21cfc80-d2d2-4248-98bb-7820c74c4606",resource:"Authorizations",routeTemplate:"_apis/{area}/InstalledExtensions/{publisherName}/{extensionName}/{resource}/{registrationId}",routeValues:{publisherName:n,extensionName:t,registrationId:i},apiVersion:"3.0-preview.1"})},t}(e);t.ExtensionManagementHttpClient3=s;l=function(n){function t(t,i){n.call(this,t,i);this.dataApiVersion=this.extensionDataCollectionQueryApiVersion=this.extensionStatesApiVersion=this.installedExtensionQueryApiVersion=this.installedExtensionsApiVersion=this.installedExtensionsByNameApiVersion=this.policiesApiVersion=this.requestedExtensionsApiVersion=this.requestedExtensionsApiVersion_ba93e1f3=this.requestedExtensionsApiVersion_216b978f=this.requestedExtensionsApiVersion_aa93e1f3=this.tokenApiVersion="2.3-preview.1"}return __extends(t,n),t}(e);t.ExtensionManagementHttpClient2_3=l;h=function(n){function t(t,i){n.call(this,t,i);this.dataApiVersion=this.extensionStatesApiVersion=this.installedExtensionQueryApiVersion=this.installedExtensionsApiVersion=this.installedExtensionsByNameApiVersion=this.requestedExtensionsApiVersion=this.requestedExtensionsApiVersion_ba93e1f3=this.requestedExtensionsApiVersion_216b978f=this.requestedExtensionsApiVersion_aa93e1f3=this.tokenApiVersion="2.2-preview.1"}return __extends(t,n),t}(e);t.ExtensionManagementHttpClient2_2=h;a=function(n){function t(t,i){n.call(this,t,i);this.installedExtensionsApiVersion=this.requestedExtensionsApiVersion=this.requestedExtensionsApiVersion_ba93e1f3=this.requestedExtensionsApiVersion_216b978f=this.requestedExtensionsApiVersion_aa93e1f3=this.tokenApiVersion="2.1-preview.1"}return __extends(t,n),t}(o);t.ExtensionManagementHttpClient2_1=a;v=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t}(c);t.ExtensionManagementHttpClient2=v;p=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t}(s);t.ExtensionManagementHttpClient=p;y={"3.0":s,"2.3":l,"2.2":h,"2.1":a,"2.0":v};t.getClient=w});
define("Gallery/Client/Service/VSSExtensionManagement/VSSExtensionManagement",["require","exports","q","Gallery/Client/Service/HttpClientProvider/HttpClientProvider","Gallery/Client/Service/VSSCommerce/IVSSCommerce","Gallery/Client/Service/VSSItem","VSS/Context","VSS/Common/Contracts/Platform","VSS/Locations/RestClient","Gallery/Client/Common/Telemetry","Gallery/Client/Common/TelemetryInternal","VSS/ExtensionManagement/RestClient","VSS/Service","Gallery/Client/Service/Item","VSS/Contributions/Contracts","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){var w=function(){function n(){this._collectionLevelEmsClients={};this._accountCollectionServiceDefinition={}}return n.prototype._getCollectionContext=function(n){var i=e.getDefaultWebContext(),t=$.extend(!0,{},i);return t.host.id=n.id,t.host.relativeUri=t.host.relativeUri+n.name+"/",t.host.hostType=o.ContextHostType.ProjectCollection,t.host.uri=t.host.uri+n.name+"/",t.host.name=n.name,t.collection=t.host,t},n.prototype._getCollectionEmsClient=function(n){var f=this,i=$.Deferred(),t,u;return e.getPageContext().webAccessConfiguration.isHosted?this._accountCollectionServiceDefinition[n.id]===undefined||this._accountCollectionServiceDefinition[n.id]===null?(t=n,this._getEmsCollections(t).then(function(u){f._accountCollectionServiceDefinition[n.id]=u;var e=r.HttpClientProvider.getHttpClient(l.ExtensionManagementHttpClient,u.locationMappings[0].location,t.id,t.tenantId);f._collectionLevelEmsClients[u.identifier]=e;i.resolve(e)},function(n){i.reject(n)})):(this._collectionLevelEmsClients[this._accountCollectionServiceDefinition[n.id].identifier]===undefined&&(u=r.HttpClientProvider.getHttpClient(l.ExtensionManagementHttpClient,this._accountCollectionServiceDefinition[n.id].locationMappings[0].location,t.id,t.tenantId),this._collectionLevelEmsClients[this._accountCollectionServiceDefinition[n.id].identifier]=u),i.resolve(this._collectionLevelEmsClients[this._accountCollectionServiceDefinition[n.id].identifier])):(this._collectionLevelEmsClients[n.id]===undefined&&(u=a.getCollectionClient(l.ExtensionManagementHttpClient,this._getCollectionContext(n)),this._collectionLevelEmsClients[n.id]=u),i.resolve(this._collectionLevelEmsClients[n.id])),i.promise()},n.prototype._getEmsCollections=function(n){var t=$.Deferred(),i=r.HttpClientProvider.getHttpClient(s.LocationsHttpClient,n.spsAccountUrl,n.id,n.tenantId);return i.getServiceDefinition("LocationService2","").then(function(u){if(u&&u.value){var f=u.value.filter(function(n){return n.identifier==="00000028-0000-8888-8000-000000000000"}),e=f[0].locationMappings[0].location;i=r.HttpClientProvider.getHttpClient(s.LocationsHttpClient,e,n.id,n.tenantId);i.getServiceDefinition("LocationService2","").then(function(n){if(n&&n.value){var i=n.value.filter(function(n){return n.properties["Microsoft.TeamFoundation.Location.CollectionName"]});t.resolve(i[0])}else t.reject(new Error(p.AcquireItemGenericError))},function(n){t.reject(n)})}else t.reject(new Error(p.AcquireItemGenericError))},function(n){t.reject(n)}),t.promise()},n.prototype.acquireItemEms=function(n,t,r,e,o,s,l){var a,p,b,w,k;return s===void 0&&(s=[]),a=i.defer(),p=null,t?s.forEach(function(n){n.id===t&&(p=n)}):t=u.SubscriptionConstants.EmptyGuid,n?(b=f.ItemModelHelper.getFullyQualifiedNameForItem(n.publisherName,n.name),w=y.AcquisitionOperationType.Request,r===f.VSSItemAcquisitionOption.Buy?w=y.AcquisitionOperationType.Buy:r===f.VSSItemAcquisitionOption.Install?w=y.AcquisitionOperationType.Install:r===f.VSSItemAcquisitionOption.Try&&(w=y.AcquisitionOperationType.Try),k={assignmentType:y.AcquisitionAssignmentType.None,billingId:e,itemId:b,operationType:w,quantity:o,properties:{}},l&&(k.properties.requestMessage=l),p=p?p:{},this._getCollectionEmsClient(p).then(function(t){t.requestAcquisition(k).then(function(n){a.resolve(n)},function(t){var i={},r=h.CustomerIntelligenceConstants.MarketPlaceIntelligencePropertyName;i[r.ITEM_NAME]=b;i[r.PRICE_CATEGORY]=v.priceCategory[n.priceCategory];i[r.OPERATION]=f.VSSItemAcquisitionOption[w];i[r.ERROR]=JSON.stringify(t);c.TelemetryHelper.publishEvent(h.CustomerIntelligenceConstants.MarketPlaceIntelligenceErrors.ACQUIRE_ITEM_ERROR,i);a.reject(t)})},function(n){a.reject(n)})):a.reject("item is invalid"),a.promise},n.prototype.getEmsAcquisitionOptions=function(n,t,r,u){var f,e;return r===void 0&&(r=!1),u===void 0&&(u=!1),f=i.defer(),n&&t?(e=n.publisherName+"."+n.name,this._getCollectionEmsClient(t).then(function(n){n.getAcquisitionOptions(e,r,u).then(function(n){var t=n.defaultOperation;f.resolve(t)},function(n){f.reject(n)})},function(n){f.reject(n)})):f.reject("item is invalid"),f.promise},n}();t.VSSExtensionManagement=w});
define("VSS/WebApi/Constants",["require","exports"],function(n,t){var i,r,u,f,e,o,s,h,c,l,a,v,y;(function(n){n.PublicAccessMappingMoniker="PublicAccessMapping";n.ServerAccessMappingMoniker="ServerAccessMapping";n.ClientAccessMappingMoniker="ClientAccessMapping";n.HostGuidAccessMappingMoniker="HostGuidAccessMapping";n.RootDomainMappingMoniker="RootDomainMapping";n.AzureInstanceMappingMoniker="AzureInstanceMapping"})(i=t.AccessMappingConstants||(t.AccessMappingConstants={})),function(n){n.AuthenticationLocationId="11420b6b-3324-490a-848d-b8aafdb906ba";n.AreaId="A084B81B-0F23-4136-BAEA-98E07F3C7446";n.AuthenticationAreaName="WebPlatformAuth";n.SessionTokenResource="SessionToken"}(r=t.AuthenticationResourceIds||(t.AuthenticationResourceIds={})),function(n){n.ResourceId="8907fe1c-346a-455b-9ab9-dde883687231";n.ResourceString="{8907fe1c-346a-455b-9ab9-dde883687231}";n.ResouceName="BlobCopyRequest";n.AreaName="BlobCopyRequest"}(u=t.BlobCopyLocationIds||(t.BlobCopyLocationIds={})),function(n){n.IdentitiesLocationId="4102f006-0b23-4b26-bb1b-b661605e6b33";n.IdentityAvatarLocationId="4d9b6936-e96a-4a42-8c3b-81e8337cd010";n.IdentityFeatureMruLocationId="839e4258-f559-421b-a38e-b6e691967ab3";n.IdentityConnectionsLocationId="c01af8fd-2a61-4811-a7a3-b85bcec080af";n.ServiceArea="IdentityPicker";n.IdentitiesResource="Identities"}(f=t.CommonIdentityPickerResourceIds||(t.CommonIdentityPickerResourceIds={})),function(n){n.DataProvidersQueryLocationId="738368db-35ee-4b85-9f94-77ed34af2b0d";n.InstalledAppsLocationId="2648442b-fd63-4b9a-902f-0c913510f139";n.InstalledAppsByNameLocationId="3e2f6668-0798-4dcb-b592-bfe2fa57fde2";n.VDiscId="0edf7a35-282d-44f1-a0cf-d7ec1c1afeff";n.VersionDiscoveryLocationId="c2088efa-e2c2-4025-8062-4dd27b6ac83e";n.VDiscCompatLocationId="5c026a00-bd90-4fde-862a-268345cc58b0";n.AreaId="8477AEC9-A4C7-4BD4-A456-BA4C53C989CB";n.ContributionsAreaName="Contribution";n.ExtensionsAreaName="Extensions";n.DataProvidersQueryLocationIdString="738368DB-35EE-4B85-9F94-77ED34AF2B0D";n.InstalledExtensionsLocationIdString="2648442B-FD63-4B9A-902F-0C913510F139";n.InstalledExtensionsByNameLocationIdString="3E2F6668-0798-4DCB-B592-BFE2FA57FDE2";n.VersionDiscoveryLocationIdString="C2088EFA-E2C2-4025-8062-4DD27B6AC83E";n.VDiscCompatLocationIdString="5C026A00-BD90-4FDE-862A-268345CC58B0"}(e=t.ContributionsResourceIds||(t.ContributionsResourceIds={})),function(n){n.EventsLocationId="b5cc35c2-ff2b-491d-a085-24b6e9f396fd";n.AreaId="40132BEE-F5F3-4F39-847F-80CC44AD9ADD";n.CustomerIntelligenceAreaName="CustomerIntelligence"}(o=t.CustomerIntelligenceResourceIds||(t.CustomerIntelligenceResourceIds={})),function(n){n.ResourceId="d56223df-8ccd-45c9-89b4-eddf69240000";n.ResourceString="{D56223DF-8CCD-45C9-89B4-EDDF69240000}";n.ResouceName="DatabaseMigration";n.AreaName="DatabaseMigration"}(s=t.DatabaseMigrationLocationIds||(t.DatabaseMigrationLocationIds={})),function(n){n.ServiceInstanceType="$ServiceInstanceType"}(h=t.ExtensionTemplateContextItemNames||(t.ExtensionTemplateContextItemNames={})),function(n){n.FeatureFlagsLocationId="3e2b80f8-9e6f-441e-8393-005610692d9c";n.AreaId="C8E5AF97-4B95-4E73-9E7F-69A06507967C";n.FeatureAvailabilityAreaName="FeatureAvailability"}(c=t.FeatureAvailabilityResourceIds||(t.FeatureAvailabilityResourceIds={})),function(n){n.MruIdentitiesLocationId="15d952a1-bb4e-436c-88ca-cfe1e9ff3331";n.AreaId="FC3682BE-3D6C-427A-87C8-E527B16A1D05";n.AreaName="Identity";n.MruIdentitiesResource="MruIdentities"}(l=t.IdentityMruResourceIds||(t.IdentityMruResourceIds={})),function(n){n.ConnectionData="00d9565f-ed9c-4a06-9a50-00e7896ccab4";n.ServiceDefinitions="d810a47d-f4f4-4a62-a03f-fa1860585c4c";n.AccessMappings="a52f2f69-b171-4e88-9dfe-34b44cf7e386";n.LocationServiceArea="Location";n.ConnectionDataResource="ConnectionData";n.ServiceDefinitionsResource="ServiceDefinitions";n.AccessMappingsResource="AccessMappings"}(a=t.LocationResourceIds||(t.LocationResourceIds={})),function(n){n.OperationsLocationId="9a1b74b4-2ca8-4a9f-8470-c2f2e6fdc949";n.AreaName="operations";n.OperationsResource="operations";n.OperationsRouteName="Operations";n.OperationsApi="OperationsApi"}(v=t.OperationsResourceIds||(t.OperationsResourceIds={})),function(n){n.SPS="951917ac-a960-4999-8464-e3f0aa25b381";n.TFS="00025394-6065-48ca-87d9-7f5672854ef7";n.TFSOnPremises="87966eaa-cb2a-443f-be3c-47bd3b5bf3cb";n.SpsExtension="00000024-0000-8888-8000-000000000000";n.SDKSample="ffffffff-0000-8888-8000-000000000000";n.SPSString="951917AC-A960-4999-8464-E3F0AA25B381";n.TFSString="00025394-6065-48CA-87D9-7F5672854EF7";n.TFSOnPremisesString="87966EAA-CB2A-443F-BE3C-47BD3B5BF3CB";n.SpsExtensionString="00000024-0000-8888-8000-000000000000";n.SDKSampleString="FFFFFFFF-0000-8888-8000-000000000000"}(y=t.ServiceInstanceTypes||(t.ServiceInstanceTypes={}))});
define("Gallery/Client/Controls/VSSAccountSelection/VSSAccountSelection",["require","exports","VSS/Adapters/Knockout"],function(n,t,i){var r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(i.TemplateControl);t.VSSAccountSelection=r});
define("Gallery/Client/Controls/TargetSelection/TargetSelection.ViewModel",["require","exports","q","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","knockout","VSS/Adapters/Knockout","Gallery/Client/Service/VSSItem","Gallery/Client/URLHelper","VSS/Utils/String"],function(n,t,i,r,u,f,e,o,s){var h=function(n){function t(t){var i=this;n.call(this);this.stepId="targetSelection";this.availableTargets=u.observableArray([]);this.selectedTarget=u.observable(null);this.headerVisible=u.observable(!0);this.showButtons=u.observable(!0);this.cancelButtonText=r.CancelButtonText;this.completeButtonText=u.observable("");this.targetStatusCheckErrorMessage=u.observable(null);this.isValid=u.observable(!0);this.isCompleted=u.observable(!1);this.isActive=u.observable(!1);this.isHidden=u.observable(!1);this.isWarning=u.observable(!0);this.targetStatusText=u.observable(null);this.readonlyContainerVisible=u.observable(!1);this.editContainerVisible=u.observable(!1);this.showCancelButton=u.observable(!1);this.cancelButtonLink=o.GalleryURLs.getHomePageURL();this.showTargetCheckingExperience=u.observable(!1);this.targetCheckingMessage=u.observable("");this.targetSelectedText=u.observable("");this.disableContinueButton=u.observable(!1);this.disableTargetPicker=u.observable(!1);this._completionPreProcess=null;this._options=t;this.availableTargets(t.targets);this.completeButtonText(r.ContinueButtonText);t.completionPreProcess&&(this._completionPreProcess=t.completionPreProcess);this.selectedTarget.subscribe(function(){i.targetStatusCheckErrorMessage(null);i.isWarning(!1);i.disableContinueButton(!1);i.completeButtonText(r.ContinueButtonText);i.targetStatusText(null);var n=o.GalleryURLs.isAccountIdSet(location.search);(i._options.isAlwaysEditable||n)&&(i.isCompleted(!1),i.completeStep())})}return __extends(t,n),t.prototype.reset=function(){},t.prototype.startEdit=function(){var t=this._options,n;t.targets&&t.targets.length>0&&(n=null,t.targetId&&(n=t.targets.filter(function(n){return n.id===t.targetId}),n&&n.length>0&&this.selectedTarget(n[0])),n&&n.length!==0||this.selectedTarget(t.targets[0]));this.readonlyContainerVisible(!1);this.editContainerVisible(!0);this.headerVisible(!0);this.isActive(!0);this.isCompleted(!1)},t.prototype.completeStep=function(){var n=this,t=function(){return n._options.isAlwaysEditable||n.targetSelectionCompleteStep(),n.isCompleted(!0),i.resolve(!0)};if(this.selectedTarget())return this._completionPreProcess?(this.showTargetCheckingExperience(!0),this.disableContinueButton(!0),this.disableTargetPicker(!0),this._completionPreProcess(this.selectedTarget()).then(function(i){return n.showTargetCheckingExperience(!1),n.disableTargetPicker(!1),i?t():void 0})):t()},t.prototype.setTargetAsActionPerformed=function(n,t,i){var u,f;this.isWarning(!1);switch(n){case e.VSSItemAcquisitionOption.Install:u=i?i:this._alreadyInstalledText;this.completeButtonText(r.ItemAlreadyInstalled);break;case e.VSSItemAcquisitionOption.Request:u=i?i:this._alreadyRequestedText;this.completeButtonText(r.ItemAlreadyRequested);break;case e.VSSItemAcquisitionOption.Try:u=i?i:this._alreadyRegisteredText;this.completeButtonText(r.ItemAlreadyUnderTrial);break;case e.VSSItemAcquisitionOption.None:u=i?i:this._noActionAvailableText;this.completeButtonText(r.ItemAlreadyInstalled)}t.id===this.selectedTarget().id&&(f=$("<a>").attr("href",t.uri).text(t.name).attr("target","_blank").addClass("target-name"),u=s.format(u,f[0].outerHTML),this.availableTargets().length>1&&(u=u+this._multiTargetAlreadyInstalledText),this.targetStatusText(u),this.disableContinueButton(!0))},t.prototype.targetSelectionCompleteStep=function(){this.editContainerVisible(!1);this.headerVisible(!1);this.disableContinueButton(!1);this.readonlyContainerVisible(!0);this.isActive(!1)},t.prototype.setTargetAsDisallowed=function(n){this.targetStatusText(n);this.isWarning(!1);this.disableContinueButton(!0)},t}(f.TemplateViewModel);t.TargetSelectionViewModel=h});
define("Gallery/Client/Controls/VSSAccountSelection/VSSAccountSelection.ViewModel",["require","exports","knockout","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/Controls/TargetSelection/TargetSelection.ViewModel","Gallery/Client/Common/Utility","VSS/Utils/String"],function(n,t,i,r,u,f,e){var o=function(n){function t(t){var u=this;n.call(this,{targets:t.accounts,targetId:t.targetAccountId,completionPreProcess:t.completionPreProcess,isAlwaysEditable:t.isAlwaysEditable});this.createNewAccountUrl=i.observable("");this.vssAccountSelectionCreateNewAccount=r.CreateNewAccount_Link_Text;this.isNewAccount=i.observable(!1);this.accountLoadingErrorMessage=i.observable(null);this.shouldRefreshAccounts=i.observable(!1);this.showAccountLoadingExperience=i.observable(!1);this.loadingAccountsMessage=r.LoadingAccountsMessage;this.accountLoadingMessage=i.observable(r.LoadingAccountsMessage);this._accountIdParam="accountId";this.stepId="accountSelection";this.createNewAccountUrl(t.createNewAccountUrl);this._targetSelectionHeader=r.VSSAccountSelectionHeader;t.accountSelectionReadOnlyText?this.targetSelectedText(t.accountSelectionReadOnlyText):this.targetSelectedText(r.AccountSelectionReadOnlyText);this._targetSelectionHelpText=r.AccountSelectionHelpText;this._noTargetsAvailableText=r.NoAccountsAvailableText;this._alreadyInstalledText=r.VSS_Install_AlreadyInstalledText;this._multiTargetAlreadyInstalledText=r.MultiAccountAlreadyInstalled;this._alreadyRequestedText=r.VSS_Request_AlreadyRequestedText;this._multiTargetAlreadyRequestedText=r.MultiAccountAlreadyRequested;this._noActionAvailableText=r.VSS_NoActionAvailable;this._multiTargetNoActionAvailableText=r.MultiAccountAlreadyInstalled;this._alreadyRegisteredText=r.ExtensionAlreadyUnderTrial;this._multiTargetAlreadyRegisteredText=r.MultiAccountAlreadyRequested;this._targetSelectionHelpText=t.accountSelectionHelpText?t.accountSelectionHelpText:r.AccountSelectionHelpText;this.availableTargets.subscribe(function(n){var i,r;if(n.length>0){if(i=f.UrlUtils.parseUrlParameter(u._accountIdParam),!i&&t.targetAccountId&&(i=t.targetAccountId),i&&i!==""&&(r=n.filter(function(n){return n.id===i}),r&&r.length>0)){u.selectedTarget(r[0]);return}u.selectedTarget(n[0])}});this.selectedTargetName=this.computed(function(){if(u.selectedTarget()){u.targetCheckingMessage(e.format("{0} {1}",r.SelectedAccountCheckMessage,u.selectedTarget().name));return f.getAccountNameFromAccountUrl(u.selectedTarget().uri)}return""})}return __extends(t,n),t.prototype.reset=function(){},t.prototype.refreshAccounts=function(){this.shouldRefreshAccounts(!0);this.showAccountLoadingExperience(!0);this.editContainerVisible(!1)},t.prototype.onNewAccountButtonClick=function(){return this.isNewAccount(!0),!0},t.prototype.setAccountAsDisallowed=function(t){n.prototype.setTargetAsDisallowed.call(this,t?t:r.AcquireItem_Disallowed_DefaultMessage)},t}(u.TargetSelectionViewModel);t.VSSAccountSelectionViewModel=o});
define("Gallery/Client/Controls/VSSCollectionSelection/VSSCollectionSelection",["require","exports","VSS/Adapters/Knockout"],function(n,t,i){var r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(i.TemplateControl);t.VSSCollectionSelection=r});
define("Gallery/Client/Controls/PackageCompatCheck/PackageCompatCheck.View",["require","exports","VSS/Adapters/Knockout"],function(n,t,i){var r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(i.TemplateControl);t.PackageCompatCheck=r});
define("Gallery/Client/Controls/PackageCompatCheck/PackageCompatCheck.ViewModel",["require","exports","knockout","VSS/Adapters/Knockout","VSS/Operations/Contracts","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/URLHelper","Gallery/Client/Service/VSSItem"],function(n,t,i,r,u,f,e,o){var s=function(n){function t(t){n.call(this);this.isValid=i.observable(!0);this.isCompleted=i.observable(!1);this.isActive=i.observable(!1);this.isHidden=i.observable(!1);this.hasNonRecoverableError=i.observable(!1);this.gettingThingsReady=f.GettingThingsReady;this.completeButtonText=f.VSS_Install_RequestButtonText;this.cancelButtonText=f.CancelButtonText;this.cancelButtonLink=e.GalleryURLs.getHomePageURL();this.stepId="packageCompat";this.isStepCancellable=!1;this.errorMessage="";this._options=t;this.completeButtonText=t.completeButtonText}return __extends(t,n),t.prototype.reset=function(){},t.prototype.startEdit=function(){this.isActive(!0);this.isCompleted(!1);this._startDownloadAndPublish()},t.prototype._startDownloadAndPublish=function(){var n=this;this._options.externalDataProvider.waitForOperation(this._options.publishJobId,t.VALIDATION_QUERY_POLL_INTERVAL,t.VALIDATION_QUERY_MAX_RETRIES).then(function(i){i.status===u.OperationStatus.Succeeded?n._options.galleryDataProvider.waitForExtensionValidation(n._options.detailedItem.publisherName,n._options.detailedItem.name,t.VALIDATION_QUERY_POLL_INTERVAL,t.VALIDATION_QUERY_MAX_RETRIES).then(function(){n._loadExtensionScopes()}):n._handleError(i.resultMessage)},function(t){n._handleError(t)})},t.prototype._loadExtensionScopes=function(){var n=this,t;if(!this._options.detailedItem){this.completeStep();return}t=o.ItemModelHelper.getFullyQualifiedNameForItem(this._options.detailedItem.publisherName,this._options.detailedItem.name);this._options.galleryDataProvider.getExtensionScopes(t).then(function(t){n._options.detailedItem.scopes=t;n.completeStep()})},t.prototype.completeStep=function(){this.isCompleted(!0);this.isActive(!1)},t.prototype._handleError=function(n){this.errorMessage=n?n:f.ErrorDownloadingExtension;this.hasNonRecoverableError(!0)},t.VALIDATION_QUERY_POLL_INTERVAL=1e3,t.VALIDATION_QUERY_MAX_RETRIES=10,t}(r.TemplateViewModel);t.PackageCompatCheckViewModel=s});
define("Gallery/Client/Controls/VSSCollectionSelection/VSSCollectionSelection.ViewModel",["require","exports","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/Controls/TargetSelection/TargetSelection.ViewModel","VSS/Utils/String"],function(n,t,i,r,u){var f=function(n){function t(t){var r=this;n.call(this,{targets:t.collections,targetId:t.targetCollectionId,completionPreProcess:t.onCollectionSelected,isAlwaysEditable:t.isAlwaysEditable});this.stepId="collectionSelection";this._noTargetsAvailableText=i.NoCollectionsAvailableText;this._targetSelectionHeader=i.VSSCollectionSelectionHeader;this.targetSelectedText(u.format(i.CollectionSelectionReadOnlyText,t.targetServerName));this._targetSelectionHelpText=t.isAlwaysEditable?"":i.CollectionSelectionHelpText;this._alreadyInstalledText=i.VSSCollectionAlreadyInstalledText;this._multiTargetAlreadyInstalledText=i.VSSCollectionMultiCollectionAlreadyInstalled;this._alreadyRequestedText=i.VSSCollectionAlreadyRequestedText;this._multiTargetAlreadyRequestedText=i.VSSCollectionMultiCollectionAlreadyRequested;this._noActionAvailableText=i.VSSCollectionNoActionAvailable;this._multiTargetNoActionAvailableText=i.VSSCollectionMultiCollectionAlreadyInstalled;this.selectedTargetName=this.computed(function(){return r.selectedTarget()?(r.targetCheckingMessage(u.format("{0} {1}",i.SelectedAccountCheckMessage,r.selectedTarget().name)),r.selectedTarget().name):""})}return __extends(t,n),t.prototype.reset=function(){},t.prototype.setCollectionAsDisallowed=function(t){n.prototype.setTargetAsDisallowed.call(this,t?t:i.VSSCollectionAcquireItemDisallowedDefaultMessage)},t}(r.TargetSelectionViewModel);t.VSSCollectionSelectionViewModel=f});
define("Gallery/Client/Controls/VSSRequestItem/VSSRequestItem.View",["require","exports","VSS/Adapters/Knockout"],function(n,t,i){var r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(i.TemplateControl);t.VSSRequestItem=r});
define("Gallery/Client/Controls/VSSRequestItem/VSSRequestItem.ViewModel",["require","exports","knockout","VSS/Context","VSS/Adapters/Knockout","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/URLHelper"],function(n,t,i,r,u,f,e){var o=function(n){function t(t){n.call(this);this.isValid=i.observable(!0);this.isCompleted=i.observable(!1);this.isActive=i.observable(!1);this.isHidden=i.observable(!0);this.requestHeaderText=f.VSS_RequestItemHeader;this.requestStepHeaderText=f.ConfirmRequestText;this.requestReason=i.observable("");this.requestMaxLength=1e3;this.completeButtonText=f.VSS_Install_RequestButtonText;this.cancelButtonText=f.CancelButtonText;this.cancelButtonLink=e.GalleryURLs.getHomePageURL();this.enabled=i.observable(!0);this.isWarning=i.observable(!0);this.targetStatusText=i.observable(null);this.requestHelpText=f.VSS_RequestHelpText;this.stepId="request";this.showRequestingExperience=i.observable(!1);this.requestingItemMessage="Requesting";this.completeButtonText=t.completeButtonText;r.getPageContext().webAccessConfiguration.isHosted||(this.requestHelpText=f.CollectionInstallRequestHelpText)}return __extends(t,n),t.prototype.reset=function(){},t.prototype.startEdit=function(){this.isActive(!0);this.enabled(!0);this.isCompleted(!0)},t.prototype.completeStep=function(){this.enabled(!1);this.isCompleted(!0);this.isActive(!1)},t}(u.TemplateViewModel);t.VSSRequestItemViewModel=o});
define("VSS/Controls/PopupContent",["require","exports","VSS/Diag","VSS/Utils/Core","VSS/Controls","VSS/Utils/UI"],function(n,t,i,r,u,f){var o=f.domElem,e=r.delegate,s=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.initialize=function(){n.prototype.initialize.call(this);this._element.addClass("popup-content-control");this.hide()},t.prototype.setContent=function(n){this._$contentContainer.html(n);this._contentSet=!0},t.prototype.resetContent=function(){this._contentSet=!1},t.prototype.show=function(){this._onShow()},t.prototype.hide=function(){this._onHide()},t.prototype.toggle=function(){this._element.is(":visible")?this.hide():this.show()},t.prototype._enhance=function(n){var t=this;this._createElement();this._$dropElement=n;this._element.appendTo(this._options.menuContainer||$(document.body));this._element.css("position","fixed");this._$contentContainer=$(o("div","popup-content-container")).appendTo(this._element);this._decorate();n.bind("remove.removePopupDropElement",function(){t.dispose()})},t.prototype._decorate=function(){var n=this;this._options.openCloseOnHover?(this._bind(this._$dropElement,"mouseover",e(this,this._onShow)),this._bind(this._$dropElement,"mouseout",e(this,this._onHide))):(this._documentEventDelegate=e(this,this._handleDocumentMouseDown),this._bind(this._$dropElement,"click",function(){n._element.is(":visible")?n._onHide():n._onShow()}));f.attachResize(this._element,e(this,this._setPosition))},t.prototype._handleDocumentMouseDown=function(n){var t=$(n.target);this._$dropElement.has(n.target).length>0||this._$dropElement[0]===n.target||this._$contentContainer.has(n.target).length>0||this._$contentContainer[0]===n.target||this._element.has(n.target).length>0||this._element[0]===n.target||this._onHide()},t.prototype._setPosition=function(){this._element.css({top:0,left:0});f.Positioning.position(this._element,this._$dropElement,{elementAlign:this._options.elementAlign||"left-top",baseAlign:this._options.baseAlign||"left-bottom",overflow:this._options.overflow,supportScroll:this._options.supportScroll,leftOffsetPixels:this._options.leftOffsetPixels,topOffsetPixels:this._options.topOffsetPixels})},t.prototype._getDropElement=function(){return this._$dropElement},t.prototype._onShow=function(){!this._contentSet&&this._options.content&&($.isFunction(this._options.content)?this.setContent(this._options.content.call(this)):this.setContent(this._options.content),this._contentSet=!0);this._setPosition();this._element.show();this._fire("popup-opened");this._documentEventDelegate&&$(document).bind("mousedown",this._documentEventDelegate)},t.prototype._onHide=function(){this._documentEventDelegate&&$(document).unbind("mousedown",this._documentEventDelegate);this._element.hide();this._fire("popup-closed")},t.prototype._dispose=function(){n.prototype._dispose.call(this);this._documentEventDelegate&&($(document).unbind("mousedown",this._documentEventDelegate),this._documentEventDelegate=null);this._$dropElement&&this._$dropElement.length>=1&&(this._unbind(this._$dropElement,"click"),this._unbind(this._$dropElement,"mouseover"),this._unbind(this._$dropElement,"mouseout"));f.detachResize(this._element)},t}(u.BaseControl),h;t.PopupContentControl=s;h=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({coreCssClass:"rich-content-tooltip",openCloseOnHover:!0},t))},t.prototype.initialize=function(){this._$popupTag=$(o("div","popup-tag")).appendTo(this._element);n.prototype.initialize.call(this)},t.prototype._getPopupTooltipElement=function(){return this._$popupTag},t.prototype._setPosition=function(){n.prototype._setPosition.call(this);this._$popupTag.css({top:0,left:0});f.Positioning.position(this._$popupTag,this._getDropElement(),{elementAlign:"left-top",baseAlign:"left-bottom",topOffsetPixels:this._options.topOffsetPixels});this._$popupTag.css("top")>this._$popupTag.parent().css("top")?(this._$popupTag.css({"-moz-transform":"scaleY(-1)","-o-transform":"scaleY(-1)","-webkit-transform":"scaleY(-1)",transform:"scaleY(-1)",filter:"FlipV","-ms-filter":"FlipV"}),this._$popupTag.css("top",parseInt(this._$popupTag.css("top"),10)-(this._getDropElement().height()+this._$popupTag.height())+"px"),this._$popupTag.parent().css("top",parseInt(this._$popupTag.parent().css("top"),10)-(this._$popupTag.height()-1)+"px")):this._$popupTag.css({"-moz-transform":"scaleY(1)","-o-transform":"scaleY(1)","-webkit-transform":"scaleY(1)",transform:"scaleY(1)",filter:"","-ms-filter":""})},t}(s);t.RichContentTooltip=h});
define("Gallery/Client/Controls/SubscriptionSelection/SubscriptionSelection.View",["require","exports","VSS/Adapters/Knockout","VSS/Controls","VSS/Controls/PopupContent","VSS/Utils/String","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery"],function(n,t,i,r,u,f,e){var o=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.initialize=function(){n.prototype.initialize.call(this);var t=this.getElement(),i=t.find(".info-container").first(),o=f.format("<a href='{0}' target='_blank'>"+e.LearnMore+"<\/a>",e.SubscriptionPickerInformationLink),s=e.SubscriptionPickerInformationText+" "+o;r.Enhancement.enhance(u.RichContentTooltip,i,{cssClass:"subscription-help-tooltip",content:s,openCloseOnHover:!1,elementAlign:"left-bottom",baseAlign:"right-top"})},t}(i.TemplateControl);t.SubscriptionSelection=o});
define("Gallery/Client/Controls/SubscriptionSelection/SubscriptionSelection.ViewModel",["require","exports","knockout","VSS/Adapters/Knockout","Gallery/Client/Service/VSSCommerce/IVSSCommerce","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/Common/Telemetry","Gallery/Client/Service/VSSItem","Gallery/Client/Common/Utility","q","VSS/Utils/Core","VSS/Events/Services"],function(n,t,i,r,u,f,e,o,s,h,c,l){var v=s.WindowWrapper,p=c.delegate,a=e.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.AcquisitionWorkFlowProperties,y=function(n){function t(t){var r=this;n.call(this);this.availableSubscriptions=i.observableArray([]);this.selectedSubscription=i.observable(null);this.validateSubscriptionMsg=i.observable("");this.createNewSubscriptionUrl=i.observable("");this.newSubscriptionId=i.observable("");this.readonlyContainerVisible=i.observable(!1);this.editContainerVisible=i.observable(!1);this.headerVisible=i.observable(!0);this.isSubscriptionAvailable=i.observable(!1);this.subscriptionSelectionDisabled=i.observable(!1);this.isCreateNewClicked=i.observable(!1);this.showSubscriptionValidatonLoadingExp=i.observable(!1);this.accountLinkedToDifferentSubscriptionMessage=i.observable("");this.subscriptionLoadingErrorMessage=i.observable(null);this.subscriptionValidationErrorMessage=i.observable(null);this.subscriptionSelectionHeader=f.SubscriptionSelectionHeader;this.createNewSubscription=f.CreateNewSubscription_Link_Text;this.subscriptionSelectedText=f.SubscriptionSelectionReadOnlyText;this.continueButtonText=f.ContinueButtonText;this.subscriptionsNotAvailable=f.SubscriptionNotAvailableText;this.showLoadingExperience=i.observable(!1);this.loadingSubscriptionsMessage=f.LoadingAzureSubscriptionsMessage;this.subscriptionPickerHelpText=i.observable(f.BilledToSubscription);this.accountId=null;this.itemName=null;this.selectedSubscriptionName=this.computed(function(){return r.validateSubscriptionMsg(""),r.selectedSubscription()?r.selectedSubscription().subscriptionName:f.None_Label});this.isValid=i.observable(!0);this.isCompleted=i.observable(!1);this.isContinueCompleted=i.observable(!1);this.isActive=i.observable(!1);this.isHidden=i.observable(!1);this.stepId="subscriptionSelection";this.isNew=this.computed(function(){return r.selectedSubscription()!==null&&r.newSubscriptionId()!==null?r._normalizeSubscriptionId(r.selectedSubscription().subscriptionId)===r.newSubscriptionId():!1});this.disableContinueButtonAndShowStatusMsg=this.computed(function(){return r.validateSubscriptionMsg()!==""?!0:!1});this.isSubscriptionValidated=i.observable(!1);this._subscriptionIdQuery="subscriptionId";this._subscriptionCreationUrl=t.subscriptionCreationUrl?t.subscriptionCreationUrl:$.parseJSON($(".vss-subscription-creation").html());this.availableSubscriptions(t.subscriptions);this.isSubscriptionForExtension=t.isExtension;this._completionPreProcess=t.completionPreProcess;var e=v.getCurrentUrl(),u=/subscriptionId=([\d\w-]*)[#&]?/g.exec(e);u!=null&&this.newSubscriptionId(this._normalizeSubscriptionId(u[1]));this.availableSubscriptions.subscribe(function(n){n.length>0&&r.selectedSubscription(n[0])});this._item=t.item;this.selectedSubscription.subscribe(function(){r.subscriptionValidationErrorMessage(null)});this.itemName=o.ItemModelHelper.getFullyQualifiedNameForItem(t.item.publisherName,t.item.name)}return __extends(t,n),t.prototype._normalizeSubscriptionId=function(n){return n.replace("-","").toLowerCase()},t.prototype.reset=function(){},t.prototype.startEdit=function(){this.readonlyContainerVisible(!1);this.editContainerVisible(!0);this.headerVisible(!0);this.isActive(!0);this.isCompleted(!1);var n=this._getSubscriptionFromUrlParams(this.availableSubscriptions());n&&(this.selectedSubscription(n),this.validate())},t.prototype.storeCookieAndRedirect=function(){var t=this,n;l.getService().fire(u.CommerceConstants.CreateNewSubscriptionEvent);s.storeRedirectionCookie(this.accountId,this.itemName);this.isCreateNewClicked(!0);n={};n[a.Id]=o.ItemModelHelper.getFullyQualifiedNameForItem(this._item.publisherName,this._item.name);n[a.AvailableSubscriptions]=this.availableSubscriptions().length;n[a.ProductType]=o.ItemModelHelper.getItemTypeText(this._item.itemType);h.allSettled([e.TelemetryHelper.publishEventAsync(e.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.CREATE_AZURE_SUBSCRIPTION,n)]).then(function(){s.WindowWrapper.open(t._subscriptionCreationUrl)})},t.prototype.validate=function(){var t=this,n=h.defer();return s.FeatureFlagUtils.isACSDecommissionMode()?this._completionPreProcess&&this._completionPreProcess(this.selectedSubscription()).then(function(){t.isContinueCompleted(!0);n.resolve(!0)},function(i){i&&i.message&&i.message.length>0?t.subscriptionValidationErrorMessage(i.message):t.subscriptionValidationErrorMessage(f.ValidateSubscription_ErrorMessage);n.reject(i)}):(this.isContinueCompleted(!0),n.resolve(!0)),n.promise},t.prototype.completeStep=function(){this.selectedSubscription()&&this.isSubscriptionValidated()&&(this.readonlyContainerVisible(!0),this.editContainerVisible(!1),this.headerVisible(!1),this.isCompleted(!0),this.isActive(!1))},t.prototype._getSubscriptionFromUrlParams=function(n){var i,t,r;if(!n||(i=s.UrlUtils.parseUrlParameter(this._subscriptionIdQuery),i===""))return null;for(t=0,r=n.length;t<r;t++)if(n[t].subscriptionId===i)return n[t];return null},t}(r.TemplateViewModel);t.SubscriptionSelectionViewModel=y});
define("Gallery/Client/Controls/BuyCustomizationBase/BuyCustomizationBase.View",["require","exports","VSS/Adapters/Knockout","VSS/Controls","VSS/Controls/PopupContent","VSS/Utils/String","VSS/Utils/Core","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery"],function(n,t,i,r,u,f,e,o){var s=e.delegate,h=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.initialize=function(){n.prototype.initialize.call(this);this.getViewModel().onActiveUsersCountChanged=s(this,this._onActiveUsersCountChanaged)},t.prototype._disposeExistingPopup=function(){this._popupContentTooltip&&(this._popupContentTooltip.dispose(),delete this._popupContentTooltip);$(".buy-customization-help-tooltip").remove()},t.prototype._onActiveUsersCountChanaged=function(n){var i;this._disposeExistingPopup();var e=this.getElement(),t=e.find(".active-user-info").first(),s=f.format(o.ActiveUsersQuantityText,n);t.length>0&&(i=r.Enhancement.enhance(u.RichContentTooltip,t,{cssClass:"buy-customization-help-tooltip",content:s,openCloseOnHover:!1,elementAlign:"left-bottom",baseAlign:"right-top"}),this._popupContentTooltip=i)},t.prototype._cleanup=function(){this._disposeExistingPopup();n.prototype._cleanup.call(this)},t}(i.TemplateControl);t.BuyCustomizationBase=h});
define("Gallery/Client/Controls/AccountBasedPurchaseDetails/AccountBasedPurchaseDetails.View",["require","exports","Gallery/Client/Controls/BuyCustomizationBase/BuyCustomizationBase.View"],function(n,t,i){var r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(i.BuyCustomizationBase);t.AccountBasedPurchaseDetailsView=r});
define("Gallery/Client/Controls/BuyCustomizationBase/BuyCustomizationBase.ViewModel",["require","exports","knockout","VSS/Adapters/Knockout","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery"],function(n,t,i,r,u){var f=function(n){function t(){n.apply(this,arguments);this.isValid=i.observable(!0);this.isCompleted=i.observable(!1);this.isActive=i.observable(!1);this.isHidden=i.observable(!1);this.item=i.observable(null);this.readonlyContainerVisible=i.observable(!1);this.editContainerVisible=i.observable(!1);this.isSubsequentPurchase=i.observable(!1);this.headerVisible=i.observable(!0);this.cancelButtonText=u.CancelButtonText;this.completeButtonText=u.ContinueButtonText}return __extends(t,n),Object.defineProperty(t.prototype,"headerText",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stepId",{get:function(){return""},enumerable:!0,configurable:!0}),t}(r.TemplateViewModel);t.BuyCustomizationBaseViewModel=f});
define("Gallery/Client/Controls/AccountBasedPurchaseDetails/AccountBasedPurchaseDetails.ViewModel",["require","exports","knockout","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","VSS/Utils/String","q","Gallery/Client/Controls/BuyCustomizationBase/BuyCustomizationBase.ViewModel"],function(n,t,i,r,u,f,e){var o=function(n){function t(t){var f=this;n.call(this);this.ko_readonlyContainerVisible=i.observable(!1);this.ko_editContainerVisible=i.observable(!1);this.ko_userCount=i.observable(0);this.ko_totalCost=i.observable("");this.ko_loading=i.observable(!1);this.ko_isSubsequentPurchase=i.observable(!1);this.ko_errorMessage=i.observable("");this.ko_headerVisible=i.observable(!0);this.loadingMessage=r.LoadingPricingMessage;this.ko_purchaseHelpText=i.observable("");this.ko_userText=r.UsersText;this.ko_costColumnName=r.TotalCostText;this.ko_disableCompleteButton=i.observable(!1);this.ko_continueButtonText=r.ContinueButtonText;this.ko_accountBasedPurchaseConfirmationText=this.computed(function(){return u.format(r.AccountBasedPurchaseBuyConfirmationText,f.ko_totalCost(),f.ko_userCount())});this._defaultCurrency="$";this._onError=t.onError?t.onError:$.noop}return __extends(t,n),Object.defineProperty(t.prototype,"stepId",{get:function(){return"accountBasedPurchaseDetails"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headerText",{get:function(){return r.ReviewPurchaseDetails},enumerable:!0,configurable:!0}),t.prototype.reset=function(){},t.prototype.startEdit=function(){this.isActive(!0);this.ko_headerVisible(!0)},t.prototype.completeStep=function(){this.isCompleted(!0);this.ko_headerVisible(!1);this.ko_readonlyContainerVisible(!0);this.ko_editContainerVisible(!1);this.isActive(!1)},t.prototype.getUserCount=function(){return this.ko_userCount()},t.prototype.initialize=function(n,t,i,e){var o=this,s=[];this.ko_purchaseHelpText(u.format(r.QuantitySelectionHelpTextForAccountBasedExtension,n.title));var h=t.call(this),c=i.call(this),l=e.call(this);s.push(h);s.push(c);s.push(l);this.ko_loading(!0);this.isActive(!0);f.allSettled(s).then(function(t){o.ko_loading(!1);var i=!0;t.forEach(function(n){n.state!=="fulfilled"&&(i=!1)});i?(o.ko_editContainerVisible(!0),h.then(function(t){c.then(function(i){l.then(function(f){var e;if(o.ko_userCount(t),o.onActiveUsersCountChanged)o.onActiveUsersCountChanged(t);if(f.quantity)o.ko_isSubsequentPurchase(!0),o.ko_purchaseHelpText(u.format(r.AlreadyPurchasedExtensionForAccount,n.title)),o.ko_disableCompleteButton(!0);else if(i){e=i.details&&i.details[0].value;e||(e=10);e=e*t;try{o.ko_totalCost(e.toLocaleString(i.locale,{style:"currency",currency:i.currencyCode}))}catch(s){o.ko_totalCost(o._defaultCurrency+e.toFixed(2))}}})})})):(t&&$.each(t,function(n,t){t.state==="rejected"&&o._onError(t.reason)}),o.ko_errorMessage(r.AcquireItemGenericError),o.ko_disableCompleteButton(!0))})},t}(e.BuyCustomizationBaseViewModel);t.AccountBasedPurchaseDetailsViewModel=o});
define("Gallery/Client/Controls/BuyCustomization/BuyCustomization.View",["require","exports","Gallery/Client/Controls/BuyCustomizationBase/BuyCustomizationBase.View"],function(n,t,i){var r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(i.BuyCustomizationBase);t.BuyCustomization=r});
define("Gallery/Client/Controls/BuyCustomization/BuyCustomization.ViewModel",["require","exports","knockout","Gallery/Client/Controls/BuyCustomizationBase/BuyCustomizationBase.ViewModel","Gallery/Client/Service/VSSCommerce/IVSSCommerce","Gallery/Client/Service/VSSItem","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/URLHelper","VSS/Utils/String","VSS/Utils/Date"],function(n,t,i,r,u,f,e,o,s,h){var c=function(n){function t(){var t=this;n.call(this);this.maxNum=i.observable(101);this.currQuantity=i.observable(0);this.nextMonthQuantity=i.observable(0);this.newQuantityLimitExceeded=i.observable(!1);this.newQuantity=i.observable(1).extend({gallerylimit:{maxValue:200,limitExceeded:this.newQuantityLimitExceeded}});this.minAllowedQuantity=i.observable(1);this.maxAllowedQuantity=i.observable(1e4);this.prepaidBalanceInfoMsg=i.observable("");this.isPricingAvailable=i.observable(!1);this.pricingNotAvailableText=i.observable(e.PricingNotAvailable);this.isMeterAvailable=i.observable(!1);this.loadingPricing=i.observable(!1);this.loadingPricingMessage=e.LoadingPricingMessage;this.confirmingPurchase=i.observable(!1);this.confirmingPurchaseMessage=e.AcquireWaitingMessage;this.showAssignMessage=i.observable(!0);this.showChooseQuantityHelpText=i.observable(!0);this.learnMore=e.OfferLearnMoreText;this.currentHeader=e.VSS_BuyExtension_Current;this.newHeader=e.VSS_BuyExtension_New;this.cancelButtonLink=o.GalleryURLs.getHomePageURL();this.purchaseType=i.observable(e.UsersText);this.totalCostHeader=e.TotalCostText;this.assignMessage=e.Assign_Purchase;this.isNotAssignedToMe=i.observable(!1);this.isOfferWorkFlow=i.observable(!1);this.isYearlyItem=i.observable(null);this.enforceMaxAllowed=i.observable(null);this.defaultCurrency="$";this.currencyCode="USD";this.locale="en";this.renewalDate=i.observable(null);this.alreadyPurchasedLicensesHelpText=e.AlreadyPurchasedLicensesHelpText;this.disableCompleteButton=i.observable(!1);this.offerPurchaseType=e.SubscriptionText;this.buyCustomizationErrorMessage=i.observable(null);this.userPlans=i.observableArray([]);this.trialEndDate=i.observable(null);this._activeUsersCount=0;this.quantityRange=this.computed(function(){var r=i.observableArray(),n;if(t.isSubsequentPurchase()){for(n=0;n<t.maxNum();n++)r.push(n);return r}for(n=1;n<t.maxNum();n++)r.push(n);return r});this.itemName=this.computed(function(){return t.item()?t.item().title:"None"});this.itemType=this.computed(function(){return t.item()?f.ItemModelHelper.isitemTypeExtension(t.item().itemType)?e.Extension:e.Subscription:e.Extension});this.currTotalPrice=this.computed(function(){return t.isPricingAvailable()?t.getComputedPrice(t.currQuantity(),t.isMeterAvailable()):e.EAPricingMsg});this.newTotalPrice=this.computed(function(){if(t.isPricingAvailable()){var n=t.getComputedPrice(t.newQuantity(),t.isMeterAvailable());return t.isYearlyItem()!==null&&n!==t.pricingNotAvailableText()&&(n=t.isYearlyItem()?n+"/"+e.Price_Unit_Annum:n+"/"+e.Price_Unit_Month),n}return e.EAPricingMsg});this.renewalMessage=this.computed(function(){if(t.renewalDate()){var n=h.shiftToUTC(t.renewalDate()),i=h.format(n,"MMMM d, yyyy");return s.format(e.VSSOffer_Renewal_Date_Message,i)}return null});this.chooseQuantityHelpText=this.computed(function(){return t.showChooseQuantityHelpText()?t.isOfferWorkFlow()?e.SubscriptionsQuantityHelpText:t.isSubsequentPurchase()?t._isPlanBasedMeter()?"":e.UpdateLicensesHelpText:e.UserLicensesQuantityHelpText:""});this.confirmPurchaseText=this.computed(function(){if(t.isSubsequentPurchase())return t.disableCompleteButton(!0),e.UpdateButtonText;var n=+t.newQuantity();return isNaN(n)&&(n=-1),n>0?t.disableCompleteButton(t.newQuantityLimitExceeded()):t.disableCompleteButton(!0),e.ContinueButtonText});this.upgradeDowngradeCancelMesg=this.computed(function(){var n=null;return t._isPlanBasedMeter()?t.newQuantity()===t.currQuantity()?t.disableCompleteButton(!0):t.newQuantity()!==t.currQuantity()&&(t.disableCompleteButton(!1),t.isSubsequentPurchase()?t.renewalDate()&&(n=s.format(e.UpgradeDowngradePlanMsg,t.renewalDate().toLocaleDateString())):t.trialEndDate()&&h.defaultComparer(t.trialEndDate(),new Date)>=0&&(n=s.format(e.BuyPlanMsg,t.trialEndDate().toLocaleDateString()))):(t.isYearlyItem()?t.newQuantity()===t.nextMonthQuantity()?t.disableCompleteButton(!0):t.disableCompleteButton(t.newQuantityLimitExceeded()):t.newQuantity()===t.nextMonthQuantity()?t.disableCompleteButton(!0):t.newQuantity()===0&&t.isSubsequentPurchase()?(t.disableCompleteButton(!1),n=e.ReductionsMsg):t.newQuantity()<t.nextMonthQuantity()?(t.disableCompleteButton(!1),n=e.DowngradeMsg):t.newQuantity()>t.nextMonthQuantity()&&(t.disableCompleteButton(t.newQuantityLimitExceeded()),t.trialEndDate()&&h.defaultComparer(h.shiftToLocal(t.trialEndDate()),h.shiftToLocal(new Date))>=0&&(n=s.format(e.BuyPlanMsg,t.trialEndDate().toLocaleDateString())),n?n+="\n"+e.UpgradeMsg:n=e.UpgradeMsg),t.newQuantityLimitExceeded()&&(t.disableCompleteButton(!0),n=n==null?e.NumUsersLimitExceedMessage:s.format("{0}<br>{1}",e.NumUsersLimitExceedMessage,n))),n});this.buyCustomizationConfirmationText=this.computed(function(){var i=t.newQuantity(),r,u,n;return t.isPricingAvailable()&&t.isMeterAvailable()?(n=t.getComputedPrice(i,t.isMeterAvailable()),t.isYearlyItem()!==null&&(n=t.isYearlyItem()?n+"/"+e.Price_Unit_Annum:n+"/"+e.Price_Unit_Month),r=t.isOfferWorkFlow()?t.offerPurchaseType:t._isPlanBasedMeter()?e.UsersText:e.ExtensionText,u='<div class="buy-customization-highlighted-values">'+i+"<\/div>",n='<div class="buy-customization-highlighted-values">'+n+"<\/div>",s.format(e.BuyCustomizationConfirmationText,u,r,n)):s.format(e.BuyCustomizationConfirmationTextWithoutCurrency,i)});this.limitNewQuantity=function(){t.enforceMaxAllowed()!==null&&t.enforceMaxAllowed()&&t.newQuantity()>t.maxAllowedQuantity()&&t.newQuantity(t.maxAllowedQuantity());t.newQuantity()<t.minAllowedQuantity()&&t.newQuantity(t.minAllowedQuantity())};this._meterPrice=[];this.newQuantity.subscribe(this.limitNewQuantity)}return __extends(t,n),Object.defineProperty(t.prototype,"stepId",{get:function(){return"buyCustomization"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headerText",{get:function(){return e.BuyCustomizationHeader},enumerable:!0,configurable:!0}),t.prototype.reset=function(){},t.prototype.startEdit=function(){this.readonlyContainerVisible(!1);this.editContainerVisible(!0);this.headerVisible(!0);this.isActive(!0)},t.prototype.completeStep=function(){this.readonlyContainerVisible(!0);this.editContainerVisible(!1);this.headerVisible(!1);this.isCompleted(!0);this.isActive(!1)},t.prototype.getComputedPrice=function(n,t){var r,i,u;if(t&&this._meterPrice&&this._meterPrice.length!==0){if(r=0,i=0,this._isPlanBasedMeter()){for(u=this._meterPrice.length;i<u;i++)if(+this._meterPrice[i].key===n){r=+this._meterPrice[i].value;break}}else{for(+this._meterPrice[0].key==0&&(this._meterPrice[0].key=1),i=1;i<this._meterPrice.length&&this._meterPrice[i].key<=n;i++)r=r+(this._meterPrice[i].key-this._meterPrice[i-1].key)*this._meterPrice[i-1].value;r=r+(n-this._meterPrice[i-1].key+1)*this._meterPrice[i-1].value}try{return r.toLocaleString(this.locale,{style:"currency",currency:this.currencyCode})}catch(f){return this.defaultCurrency+r.toFixed(2)}}else return this.pricingNotAvailableText()},t.prototype.setMeterPrice=function(n,t){if(this._meterPrice=n,t){var i=n.map(function(n){return n.key});n.length!==0&&n[0].value===u.CommerceConstants.InvalidPrice&&(this._meterPrice=[]);this.userPlans(i)}},t.prototype.getMeterPrice=function(){return this._meterPrice},t.prototype.setTrialEndDate=function(n){this.trialEndDate(n)},t.prototype.setRenewalDate=function(n){this.renewalDate(n)},t.prototype.setActiveUsersCount=function(n){if(this._activeUsersCount=n,this.onActiveUsersCountChanged)this.onActiveUsersCountChanged(n)},t.prototype.getActiveUsersCount=function(){return this._activeUsersCount},t.prototype.initializeCurrentAndNewQuantity=function(n){this.currQuantity(n);n>0&&this.newQuantity(n)},t.prototype._isPlanBasedMeter=function(){return this.userPlans().length>0},t}(r.BuyCustomizationBaseViewModel);t.BuyCustomizationViewModel=c});
define("Gallery/Client/Controls/AcquireItemWizard/AcquireItemWizard.View",["require","exports","VSS/Adapters/Knockout"],function(n,t,i){var r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(i.TemplateControl);t.AcquireItemWizard=r});
define("Gallery/Client/Controls/AcquireItemWizard/AcquireItemWizard.ViewModel",["require","exports","VSS/Diag","knockout","VSS/Adapters/Knockout","VSS/Events/Services","VSS/Utils/String","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/URLHelper","Gallery/Client/Common/Utility"],function(n,t,i,r,u,f,e,o,s,h){var c=function(n){function t(u){var e=this,c;n.call(this);this.stepViewModels=[];this.completedStepDefinition=r.observable(null);this.stepDefinitions=r.observableArray([]);this.workflowCompleted=r.observable(!1);this.hasNonRecoverableError=!1;this.workflowAlreadyComplete=r.observable(!1);this.stepCssList=r.observableArray([]);this.completeButtonText=null;this.showCompleteButtonSpinner=r.observable(!1);this.disableCompleteButton=r.observable(!0);this.disableCancelButton=r.observable(!1);this.hideDialogButtons=r.observable(!1);this.cancelButtonLink=r.observable("");this.cancelButtonText=r.observable(o.CancelButtonText);this.closeButtonText=o.CloseButtonText;this.errorContent=r.observable(o.AcquireItemGenericError);this._koShowCompleteWorkFlowError=r.observable(!1);this._completionInProgress=!1;this._workflowInProgress=!1;this.showModalInstall=!1;this.completeWorkflow=function(){e.disableCompleteButton()||(e.disableCompleteButton(!0),e.showCompleteButtonSpinner(!0),e.disableCancelButton(!0),e._wizardWorkflow.completeWorkflow().then(function(n){e.workflowCompleted(!0);e._workflowInProgress=!1;e._completionInProgress=!1;n&&e.completedStepDefinition(n);e.showCompleteButtonSpinner(!1)},function(n){n?e.errorContent(n):e.errorContent(o.AcquireItemGenericError);e._koShowCompleteWorkFlowError(!0);e.disableCompleteButton(!1);e.showCompleteButtonSpinner(!1);e.disableCancelButton(!1)}))};this._wizardWorkflow=u.wizardWorkflow;this.wizardCSSClass=u.cssClassName;this.completeButtonText=this._wizardWorkflow.completeButtonText;c=h.getItemNameForInstall();u.cancelButtonLink?this.cancelButtonLink(u.cancelButtonLink):h.FeatureFlagUtils.isModalInstallEnabled()?(this.showModalInstall=!0,this.cancelButtonLink("")):this.cancelButtonLink(s.GalleryURLs.getItemDetailsURL(c));this._initializeStepDefinitions(this._wizardWorkflow.getStepDefinitions());f.getService().attachEvent(t.EVENT_WORKFLOW_ERROR,this._onWorkFlowError.bind(this))}return __extends(t,n),t.prototype._onWorkFlowError=function(){var n=this,t=function(){n.hasNonRecoverableError=!0;n.workflowCompleted(!0)};$.isFunction(this._wizardWorkflow.getErrorStepDefinition)&&this._wizardWorkflow.getErrorStepDefinition().then(function(i){i&&(n.closeButtonText=o.AcquireItemWizardOk,n.completedStepDefinition(i),t())},t)},t.prototype._initializeStepDefinitions=function(n){var i=this,t,u;for(this.stepDefinitions(n),t=0,u=this.stepDefinitions().length;t<u;t++)this.stepViewModels[t]=r.observable(null),this.stepCssList()[t]=e.format("icon-step-{0} step-inactive",t+1)+" "+n[t].stepCSSClassName;this.computed(function(){for(var t=!0,n=0,r=i.stepDefinitions().length;n<r;n++)i.stepViewModels[n]()||(t=!1);t&&!i._workflowInProgress&&i._startWorkflow()});this.headerText=this._wizardWorkflow.workflowHeader},t.prototype._startWorkflow=function(){var n=this,t;this._workflowInProgress=!0;this.isValid=this.computed(function(){for(var i=!0,t=0,r=n.stepDefinitions().length;t<r;t++)n.stepViewModels[t]().isValid()||(i=!1);return i});this.isActive=this.computed(function(){for(var i=!1,t=0,r=n.stepDefinitions().length;t<r;t++)n.stepViewModels[t]().isActive()&&(i=!0);return i});this.currentStep=this.computed(function(){for(var i="",t=0,r=n.stepDefinitions().length;t<r;t++)if(n.stepViewModels[t]().isActive()){i=n.stepViewModels[t]().stepId;break}return i});this.currentStep.subscribe(function(t){for(var i=0,r=n.stepDefinitions().length;i<r;i++)if(n.stepViewModels[i]().stepId===t){n.stepViewModels[i]().isStepCancellable!=null&&n.stepViewModels[i]().isStepCancellable===!1?n.hideDialogButtons(!0):n.hideDialogButtons(!1);break}});this._allStepsCompleted=this.computed(function(){for(var i=!0,t=0,r=n.stepDefinitions().length;t<r;t++)n.stepViewModels[t]().isCompleted()||n.stepViewModels[t]().isHidden&&n.stepViewModels[t]().isHidden()||(i=!1);return i});this.computed(function(){for(var i,t=0,r=n.stepDefinitions().length;t<r;t++)i=n.stepDefinitions()[t].stepCSSClassName,n.stepViewModels[t]().isHidden&&n.stepViewModels[t]().isHidden()?(n.stepCssList()[t]=e.format("icon-step-{0} step-hidden",t+1)+" "+i,n.stepCssList.valueHasMutated()):n.stepViewModels[t]().isActive()||n.stepViewModels[t]().isCompleted()?n.stepViewModels[t]().isActive()?(n.stepCssList()[t]=e.format("icon-step-{0} step-active",t+1)+" "+i,n.stepCssList.valueHasMutated()):n.stepViewModels[t]().isCompleted()&&(n._isLastStepOfWizard(t)||(n.stepCssList()[t]=e.format("icon-step-{0} step-completed",t+1)+" "+i,n.stepCssList.valueHasMutated())):(n.stepCssList()[t]=e.format("icon-step-{0} step-inactive",t+1)+" "+i,n.stepCssList.valueHasMutated())});this._allStepsCompleted.subscribe(function(t){t?n.disableCompleteButton(!1):n.disableCompleteButton(!0)});t=[];$.each(this.stepViewModels,function(n,i){t.push(i())});this._wizardWorkflow.workflowAlreadyComplete!==undefined&&this._wizardWorkflow.workflowAlreadyComplete.subscribe(function(){n.workflowAlreadyComplete(!0)});this._wizardWorkflow.startWorkflow(t)},t.prototype._isLastStepOfWizard=function(n){if(n===this.stepViewModels.length-1)return!0;for(var t=n+1,i=this.stepDefinitions().length;t<i;t++)if(!(this.stepViewModels[t]().isHidden&&this.stepViewModels[t]().isHidden()))return!1;return!0},t.EVENT_WORKFLOW_ERROR="Gallery.AcquireItem.Error",t}(u.TemplateViewModel);t.AcquireItemWizardViewModel=c});
define("VSS/Commerce/Contracts",["require","exports"],function(n,t){"use strict";var i,r,u,f,e,o,s,h,c,l,a,v,y,p,w;(function(n){n[n.VisualStudioOnline=0]="VisualStudioOnline";n[n.AppInsights=1]="AppInsights";n[n.Marketplace=2]="Marketplace";n[n.OnPremise=3]="OnPremise"})(t.AccountProviderNamespace||(t.AccountProviderNamespace={}));i=t.AccountProviderNamespace,function(n){n[n.SelfManaged=0]="SelfManaged";n[n.AzureStoreManaged=1]="AzureStoreManaged"}(t.BillingProvider||(t.BillingProvider={}));r=t.BillingProvider,function(n){n[n.Free=0]="Free";n[n.Paid=1]="Paid"}(t.MeterBillingState||(t.MeterBillingState={}));u=t.MeterBillingState,function(n){n[n.Legacy=0]="Legacy";n[n.Bundle=1]="Bundle";n[n.Extension=2]="Extension"}(t.MeterCategory||(t.MeterCategory={}));f=t.MeterCategory,function(n){n[n.None=0]="None";n[n.Monthly=1]="Monthly";n[n.Annually=2]="Annually"}(t.MeterRenewalFrequecy||(t.MeterRenewalFrequecy={}));e=t.MeterRenewalFrequecy,function(n){n[n.Registered=0]="Registered";n[n.Active=1]="Active";n[n.Retired=2]="Retired";n[n.Deleted=3]="Deleted"}(t.MeterState||(t.MeterState={}));o=t.MeterState,function(n){n[n.None=0]="None";n[n.Express=1]="Express";n[n.Advanced=2]="Advanced";n[n.AdvancedPlus=3]="AdvancedPlus";n[n.Stakeholder=4]="Stakeholder"}(t.MinimumRequiredServiceLevel||(t.MinimumRequiredServiceLevel={}));s=t.MinimumRequiredServiceLevel,function(n){n[n.Explicit=0]="Explicit";n[n.Implicit=1]="Implicit"}(t.OfferMeterAssignmentModel||(t.OfferMeterAssignmentModel={}));h=t.OfferMeterAssignmentModel,function(n){n[n.Account=0]="Account";n[n.User=1]="User";n[n.UserAccount=2]="UserAccount"}(t.OfferScope||(t.OfferScope={}));c=t.OfferScope,function(n){n[n.None=0]="None";n[n.MonetaryLimitSet=1]="MonetaryLimitSet";n[n.InvalidOfferCode=2]="InvalidOfferCode";n[n.NotAdminOrCoAdmin=3]="NotAdminOrCoAdmin";n[n.InvalidRegionPurchase=4]="InvalidRegionPurchase"}(t.PurchaseErrorReason||(t.PurchaseErrorReason={}));l=t.PurchaseErrorReason,function(n){n[n.Committment=0]="Committment";n[n.PayAsYouGo=1]="PayAsYouGo"}(t.ResourceBillingMode||(t.ResourceBillingMode={}));a=t.ResourceBillingMode,function(n){n[n.StandardLicense=0]="StandardLicense";n[n.AdvancedLicense=1]="AdvancedLicense";n[n.ProfessionalLicense=2]="ProfessionalLicense";n[n.Build=3]="Build";n[n.LoadTest=4]="LoadTest";n[n.PremiumBuildAgent=5]="PremiumBuildAgent";n[n.PrivateOtherBuildAgent=6]="PrivateOtherBuildAgent";n[n.PrivateAzureBuildAgent=7]="PrivateAzureBuildAgent"}(t.ResourceName||(t.ResourceName={}));v=t.ResourceName,function(n){n[n.Monthly=0]="Monthly";n[n.Jan=1]="Jan";n[n.Feb=2]="Feb";n[n.Mar=3]="Mar";n[n.Apr=4]="Apr";n[n.May=5]="May";n[n.Jun=6]="Jun";n[n.Jul=7]="Jul";n[n.Aug=8]="Aug";n[n.Sep=9]="Sep";n[n.Oct=10]="Oct";n[n.Nov=11]="Nov";n[n.Dec=12]="Dec"}(t.ResourceRenewalGroup||(t.ResourceRenewalGroup={}));y=t.ResourceRenewalGroup,function(n){n[n.None=0]="None";n[n.NoAzureSubscription=1]="NoAzureSubscription";n[n.NoIncludedQuantityLeft=2]="NoIncludedQuantityLeft";n[n.SubscriptionDisabled=4]="SubscriptionDisabled";n[n.PaidBillingDisabled=8]="PaidBillingDisabled";n[n.MaximumQuantityReached=16]="MaximumQuantityReached"}(t.ResourceStatusReason||(t.ResourceStatusReason={}));p=t.ResourceStatusReason,function(n){n[n.Unknown=0]="Unknown";n[n.Active=1]="Active";n[n.Disabled=2]="Disabled";n[n.Deleted=3]="Deleted";n[n.Unregistered=4]="Unregistered"}(t.SubscriptionStatus||(t.SubscriptionStatus={}));w=t.SubscriptionStatus;t.TypeInfo={AccountProviderNamespace:{enumValues:{visualStudioOnline:0,appInsights:1,marketplace:2,onPremise:3}},BillingProvider:{enumValues:{selfManaged:0,azureStoreManaged:1}},IOfferSubscription:{},ISubscriptionAccount:{},ISubscriptionResource:{},IUsageEventAggregate:{},MeterBillingState:{enumValues:{free:0,paid:1}},MeterCategory:{enumValues:{legacy:0,bundle:1,extension:2}},MeterRenewalFrequecy:{enumValues:{none:0,monthly:1,annually:2}},MeterState:{enumValues:{registered:0,active:1,retired:2,deleted:3}},MinimumRequiredServiceLevel:{enumValues:{none:0,express:1,advanced:2,advancedPlus:3,stakeholder:4}},OfferMeter:{},OfferMeterAssignmentModel:{enumValues:{explicit:0,implicit:1}},OfferScope:{enumValues:{account:0,user:1,userAccount:2}},OfferSubscription:{},PurchasableOfferMeter:{},PurchaseErrorReason:{enumValues:{none:0,monetaryLimitSet:1,invalidOfferCode:2,notAdminOrCoAdmin:3,invalidRegionPurchase:4}},ResourceBillingMode:{enumValues:{committment:0,payAsYouGo:1}},ResourceName:{enumValues:{standardLicense:0,advancedLicense:1,professionalLicense:2,build:3,loadTest:4,premiumBuildAgent:5,privateOtherBuildAgent:6,privateAzureBuildAgent:7}},ResourceRenewalGroup:{enumValues:{monthly:0,jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12}},ResourceStatusReason:{enumValues:{none:0,noAzureSubscription:1,noIncludedQuantityLeft:2,subscriptionDisabled:4,paidBillingDisabled:8,maximumQuantityReached:16}},SubscriptionResource:{},SubscriptionStatus:{enumValues:{unknown:0,active:1,disabled:2,deleted:3,unregistered:4}},UsageEvent:{}};t.TypeInfo.IOfferSubscription.fields={azureSubscriptionState:{enumType:t.TypeInfo.SubscriptionStatus},disabledReason:{enumType:t.TypeInfo.ResourceStatusReason},offerMeter:{typeInfo:t.TypeInfo.OfferMeter},renewalGroup:{enumType:t.TypeInfo.ResourceRenewalGroup},resetDate:{isDate:!0},startDate:{isDate:!0},trialExpiryDate:{isDate:!0}};t.TypeInfo.ISubscriptionAccount.fields={failedPurchaseReason:{enumType:t.TypeInfo.PurchaseErrorReason},subscriptionStatus:{enumType:t.TypeInfo.SubscriptionStatus}};t.TypeInfo.ISubscriptionResource.fields={disabledReason:{enumType:t.TypeInfo.ResourceStatusReason},name:{enumType:t.TypeInfo.ResourceName},resetDate:{isDate:!0}};t.TypeInfo.IUsageEventAggregate.fields={endTime:{isDate:!0},resource:{enumType:t.TypeInfo.ResourceName},startTime:{isDate:!0}};t.TypeInfo.OfferMeter.fields={assignmentModel:{enumType:t.TypeInfo.OfferMeterAssignmentModel},billingEntity:{enumType:t.TypeInfo.BillingProvider},billingMode:{enumType:t.TypeInfo.ResourceBillingMode},billingStartDate:{isDate:!0},billingState:{enumType:t.TypeInfo.MeterBillingState},category:{enumType:t.TypeInfo.MeterCategory},minimumRequiredAccessLevel:{enumType:t.TypeInfo.MinimumRequiredServiceLevel},offerScope:{enumType:t.TypeInfo.OfferScope},renewalFrequency:{enumType:t.TypeInfo.MeterRenewalFrequecy},status:{enumType:t.TypeInfo.MeterState}};t.TypeInfo.OfferSubscription.fields={azureSubscriptionState:{enumType:t.TypeInfo.SubscriptionStatus},disabledReason:{enumType:t.TypeInfo.ResourceStatusReason},offerMeter:{typeInfo:t.TypeInfo.OfferMeter},renewalGroup:{enumType:t.TypeInfo.ResourceRenewalGroup},resetDate:{isDate:!0},startDate:{isDate:!0},trialExpiryDate:{isDate:!0}};t.TypeInfo.PurchasableOfferMeter.fields={estimatedRenewalDate:{isDate:!0},offerMeterDefinition:{typeInfo:t.TypeInfo.OfferMeter}};t.TypeInfo.SubscriptionResource.fields={disabledReason:{enumType:t.TypeInfo.ResourceStatusReason},name:{enumType:t.TypeInfo.ResourceName},resetDate:{isDate:!0}};t.TypeInfo.UsageEvent.fields={billableDate:{isDate:!0},eventTimestamp:{isDate:!0},resourceBillingMode:{enumType:t.TypeInfo.ResourceBillingMode}}});
define("Gallery/Client/Controls/AcquireItemWizard/BuyOfferWorkflow",["require","exports","knockout","q","Gallery/Client/Common/Constants","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/Common/Telemetry","Gallery/Client/Common/TelemetryInternal","Gallery/Client/URLHelper","Gallery/Client/Common/Utility","Gallery/Client/Common/Utility.Common","Gallery/Client/Service/VSSItem","Gallery/Client/Service/VSSOffer","Gallery/Client/Service/HttpClientProvider/HttpClientProvider","VSS/Commerce/Contracts","VSS/Utils/Core","VSS/Utils/String"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){var b=e.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.AcquisitionWorkFlowProperties,k=function(){function n(n){this._useCache=!0;this._eulaContent=null;this.workflowHeader="";this.completeButtonText=i.observable(f.ConfirmText);this._commerceDataProvider=n.commerceDataProvider;this._galleryDataProvider=n.galleryDataProvider;this._item=n.item;this._galleryId=l.ItemModelHelper.getFullyQualifiedNameForItem(n.item.publisherName,n.item.name);this._eulaContent=n.eulaContent;this.workflowHeader=w.format(f.AquireItemWizardHeader,this.getStepDefinitions().length);this._onError=n.onError||$.noop}return n.prototype.getStepDefinitions=function(){var n=[],e={subscriptions:[],createNewSubscriptionUrl:"",item:this._item,isExtension:!1,completionPreProcess:this._beginCheckAndRedirectTenantIfRequired.bind(this)},r,t,u;return n.push({stepTemplateName:"subscription-selection-template",stepViewModelOptions:e}),r={},n.push({stepTemplateName:"buy-customization-template",stepViewModelOptions:r}),this._item.scopes&&(t=[],$.each(this._item.scopes,function(n,i){t.push(i.title)})),u={scopes:t,eulaContent:this._eulaContent,acquireItemReviewHeader:i.observable(f.ConfirmText)},n.push({stepTemplateName:"vss-acquireitem-review-template",stepCSSClassName:"install-flow-step review-step",stepViewModelOptions:u}),n},n.prototype.startWorkflow=function(n){var t=this,i,r,u;this._initializeViewModels(n);this._subscriptionSelectionViewModel.isActive(!0);this.getSubscriptions();this._buyCustomizationViewModel.maxNum(51);this._buyCustomizationViewModel.isOfferWorkFlow(!0);this._buyCustomizationViewModel.isYearlyItem(this._item.duration===a.OfferDuration.Yearly);this._commerceDataProvider.getMsdnBaseURL().then(function(n){t._baseSubscriptionUri=n});this._reviewViewModel.acquiringItemMessage(f.PurchasingText);i=this._subscriptionSelectionViewModel.subscribe(this._subscriptionSelectionViewModel.isContinueCompleted,function(){t._subscriptionSelectionViewModel.isContinueCompleted()&&(t._validateSubscription(),t._subscriptionSelectionViewModel.isContinueCompleted(!1))});r=this._subscriptionSelectionViewModel.subscribe(this._subscriptionSelectionViewModel.isCompleted,function(){t._subscriptionSelectionViewModel.isCompleted()&&t._onStep1Complete()});this._subscriptionSelectionViewModel.itemName=l.ItemModelHelper.getFullyQualifiedNameForItem(this._item.publisherName,this._item.name);u=this._buyCustomizationViewModel.subscribe(this._buyCustomizationViewModel.isCompleted,function(){t._buyCustomizationViewModel.isCompleted()&&t._onStep2Complete()})},n.prototype.completeWorkflow=function(){var n=this,ut=function(t){var i={};return i[b.LinkType]=t,i[b.WorkFlowType]="Buy_Offer",i[b.Id]=l.ItemModelHelper.getFullyQualifiedNameForItem(n._item.publisherName,n._item.name),i[b.Quantity]=n._buyCustomizationViewModel.newQuantity(),i[b.IsNewSubscription]=n._subscriptionSelectionViewModel.isNew()?1:0,i[b.AssignedToMe]=n._buyCustomizationViewModel.isNotAssignedToMe()?0:1,i[b.ProductType]=l.ItemModelHelper.getItemTypeText(n._item.itemType),o.TelemetryHelper.publishEvent(e.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.POST_INSTALL_WORKFLOW,i,!0),!0},k=r.defer(),d,i,t;this._buyCustomizationViewModel.newQuantity()<this._buyCustomizationViewModel.nextMonthQuantity()?this.completeButtonText(f.ReducingText):this.completeButtonText(f.PurchasingText);d=this._subscriptionSelectionViewModel.selectedSubscription();i=null;d&&(i=d.subscriptionId);var it=this._buyCustomizationViewModel.newQuantity()!==1,g=!this._buyCustomizationViewModel.isSubsequentPurchase()&&!this._buyCustomizationViewModel.isNotAssignedToMe(),nt=this._baseSubscriptionUri+"_apis/Home/Redirect?redirectSource=Commerce",rt=this._galleryId,a=nt,v=this._baseSubscriptionUri;if(i){g&&(v=this.generateUriFromParams(nt,i,rt,"Subscriptions"),a=this.generateUriFromParams(nt,i,rt,"Admin"));this._reviewViewModel.showAcquiringItemExperience(!0);t={};t[b.Id]=l.ItemModelHelper.getFullyQualifiedNameForItem(this._item.publisherName,this._item.name);t[b.Quantity]=this._buyCustomizationViewModel.newQuantity();t[b.IsNewSubscription]=this._subscriptionSelectionViewModel.isNew()?1:0;t[b.ProductType]=l.ItemModelHelper.getItemTypeText(this._item.itemType);var y=function(){t[b.AssignOrView]=0;var n=e.TelemetryHelper.publishEventAsync(e.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.ASSIGN_VIEW_VS_SUBSCRIPTION,t);return!0},tt=function(){t[b.AssignOrView]=1;var n=e.TelemetryHelper.publishEventAsync(e.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.ASSIGN_VIEW_VS_SUBSCRIPTION,t);return!0},h={};h[b.Id]=l.ItemModelHelper.getFullyQualifiedNameForItem(this._item.publisherName,this._item.name);h[b.ProductType]=l.ItemModelHelper.getItemTypeText(this._item.itemType);h[b.Quantity]=this._buyCustomizationViewModel.newQuantity();h[b.IsNewSubscription]=this._subscriptionSelectionViewModel.isNew()?1:0;this._galleryDataProvider.acquireItem(this._item,null,l.VSSItemAcquisitionOption.Buy,i,this._buyCustomizationViewModel.newQuantity()).then(function(){r.allSettled([e.TelemetryHelper.publishEventAsync(e.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.CONFIRM_BUY_ITEM,h)]).then(function(){n._reviewViewModel.showAcquiringItemExperience(!1);var e=[],t=[],i,r,h,o;c.isHockeyAppOffer(n._item.name)?(o=!1,n._buyCustomizationViewModel.newQuantity()===0?(i=f.HockeyApp_CancelOffer_Completed,r=f.HockeyApp_GoodToGoText_Cancel):(i=f.HockeyApp_PurchaseOffer_Completed,r=f.HockeyApp_GoodToGoText,t.push({linkText:f.HockeyApp_Visit,linkUrl:f.HockeyApp_SignIn,openInNewTab:!0,onClick:y}))):(i=w.format(f.VSS_PurchaseOffer_Completed,n._buyCustomizationViewModel.newQuantity(),n._item.title),g?it?(t.push({linkText:f.AssignUsersButtonText,linkUrl:a,openInNewTab:!0,onClick:y}),t.push({linkText:f.ViewMySubscription,linkUrl:v,openInNewTab:!0,onClick:tt})):t.push({linkText:f.ViewMySubscription,linkUrl:v,openInNewTab:!0,onClick:tt}):t.push({linkText:f.AssignUsersButtonText,linkUrl:a,openInNewTab:!0,onClick:y}));e.push({linkText:f.AcquireCompletionDiscoverMoreSubscriptions,linkUrl:s.GalleryURLs.getHomePageVSSubscriptionsTabURL(),onClick:p.curry(ut,u.AcquireWorkFlowConstants.DISCOVER_MORE_SUBSCRIPTIONS)});k.resolve({stepTemplateName:"acquire-item-completion-message",stepViewModelOptions:{installCompletionDetailedMessage:i,asssignSubscriptionLink:a,mySubscriptionLink:v,quantityNotOne:it,isChecked:g,isOfferWorkFlow:!0,accountLinks:e,assignSubscriptionCallback:y,viewSubscriptionCallback:tt,acquireCompletionButtons:t,readyToGoText:r,assignUsersButtonText:h,showLinksSection:o}})})},function(t){n._onError(t);var i=t&&t.message&&t.message.length>0?t.message:f.PurchaseFailed_ErrorMessage;n.completeButtonText(f.ConfirmText);k.reject(i)})}return k.promise},n.prototype._initializeViewModels=function(n){this._subscriptionSelectionViewModel=n[0];this._buyCustomizationViewModel=n[1];this._reviewViewModel=n[2];c.isHockeyAppOffer(this._item.name)&&(this._buyCustomizationViewModel.enforceMaxAllowed(!0),this._buyCustomizationViewModel.purchaseType(f.PlansText),this._buyCustomizationViewModel.showChooseQuantityHelpText(!1),this._buyCustomizationViewModel.minAllowedQuantity(0),this._buyCustomizationViewModel.maxAllowedQuantity(1),this._buyCustomizationViewModel.pricingNotAvailableText(f.PricingNotAvailableHockeyApp),this._buyCustomizationViewModel.showAssignMessage(!1),this._buyCustomizationViewModel.offerPurchaseType=f.HockeyAppOfferPurchaseType)},n.prototype._beginCheckAndRedirectTenantIfRequired=function(n){var t=r.defer();return v.TokenProvider.getToken(null,n.tenantId,n.subscriptionId).then(function(){t.resolve(!0)},function(n){t.reject(n)}),t.promise},n.prototype._validateSubscription=function(){var n=this;this._subscriptionSelectionViewModel.showSubscriptionValidatonLoadingExp(!0);this._subscriptionSelectionViewModel.validateSubscriptionMsg(f.CheckingYourSubscription);this._commerceDataProvider.getAzureSubscriptionForPurchase(this._subscriptionSelectionViewModel.selectedSubscription().subscriptionId,this._subscriptionSelectionViewModel.itemName).then(function(t){var r,i,u;n._subscriptionSelectionViewModel.selectedSubscription().offerCode=t.offerCode;n._subscriptionSelectionViewModel.selectedSubscription().tenantId=t.tenantId;n._subscriptionSelectionViewModel.selectedSubscription().objectId=t.objectId;n._subscriptionSelectionViewModel.selectedSubscription().isPricingAvailable=t.isPricingAvailable;n._subscriptionSelectionViewModel.selectedSubscription().isPrepaidFundSubscription=t.isPrepaidFundSubscription;n._buyCustomizationViewModel.isPricingAvailable(t.isPricingAvailable);n._subscriptionSelectionViewModel.showSubscriptionValidatonLoadingExp(!1);t.failedPurchaseReason===y.PurchaseErrorReason.None?(n._subscriptionSelectionViewModel.isSubscriptionValidated(!0),n._subscriptionSelectionViewModel.completeStep(),n._subscriptionSelectionViewModel.validateSubscriptionMsg(""),r=t.isPrepaidFundSubscription?f.PrepaidBalanceInfoMsg:"",n._buyCustomizationViewModel.prepaidBalanceInfoMsg(r)):(i="",t.failedPurchaseReason===y.PurchaseErrorReason.MonetaryLimitSet?(u=w.format("<a href=\"{0}\" target='_blank'>"+f.RemoveSpendingLimit+"<\/a>",f.RemoveSpendingLimitForwardLink),i=w.format(f.SubscriptionHasSpendingLimit,u)):t.failedPurchaseReason===y.PurchaseErrorReason.InvalidOfferCode?i=f.SubscriptionCannotBeUsedForPurchase:t.failedPurchaseReason===y.PurchaseErrorReason.NotAdminOrCoAdmin&&(i=f.NotAdminForSubscription),n._subscriptionSelectionViewModel.validateSubscriptionMsg(i))},function(t){n._onError(t);n._subscriptionSelectionViewModel.showSubscriptionValidatonLoadingExp(!1);n._subscriptionSelectionViewModel.validateSubscriptionMsg("");n._subscriptionSelectionViewModel.subscriptionValidationErrorMessage(f.ValidateSubscription_ErrorMessage)})},n.prototype._onStep1Complete=function(){var n=this,t={},i,u,s;t[b.Id]=l.ItemModelHelper.getFullyQualifiedNameForItem(this._item.publisherName,this._item.name);t[b.SubscriptionId]=this._subscriptionSelectionViewModel.selectedSubscription().subscriptionId;t[b.IsNewSubscription]=this._subscriptionSelectionViewModel.isNew()?1:0;t[b.ProductType]=l.ItemModelHelper.getItemTypeText(this._item.itemType);i=this._item.duration===a.OfferDuration.Yearly;o.TelemetryHelper.publishEvent(e.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.SELECT_AZURE_SUBSCRIPTION,t,!0);this._buyCustomizationViewModel.isActive(!0);this._buyCustomizationViewModel.item(this._item);this._buyCustomizationViewModel.loadingPricing(!0);u=[];i||u.push(this._getQuantities());(this._subscriptionSelectionViewModel.selectedSubscription().isPricingAvailable||i)&&(s=this._commerceDataProvider.getItemPrice(this._item,null,this._subscriptionSelectionViewModel.selectedSubscription().subscriptionId,this._subscriptionSelectionViewModel.selectedSubscription().offerCode,this._subscriptionSelectionViewModel.selectedSubscription().tenantId,this._subscriptionSelectionViewModel.selectedSubscription().objectId).then(function(t){var r,u,e;if(i&&(n._buyCustomizationViewModel.renewalDate(t.renewalDate),n._getQuantities(t.renewalDate).then(function(){n._buyCustomizationViewModel.startEdit();n._buyCustomizationViewModel.loadingPricing(!1)},function(t){n._onError(t);n._buyCustomizationViewModel.loadingPricing(!1);n._buyCustomizationViewModel.buyCustomizationErrorMessage(f.AcquireItemGenericError)})),t.currencyCode&&(n._buyCustomizationViewModel.currencyCode=t.currencyCode),t.locale&&(n._buyCustomizationViewModel.locale=t.locale),t.details){r=[];u=0;for(e in t.details)r[u]={key:e,value:t.details[e]},u++;n._buyCustomizationViewModel.setMeterPrice(r.sort(function(n,t){return n.key-t.key}),!1);n._buyCustomizationViewModel.isMeterAvailable(!0)}},function(){return n._buyCustomizationViewModel.loadingPricing(!1),n._buyCustomizationViewModel.buyCustomizationErrorMessage(f.AcquireItemGenericError),r.reject("Error getting price details")}),u.push(s));i||r.allSettled(u).done(function(t){n._buyCustomizationViewModel.loadingPricing(!1);n._areAllPromisesFulfilled(t)?n._buyCustomizationViewModel.startEdit():n._buyCustomizationViewModel.buyCustomizationErrorMessage(f.AcquireItemGenericError)},function(){n._buyCustomizationViewModel.loadingPricing(!1);n._buyCustomizationViewModel.buyCustomizationErrorMessage(f.AcquireItemGenericError)})},n.prototype._getQuantities=function(n){var t=this,i=[],u=r.defer(),e=this._commerceDataProvider.getSubscriptionScopedQuantity(this._item,this._subscriptionSelectionViewModel.selectedSubscription().subscriptionId,!1,n),f;return e.then(function(n){n.quantity>0&&t._buyCustomizationViewModel.isSubsequentPurchase(!0);t._buyCustomizationViewModel.currQuantity(n.quantity)}),i.push(e),f=this._commerceDataProvider.getSubscriptionScopedQuantity(this._item,this._subscriptionSelectionViewModel.selectedSubscription().subscriptionId,!0,n),f.then(function(n){n&&t._buyCustomizationViewModel.nextMonthQuantity(n.quantity)}),i.push(f),r.allSettled(i).then(function(n){t._areAllPromisesFulfilled(n)?(t._buyCustomizationViewModel.isSubsequentPurchase()&&(t._buyCustomizationViewModel.minAllowedQuantity(0),t._buyCustomizationViewModel.newQuantity(t._buyCustomizationViewModel.nextMonthQuantity())),u.resolve(!0)):(n&&$.each(n,function(n,i){i.state==="rejected"&&t._onError(i.reason)}),u.reject(""))}),u.promise},n.prototype._areAllPromisesFulfilled=function(n){var t=!0;return $.each(n,function(n,i){i.state!=="fulfilled"&&(t=!1)}),t},n.prototype._onStep2Complete=function(){this._reviewViewModel.startEdit()},n.prototype.getSubscriptions=function(){var n=this,t;this._subscriptionSelectionViewModel.showLoadingExperience(!0);t=h.FeatureFlagUtils.isACSDecommissionMode()?this._commerceDataProvider.getAllSubscriptions():this._commerceDataProvider.getAzureSubscriptionForUser(null);t.then(function(t){n._subscriptionSelectionViewModel.showLoadingExperience(!1);n._subscriptionSelectionViewModel.availableSubscriptions(t);n._subscriptionSelectionViewModel.startEdit();t&&t.length!==0&&n._subscriptionSelectionViewModel.isSubscriptionAvailable(!0)},function(){n._subscriptionSelectionViewModel.showLoadingExperience(!1);n._subscriptionSelectionViewModel.subscriptionLoadingErrorMessage(f.LoadingSubscription_ErrorMessage)})},n.prototype.generateUriFromParams=function(n,t,i,r){return n+"&azureSubscriptionId="+t+"&galleryId="+i+"&destination="+r},n}();t.BuyOfferWorkflow=k});
define("Gallery/Client/Service/VSSAcquisition/VSSAcquisition",["require","exports","q","VSS/Context","VSS/Service","Gallery/Client/Common/Utility","VSS/Gallery/RestClient"],function(n,t,i,r,u,f,e){var o=function(){function n(n,t){this._galleryDataProvider=n;this._extensionManagementDataProvider=t;this._useEMSAcquisitionService=f.FeatureFlagUtils.isUseEMSAquisitionService()}return n.prototype.getAcquisitionOptions=function(n,t,f,o){var s,h,c,l;return f===void 0&&(f=!1),o===void 0&&(o=!1),s=i.defer(),this._useEMSAcquisitionService?this._extensionManagementDataProvider.getEmsAcquisitionOptions(n,t,f,o).then(function(n){s.resolve(n)},function(n){s.reject(n)}):(h=t,r.getPageContext().webAccessConfiguration.isHosted?this._galleryDataProvider.getItemAcquisitionOptions(n,h,f,o).then(function(n){s.resolve(n)},function(n){s.reject(n)}):(c=u.getClient(e.GalleryHttpClient),l=n.publisherName+"."+n.name,c.getAcquisitionOptions(l,h.id).then(function(n){var t=n.defaultOperation;s.resolve(t)},function(n){s.reject(n)}))),s.promise},n.prototype.acquireItem=function(n,t,i,u,f,e,o){var s,h;return this._useEMSAcquisitionService?s=this._extensionManagementDataProvider.acquireItemEms(n,t,i,u,f,e,o):(h=[],r.getPageContext().webAccessConfiguration.isHosted&&(h=e),s=this._galleryDataProvider.acquireItem(n,t,i,u,f,h,o)),s},n}();t.VSSAcquisition=o});
define("Gallery/Client/Controls/AcquireItemWizard/BuyExtensionWorkflowBase",["require","exports","knockout","q","Gallery/Client/Common/Constants","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/Common/Telemetry","Gallery/Client/Common/TelemetryInternal","Gallery/Client/URLHelper","Gallery/Client/Common/Utility","Gallery/Client/Service/VSSGallery/VSSGallery","Gallery/Client/Service/VSSItem","Gallery/Client/Service/VSSAcquisition/VSSAcquisition","VSS/Commerce/Contracts","VSS/Utils/Core","VSS/Utils/String"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){var w=e.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.AcquisitionWorkFlowProperties,b=function(){function n(n){this._extensionUrlPathQuery="/index?id=";this._isSubsequentPurchase=!1;this._accountId="accountId";this._eulaContent=null;this._installOption=l.VSSItemAcquisitionOption.Buy;this.completeButtonText=i.observable(f.ConfirmText);this._commerceDataProvider=n.commerceDataProvider;this._galleryDataProvider=n.galleryDataProvider;this._item=n.item;this._eulaContent=n.eulaContent;this._onError=n.onError||$.noop;this._acquisitionService=new a.VSSAcquisition(n.galleryDataProvider,n.extensionManagementDataProvider)}return n.prototype.getStepDefinitions=function(){var t,r,u,e;if(!this._stepDefinitions){var n=[],o={subscriptions:[],item:this._item,isExtension:!0,completionPreProcess:this._beginCheckAndRedirectTenantIfRequired.bind(this)},s={stepTemplateName:"subscription-selection-template",stepViewModelOptions:o};n.push(s);t=this._getBuyCustomizationStep();t&&n.push(t);r=[];$.each(this._item.scopes,function(n,t){r.push(t.title)});u={scopes:r,eulaContent:this._eulaContent,acquireItemReviewHeader:i.observable(f.ConfirmText)};n.push({stepTemplateName:"vss-acquireitem-review-template",stepCSSClassName:"install-flow-step review-step",stepViewModelOptions:u});e={completeButtonText:f.ConfirmText};n.push({stepTemplateName:"vss-request-item-template",stepCSSClassName:"install-flow-step request-step",stepViewModelOptions:e});this._stepDefinitions=n}return this._stepDefinitions},n.prototype._onBuyWorkFlowComplete=function(n){return this._installOption===l.VSSItemAcquisitionOption.Request?this._handleExtensionPurchaseRequest(n):this._handleExtensionPurchase(n)},n.prototype._onTragetSelectionComplete=function(n){var t=this,r={},u,s;r[w.Id]=l.ItemModelHelper.getFullyQualifiedNameForItem(this._item.publisherName,this._item.name);r[w.AccountId]=this._targetSelectionViewModel.selectedTarget().id;r[w.AccountName]=this._targetSelectionViewModel.selectedTarget().name;r[w.AvailableAccounts]=this._targetSelectionViewModel.availableTargets().length;r[w.SubscriptionLinked]=0;r[w.SubscriptionId]="";r[w.IsSubsequentPurchase]=this._isSubsequentPurchase?1:0;r[w.ProductType]=l.ItemModelHelper.getItemTypeText(this._item.itemType);this._targetSelectionViewModel.selectedTarget().subscriptionId&&(r[w.SubscriptionLinked]=1,r[w.SubscriptionId]=this._targetSelectionViewModel.selectedTarget().subscriptionId);o.TelemetryHelper.publishEvent(e.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.SELECT_ACCOUNT,r,!0);this._subscriptionSelectionViewModel.isActive(!0);this._subscriptionSelectionViewModel.showLoadingExperience(!0);this._subscriptionSelectionViewModel.accountId=this._targetSelectionViewModel.selectedTarget().id;this._targetSelectionViewModel.selectedTarget().subscriptionId?(this._subscriptionSelectionViewModel.subscriptionPickerHelpText=i.observable(f.AccountLinkedToSubscription),this._subscriptionSelectionViewModel.subscriptionSelectionDisabled(!0)):this._subscriptionSelectionViewModel.subscriptionPickerHelpText=i.observable(f.BilledToSubscription);u=this._targetSelectionViewModel.selectedTarget();s=h.FeatureFlagUtils.isACSDecommissionMode()&&n&&!this._isLinkedToAzureSubscription(u)?this._commerceDataProvider.getAllSubscriptions():this._commerceDataProvider.getAzureSubscriptionForUser(u.subscriptionId);s.then(function(n){if(t._subscriptionSelectionViewModel.showLoadingExperience(!1),t._subscriptionSelectionViewModel.availableSubscriptions(n),t._subscriptionSelectionViewModel.accountLinkedToDifferentSubscriptionMessage(""),t._subscriptionSelectionViewModel.startEdit(),n&&n.length!==0)t._subscriptionSelectionViewModel.isSubscriptionAvailable(!0);else if(t._targetSelectionViewModel.selectedTarget().subscriptionId){var i=p.format(f.AccountLinkedToDifferentSubscriptionText,t._targetSelectionViewModel.selectedTarget().subscriptionId);t._subscriptionSelectionViewModel.accountLinkedToDifferentSubscriptionMessage(i)}n&&n.length!==0&&(t._isSubsequentPurchase||t._targetSelectionViewModel.selectedTarget().subscriptionId)&&t._subscriptionSelectionViewModel.validate()},function(n){t._onError(n);t._subscriptionSelectionViewModel.showLoadingExperience(!1);t._subscriptionSelectionViewModel.subscriptionLoadingErrorMessage(f.LoadingSubscription_ErrorMessage)})},n.prototype._isLinkedToAzureSubscription=function(n){return p.isGuid(n.subscriptionId)&&!p.isEmptyGuid(n.subscriptionId)},n.prototype._handleExtensionPurchaseRequest=function(n){var t=this,i=r.defer();return this.completeButtonText(f.RequestingText),this._acquisitionService.acquireItem(this._item,this._targetSelectionViewModel.selectedTarget().id,this._installOption,null,0,this._availableAccounts,this._requestItemViewModel.requestReason()).then(function(){var r=[],o=[],e,h;o.push({linkText:f.VSS_Install_ViewRequest,linkUrl:t._targetSelectionViewModel.selectedTarget().uri+u.GalleryRequestUrlsConstants.RequestExtensionURLWithDefaultCollection,openInNewTab:!0,onClick:y.curry(n,u.AcquireWorkFlowConstants.VIEW_REQUEST)});t._item.properties&&t._item.properties[c.ItemConstants.PROPERTY_LEARN_LINK]&&r.push({linkText:f.ExtensionLearnMoreDescriptiveText,linkUrl:t._item.properties[c.ItemConstants.PROPERTY_LEARN_LINK],openInNewTab:!0,onClick:y.curry(n,u.AcquireWorkFlowConstants.LEARN_MORE)});r.push({linkText:f.AcquireCompletionDiscoverMoreExtensions,linkUrl:s.GalleryURLs.getHomePageVSTSTabURL(),onClick:y.curry(n,u.AcquireWorkFlowConstants.DISCOVER_MORE_EXTENSIONS)});e=t._targetSelectionViewModel.selectedTarget();h={installCompletionDetailedMessage:f.VSS_Install_RequestSuccessMessage,accountName:e.name,accountUrl:e.uri,accountLinks:r,acquireCompletionButtons:o};i.resolve({stepTemplateName:"acquire-item-completion-message",stepViewModelOptions:h})},function(n){t._onError(n);console.log("acquire item failed");t.completeButtonText(f.ConfirmText);i.reject(f.RequestFailed_ErrorMessage)}),i.promise},n.prototype._handleExtensionPurchase=function(n){var t=this,b=r.defer(),v,a,p,i;this.completeButtonText(this._getPurchaseActionText());var o=this._targetSelectionViewModel.selectedTarget(),h=null,k=null;return o&&(h=o.id,k=o.name),v=this._subscriptionSelectionViewModel.selectedSubscription(),a=null,v&&(a=v.subscriptionId),p=this._getPurchaseQuantity(),i={},i[w.Id]=l.ItemModelHelper.getFullyQualifiedNameForItem(this._item.publisherName,this._item.name),i[w.ProductType]=l.ItemModelHelper.getItemTypeText(this._item.itemType),i[w.AccountId]=h,i[w.Quantity]=p,i[w.IsNewSubscription]=this._subscriptionSelectionViewModel.isNew()?1:0,i[w.IsSubsequentPurchase]=this._isSubsequentPurchase?1:0,h&&a?(this._reviewViewModel.showAcquiringItemExperience(!0),this._acquisitionService.acquireItem(this._item,h,this._installOption,a,p,this._availableAccounts).then(function(){r.allSettled([e.TelemetryHelper.publishEventAsync(e.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.CONFIRM_BUY_ITEM,i)]).then(function(){var i,r,e;t._reviewViewModel.showAcquiringItemExperience(!1);i=[];r=t._getAcquireActionsPostExtensionPurchase(n);t._item.properties&&t._item.properties[c.ItemConstants.PROPERTY_LEARN_LINK]&&i.push({linkText:f.ExtensionLearnMoreDescriptiveText,linkUrl:t._item.properties[c.ItemConstants.PROPERTY_LEARN_LINK],openInNewTab:!0,onClick:y.curry(n,u.AcquireWorkFlowConstants.LEARN_MORE)});i.push({linkText:f.AcquireCompletionDiscoverMoreExtensions,linkUrl:s.GalleryURLs.getHomePageVSTSTabURL(),onClick:y.curry(n,u.AcquireWorkFlowConstants.DISCOVER_MORE_EXTENSIONS)});e=t._getExtensionBuySuccessMessage();b.resolve({stepTemplateName:"acquire-item-completion-message",stepViewModelOptions:{buttonText:f.VSS_BuyExtension_AssignUsers,buttonLink:o.userHubUrl+t._extensionUrlPathQuery+l.ItemModelHelper.getFullyQualifiedNameForItem(t._item.publisherName,t._item.name),installCompletionDetailedMessage:e,accountLinks:i,accountName:k,accountUrl:o.uri,acquireCompletionButtons:r}})})},function(n){t._onError(n);var i=n&&n.message&&n.message.length>0?n.message:f.PurchaseFailed_ErrorMessage}),b.promise):void 0},n.prototype._getAcquireActionsPostExtensionPurchase=function(n){var i=this._targetSelectionViewModel.selectedTarget(),t=[];return this._item.properties&&this._item.properties[c.ItemConstants.PROPERTY_GET_STARTED_LINK]?t.push({linkText:f.GetStartedButtonText,linkUrl:this._item.properties[c.ItemConstants.PROPERTY_GET_STARTED_LINK],openInNewTab:!0,onClick:y.curry(n,u.AcquireWorkFlowConstants.GET_STARTED)}):t.push({linkText:f.ProceedToAccountButtonText,linkUrl:i.uri,openInNewTab:!0,onClick:y.curry(n,u.AcquireWorkFlowConstants.PROCEED_TO_ACCOUNT)}),t},n.prototype._initializeViewModels=function(n){this._targetSelectionViewModel=n[0];this._subscriptionSelectionViewModel=n[1];this._reviewViewModel=n[3];this._requestItemViewModel=n[4]},n.prototype._checkLinkedSubscriptionForAccount=function(){var n=this;this._subscriptionSelectionViewModel.subscribe(this._subscriptionSelectionViewModel.isContinueCompleted,function(){n._subscriptionSelectionViewModel.isContinueCompleted()&&(n._validateSubscription(),n._subscriptionSelectionViewModel.isContinueCompleted(!1))});this._subscriptionSelectionViewModel.subscribe(this._subscriptionSelectionViewModel.isCompleted,function(){n._subscriptionSelectionViewModel.isCompleted()&&n._onSubscriptionSelectionComplete()});this._subscriptionSelectionViewModel.itemName=l.ItemModelHelper.getFullyQualifiedNameForItem(this._item.publisherName,this._item.name)},n.prototype._validateSubscription=function(){var n=this;this._subscriptionSelectionViewModel.showSubscriptionValidatonLoadingExp(!0);this._subscriptionSelectionViewModel.validateSubscriptionMsg(f.CheckingYourSubscription);this._commerceDataProvider.getAzureSubscriptionForPurchase(this._subscriptionSelectionViewModel.selectedSubscription().subscriptionId,this._subscriptionSelectionViewModel.itemName,this._subscriptionSelectionViewModel.accountId).then(function(t){var i,r;n._subscriptionSelectionViewModel.selectedSubscription().offerCode=t.offerCode;n._subscriptionSelectionViewModel.selectedSubscription().tenantId=t.tenantId;n._subscriptionSelectionViewModel.selectedSubscription().objectId=t.objectId;n._subscriptionSelectionViewModel.selectedSubscription().isPricingAvailable=t.isPricingAvailable;n._setSubscriptionUsedForPurchase(t);n._subscriptionSelectionViewModel.showSubscriptionValidatonLoadingExp(!1);t.failedPurchaseReason===v.PurchaseErrorReason.None?(n._subscriptionSelectionViewModel.isSubscriptionValidated(!0),n._subscriptionSelectionViewModel.completeStep(),n._subscriptionSelectionViewModel.validateSubscriptionMsg("")):(i="",t.failedPurchaseReason===v.PurchaseErrorReason.MonetaryLimitSet?(r=p.format("<a href=\"{0}\" target='_blank'>"+f.RemoveSpendingLimit+"<\/a>",f.RemoveSpendingLimitForwardLink),i=p.format(f.SubscriptionHasSpendingLimit,r)):t.failedPurchaseReason===v.PurchaseErrorReason.InvalidOfferCode?i=f.SubscriptionCannotBeUsedForPurchase:t.failedPurchaseReason===v.PurchaseErrorReason.NotAdminOrCoAdmin?i=f.NotAdminForSubscription:t.failedPurchaseReason===v.PurchaseErrorReason.InvalidRegionPurchase&&(i=p.format(f.InvalidRegionForPurchase,n._targetSelectionViewModel.selectedTarget().geoLocation)),n._subscriptionSelectionViewModel.validateSubscriptionMsg(i))},function(t){n._onError(t);n._subscriptionSelectionViewModel.showSubscriptionValidatonLoadingExp(!1);n._subscriptionSelectionViewModel.validateSubscriptionMsg("");n._subscriptionSelectionViewModel.subscriptionValidationErrorMessage(f.ValidateSubscription_ErrorMessage)})},n.prototype._getTargetSelectionStepIndex=function(){return 0},n.prototype._isMSABackedAccountAlreadyLinkedToAzureSubscription=function(n){return this._isMSABackedAccount(n)&&this._isLinkedToAzureSubscription(n)},n.prototype._isMSABackedAccount=function(n){return p.isEmptyGuid(n.tenantId)},n.prototype._hideStages=function(){this._reviewViewModel.isHidden(!0);this._subscriptionSelectionViewModel.isHidden(!0)},n}();t.BuyExtensionWorkflowBase=b});
define("Gallery/Client/Controls/AcquireItemWizard/BuyExtensionWorkflowForOnPrem",["require","exports","q","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/Common/Telemetry","Gallery/Client/Common/TelemetryInternal","Gallery/Client/Common/Constants","Gallery/Client/Service/VSSCommerce/IVSSCommerce","VSS/Utils/String","Gallery/Client/Controls/AcquireItemWizard/BuyExtensionWorkflowBase","Gallery/Client/Service/VSSItem","VSS/Utils/Core"],function(n,t,i,r,u,f,e,o,s,h,c,l){var a=u.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.AcquisitionWorkFlowProperties,v=function(n){function t(t){n.call(this,{commerceDataProvider:t.commerceDataProvider,extensionManagementDataProvider:t.extensionManagementDataProvider,galleryDataProvider:t.galleryDataProvider,item:t.item,eulaContent:t.eulaContent,onError:t.onError});this._options=t}return __extends(t,n),t.prototype.getStepDefinitions=function(){var t=n.prototype.getStepDefinitions.call(this),i={collections:this._options.collections,targetCollectionId:this._options.collections[0].id,isAlwaysEditable:!0,targetServerName:this._options.targetServerName},r={stepTemplateName:"vss-collection-selection-template",stepCSSClassName:"install-flow-step collection-step",stepViewModelOptions:i};return t.splice(0,0,r),t},t.prototype.startWorkflow=function(n){var i=this;this._initializeViewModels(n);this._reviewViewModel.isHidden(!0);this._collectionSelectionViewModel.startEdit();this._checkLinkedSubscriptionForAccount();this._buyCustomizationViewModel.maxNum(201);this._buyCustomizationViewModel.isOfferWorkFlow(!1);this._item.name===t.TESTMANAGER_EXTENSION_NAME&&this._buyCustomizationViewModel.isYearlyItem(!1);this._buyCustomizationViewModel.subscribe(this._buyCustomizationViewModel.isCompleted,function(){i._buyCustomizationViewModel.isCompleted()&&i._onBuyComplete()});this._collectionSelectionViewModel.readonlyContainerVisible(!0);this._collectionSelectionViewModel.targetSelectionCompleteStep();this._collectionSelectionViewModel.isCompleted(!0);this._onCollectionSelectionComplete()},t.prototype.completeWorkflow=function(){var n=function(){return!0};return this._onBuyWorkFlowComplete(n)},t.prototype._onCollectionSelectionComplete=function(){this._targetSelectionViewModel.selectedTarget().id=this._options.collections[0].hiddenAccountId;this._onTragetSelectionComplete(!0);this._subscriptionSelectionViewModel.subscriptionSelectedText=r.SubscriptionSelectionReadOnlyTextForOnPrem},t.prototype._initializeViewModels=function(t){n.prototype._initializeViewModels.call(this,t);this._collectionSelectionViewModel=t[this._getTargetSelectionStepIndex()];this._buyCustomizationViewModel=t[2]},t.prototype._getBuyCustomizationStep=function(){return{stepTemplateName:"buy-customization-template",stepViewModelOptions:{}}},t.prototype._getPurchaseQuantity=function(){return this._buyCustomizationViewModel.newQuantity()},t.prototype._getPurchaseActionText=function(){return this._buyCustomizationViewModel.newQuantity()<this._buyCustomizationViewModel.nextMonthQuantity()?r.ReducingText:r.PurchasingText},t.prototype._hideStages=function(){n.prototype._hideStages.call(this);this._buyCustomizationViewModel.isHidden(!0)},t.prototype._setSubscriptionUsedForPurchase=function(n){this._buyCustomizationViewModel.isPricingAvailable(n.isPricingAvailable)},t.prototype._onSubscriptionSelectionComplete=function(){var n=this,t={},e,s,h;t[a.Id]=c.ItemModelHelper.getFullyQualifiedNameForItem(this._item.publisherName,this._item.name);t[a.SubscriptionId]=this._subscriptionSelectionViewModel.selectedSubscription().subscriptionId;t[a.IsNewSubscription]=this._subscriptionSelectionViewModel.isNew()?1:0;t[a.ProductType]=c.ItemModelHelper.getItemTypeText(this._item.itemType);f.TelemetryHelper.publishEvent(u.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.SELECT_AZURE_SUBSCRIPTION,t,!0);this._buyCustomizationViewModel.isActive(!0);this._buyCustomizationViewModel.loadingPricing(!0);e=[];s=!1;this._subscriptionSelectionViewModel.selectedSubscription().isPricingAvailable&&(h=this._commerceDataProvider.getItemPrice(this._item,this._targetSelectionViewModel.selectedTarget().id,this._subscriptionSelectionViewModel.selectedSubscription().subscriptionId,this._subscriptionSelectionViewModel.selectedSubscription().offerCode,this._subscriptionSelectionViewModel.selectedSubscription().tenantId,this._subscriptionSelectionViewModel.selectedSubscription().objectId),e.push(h),h.then(function(t){var u,f,h,c;if(t.currencyCode&&(n._buyCustomizationViewModel.currencyCode=t.currencyCode),t.locale&&(n._buyCustomizationViewModel.locale=t.locale),t.details){u=[];f=0;for(h in t.details)u[f]={key:h,value:t.details[h]},f++;s=t.type===o.PricingType.PerPlan;c=u.sort(function(n,t){return n.key-t.key});n._buyCustomizationViewModel.setMeterPrice(c,s);n._buyCustomizationViewModel.isMeterAvailable(!0)}s?n._initializeDataForPlanBasedMeter(e):n._initializeDataForUserBasedMeter(e);i.allSettled(e).then(function(t){n._buyCustomizationViewModel.loadingPricing(!1);var i=!0;$.each(t,function(n,t){t.state!=="fulfilled"&&(i=!1)});i?(n._buyCustomizationViewModel.isSubsequentPurchase()&&(n._buyCustomizationViewModel.minAllowedQuantity(0),s?n._buyCustomizationViewModel.newQuantity(n._buyCustomizationViewModel.currQuantity()):n._buyCustomizationViewModel.newQuantity(n._buyCustomizationViewModel.nextMonthQuantity())),n._buyCustomizationViewModel.startEdit()):(t&&$.each(t,function(t,i){i.state==="rejected"&&n._onError(i.reason)}),n._buyCustomizationViewModel.buyCustomizationErrorMessage(r.AcquireItemGenericError))})}));this._buyCustomizationViewModel.item(this._item)},t.prototype._initializeDataForPlanBasedMeter=function(n){var t=this,i=this._commerceDataProvider.getAccountScopedPurchaseDetails(this._item,this._targetSelectionViewModel.selectedTarget().id);n.push(i);i.then(function(n){n.trialEndDate!==null&&t._buyCustomizationViewModel.setTrialEndDate(n.trialEndDate);n.renewalDate!==null&&t._buyCustomizationViewModel.setRenewalDate(n.renewalDate);n.quantity>0&&(t._isSubsequentPurchase=!0,t._buyCustomizationViewModel.isSubsequentPurchase(t._isSubsequentPurchase));t._buyCustomizationViewModel.currQuantity(n.quantity)})},t.prototype._initializeDataForUserBasedMeter=function(n){var t=this,i=this._commerceDataProvider.getAccountScopedQuantity(this._item,this._targetSelectionViewModel.selectedTarget().id,!1),r=this._commerceDataProvider.getAccountScopedQuantity(this._item,this._targetSelectionViewModel.selectedTarget().id,!0);n.push(i);n.push(r);i.then(function(n){t._buyCustomizationViewModel.currQuantity(n.quantity);n.quantity>0&&(t._isSubsequentPurchase=!0);t._buyCustomizationViewModel.isSubsequentPurchase(t._isSubsequentPurchase)});r.then(function(n){n&&t._buyCustomizationViewModel.nextMonthQuantity(n.quantity)})},t.prototype._getAcquireActionsPostExtensionPurchase=function(t){var i=n.prototype._getAcquireActionsPostExtensionPurchase.call(this,t),u=this._targetSelectionViewModel.selectedTarget(),f=u.userHubUrl+this._extensionUrlPathQuery+c.ItemModelHelper.getFullyQualifiedNameForItem(this._item.publisherName,this._item.name);return i.push({linkText:r.AssignUsersButtonText,linkUrl:f,openInNewTab:!0,onClick:l.curry(t,e.AcquireWorkFlowConstants.ASSIGN_TO_USERS)}),i},t.prototype._getExtensionBuySuccessMessage=function(){return s.format(r.ExtensionBuySuccessMessage,this._getPurchaseQuantity(),this._item.title)},t.prototype._getAccountSelectionReadOnlyText=function(){return r.AccountSelectionReadOnlyText},t.prototype._beginCheckAndRedirectTenantIfRequired=function(){var n=i.defer();return n.resolve(!0),n.promise},t.prototype._onBuyComplete=function(){this._reviewViewModel.startEdit()},t.TESTMANAGER_EXTENSION_NAME="vss-testmanager-web",t}(h.BuyExtensionWorkflowBase);t.BuyExtensionWorkflowForOnPrem=v});
define("Gallery/Client/Controls/AcquireItemWizard/BuyExtensionWorkflow",["require","exports","q","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/Common/Telemetry","Gallery/Client/Common/Constants","Gallery/Client/Common/TelemetryInternal","Gallery/Client/Controls/AcquireItemWizard/BuyExtensionWorkflowBase","Gallery/Client/Service/VSSItem","Gallery/Client/Service/HttpClientProvider/HttpClientProvider","VSS/Contributions/Contracts","VSS/Utils/String","Gallery/Client/Common/Utility"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){var v=u.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.AcquisitionWorkFlowProperties,y=function(n){function t(t){n.call(this,{commerceDataProvider:t.commerceDataProvider,galleryDataProvider:t.galleryDataProvider,extensionManagementDataProvider:t.extensionManagementDataProvider,item:t.item,eulaContent:t.eulaContent,onError:t.onError});this._createNewAccountUrl="";this._useCache=!0;this._createNewAccountUrl=t.createNewAccountUrl;this._targetAccountId=t.targetAccountId}return __extends(t,n),t.prototype.getStepDefinitions=function(){var t=n.prototype.getStepDefinitions.call(this),i={accounts:[],createNewAccountUrl:this._createNewAccountUrl,targetAccountId:this._targetAccountId,completionPreProcess:this._accountSelectionChanged.bind(this),accountSelectionReadOnlyText:this._getAccountSelectionReadOnlyText()},r={stepTemplateName:"vss-account-selection-template",stepViewModelOptions:i};return t.splice(0,0,r),t},t.prototype._initializeViewModels=function(t){n.prototype._initializeViewModels.call(this,t);this._accountSelectionViewModel=t[0]},t.prototype.startWorkflow=function(n){var t=this;this._initializeViewModels(n);this._accountSelectionViewModel.isActive(!0);this._accountSelectionViewModel.showAccountLoadingExperience(!0);this._isSubsequentPurchase=!1;this.getAccounts();this._reviewViewModel.acquiringItemMessage(r.PurchasingText);this._accountSelectionViewModel.subscribe(this._accountSelectionViewModel.isCompleted,function(){if(t._accountSelectionViewModel.isCompleted()){var n=t._targetSelectionViewModel.selectedTarget();t._onTragetSelectionComplete(t._isMSABackedAccount(n))}});this._accountSelectionViewModel.subscribe(this._accountSelectionViewModel.shouldRefreshAccounts,function(){t._accountSelectionViewModel.shouldRefreshAccounts()&&(t.getAccounts(!t._useCache),t._accountSelectionViewModel.shouldRefreshAccounts(!1))});this._checkLinkedSubscriptionForAccount()},t.prototype.completeWorkflow=function(){var n=this,t="",i;return t=this._installOption===s.VSSItemAcquisitionOption.Request?f.AcquireWorkFlowConstants.BUY_REQUEST:f.AcquireWorkFlowConstants.BUY_EXTENSION,i=function(i){var r={};return r[v.LinkType]=i,r[v.WorkFlowType]=t,r[v.Id]=s.ItemModelHelper.getFullyQualifiedNameForItem(n._item.publisherName,n._item.name),r[v.Quantity]=n._getPurchaseQuantity(),r[v.IsNewSubscription]=n._subscriptionSelectionViewModel.isNew()?1:0,r[v.AccountId]=n._targetSelectionViewModel.selectedTarget().id,r[v.IsNewAccount]=n._accountSelectionViewModel.isNewAccount()?1:0,r[v.IsSubsequentPurchase]=n._isSubsequentPurchase?1:0,r[v.ProductType]=s.ItemModelHelper.getItemTypeText(n._item.itemType),e.TelemetryHelper.publishEvent(u.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.POST_INSTALL_WORKFLOW,r,!0),!0},this._onBuyWorkFlowComplete(i)},t.prototype._accountSelectionChanged=function(n){var t=this,u=i.defer();return this._acquisitionService.getAcquisitionOptions(this._item,n).then(function(i){if(i.operationState===c.AcquisitionOperationState.Disallow)t._targetSelectionViewModel.setTargetAsDisallowed(i.reason),u.resolve(!1),t._logTelemetryForDisallowedInstall(n.id,i.reason),i.operationType;else if(t._requestItemViewModel.isWarning(!0),i.operationType!==c.AcquisitionOperationType.Request&&(n.isAccountOwner||n.subscriptionId))a.FeatureFlagUtils.isACSDecommissionMode()&&t._isMSABackedAccountAlreadyLinkedToAzureSubscription(n)?t._refreshTokenForLinkedSubscription(n).then(function(){u.resolve(!0)},function(n){t._onError(n);u.resolve(!0)}):(t._installOption=s.VSSItemAcquisitionOption.Buy,u.resolve(!0));else if(i.operationState===c.AcquisitionOperationState.Completed)t._targetSelectionViewModel.setTargetAsActionPerformed(s.VSSItemAcquisitionOption.Request,n),t._requestItemViewModel.isHidden(!0),u.resolve(!1);else{t._targetSelectionViewModel.targetSelectedText(r.AccountSelectionReadOnlyText_Request);t._installOption=s.VSSItemAcquisitionOption.Request;var f=l.format("<a href='{0}' target='_blank'>"+r.LearnMore+"<\/a>",r.MarketPlaceFAQLink),e=l.format(r.VSS_Install_DoNotHavePermissionText,n.uri,a.getAccountNameFromAccountUrl(n.uri));t._requestItemViewModel.targetStatusText(e+" "+f);t._requestItemViewModel.isWarning(!1);t._requestItemViewModel.isHidden(!1);t._requestItemViewModel.startEdit();t._hideStages();t._logTelemetryForInstallRequest(t._item,n.id);u.resolve(!0);t.completeButtonText(r.ConfirmText)}},function(n){t._onError(n);t._targetSelectionViewModel.targetStatusCheckErrorMessage(r.CheckInstallationStatus_ErrorMessage);u.resolve(!1)}),u.promise},t.prototype._refreshTokenForLinkedSubscription=function(n){var t=i.defer(),r=n.subscriptionId;return this._commerceDataProvider.getTenantForSubscription(r).then(function(i){i?h.TokenProvider.getToken(n.id,i,r).then(function(){t.resolve(!0)},function(n){t.reject(n)}):t.resolve(!0)},function(n){t.reject(n)}),t.promise},t.prototype._logTelemetryForDisallowedInstall=function(n,t){var i={},r;i[v.ErrorString]=n+" : "+t;i[v.ProductType]=s.ItemModelHelper.getItemTypeText(this._item.itemType);r=u.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.INSTALL_WORKFLOW_ERRORS;e.TelemetryHelper.publishEvent(r,i)},t.prototype._logTelemetryForInstallRequest=function(n,t){var f=s.ItemModelHelper.getFullyQualifiedNameForItem(n.publisherName,n.name),i={},r;i[v.Id]=f;i[v.AccountId]=t;i[v.IsPublic]=n.isPublic;i[v.ProductType]=s.ItemModelHelper.getItemTypeText(this._item.itemType);r=u.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.INITIATE_REQUEST_INSTALL;e.TelemetryHelper.publishEvent(r,i)},t.prototype.getAccounts=function(n){var t=this;n===void 0&&(n=!0);this._commerceDataProvider.getAllAccounts(!1,!1,this._item).then(function(n){t._availableAccounts=n;t._accountSelectionViewModel.showAccountLoadingExperience(!1);t._accountSelectionViewModel.availableTargets(n);t._accountSelectionViewModel.startEdit()},function(n){t._onError(n);t._accountSelectionViewModel.showAccountLoadingExperience(!1);t._accountSelectionViewModel.accountLoadingErrorMessage(r.LoadingAccounts_ErrorMessage)})},t.prototype._beginCheckAndRedirectTenantIfRequired=function(n){var r=this._accountSelectionViewModel.selectedTarget(),t=i.defer();return this._isAADBackedAccount(r)?t.resolve(!0):h.TokenProvider.getToken(r.id,n.tenantId,n.subscriptionId).then(function(){t.resolve(!0)},function(n){t.reject(n)}),t.promise},t.prototype._isAADBackedAccount=function(n){return l.isGuid(n.tenantId)&&!l.isEmptyGuid(n.tenantId)},t}(o.BuyExtensionWorkflowBase);t.BuyExtensionWorkflow=y});
define("Gallery/Client/Controls/AcquireItemWizard/BuyPerUserExtensionWorkflow",["require","exports","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/Common/Telemetry","Gallery/Client/Common/TelemetryInternal","Gallery/Client/Common/Constants","Gallery/Client/Service/VSSCommerce/IVSSCommerce","VSS/Utils/String","Gallery/Client/Controls/AcquireItemWizard/BuyExtensionWorkflow","Gallery/Client/Service/VSSItem","q","VSS/Utils/Core"],function(n,t,i,r,u,f,e,o,s,h,c,l){var a=r.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.AcquisitionWorkFlowProperties,v=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.startWorkflow=function(t){var i=this;n.prototype.startWorkflow.call(this,t);this._buyCustomizationViewModel.maxNum(201);this._buyCustomizationViewModel.isOfferWorkFlow(!1);this._buyCustomizationViewModel.isYearlyItem(!1);this._buyCustomizationViewModel.subscribe(this._buyCustomizationViewModel.isCompleted,function(){i._buyCustomizationViewModel.isCompleted()&&i._onBuyComplete()})},t.prototype._initializeViewModels=function(t){n.prototype._initializeViewModels.call(this,t);this._buyCustomizationViewModel=t[2]},t.prototype._getBuyCustomizationStep=function(){return{stepTemplateName:"buy-customization-template",stepViewModelOptions:{}}},t.prototype._getPurchaseQuantity=function(){return this._buyCustomizationViewModel.newQuantity()},t.prototype._getPurchaseActionText=function(){return this._buyCustomizationViewModel.newQuantity()<this._buyCustomizationViewModel.nextMonthQuantity()?i.ReducingText:i.PurchasingText},t.prototype._hideStages=function(){n.prototype._hideStages.call(this);this._buyCustomizationViewModel.isHidden(!0)},t.prototype._setSubscriptionUsedForPurchase=function(n){this._buyCustomizationViewModel.isPricingAvailable(n.isPricingAvailable)},t.prototype._onSubscriptionSelectionComplete=function(){var n=this,i={},t,f,o;i[a.Id]=this._getFullyQualifiedExtensionName(this._item);i[a.SubscriptionId]=this._subscriptionSelectionViewModel.selectedSubscription().subscriptionId;i[a.IsNewSubscription]=this._subscriptionSelectionViewModel.isNew()?1:0;i[a.ProductType]=h.ItemModelHelper.getItemTypeText(this._item.itemType);u.TelemetryHelper.publishEvent(r.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.SELECT_AZURE_SUBSCRIPTION,i,!0);this._buyCustomizationViewModel.isActive(!0);this._commerceDataProvider.getValidUsersCount(this._accountSelectionViewModel.selectedTarget().id,this._getFullyQualifiedExtensionName(this._item)).then(function(t){n._buyCustomizationViewModel.setActiveUsersCount(t)});this._buyCustomizationViewModel.loadingPricing(!0);t=[];f=!1;this._subscriptionSelectionViewModel.selectedSubscription().isPricingAvailable?(o=this._commerceDataProvider.getItemPrice(this._item,this._accountSelectionViewModel.selectedTarget().id,this._subscriptionSelectionViewModel.selectedSubscription().subscriptionId,this._subscriptionSelectionViewModel.selectedSubscription().offerCode,this._subscriptionSelectionViewModel.selectedSubscription().tenantId,this._subscriptionSelectionViewModel.selectedSubscription().objectId),t.push(o),o.then(function(i){var r,u,o,s;if(i.currencyCode&&(n._buyCustomizationViewModel.currencyCode=i.currencyCode),i.locale&&(n._buyCustomizationViewModel.locale=i.locale),i.details){r=[];u=0;for(o in i.details)r[u]={key:o,value:i.details[o]},u++;f=i.type===e.PricingType.PerPlan;s=r.sort(function(n,t){return n.key-t.key});n._buyCustomizationViewModel.setMeterPrice(s,f);n._buyCustomizationViewModel.isMeterAvailable(!0)}f?n._initializeDataForPlanBasedMeter(t):n._initializeDataForUserBasedMeter(t);n._initializeBuyCustomizationViewModelWithQuantityData(t,f)})):(this._initializeDataForUserBasedMeter(t),this._initializeBuyCustomizationViewModelWithQuantityData(t,!1));this._buyCustomizationViewModel.item(this._item)},t.prototype._initializeBuyCustomizationViewModelWithQuantityData=function(n,t){var r=this;c.allSettled(n).then(function(n){r._buyCustomizationViewModel.loadingPricing(!1);var u=!0;$.each(n,function(n,t){t.state!=="fulfilled"&&(u=!1)});u?(r._buyCustomizationViewModel.isSubsequentPurchase()&&(r._buyCustomizationViewModel.minAllowedQuantity(0),t?r._buyCustomizationViewModel.newQuantity(r._buyCustomizationViewModel.currQuantity()):r._buyCustomizationViewModel.newQuantity(r._buyCustomizationViewModel.nextMonthQuantity())),r._buyCustomizationViewModel.startEdit()):(n&&$.each(n,function(n,t){t.state==="rejected"&&r._onError(t.reason)}),r._buyCustomizationViewModel.buyCustomizationErrorMessage(i.AcquireItemGenericError))})},t.prototype._initializeDataForPlanBasedMeter=function(n){var t=this,i=this._commerceDataProvider.getAccountScopedPurchaseDetails(this._item,this._accountSelectionViewModel.selectedTarget().id);n.push(i);i.then(function(n){n.trialEndDate!==null&&t._buyCustomizationViewModel.setTrialEndDate(n.trialEndDate);n.renewalDate!==null&&t._buyCustomizationViewModel.setRenewalDate(n.renewalDate);n.quantity>0&&(t._isSubsequentPurchase=!0,t._buyCustomizationViewModel.isSubsequentPurchase(t._isSubsequentPurchase));t._buyCustomizationViewModel.currQuantity(n.quantity)})},t.prototype._initializeDataForUserBasedMeter=function(n){var t=this,i=this._commerceDataProvider.getAccountScopedQuantity(this._item,this._accountSelectionViewModel.selectedTarget().id,!1),r=this._commerceDataProvider.getAccountScopedQuantity(this._item,this._accountSelectionViewModel.selectedTarget().id,!0);n.push(i);n.push(r);i.then(function(n){n.trialEndDate!==null&&t._buyCustomizationViewModel.setTrialEndDate(n.trialEndDate);t._buyCustomizationViewModel.currQuantity(n.quantity);n.quantity>0&&(t._isSubsequentPurchase=!0);t._buyCustomizationViewModel.isSubsequentPurchase(t._isSubsequentPurchase)});r.then(function(n){n&&t._buyCustomizationViewModel.nextMonthQuantity(n.quantity)})},t.prototype._getAcquireActionsPostExtensionPurchase=function(t){var r=n.prototype._getAcquireActionsPostExtensionPurchase.call(this,t),u=this._accountSelectionViewModel.selectedTarget(),e=u.userHubUrl+this._extensionUrlPathQuery+this._getFullyQualifiedExtensionName(this._item);return r.push({linkText:i.AssignUsersButtonText,linkUrl:e,openInNewTab:!0,onClick:l.curry(t,f.AcquireWorkFlowConstants.ASSIGN_TO_USERS)}),r},t.prototype._getExtensionBuySuccessMessage=function(){return o.format(i.ExtensionBuySuccessMessage,this._getPurchaseQuantity(),this._item.title)},t.prototype._getAccountSelectionReadOnlyText=function(){return i.AccountSelectionReadOnlyText},t.prototype._onBuyComplete=function(){this._reviewViewModel.startEdit()},t.prototype._getFullyQualifiedExtensionName=function(n){return h.ItemModelHelper.getFullyQualifiedNameForItem(n.publisherName,n.name)},t.TESTMANAGER_EXTENSION_NAME="vss-testmanager-web",t}(s.BuyExtensionWorkflow);t.BuyPerUserExtensionWorkflow=v});
define("Gallery/Client/Controls/AcquireItemWizard/BuyPerAccountExtensionWorkflow",["require","exports","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/Common/Telemetry","Gallery/Client/Common/TelemetryInternal","VSS/Utils/String","Gallery/Client/Controls/AcquireItemWizard/BuyExtensionWorkflow","Gallery/Client/Service/VSSItem","VSS/Utils/Core"],function(n,t,i,r,u,f,e,o,s){var h=r.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.AcquisitionWorkFlowProperties,c=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.startWorkflow=function(t){var i=this;n.prototype.startWorkflow.call(this,t);this._accountBasedPurchaseDetailsViewModel.subscribe(this._accountBasedPurchaseDetailsViewModel.isCompleted,function(){i._accountBasedPurchaseDetailsViewModel.isCompleted()&&i._onBuyComplete()})},t.prototype._initializeViewModels=function(t){n.prototype._initializeViewModels.call(this,t);this._accountBasedPurchaseDetailsViewModel=t[2]},t.prototype._getBuyCustomizationStep=function(){var n={onError:this._onError};return{stepTemplateName:"account-based-purchase-details-template",stepViewModelOptions:n}},t.prototype._getAccountSelectionReadOnlyText=function(){return f.format(i.BuyAccountWideExtensionAccountSelectionReadOAccountSelectionReadOnlyText_AccountWideExtension,this._item.title)},t.prototype._getPurchaseQuantity=function(){return this._accountBasedPurchaseDetailsViewModel.getUserCount()},t.prototype._getPurchaseActionText=function(){return i.PurchasingText},t.prototype._hideStages=function(){n.prototype._hideStages.call(this);this._accountBasedPurchaseDetailsViewModel.isHidden(!0)},t.prototype._setSubscriptionUsedForPurchase=function(n){this._isPricingAvailable=n.isPricingAvailable},t.prototype._onSubscriptionSelectionComplete=function(){var n={};if(n[h.Id]=o.ItemModelHelper.getFullyQualifiedNameForItem(this._item.publisherName,this._item.name),n[h.SubscriptionId]=this._subscriptionSelectionViewModel.selectedSubscription().subscriptionId,n[h.IsNewSubscription]=this._subscriptionSelectionViewModel.isNew()?1:0,u.TelemetryHelper.publishEvent(r.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.SELECT_AZURE_SUBSCRIPTION,n,!0),this._isPricingAvailable){var t=s.delegate(this._commerceDataProvider,s.curry(this._commerceDataProvider.getValidUsersCount,this._accountSelectionViewModel.selectedTarget().id,o.ItemModelHelper.getFullyQualifiedNameForItem(this._item.publisherName,this._item.name))),i=s.delegate(this._commerceDataProvider,s.curry(this._commerceDataProvider.getAccountScopedQuantity,this._item,this._accountSelectionViewModel.selectedTarget().id,!1)),f=s.delegate(this._commerceDataProvider,s.curry(this._commerceDataProvider.getItemPrice,this._item,this._accountSelectionViewModel.selectedTarget().id,this._subscriptionSelectionViewModel.selectedSubscription().subscriptionId,this._subscriptionSelectionViewModel.selectedSubscription().offerCode,this._subscriptionSelectionViewModel.selectedSubscription().tenantId,this._subscriptionSelectionViewModel.selectedSubscription().objectId));this._accountBasedPurchaseDetailsViewModel.initialize(this._item,t,f,i);this._accountBasedPurchaseDetailsViewModel.startEdit()}},t.prototype._getExtensionBuySuccessMessage=function(){return f.format(i.AccountWidePurchaseSuccessMessage,this._item.title)},t.prototype._onBuyComplete=function(){this._reviewViewModel.startEdit()},t}(e.BuyExtensionWorkflow);t.BuyPerAccountExtensionWorkflow=c});
define("Gallery/Client/Controls/AcquireItemWizard/FreeExtensionWorkFlowBase",["require","exports","knockout","Gallery/Client/Common/Constants","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/URLHelper","Gallery/Client/Common/Utility","Gallery/Client/Service/VSSGallery/VSSGallery","Gallery/Client/Service/VSSItem","Gallery/Client/Service/VSSAcquisition/VSSAcquisition","VSS/Contributions/Contracts","VSS/Utils/Core","VSS/Utils/String"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){var v=function(){function n(n){this._isRedirectToBuyWorkFlow=!1;this._eulaContent=null;this._installOption=s.VSSItemAcquisitionOption.Install;this._targetSelectionTextRequest="";this.workflowHeader=null;this.completeButtonText=i.observable(u.ConfirmText);this.workflowAlreadyComplete=i.observable(!1);this._detailedItem=n.detailedItem;this._eulaContent=n.eulaContent;this._onError=n.onError||$.noop;this._acquisitionService=new h.VSSAcquisition(n.galleryDataProvider,n.extensionManagementDataProvider)}return n.prototype.getStepDefinitions=function(){var n=[],f={completeButtonText:u.ConfirmText},t,r;return n.push({stepTemplateName:"vss-request-item-template",stepCSSClassName:"install-flow-step request-step",stepViewModelOptions:f}),t=[],this._detailedItem.scopes&&$.each(this._detailedItem.scopes,function(n,i){t.push(i.title)}),r={scopes:t,eulaContent:this._eulaContent,acquireItemReviewHeader:i.observable(u.ConfirmText),isAlwaysEditable:!0},n.push({stepTemplateName:"vss-acquireitem-review-template",stepCSSClassName:"install-flow-step review-step",stepViewModelOptions:r}),n},n.prototype._setCompleteButtonTextOnCompleteWorkFlow=function(){this._installOption===s.VSSItemAcquisitionOption.Request?this.completeButtonText(u.RequestingText):this.completeButtonText(u.InstallingText)},n.prototype._acquireItemSuccessHandler=function(n,t){this._requestItemViewModel.showRequestingExperience(!1);this._reviewViewModel.showAcquiringItemExperience(!1);n.resolve({stepTemplateName:"acquire-item-completion-message",stepViewModelOptions:this._getCompletedStepOptions(t)})},n.prototype._acquireItemErrorHandler=function(n,t){if(this._onError(t),console.log("acquire item failed"),this._installOption===s.VSSItemAcquisitionOption.Request)this.completeButtonText(u.ConfirmText),n.reject(u.RequestFailed_ErrorMessage);else{var i=t&&t.message&&t.message.length>0?t.message:u.InstallFailed_ErrorMessaage;this.completeButtonText(u.ConfirmText);n.reject(i)}},n.prototype._getCompletedStepOptions=function(n,t){var h=[],i=[],t=t?t:function(){return!0},e;return this._installOption===s.VSSItemAcquisitionOption.Request?(h.push({linkText:u.VSS_Install_ViewRequest,linkUrl:this._targetSelectionViewModel.selectedTarget().uri+this._getRequestExtensionUrl(),openInNewTab:!0}),this._detailedItem.properties&&this._detailedItem.properties[o.ItemConstants.PROPERTY_LEARN_LINK]&&i.push({linkText:u.ExtensionLearnMoreDescriptiveText,linkUrl:this._detailedItem.properties[o.ItemConstants.PROPERTY_LEARN_LINK],openInNewTab:!0,onClick:l.curry(t,r.AcquireWorkFlowConstants.LEARN_MORE)}),i.push({linkText:u.AcquireCompletionDiscoverMoreExtensions,linkUrl:f.GalleryURLs.getHomePageVSTSTabURL(),onClick:l.curry(t,r.AcquireWorkFlowConstants.DISCOVER_MORE_EXTENSIONS)}),e=this._targetSelectionViewModel.selectedTarget(),{installCompletionDetailedMessage:"",accountName:e.name,accountUrl:e.uri,accountLinks:i,acquireCompletionButtons:h}):(e=this._targetSelectionViewModel.selectedTarget(),h=[],this._detailedItem.properties&&this._detailedItem.properties[o.ItemConstants.PROPERTY_GET_STARTED_LINK]&&h.push({linkText:u.GetStartedButtonText,linkUrl:this._detailedItem.properties[o.ItemConstants.PROPERTY_GET_STARTED_LINK],openInNewTab:!0,onClick:l.curry(t,r.AcquireWorkFlowConstants.GET_STARTED)}),this._detailedItem.properties&&this._detailedItem.properties[o.ItemConstants.PROPERTY_LEARN_LINK]&&i.push({linkText:u.ExtensionLearnMoreDescriptiveText,linkUrl:this._detailedItem.properties[o.ItemConstants.PROPERTY_LEARN_LINK],openInNewTab:!0,onClick:l.curry(t,r.AcquireWorkFlowConstants.LEARN_MORE)}),i.push({linkText:u.AcquireCompletionDiscoverMoreExtensions,linkUrl:f.GalleryURLs.getHomePageVSTSTabURL(),onClick:l.curry(t,r.AcquireWorkFlowConstants.DISCOVER_MORE_EXTENSIONS)}),{installCompletionDetailedMessage:"",accountName:e.name,accountUrl:e.uri,accountLinks:i,acquireCompletionButtons:h})},n.prototype._initializeViewModels=function(n){var t=this._getTargetSelectionStepIndex();this._targetSelectionViewModel=n[t];this._requestItemViewModel=n[t+1];this._reviewViewModel=n[t+2]},n.prototype._getTargetSelectionStepIndex=function(){return 0},n.prototype.isRedirectToBuyWorkFlow=function(){return this._isRedirectToBuyWorkFlow},n.prototype._shouldContinueOnTargetSelectionChanged=function(n,t){var i,r,f;if(this._isRedirectToBuyWorkFlow=!1,t.operationState===c.AcquisitionOperationState.Disallow)this._reviewViewModel.isHidden(!1),this._requestItemViewModel.isHidden(!0),t.operationType===c.AcquisitionOperationType.Try&&e.FeatureFlagUtils.checkAndSetEnableFirstPartyCommerce()&&t.reason&&a.caseInsensitiveContains(t.reason,u.BuyRedirectText)?(t.reason=a.format(t.reason,n.name),this._targetSelectionViewModel.setTargetAsDisallowed(t.reason),this.completeButtonText(u.ContinueButtonText),this._reviewViewModel.isCompleted(!0),this._isRedirectToBuyWorkFlow=!0,i=!0):(this._targetSelectionViewModel.setTargetAsDisallowed(t.reason),i=!1);else{this._requestItemViewModel.isWarning(!0);switch(t.operationType){case c.AcquisitionOperationType.None:this._targetSelectionViewModel.setTargetAsActionPerformed(s.VSSItemAcquisitionOption.None,n);this._reviewViewModel.isHidden(!1);this._requestItemViewModel.isHidden(!0);this.completeButtonText(u.ConfirmText);i=!1;case c.AcquisitionOperationType.Request:t.operationState===c.AcquisitionOperationState.Completed?(this._reviewViewModel.isHidden(!1),this._requestItemViewModel.isHidden(!0),this._onActionAlreadyPerformed(c.AcquisitionOperationType.Request,n),i=!1):(this._targetSelectionViewModel.targetSelectedText(this._targetSelectionTextRequest),this._installOption=s.VSSItemAcquisitionOption.Request,r=a.format("<a href='{0}' target='_blank'>"+u.LearnMore+"<\/a>",u.MarketPlaceFAQLink),f=a.format(u.VSS_Install_DoNotHavePermissionText,n.uri,this._getNameForTarget(n)),this._requestItemViewModel.targetStatusText(f+" "+r),this._requestItemViewModel.isWarning(!1),this._reviewViewModel.isHidden(!0),this._requestItemViewModel.isHidden(!1),this._requestItemViewModel.startEdit(),this._reviewViewModel.isHidden(!0),i=!0);this.completeButtonText(u.ConfirmText);break;case c.AcquisitionOperationType.Install:this._requestItemViewModel.isHidden(!0);this._reviewViewModel.isHidden(!1);t.operationState===c.AcquisitionOperationState.Completed?(this._onActionAlreadyPerformed(c.AcquisitionOperationType.Install,n),i=!1):(this._setWorkflowStatesForAcquisitionOptionOnSuccess(c.AcquisitionOperationType.Install,""),i=!0);this.completeButtonText(u.ConfirmText)}}return i},n.prototype._getRequestExtensionUrl=function(){throw new Error("Dervied class should provide definition for _getRequestExtensionUrl");},n.prototype._getNameForTarget=function(n){return n?n.name:""},n.prototype._onGetAcquisitionOptionsFailed=function(n){this._onError&&this._onError(n);this._targetSelectionViewModel.targetStatusCheckErrorMessage(u.CheckInstallationStatus_ErrorMessage)},n.prototype._onActionAlreadyPerformed=function(n,t,i){var r=this._getVSSItemAcquisitionOptionForAcquisitionOperation(n);this._targetSelectionViewModel.setTargetAsActionPerformed(r,t,i);this.workflowAlreadyComplete(!0)},n.prototype._setWorkflowStatesForAcquisitionOptionOnSuccess=function(n,t){var i=this._getVSSItemAcquisitionOptionForAcquisitionOperation(n);this._targetSelectionViewModel.targetSelectedText(t);this._installOption=i;this._targetSelectionViewModel.targetStatusText(null);this._requestItemViewModel.isCompleted(!0);this._reviewViewModel.startEdit();this.completeButtonText(u.ConfirmText)},n.prototype._getVSSItemAcquisitionOptionForAcquisitionOperation=function(n){var t=s.VSSItemAcquisitionOption.None;switch(n){case c.AcquisitionOperationType.Install:t=s.VSSItemAcquisitionOption.Install;break;case c.AcquisitionOperationType.Buy:t=s.VSSItemAcquisitionOption.Buy;break;case c.AcquisitionOperationType.Try:t=s.VSSItemAcquisitionOption.Try;break;case c.AcquisitionOperationType.Request:t=s.VSSItemAcquisitionOption.Request;break;case c.AcquisitionOperationType.Get:t=s.VSSItemAcquisitionOption.Get}return t},n.prototype._hasGetStartedLink=function(){return this._detailedItem.properties&&this._detailedItem.properties[o.ItemConstants.PROPERTY_GET_STARTED_LINK]?!0:!1},n}();t.FreeExtensionWorkflowBase=v});
define("Gallery/Client/Common/ServerConstants",["require","exports"],function(n,t){var i,r,u,f,e;(function(n){n.TrialExpiryDate="TrialExpiryDate"})(i=t.AcquisitionConstants||(t.AcquisitionConstants={})),function(n){n[n.General=1]="General";n[n.Abusive=2]="Abusive";n[n.Spam=4]="Spam"}(t.ConcernCategory||(t.ConcernCategory={}));r=t.ConcernCategory,function(n){n[n.None=0]="None";n[n.Private=1]="Private";n[n.Public=2]="Public";n[n.Preview=4]="Preview";n[n.Released=8]="Released";n[n.FirstParty=16]="FirstParty";n[n.All=31]="All"}(t.ExtensionPolicyFlags||(t.ExtensionPolicyFlags={}));u=t.ExtensionPolicyFlags,function(n){n[n.None=0]="None";n[n.FilterEmptyReviews=1]="FilterEmptyReviews";n[n.FilterEmptyUserNames=2]="FilterEmptyUserNames"}(t.ReviewFilterOptions||(t.ReviewFilterOptions={}));f=t.ReviewFilterOptions,function(n){n[n.FlagReview=1]="FlagReview";n[n.UpdateReview=2]="UpdateReview"}(t.ReviewPatchOperation||(t.ReviewPatchOperation={}));e=t.ReviewPatchOperation;t.TypeInfo={ConcernCategory:{enumValues:{general:1,abusive:2,spam:4}},ExtensionIdentifier:{fields:null},ExtensionPolicy:{fields:null},ExtensionPolicyFlags:{enumValues:{none:0,private:1,public:2,preview:4,released:8,firstParty:16,all:31}},Review:{fields:null},ReviewFilterOptions:{enumValues:{none:0,filterEmptyReviews:1,filterEmptyUserNames:2}},ReviewPatch:{fields:null},ReviewPatchOperation:{enumValues:{flagReview:1,updateReview:2}},ReviewsResult:{fields:null},UserExtensionPolicy:{fields:null},UserReportedConcern:{fields:null}};t.TypeInfo.ExtensionPolicy.fields={install:{enumType:t.TypeInfo.ExtensionPolicyFlags},request:{enumType:t.TypeInfo.ExtensionPolicyFlags}};t.TypeInfo.Review.fields={updatedDate:{isDate:!0}};t.TypeInfo.ReviewPatch.fields={operation:{enumType:t.TypeInfo.ReviewPatchOperation},reportedConcern:{typeInfo:t.TypeInfo.UserReportedConcern},reviewItem:{typeInfo:t.TypeInfo.Review}};t.TypeInfo.ReviewsResult.fields={reviews:{isArray:!0,typeInfo:t.TypeInfo.Review}};t.TypeInfo.UserExtensionPolicy.fields={permissions:{typeInfo:t.TypeInfo.ExtensionPolicy}};t.TypeInfo.UserReportedConcern.fields={category:{enumType:t.TypeInfo.ConcernCategory},submittedDate:{isDate:!0}}});
define("Gallery/Client/Controls/AcquireItemWizard/FreeExtensionWorkflow",["require","exports","knockout","q","Gallery/Client/Controls/AcquireItemWizard/FreeExtensionWorkFlowBase","Gallery/Client/Common/Constants","VSS/Contributions/Contracts","Gallery/Client/Common/ServerConstants","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/Common/Telemetry","Gallery/Client/Common/TelemetryInternal","Gallery/Client/URLHelper","Gallery/Client/Common/Utility","Gallery/Client/Service/VSSItem","Gallery/Client/Service/VSSAcquisition/VSSAcquisition","VSS/Diag","VSS/Utils/Core","VSS/Utils/Date","VSS/Utils/String"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){var g=a.WindowWrapper,d=h.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.AcquisitionWorkFlowProperties,nt=function(n){function t(t){n.call(this,{galleryDataProvider:t.galleryDataProvider,extensionManagementDataProvider:t.extensionManagementDataProvider,detailedItem:t.detailedItem,eulaContent:t.eulaContent,onError:t.onError});this._createNewAccountUrl="";this._testCommerce=!1;this.workflowHeader=null;this.completeButtonText=i.observable(s.ConfirmText);this.workflowAlreadyComplete=i.observable(!1);this._commerceDataProvider=t.commerceDataProvider;this._createNewAccountUrl=t.createNewAccountUrl;this._accountIdsFilter=t.accountIdsFilter;this._targetAccountId=t.targetAccountId;this._onError=t.onError||$.noop;this._targetSelectionTextRequest=s.AccountSelectionReadOnlyText_Request;this._testCommerce=l.GalleryURLs.isTestCommerceEnabled(a.WindowWrapper.getQueryString());this._acquisitionService=new y.VSSAcquisition(t.galleryDataProvider,t.extensionManagementDataProvider)}return __extends(t,n),t.prototype.getStepDefinitions=function(){var t=n.prototype.getStepDefinitions.call(this),i={accounts:[],targetAccountId:this._targetAccountId,createNewAccountUrl:this._createNewAccountUrl,completeButtonText:s.ConfirmText,completionPreProcess:this._accountSelectionChanged.bind(this),isAlwaysEditable:!0},r;return(v.ItemModelHelper.isFirstPartyPaidExtension(this._detailedItem)&&a.FeatureFlagUtils.checkAndSetEnableFirstPartyCommerce()||v.ItemModelHelper.isThirdPartyPaidExtension(this._detailedItem)&&a.FeatureFlagUtils.checkAndSetEnableThirdPartyCommerce())&&(i.accountSelectionHelpText=s.AccountSelectionHelpTextForTrial),r={stepTemplateName:"vss-account-selection-template",stepCSSClassName:"install-flow-step account-step",stepViewModelOptions:i},t.splice(0,0,r),t},t.prototype.startWorkflow=function(n){var t=this;this._initializeViewModels(n);this._accountSelectionViewModel.isActive(!0);this._accountSelectionViewModel.showAccountLoadingExperience(!0);this._reviewViewModel.acquiringItemMessage(s.InstallingText);this._accountSelectionViewModel.subscribe(this._accountSelectionViewModel.isCompleted,function(){t._accountSelectionViewModel.isCompleted()&&t._onAccountSelectionComplete()});this._commerceDataProvider.getAllAccounts(!1,!1,this._detailedItem).then(function(n){t._availableAccounts=n;t._accountIdsFilter&&(n=n.filter(function(n){return t._accountIdsFilter[n.id.toLowerCase()]}));t._accountSelectionViewModel.availableTargets(n);t._accountSelectionViewModel.showAccountLoadingExperience(!1);t._accountSelectionViewModel.startEdit()},function(n){t._onError(n);console.log("accounts load failed");t._accountSelectionViewModel.showAccountLoadingExperience(!1);t._accountSelectionViewModel.accountLoadingErrorMessage(s.LoadingAccounts_ErrorMessage)})},t.prototype.completeWorkflow=function(){var n=this,t=r.defer();return this.isRedirectToBuyWorkFlow()?(g.open(a.getRedirectToBuyWorkflowURL(this._accountSelectionViewModel.selectedTarget().id),"_self"),t.promise):(this._setCompleteButtonTextOnCompleteWorkFlow(),this._acquisitionService.acquireItem(this._detailedItem,this._accountSelectionViewModel.selectedTarget().id,this._installOption,null,0,this._availableAccounts,this._requestItemViewModel.requestReason()).then(function(i){n._logCITelemetry(n._detailedItem,n._installOption);n._acquireItemSuccessHandler(t,i)},function(i){n._acquireItemErrorHandler(t,i)}),t.promise)},t.prototype._logCITelemetry=function(n,t,i){var f,r,u;i===void 0&&(i=!1);f=v.ItemModelHelper.getFullyQualifiedNameForItem(n.publisherName,n.name);r={};r[d.Id]=f;r[d.AccountId]=this._accountSelectionViewModel.selectedTarget().id;u="";t===v.VSSItemAcquisitionOption.Request?(u=h.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.REQUESTEXTENSION,r[d.IsPublic]=n.isPublic,r[d.ProductType]=v.ItemModelHelper.getItemTypeText(n.itemType),i&&(r[d.AlreadyRequested]=1)):t===v.VSSItemAcquisitionOption.Install?(u=h.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.CONFIRM_INSTALL_ITEM,r[d.ProductType]=v.ItemModelHelper.getItemTypeText(n.itemType),r[d.IsNewAccount]=this._accountSelectionViewModel.isNewAccount()?1:0,r[d.IsPublic]=n.isPublic,i&&(r[d.AlreadyInstalled]=1)):t===v.VSSItemAcquisitionOption.Try&&(u=h.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.CONFIRM_TRIAL_ITEM,r[d.IsNewAccount]=this._accountSelectionViewModel.isNewAccount()?1:0,i&&(r[d.AlreadyUnderTrial]=1));u!==""&&c.TelemetryHelper.publishEvent(u,r,!0)},t.prototype._getCompletedStepOptions=function(t){var i=this,e=function(n){var t={},r=i._getWorkFlowType();return t[d.LinkType]=n,t[d.WorkFlowType]=r,t[d.Id]=v.ItemModelHelper.getFullyQualifiedNameForItem(i._detailedItem.publisherName,i._detailedItem.name),t[d.AccountId]=i._accountSelectionViewModel.selectedTarget().id,t[d.IsNewAccount]=i._accountSelectionViewModel.isNewAccount()?1:0,t[d.ProductType]=v.ItemModelHelper.getItemTypeText(i._detailedItem.itemType),c.TelemetryHelper.publishEvent(h.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.POST_INSTALL_WORKFLOW,t,!0),!0},r=n.prototype._getCompletedStepOptions.call(this,t,e),o,u;return this._installOption===v.VSSItemAcquisitionOption.Try&&(o=this._getTrialSuccessMessage(t),r.trialSuccessMessage=o,u=this._getTrialExpiryDate(t),u&&(r.trialExpiryDate=u.toLocaleDateString())),this._installOption===v.VSSItemAcquisitionOption.Request?r.installCompletionDetailedMessage=s.VSS_Install_RequestSuccessMessage:(r.installCompletionDetailedMessage=s.ExtensionInstallSuccessMessage,this._hasGetStartedLink()||r.acquireCompletionButtons.push({linkText:s.ProceedToAccountButtonText,linkUrl:this._accountSelectionViewModel.selectedTarget().uri,openInNewTab:!0,onClick:w.curry(e,f.AcquireWorkFlowConstants.PROCEED_TO_ACCOUNT)})),r},t.prototype._getWorkFlowType=function(){return this._installOption===v.VSSItemAcquisitionOption.Request?f.AcquireWorkFlowConstants.INSTALL_REQUEST:this._installOption===v.VSSItemAcquisitionOption.Try?f.AcquireWorkFlowConstants.TRIAL:f.AcquireWorkFlowConstants.INSTALL},t.prototype._getTrialSuccessMessage=function(n){var t="",i=this._getTrialExpiryDate(n),r;return i?(r=b.daysBetweenDates(b.stripTimeFromDate(new Date),i,!0),t=k.format(s.TrialAcquisitionSuccessMessage,r)):t=s.TrialAcquisitionSuccessMessageIndefinite,t},t.prototype._getTrialExpiryDate=function(n){var t=n.properties?n.properties[o.AcquisitionConstants.TrialExpiryDate]:"",i=null;if(p.logInfo("Trial expiryDate = "+t),t)try{i=b.parseDateString(t)}catch(r){i=null}return i},t.prototype._initializeViewModels=function(t){n.prototype._initializeViewModels.call(this,t);this._accountSelectionViewModel=t[0]},t.prototype._logTelemetryForInstallRequest=function(n){var r=v.ItemModelHelper.getFullyQualifiedNameForItem(n.publisherName,n.name),t={},i;t[d.Id]=r;t[d.AccountId]=this._accountSelectionViewModel.selectedTarget().id;t[d.IsPublic]=n.isPublic;t[d.ProductType]=v.ItemModelHelper.getItemTypeText(this._detailedItem.itemType);i=h.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.INITIATE_REQUEST_INSTALL;c.TelemetryHelper.publishEvent(i,t)},t.prototype._logTelemetryForDisallowedInstall=function(n,t){var i={},r;i[d.ErrorString]=n+" : "+t;i[d.ProductType]=v.ItemModelHelper.getItemTypeText(this._detailedItem.itemType);r=h.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.INSTALL_WORKFLOW_ERRORS;c.TelemetryHelper.publishEvent(r,i)},t.prototype._accountSelectionChanged=function(t){var i=this,u=r.defer();return this._acquisitionService.getAcquisitionOptions(this._detailedItem,t,this._testCommerce,!0).then(function(r){var f=n.prototype._shouldContinueOnTargetSelectionChanged.call(i,t,r),o;r.operationState===e.AcquisitionOperationState.Disallow?i._logTelemetryForDisallowedInstall(t.id,r.reason):r.operationType===e.AcquisitionOperationType.Request?i._logTelemetryForInstallRequest(i._detailedItem):r.operationType===e.AcquisitionOperationType.Try&&(i._reviewViewModel.isHidden(!1),i._requestItemViewModel.isHidden(!0),r.operationState===e.AcquisitionOperationState.Completed?(o=r.reason,i._onActionAlreadyPerformed(e.AcquisitionOperationType.Try,t,o),f=!1):(i._setWorkflowStatesForAcquisitionOptionOnSuccess(e.AcquisitionOperationType.Try,s.AccountSelectionReadOnlyText_Trial),f=!0));u.resolve(f)},function(n){i._onGetAcquisitionOptionsFailed(n);u.resolve(!1)}),u.promise},t.prototype._getNameForTarget=function(n){return n?a.getAccountNameFromAccountUrl(n.uri):""},t.prototype._getRequestExtensionUrl=function(){return f.GalleryRequestUrlsConstants.RequestExtensionURLWithDefaultCollection},t.prototype._onAccountSelectionComplete=function(){var n={};n[d.Id]=v.ItemModelHelper.getFullyQualifiedNameForItem(this._detailedItem.publisherName,this._detailedItem.name);n[d.AccountId]=this._accountSelectionViewModel.selectedTarget().id;n[d.AccountName]=this._accountSelectionViewModel.selectedTarget().name;n[d.AvailableAccounts]=this._accountSelectionViewModel.availableTargets().length;n[d.ProductType]=v.ItemModelHelper.getItemTypeText(this._detailedItem.itemType);c.TelemetryHelper.publishEvent(h.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.SELECT_ACCOUNT,n,!0)},t.prototype._onActionAlreadyPerformed=function(t,i,r){n.prototype._onActionAlreadyPerformed.call(this,t,i,r);var u=this._getVSSItemAcquisitionOptionForAcquisitionOperation(t);this._logCITelemetry(this._detailedItem,u,!0)},t}(u.FreeExtensionWorkflowBase);t.FreeExtensionWorkflow=nt});
define("Gallery/Client/Controls/AcquireItemWizard/OnPremExtensionWorkflow",["require","exports","Gallery/Client/Controls/AcquireItemWizard/FreeExtensionWorkFlowBase","Gallery/Client/Service/VSSItem","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/Common/Constants","q","VSS/Utils/File"],function(n,t,i,r,u,f,e,o){var s=function(n){function t(t){n.call(this,{galleryDataProvider:t.galleryDataProvider,extensionManagementDataProvider:t.extensionManagementDataProvider,detailedItem:t.detailedItem,eulaContent:t.eulaContent,onError:t.onError});this._options=t;this._targetSelectionTextRequest=u.CollectionSelectionReadOnlyText_Request}return __extends(t,n),t.prototype.getStepDefinitions=function(){var t=n.prototype.getStepDefinitions.call(this),i={collections:this._options.collections,targetCollectionId:this._options.targetCollectionId,completeButtonText:u.ConfirmText,onCollectionSelected:this._collectionSelectionChanged.bind(this),isAlwaysEditable:!0},r={stepTemplateName:"vss-collection-selection-template",stepCSSClassName:"install-flow-step collection-step",stepViewModelOptions:i};return t.splice(0,0,r),t},t.prototype.startWorkflow=function(n){this._initializeViewModels(n);this._startCollectionEdit()},t.prototype.completeWorkflow=function(){var t=this,n=e.defer();return this._setCompleteButtonTextOnCompleteWorkFlow(),this._acquisitionService.acquireItem(this._options.detailedItem,this._collectionSelectionViewModel.selectedTarget().id,this._installOption,null,0,[this._collectionSelectionViewModel.selectedTarget()],this._requestItemViewModel.requestReason()).then(function(){t._acquireItemSuccessHandler(n)},function(i){t._acquireItemErrorHandler(n,i)}),n.promise},t.prototype._startCollectionEdit=function(){this._collectionSelectionViewModel.isActive(!0);this._collectionSelectionViewModel.startEdit()},t.prototype._initializeViewModels=function(t){n.prototype._initializeViewModels.call(this,t);this._collectionSelectionViewModel=t[this._getTargetSelectionStepIndex()]},t.prototype._getCompletedStepOptions=function(t){var i=n.prototype._getCompletedStepOptions.call(this,t);return this._installOption===r.VSSItemAcquisitionOption.Request?i.installCompletionDetailedMessage=u.CollectionInstallRequestSuccessMessage:(i.installCompletionDetailedMessage=u.ExtensionOnPremInstallSuccessMessage,this._hasGetStartedLink()||i.acquireCompletionButtons.push({linkText:u.ManageExtensionsButtonText,linkUrl:o.combinePaths(this._collectionSelectionViewModel.selectedTarget().uri,"_admin/_apps/hub/ms.vss-extmgmt-web.manageExtensions-collection"),openInNewTab:!0})),i},t.prototype._collectionSelectionChanged=function(t){var r=this,i=e.defer();return this._acquisitionService.getAcquisitionOptions(this._detailedItem,t).then(function(u){var f=n.prototype._shouldContinueOnTargetSelectionChanged.call(r,t,u);i.resolve(f)},function(n){r._onGetAcquisitionOptionsFailed(n);i.resolve(!1)}),i.promise},t.prototype._getRequestExtensionUrl=function(){return f.GalleryRequestUrlsConstants.RequestExtensionURL},t}(i.FreeExtensionWorkflowBase);t.OnPremExtensionWorkflow=s});
define("Gallery/Client/Controls/AcquireItemWizard/OnPremConnectedFreeWorkflow",["require","exports","q","VSS/Events/Services","Gallery/Client/Controls/AcquireItemWizard/OnPremExtensionWorkflow","Gallery/Client/Controls/AcquireItemWizard/AcquireItemWizard.ViewModel"],function(n,t,i,r,u,f){var e=function(n){function t(t){n.call(this,t);this._externalProvider=t.externalProvider;this._publishJobId=t.publishJobId}return __extends(t,n),t.prototype.getStepDefinitions=function(){var t=n.prototype.getStepDefinitions.call(this),i={detailedItem:this._options.detailedItem,publishJobId:this._publishJobId,galleryDataProvider:this._options.galleryDataProvider,externalDataProvider:this._externalProvider},r={stepTemplateName:"package-compat-check-template",stepCSSClassName:"install-flow-step collection-step publish-step",stepViewModelOptions:i};return t.splice(0,0,r),t},t.prototype.getErrorStepDefinition=function(){var n=i.defer(),t={message:this._packageCompatViewModel.errorMessage};return n.resolve({stepTemplateName:"acquire-item-wizard-error",stepViewModelOptions:t}),n.promise},t.prototype.startWorkflow=function(n){var t=this;this._initializeViewModels(n);this._collectionSelectionViewModel.isHidden(!0);this._reviewViewModel.isHidden(!0);this._packageCompatViewModel.isActive(!0);this._packageCompatViewModel.startEdit();this._packageCompatViewModel.isCompleted.subscribe(function(n){if(n){if(t._detailedItem.scopes){var i=$.map(t._detailedItem.scopes,function(n){return n.title});t._reviewViewModel.scopes(i)}t._collectionSelectionViewModel.isHidden(!1);t._reviewViewModel.isHidden(!1);t._packageCompatViewModel.isHidden(!0);t._startCollectionEdit()}});this._packageCompatViewModel.hasNonRecoverableError.subscribe(function(n){n&&(t._onError(t._packageCompatViewModel.errorMessage),r.getService().fire(f.AcquireItemWizardViewModel.EVENT_WORKFLOW_ERROR))})},t.prototype._initializeViewModels=function(t){n.prototype._initializeViewModels.call(this,t);this._packageCompatViewModel=t[0]},t.prototype._getTargetSelectionStepIndex=function(){return 1},t}(u.OnPremExtensionWorkflow);t.OnPremConnectedWorkflow=e});
define("Gallery/Client/Service/VSSCommerce/VSSCommerceMock",["require","exports","q","Gallery/Client/Service/VSSCommerce/IVSSCommerce","Gallery/Client/Service/VSSItem","Gallery/Client/Common/Utility.Common","VSS/Commerce/Contracts","VSS/Utils/String"],function(n,t,i,r,u,f,e,o){var c=function(){function n(){}return n.prototype.getTfsAccountUrl=function(n){return i.resolve(n.uri)},n.prototype.getAccountsPlusSubscriptions=function(){return i.resolve(n.getAllAccounts())},n.prototype.getAllAccounts=function(){var t=i.defer();return t.resolve(n.getAllAccounts()),t.promise},n.prototype.getValidUsersCount=function(){var n=i.defer();return n.resolve(6),n.promise},n.prototype.getLinkedSubscription=function(){var t=i.defer();return t.resolve(n.getValidSubscription()),t.promise},n.prototype.getOwnedSubscriptions=function(){var t=i.defer();return t.resolve(n.getAllSubscriptions()),t.promise},n.prototype.getAzureSubscriptionForPurchase=function(){var t=i.defer();return t.resolve(n.getValidSubscription()),t.promise},n.prototype.getOfferMeterPrice=function(){var t=i.defer();return t.resolve(n.getOfferMeterPriceMock()),t.promise},n.prototype.getAzureSubscriptionForUser=function(t){var f=i.defer(),e=[],u,r;if(t){for(u=n.getAllSubscriptions(),r=0;r<u.length;r++)u[r].subscriptionId===t&&e.push(u[r]);f.resolve(e)}else f.resolve(n.getAllSubscriptions());return f.promise},n.prototype.createAccount=function(){var t=i.defer();return t.resolve(n.getAllAccounts()[0]),t.promise},n.prototype.linkSubscriptionToAccount=function(){var n=i.defer(),t;return n.resolve(t),n.promise},n.prototype.getItemPrice=function(){var t=i.defer(),n;return o.ignoreCaseComparer(f.getCookie("TieredPricing"),"true")!==0?t.resolve({type:r.PricingType.PerUser,details:[{key:0,value:1},{key:5,value:5},{key:10,value:10}],renewalDate:new Date,currencyCode:"USD",locale:"en"}):(n={type:r.PricingType.PerPlan,details:[],renewalDate:new Date,currencyCode:"USD",locale:"en"},n.details["5"]="100",n.details["10"]="200",n.details["50"]="1000",t.resolve(n)),t.promise},n.prototype.getAccountScopedQuantity=function(n){var t=i.defer(),r=u.ItemModelHelper.getFullyQualifiedNameForItem(n.publisherName,n.name);return t.resolve({itemId:r,quantity:1}),t.promise},n.prototype.getAccountScopedPurchaseDetails=function(){return null},n.prototype.getSubscriptionScopedQuantity=function(n){var t=i.defer(),r=u.ItemModelHelper.getFullyQualifiedNameForItem(n.publisherName,n.name);return t.resolve({itemId:r,quantity:1}),t.promise},n.prototype.getMsdnBaseURL=function(){var n=i.defer();return n.resolve("http://app.msdnadmin.visualstudio.com/"),n.promise},n.prototype.connectServer=function(){return i.resolve(null)},n.prototype.getMockedServiceDefinition=function(){var n=new s("location1","https://abc.visualstudio.com"),t=new s("location2","https://abc.visualstudio.com"),i=[n,t];return new h(null,null,null,null,i,null,null,null,null,null,null,null,null,null,null,null)},n.prototype.getAllSubscriptions=function(){return i.resolve(n.getAllSubscriptions())},n.prototype.getTenantForSubscription=function(t){for(var u=n.getAllSubscriptions(),f=o.empty,r=0;r<u.length;r++)u[r].subscriptionId===t&&(f=u[r].tenantId);return i.resolve(f)},n.prototype.dispose=function(){},n.getOfferMeterPriceMock=function(){return[{currencyCode:"USD",meterName:"meterName",planName:"Pro",price:39,quantity:10,region:"US"},{currencyCode:"USD",meterName:"meterName",planName:"Business",price:139,quantity:100,region:"US"},{currencyCode:"USD",meterName:"meterName",planName:"Enterprise",price:1139,quantity:1e3,region:"US"}]},n.getAllAccounts=function(){return[{id:"a1",name:"abc.visualstudio.com",userHubUrl:"",uri:"",spsAccountUrl:"",subscriptionId:"s1",tenantId:"00000000-0000-0000-0000-000000000000",isAccountOwner:!0,geoLocation:"North Central US"},{id:"a2",name:"def.visualstudio.com",userHubUrl:"",uri:"",spsAccountUrl:"",subscriptionId:"s2",tenantId:"00000000-0000-0000-0000-000000000000",isAccountOwner:!0,geoLocation:"North Central US"},{id:"a3",name:"123.visualstudio.com",userHubUrl:"",uri:"",spsAccountUrl:"",subscriptionId:"s3",tenantId:"00000000-0000-0000-0000-000000000000",isAccountOwner:!0,geoLocation:"North Central US"},{id:"a4",name:"ijk.visualstudio.com",userHubUrl:"",uri:"",spsAccountUrl:"",subscriptionId:"",tenantId:"00000000-0000-0000-0000-000000000000",isAccountOwner:!0,geoLocation:"North Central US"},{id:"a5",name:"aad.visualstudio.com",userHubUrl:"",uri:"",spsAccountUrl:"",subscriptionId:"s5",tenantId:"00000000-0000-0000-0000-00000000000d",isAccountOwner:!0,geoLocation:"North Central US"},{id:"a6",name:"aad.visualstudio.com",userHubUrl:"",uri:"",spsAccountUrl:"",subscriptionId:"00000000-0000-0000-0000-00000000000d",tenantId:"00000000-0000-0000-0000-000000000000",isAccountOwner:!0,geoLocation:"North Central US"},{id:"a6",name:"msa.visualstudio.com",userHubUrl:"",uri:"",spsAccountUrl:"",subscriptionId:"00000000-0000-0000-0000-000000000000",tenantId:"00000000-0000-0000-0000-000000000000",isAccountOwner:!0,geoLocation:"North Central US"}]},n.getAllSubscriptions=function(){return[{subscriptionId:"a705c2fa-63b6-43d0-89d5-fbe4491baac0",subscriptionName:"Subscription1",isPricingAvailable:!0,isPrepaidFundSubscription:!0,failedPurchaseReason:e.PurchaseErrorReason.None,tenantId:"Tenant1"},{subscriptionId:"bc314d7d-9a05-4244-bef0-12688a279c1a",subscriptionName:"Subscription2",isPricingAvailable:!0,isPrepaidFundSubscription:!0,failedPurchaseReason:e.PurchaseErrorReason.MonetaryLimitSet,tenantId:"Tenant2"},{subscriptionId:"c880bb67-5239-44fe-bd8f-6c968b5ca53f",subscriptionName:"Subscription3",isPricingAvailable:!1,isPrepaidFundSubscription:!1,failedPurchaseReason:e.PurchaseErrorReason.InvalidOfferCode,tenantId:"Tenant3"},{subscriptionId:"e203712b-699c-4239-a70b-c744f3b66b57",subscriptionName:"Subscription4",isPricingAvailable:!1,isPrepaidFundSubscription:!1,failedPurchaseReason:e.PurchaseErrorReason.NotAdminOrCoAdmin,tenantId:"Tenant4"},{subscriptionId:"00000000-0000-0000-0000-00000000000d",subscriptionName:"Subscription5",isPricingAvailable:!1,isPrepaidFundSubscription:!1,failedPurchaseReason:e.PurchaseErrorReason.None,tenantId:"Tenant5"},{subscriptionId:"a705c2fa-63b6-43d0-89d5-fbe4491baac1",subscriptionName:"Enterprise Azure",isPricingAvailable:!1,isPrepaidFundSubscription:!1,failedPurchaseReason:e.PurchaseErrorReason.None,tenantId:"Tenant6"}]},n.getEnterpriseAzureSubscription=function(){return n.getAllSubscriptions()[5]},n.getValidSubscription=function(){return{subscriptionId:"a705c2fa-63b6-43d0-89d5-fbe4491baac0",subscriptionName:"Subscription1",isPricingAvailable:!0,isPrepaidFundSubscription:!0,failedPurchaseReason:e.PurchaseErrorReason.None}},n.getInvalidSubscriptionWithMonetaryLimitSet=function(){return{subscriptionId:"bc314d7d-9a05-4244-bef0-12688a279c1a",subscriptionName:"Subscription2",isPricingAvailable:!0,isPrepaidFundSubscription:!0,failedPurchaseReason:e.PurchaseErrorReason.MonetaryLimitSet}},n.getInvalidSubscriptionWithInvalidOfferCode=function(){return{subscriptionId:"c880bb67-5239-44fe-bd8f-6c968b5ca53f",subscriptionName:"Subscription3",isPricingAvailable:!1,isPrepaidFundSubscription:!1,failedPurchaseReason:e.PurchaseErrorReason.InvalidOfferCode}},n.getInvalidSubscriptionWithNotAdminOrCoAdmin=function(){return{subscriptionId:"e203712b-699c-4239-a70b-c744f3b66b57",subscriptionName:"Subscription4",isPricingAvailable:!1,isPrepaidFundSubscription:!1,failedPurchaseReason:e.PurchaseErrorReason.NotAdminOrCoAdmin}},n}(),s,h;t.VSSCommerceMock=c;s=function(){function n(n,t){this.accessMappingMoniker=n;this.location=t}return n}();t.MockLocationMapping=s;h=function(){function n(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){this.description=n;this.displayName=t;this.identifier=i;this.inheritLevel=r;this.locationMappings=u;this.maxVersion=f;this.minVersion=e;this.parentIdentifier=o;this.parentServiceType=s;this.properties=h;this.relativePath=c;this.relativeToSetting=l;this.releasedVersion=a;this.resourceVersion=v;this.serviceType=y;this.status=p}return n}();t.MockServiceDefinition=h});
define("Gallery/Client/Common/Cache",["require","exports","VSS/Utils/String"],function(n,t,i){var f=function(){function n(){}return n.prototype.now=function(){return Date.now()},n}(),r,u,e;t.CurrentTimeProvider=f;r=function(){function n(n,t,i){this._id=n;this._refreshIntervalInMinutes=t;this._timeProvider=i;this._timeProvider||(this._timeProvider=new f);sessionStorage&&this.setLastAccessedTime(this._timeProvider.now())}return n.prototype.getItem=function(n){try{var i=this._timeProvider.now(),t,r=(i-this.getLastAccessedTime())/6e4;return r>this._refreshIntervalInMinutes?(this.clear(),t=null):t=this.getItemInternal(n),this.setLastAccessedTime(i),t}catch(u){return null}},n.prototype.clear=function(){this.clearInternal();this.setLastAccessedTime(this._timeProvider.now())},n.prototype.getId=function(){return this._id},n}();t.Cache=r;u=function(n){function t(t,i,r){n.call(this,t,i,r)}return __extends(t,n),t.prototype.setItem=function(n,t){try{n&&!i.startsWith(n,this._getKeyPrefix())&&sessionStorage.setItem(this._getKey(n),JSON.stringify(t))}catch(r){}},t.prototype.clearInternal=function(){for(var t,n=0,r=sessionStorage.length;n<r;n++)t=sessionStorage.key(n),t&&i.startsWith(t,this._getKeyPrefix())&&sessionStorage.removeItem(t)},t.prototype.getItemInternal=function(n){var t=sessionStorage.getItem(this._getKey(n));return t?JSON.parse(t):null},t.prototype.getLastAccessedTime=function(){var n=sessionStorage.getItem(this._getKeyForLastAccessTime());return n?parseInt(n):0},t.prototype.setLastAccessedTime=function(n){sessionStorage.setItem(this._getKeyForLastAccessTime(),n.toString())},t.prototype._getKey=function(n){return this._getKeyPrefix()+n},t.prototype._getKeyPrefix=function(){return this.getId()+":"},t.prototype._getKeyForLastAccessTime=function(){return"ms.vsts.gallery.__lastAccessedTimeEntry"+this.getId()},t}(r);t.SessionStoreCache=u;e=function(){function n(){}return n.createSessionStoreCache=function(n,t,i){return new u(n,t,i)},n}();t.CacheFactory=e});
define("VSS/Commerce/RestClient",["require","exports","VSS/Commerce/Contracts","VSS/Service","VSS/WebApi/RestClient","VSS/WebApi/Constants"],function(n,t,i,r,u,f){"use strict";function y(n){return window.VSS&&window.VSS.VssSDKRestVersion&&a[window.VSS.VssSDKRestVersion]?r.getClient(a[window.VSS.VssSDKRestVersion],undefined,undefined,undefined,n):r.getClient(s,undefined,undefined,undefined,n)}var e=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t.prototype.reportUsage=function(n){return this._beginRequest({httpMethod:"POST",httpResponseType:"html",area:"Commerce",locationId:"eed7d28a-12a9-47ed-9a85-91a76c63e74b",resource:"UsageEvents",routeTemplate:"_apis/{area}/{resource}/{resourceName}",requestType:i.TypeInfo.UsageEvent,apiVersion:this.usageEventsApiVersion,data:n})},t.prototype.getUsage=function(n,t,r){var u={startTime:n,endTime:t,timeSpan:r};return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"eed7d28a-12a9-47ed-9a85-91a76c63e74b",resource:"UsageEvents",routeTemplate:"_apis/{area}/{resource}/{resourceName}",responseType:i.TypeInfo.IUsageEventAggregate,responseIsCollection:!0,queryParams:u,apiVersion:this.usageEventsApiVersion})},t.prototype.unlinkAccount=function(n,t,i,r){var u={providerNamespaceId:t,accountId:i,ownerId:r};return this._beginRequest({httpMethod:"DELETE",httpResponseType:"html",area:"Commerce",locationId:"64485509-d692-4b70-b440-d02b3b809820",resource:"Subscription",routeTemplate:"_apis/{area}/{resource}/{subscriptionId}",routeValues:{subscriptionId:n},queryParams:u,apiVersion:this.subscriptionApiVersion})},t.prototype.linkAccount=function(n,t,i,r){var u={providerNamespaceId:t,accountId:i,ownerId:r};return this._beginRequest({httpMethod:"PUT",httpResponseType:"html",area:"Commerce",locationId:"64485509-d692-4b70-b440-d02b3b809820",resource:"Subscription",routeTemplate:"_apis/{area}/{resource}/{subscriptionId}",routeValues:{subscriptionId:n},queryParams:u,apiVersion:this.subscriptionApiVersion})},t.prototype.getSubscriptionAccount=function(n,t){var r={providerNamespaceId:n,accountId:t};return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"64485509-d692-4b70-b440-d02b3b809820",resource:"Subscription",routeTemplate:"_apis/{area}/{resource}/{subscriptionId}",responseType:i.TypeInfo.ISubscriptionAccount,queryParams:r,apiVersion:this.subscriptionApiVersion})},t.prototype.getAzureSubscriptionForUser=function(n,t){var r={queryAcrossTenants:t};return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"64485509-d692-4b70-b440-d02b3b809820",resource:"Subscription",routeTemplate:"_apis/{area}/{resource}/{subscriptionId}",responseType:i.TypeInfo.ISubscriptionAccount,responseIsCollection:!0,routeValues:{subscriptionId:n},queryParams:r,apiVersion:this.subscriptionApiVersion})},t.prototype.getAzureSubscriptionForPurchase=function(n,t,r){var u={galleryItemId:t,accountId:r};return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"64485509-d692-4b70-b440-d02b3b809820",resource:"Subscription",routeTemplate:"_apis/{area}/{resource}/{subscriptionId}",responseType:i.TypeInfo.ISubscriptionAccount,routeValues:{subscriptionId:n},queryParams:u,apiVersion:this.subscriptionApiVersion})},t.prototype.getAccountsByIdentityForOfferId=function(n,t,r,u,f,e,o,s,h){var c={providerNamespaceId:n,memberId:t,queryOnlyOwnerAccounts:r,inlcudeDisabledAccounts:u,includeMSAAccounts:f,serviceOwners:e,galleryId:o,addUnlinkedSubscription:s,queryAccountsByUpn:h};return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"64485509-d692-4b70-b440-d02b3b809820",resource:"Subscription",routeTemplate:"_apis/{area}/{resource}/{subscriptionId}",responseType:i.TypeInfo.ISubscriptionAccount,responseIsCollection:!0,queryParams:c,apiVersion:this.subscriptionApiVersion})},t.prototype.getAccountsByIdentity=function(n,t,r,u,f,e){var o={providerNamespaceId:n,memberId:t,queryOnlyOwnerAccounts:r,inlcudeDisabledAccounts:u,includeMSAAccounts:f,serviceOwners:e};return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"64485509-d692-4b70-b440-d02b3b809820",resource:"Subscription",routeTemplate:"_apis/{area}/{resource}/{subscriptionId}",responseType:i.TypeInfo.ISubscriptionAccount,responseIsCollection:!0,queryParams:o,apiVersion:this.subscriptionApiVersion})},t.prototype.getAccounts=function(n,t){var r={providerNamespaceId:t};return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"64485509-d692-4b70-b440-d02b3b809820",resource:"Subscription",routeTemplate:"_apis/{area}/{resource}/{subscriptionId}",responseType:i.TypeInfo.ISubscriptionAccount,responseIsCollection:!0,routeValues:{subscriptionId:n},queryParams:r,apiVersion:this.subscriptionApiVersion})},t.prototype.getAccountRegions=function(){return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"9527c79d-9f3e-465d-8178-069106c39457",resource:"Regions",routeTemplate:"_apis/{area}/{resource}/{resourceName}",responseIsCollection:!0,apiVersion:this.regionsApiVersion})},t.prototype.updateOfferSubscription=function(n){return this._beginRequest({httpMethod:"PATCH",httpResponseType:"html",area:"Commerce",locationId:"e8950ce5-80bc-421f-b093-033c18fd3d79",resource:"OfferSubscription",routeTemplate:"_apis/{area}/{resource}/{resourceName}",requestType:i.TypeInfo.OfferSubscription,apiVersion:this.offerSubscriptionApiVersion,data:n})},t.prototype.getOfferSubscriptionsForGalleryItem=function(n,t,r){var u={galleryItemId:n,azureSubscriptionId:t,nextBillingPeriod:r};return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"e8950ce5-80bc-421f-b093-033c18fd3d79",resource:"OfferSubscription",routeTemplate:"_apis/{area}/{resource}/{resourceName}",responseType:i.TypeInfo.IOfferSubscription,responseIsCollection:!0,queryParams:u,apiVersion:this.offerSubscriptionApiVersion})},t.prototype.getOfferSubscriptions=function(n){var t={nextBillingPeriod:n};return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"e8950ce5-80bc-421f-b093-033c18fd3d79",resource:"OfferSubscription",routeTemplate:"_apis/{area}/{resource}/{resourceName}",responseType:i.TypeInfo.IOfferSubscription,responseIsCollection:!0,queryParams:t,apiVersion:this.offerSubscriptionApiVersion})},t.prototype.getOfferSubscription=function(n,t){var r={galleryId:n,nextBillingPeriod:t};return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"e8950ce5-80bc-421f-b093-033c18fd3d79",resource:"OfferSubscription",routeTemplate:"_apis/{area}/{resource}/{resourceName}",responseType:i.TypeInfo.IOfferSubscription,queryParams:r,apiVersion:this.offerSubscriptionApiVersion})},t.prototype.getAllOfferSubscriptionsForUser=function(n,t){var r={validateAzuresubscription:n,nextBillingPeriod:t};return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"e8950ce5-80bc-421f-b093-033c18fd3d79",resource:"OfferSubscription",routeTemplate:"_apis/{area}/{resource}/{resourceName}",responseType:i.TypeInfo.IOfferSubscription,responseIsCollection:!0,queryParams:r,apiVersion:this.offerSubscriptionApiVersion})},t.prototype.enableTrialOrPreviewOfferSubscription=function(n,t){var i={offerMeterName:n,renewalGroup:t};return this._beginRequest({httpMethod:"POST",httpResponseType:"html",area:"Commerce",locationId:"e8950ce5-80bc-421f-b093-033c18fd3d79",resource:"OfferSubscription",routeTemplate:"_apis/{area}/{resource}/{resourceName}",queryParams:i,apiVersion:this.offerSubscriptionApiVersion})},t.prototype.createOfferSubscription=function(n,t,r,u,f){var e={offerCode:t,tenantId:r,objectId:u,billingTarget:f};return this._beginRequest({httpMethod:"POST",httpResponseType:"html",area:"Commerce",locationId:"e8950ce5-80bc-421f-b093-033c18fd3d79",resource:"OfferSubscription",routeTemplate:"_apis/{area}/{resource}/{resourceName}",requestType:i.TypeInfo.OfferSubscription,queryParams:e,apiVersion:this.offerSubscriptionApiVersion,data:n})},t.prototype.cancelOfferSubscription=function(n,t){var r={cancelReason:t};return this._beginRequest({httpMethod:"PATCH",httpResponseType:"html",area:"Commerce",locationId:"e8950ce5-80bc-421f-b093-033c18fd3d79",resource:"OfferSubscription",routeTemplate:"_apis/{area}/{resource}/{resourceName}",requestType:i.TypeInfo.OfferSubscription,queryParams:r,apiVersion:this.offerSubscriptionApiVersion,data:n})},t.prototype.getOfferMeterPrice=function(n){var t={galleryId:n};return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"1c67c343-2269-4608-bc53-fe62daa8e32b",resource:"OfferMeterPrice",routeTemplate:"_apis/{area}/{resource}/{resourceName}",responseIsCollection:!0,queryParams:t,apiVersion:this.offerMeterPriceApiVersion})},t.prototype.getPurchasableOfferMeter=function(n,t,r,u,f,e,o){var s={resourceNameResolveMethod:t,subscriptionId:r,includeMeterPricing:u,offerCode:f,tenantId:e,objectId:o};return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"8b79e1fb-777b-4d0a-9d2e-6a4b2b8761b9",resource:"OfferMeter",routeTemplate:"_apis/{area}/{resource}/{resourceName}",responseType:i.TypeInfo.PurchasableOfferMeter,routeValues:{resourceName:n},queryParams:s,apiVersion:this.offerMeterApiVersion})},t.prototype.getOfferMeters=function(){return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"8b79e1fb-777b-4d0a-9d2e-6a4b2b8761b9",resource:"OfferMeter",routeTemplate:"_apis/{area}/{resource}/{resourceName}",responseType:i.TypeInfo.OfferMeter,responseIsCollection:!0,apiVersion:this.offerMeterApiVersion})},t.prototype.getOfferMeter=function(n,t){var r={resourceNameResolveMethod:t};return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"8b79e1fb-777b-4d0a-9d2e-6a4b2b8761b9",resource:"OfferMeter",routeTemplate:"_apis/{area}/{resource}/{resourceName}",responseType:i.TypeInfo.OfferMeter,routeValues:{resourceName:n},queryParams:r,apiVersion:this.offerMeterApiVersion})},t.prototype.createOfferMeterDefinition=function(n){return this._beginRequest({httpMethod:"POST",httpResponseType:"html",area:"Commerce",locationId:"8b79e1fb-777b-4d0a-9d2e-6a4b2b8761b9",resource:"OfferMeter",routeTemplate:"_apis/{area}/{resource}/{resourceName}",requestType:i.TypeInfo.OfferMeter,apiVersion:this.offerMeterApiVersion,data:n})},t.prototype.updateMeter=function(n){return this._beginRequest({httpMethod:"PATCH",httpResponseType:"html",area:"Commerce",locationId:"afb09d56-7740-4eb0-867f-792021fab7c9",resource:"Meters",routeTemplate:"_apis/{area}/{resource}/{resourceName}",requestType:i.TypeInfo.SubscriptionResource,apiVersion:this.metersApiVersion,data:n})},t.prototype.getResourceStatusByResourceName=function(n,t){var r={nextBillingPeriod:t};return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"afb09d56-7740-4eb0-867f-792021fab7c9",resource:"Meters",routeTemplate:"_apis/{area}/{resource}/{resourceName}",responseType:i.TypeInfo.ISubscriptionResource,routeValues:{resourceName:i.ResourceName[n]},queryParams:r,apiVersion:this.metersApiVersion})},t.prototype.getResourceStatus=function(n){var t={nextBillingPeriod:n};return this._beginRequest({httpMethod:"GET",area:"Commerce",locationId:"afb09d56-7740-4eb0-867f-792021fab7c9",resource:"Meters",routeTemplate:"_apis/{area}/{resource}/{resourceName}",responseType:i.TypeInfo.ISubscriptionResource,responseIsCollection:!0,queryParams:t,apiVersion:this.metersApiVersion})},t.serviceInstanceId=f.ServiceInstanceTypes.SPS,t}(u.VssHttpClient),o,h,s,c,l,v,a;t.CommonMethods2To3=e;o=function(n){function t(t,i){n.call(this,t,i);this.offerMeterApiVersion=this.offerMeterPriceApiVersion=this.offerSubscriptionApiVersion=this.regionsApiVersion=this.subscriptionApiVersion=this.usageEventsApiVersion="3.0-preview.1";this.metersApiVersion="3.0-preview.2"}return __extends(t,n),t.prototype.connectConnectedServer=function(n){return this._beginRequest({httpMethod:"PATCH",area:"Commerce",locationId:"c9928a7a-8102-4061-bdce-b090068c0d2b",resource:"ConnectedServer",routeTemplate:"_apis/{area}/{resource}",apiVersion:"3.0-preview.1",data:n})},t.prototype.createConnectedServer=function(n){return this._beginRequest({httpMethod:"POST",area:"Commerce",locationId:"c9928a7a-8102-4061-bdce-b090068c0d2b",resource:"ConnectedServer",routeTemplate:"_apis/{area}/{resource}",apiVersion:"3.0-preview.1",data:n})},t}(e);t.CommerceHttpClient3=o;h=function(n){function t(t,i){n.call(this,t,i);this.offerMeterApiVersion=this.offerMeterPriceApiVersion=this.offerSubscriptionApiVersion=this.regionsApiVersion=this.subscriptionApiVersion=this.usageEventsApiVersion="2.3-preview.1";this.metersApiVersion="2.3-preview.2"}return __extends(t,n),t}(e);t.CommerceHttpClient2_3=h;s=function(n){function t(t,i){n.call(this,t,i);this.offerMeterApiVersion=this.offerMeterPriceApiVersion=this.offerSubscriptionApiVersion=this.regionsApiVersion=this.subscriptionApiVersion=this.usageEventsApiVersion="2.2-preview.1";this.metersApiVersion="2.2-preview.2"}return __extends(t,n),t}(e);t.CommerceHttpClient2_2=s;c=function(n){function t(t,i){n.call(this,t,i);this.offerMeterApiVersion=this.offerMeterPriceApiVersion=this.offerSubscriptionApiVersion=this.regionsApiVersion=this.subscriptionApiVersion=this.usageEventsApiVersion="2.1-preview.1";this.metersApiVersion="2.1-preview.2"}return __extends(t,n),t}(e);t.CommerceHttpClient2_1=c;l=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t}(e);t.CommerceHttpClient2=l;v=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t}(o);t.CommerceHttpClient=v;a={"3.0":o,"2.3":h,"2.2":s,"2.1":c,"2.0":l};t.getClient=y});
define("VSS/Accounts/Contracts",["require","exports"],function(n,t){"use strict";var i,r,u,f,e;(function(n){n[n.None=2]="None";n[n.VsExpress=10]="VsExpress";n[n.VsPro=12]="VsPro";n[n.VsTestPro=14]="VsTestPro";n[n.VsPremium=16]="VsPremium";n[n.VsUltimate=18]="VsUltimate";n[n.MSDN=38]="MSDN";n[n.MsdnPro=40]="MsdnPro";n[n.MsdnTestPro=42]="MsdnTestPro";n[n.MsdnPremium=44]="MsdnPremium";n[n.MsdnUltimate=46]="MsdnUltimate";n[n.MsdnPlatforms=48]="MsdnPlatforms";n[n.VSOStandard=50]="VSOStandard";n[n.VSOAdvanced=52]="VSOAdvanced";n[n.VSOProStandard=54]="VSOProStandard";n[n.Win8=56]="Win8";n[n.Desktop=58]="Desktop";n[n.Phone=60]="Phone";n[n.VsEarlyAdopter=70]="VsEarlyAdopter"})(t.AccountLicenseSource||(t.AccountLicenseSource={}));i=t.AccountLicenseSource,function(n){n[n.StandardLicense=0]="StandardLicense";n[n.AdvancedLicense=1]="AdvancedLicense";n[n.ProfessionalLicense=2]="ProfessionalLicense";n[n.None=3]="None"}(t.AccountServiceRights||(t.AccountServiceRights={}));r=t.AccountServiceRights,function(n){n[n.None=0]="None";n[n.Enabled=1]="Enabled";n[n.Disabled=2]="Disabled";n[n.Deleted=3]="Deleted";n[n.Moved=4]="Moved"}(t.AccountStatus||(t.AccountStatus={}));u=t.AccountStatus,function(n){n[n.Personal=0]="Personal";n[n.Organization=1]="Organization"}(t.AccountType||(t.AccountType={}));f=t.AccountType,function(n){n[n.None=0]="None";n[n.Active=1]="Active";n[n.Disabled=2]="Disabled";n[n.Deleted=3]="Deleted";n[n.Pending=4]="Pending";n[n.Expired=5]="Expired";n[n.PendingDisabled=6]="PendingDisabled"}(t.AccountUserStatus||(t.AccountUserStatus={}));e=t.AccountUserStatus;t.TypeInfo={Account:{},AccountLicenseSource:{enumValues:{none:2,vsExpress:10,vsPro:12,vsTestPro:14,vsPremium:16,vsUltimate:18,mSDN:38,msdnPro:40,msdnTestPro:42,msdnPremium:44,msdnUltimate:46,msdnPlatforms:48,vSOStandard:50,vSOAdvanced:52,vSOProStandard:54,win8:56,desktop:58,phone:60,vsEarlyAdopter:70}},AccountServiceRights:{enumValues:{standardLicense:0,advancedLicense:1,professionalLicense:2,none:3}},AccountStatus:{enumValues:{none:0,enabled:1,disabled:2,deleted:3,moved:4}},AccountType:{enumValues:{personal:0,organization:1}},AccountUser:{},AccountUserStatus:{enumValues:{none:0,active:1,disabled:2,deleted:3,pending:4,expired:5,pendingDisabled:6}}};t.TypeInfo.Account.fields={accountStatus:{enumType:t.TypeInfo.AccountStatus},accountType:{enumType:t.TypeInfo.AccountType},createdDate:{isDate:!0},lastUpdatedDate:{isDate:!0}};t.TypeInfo.AccountUser.fields={creationDate:{isDate:!0},lastUpdated:{isDate:!0},licenseSource:{enumType:t.TypeInfo.AccountLicenseSource},serviceRights:{enumType:t.TypeInfo.AccountServiceRights},userStatus:{enumType:t.TypeInfo.AccountUserStatus}}});
define("VSS/Licensing/Contracts",["require","exports","VSS/Accounts/Contracts"],function(n,t,i){"use strict";var r,u,f,e,o;(function(n){n[n.None=1]="None";n[n.Bundle=2]="Bundle";n[n.AccountAssignment=4]="AccountAssignment";n[n.ImplicitAssignment=8]="ImplicitAssignment";n[n.All=-1]="All"})(t.ExtensionFilterOptions||(t.ExtensionFilterOptions={}));r=t.ExtensionFilterOptions,function(n){n[n.Assign=0]="Assign";n[n.Unassign=1]="Unassign"}(t.ExtensionOperation||(t.ExtensionOperation={}));u=t.ExtensionOperation,function(n){n[n.None=0]="None";n[n.Account=1]="Account";n[n.Msdn=2]="Msdn";n[n.Profile=3]="Profile";n[n.Auto=4]="Auto";n[n.Trial=5]="Trial"}(t.LicensingSource||(t.LicensingSource={}));f=t.LicensingSource,function(n){n[n.Success=0]="Success";n[n.Warning=1]="Warning";n[n.Error=2]="Error"}(t.OperationResult||(t.OperationResult={}));e=t.OperationResult,function(n){n[n.None=0]="None";n[n.Express=1]="Express";n[n.Advanced=2]="Advanced";n[n.AdvancedPlus=3]="AdvancedPlus";n[n.Stakeholder=4]="Stakeholder"}(t.VisualStudioOnlineServiceLevel||(t.VisualStudioOnlineServiceLevel={}));o=t.VisualStudioOnlineServiceLevel;t.TypeInfo={AccountEntitlement:{},AccountEntitlementUpdateModel:{},AccountLicenseUsage:{},AccountUserLicense:{},ExtensionAssignment:{},ExtensionFilterOptions:{enumValues:{none:1,bundle:2,accountAssignment:4,implicitAssignment:8,all:-1}},ExtensionOperation:{enumValues:{assign:0,unassign:1}},ExtensionOperationResult:{},IServiceRight:{},IUsageRight:{},License:{},LicensingSource:{enumValues:{none:0,account:1,msdn:2,profile:3,auto:4,trial:5}},MsdnEntitlement:{},OperationResult:{enumValues:{success:0,warning:1,error:2}},TransformedAccountEntitlement:{},VisualStudioOnlineServiceLevel:{enumValues:{none:0,express:1,advanced:2,advancedPlus:3,stakeholder:4}}};t.TypeInfo.AccountEntitlement.fields={assignmentDate:{isDate:!0},lastAccessedDate:{isDate:!0},license:{typeInfo:t.TypeInfo.License},userStatus:{typeInfo:i.TypeInfo.AccountUserStatus}};t.TypeInfo.AccountEntitlementUpdateModel.fields={license:{typeInfo:t.TypeInfo.License}};t.TypeInfo.AccountLicenseUsage.fields={license:{typeInfo:t.TypeInfo.AccountUserLicense}};t.TypeInfo.AccountUserLicense.fields={source:{enumType:t.TypeInfo.LicensingSource}};t.TypeInfo.ExtensionAssignment.fields={licensingSource:{enumType:t.TypeInfo.LicensingSource}};t.TypeInfo.ExtensionOperationResult.fields={operation:{enumType:t.TypeInfo.ExtensionOperation},result:{enumType:t.TypeInfo.OperationResult}};t.TypeInfo.IServiceRight.fields={serviceLevel:{enumType:t.TypeInfo.VisualStudioOnlineServiceLevel}};t.TypeInfo.IUsageRight.fields={expirationDate:{isDate:!0}};t.TypeInfo.License.fields={source:{enumType:t.TypeInfo.LicensingSource}};t.TypeInfo.MsdnEntitlement.fields={subscriptionExpirationDate:{isDate:!0}};t.TypeInfo.TransformedAccountEntitlement.fields={assignmentDate:{isDate:!0},lastAccessedDate:{isDate:!0},license:{typeInfo:t.TypeInfo.License},status:{typeInfo:i.TypeInfo.AccountUserStatus}}});
define("VSS/WebApi/Contracts",["require","exports","VSS/Licensing/Contracts"],function(n,t,i){"use strict";var r,u,f;(function(n){n[n.None=0]="None";n[n.IncludeServices=1]="IncludeServices";n[n.IncludeLastUserAccess=2]="IncludeLastUserAccess";n[n.IncludeInheritedDefinitionsOnly=4]="IncludeInheritedDefinitionsOnly";n[n.IncludeNonInheritedDefinitionsOnly=8]="IncludeNonInheritedDefinitionsOnly"})(t.ConnectOptions||(t.ConnectOptions={}));r=t.ConnectOptions,function(n){n[n.None=0]="None";n[n.HS256=1]="HS256";n[n.RS256=2]="RS256"}(t.JWTAlgorithm||(t.JWTAlgorithm={}));u=t.JWTAlgorithm,function(n){n[n.Add=0]="Add";n[n.Remove=1]="Remove";n[n.Replace=2]="Replace";n[n.Move=3]="Move";n[n.Copy=4]="Copy";n[n.Test=5]="Test"}(t.Operation||(t.Operation={}));f=t.Operation;t.TypeInfo={ConnectOptions:{enumValues:{none:0,includeServices:1,includeLastUserAccess:2,includeInheritedDefinitionsOnly:4,includeNonInheritedDefinitionsOnly:8}},ExtensionLicenseData:{},JsonPatchOperation:{},JWTAlgorithm:{enumValues:{none:0,hS256:1,rS256:2}},Operation:{enumValues:{add:0,remove:1,replace:2,move:3,copy:4,test:5}}};t.TypeInfo.ExtensionLicenseData.fields={createdDate:{isDate:!0},minimumRequiredAccessLevel:{typeInfo:i.TypeInfo.VisualStudioOnlineServiceLevel},updatedDate:{isDate:!0}};t.TypeInfo.JsonPatchOperation.fields={op:{enumType:t.TypeInfo.Operation}}});
define("VSS/Licensing/RestClient",["require","exports","VSS/Licensing/Contracts","VSS/WebApi/Contracts","VSS/Service","VSS/WebApi/RestClient"],function(n,t,i,r,u,f){"use strict";function y(n){return window.VSS&&window.VSS.VssSDKRestVersion&&a[window.VSS.VssSDKRestVersion]?u.getClient(a[window.VSS.VssSDKRestVersion],undefined,undefined,undefined,n):u.getClient(s,undefined,undefined,undefined,n)}var e=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t.prototype.getUsageRights=function(n){return this._beginRequest({httpMethod:"GET",area:"licensing",locationId:"d09ac573-58fe-4948-af97-793db40a7e16",resource:"UsageRights",routeTemplate:"_apis/{area}/{resource}/{rightName}",responseType:i.TypeInfo.IUsageRight,responseIsCollection:!0,routeValues:{rightName:n},apiVersion:this.usageRightsApiVersion})},t.prototype.getAccountLicensesUsage=function(){return this._beginRequest({httpMethod:"GET",area:"licensing",locationId:"d3266b87-d395-4e91-97a5-0215b81a0b7d",resource:"Usage",routeTemplate:"_apis/{area}/{resource}",responseType:i.TypeInfo.AccountLicenseUsage,responseIsCollection:!0,apiVersion:this.usageApiVersion})},t.prototype.getServiceRights=function(n){return this._beginRequest({httpMethod:"GET",area:"licensing",locationId:"78ed2f48-d449-412d-8772-e4e97317b7be",resource:"ServiceRights",routeTemplate:"_apis/{area}/{resource}/{rightName}",responseType:i.TypeInfo.IServiceRight,responseIsCollection:!0,routeValues:{rightName:n},apiVersion:this.serviceRightsApiVersion})},t.prototype.getEntitlements=function(){return this._beginRequest({httpMethod:"GET",area:"licensing",locationId:"1cc6137e-12d5-4d44-a4f2-765006c9e85d",resource:"Msdn",routeTemplate:"_apis/{area}/{resource}/entitlements/me",responseType:i.TypeInfo.MsdnEntitlement,responseIsCollection:!0,apiVersion:this.msdnApiVersion})},t.prototype.getMsdnPresence=function(){return this._beginRequest({httpMethod:"GET",httpResponseType:"html",area:"licensing",locationId:"69522c3f-eecc-48d0-b333-f69ffb8fa6cc",resource:"Msdn",routeTemplate:"_apis/{area}/{resource}/me",apiVersion:this.msdnApiVersion_69522c3f})},t.prototype.computeExtensionRights=function(n){return this._beginRequest({httpMethod:"POST",area:"licensing",locationId:"5f1dbe21-f748-47c7-b5fd-3770c8bc2c08",resource:"ExtensionRights",routeTemplate:"_apis/{area}/{resource}",responseIsCollection:!0,apiVersion:this.extensionRightsApiVersion,data:n})},t.prototype.registerExtensionLicense=function(n){return this._beginRequest({httpMethod:"POST",area:"Licensing",locationId:"004a420a-7bef-4b7f-8a50-22975d2067cc",resource:"ExtensionRegistration",routeTemplate:"_apis/{area}/{resource}/{extensionId}",requestType:r.TypeInfo.ExtensionLicenseData,apiVersion:this.extensionRegistrationApiVersion,data:n})},t.prototype.getExtensionLicenseData=function(n){return this._beginRequest({httpMethod:"GET",area:"Licensing",locationId:"004a420a-7bef-4b7f-8a50-22975d2067cc",resource:"ExtensionRegistration",routeTemplate:"_apis/{area}/{resource}/{extensionId}",responseType:r.TypeInfo.ExtensionLicenseData,routeValues:{extensionId:n},apiVersion:this.extensionRegistrationApiVersion})},t.prototype.getAccountEntitlementForUser=function(n){return this._beginRequest({httpMethod:"GET",area:"licensing",locationId:"6490e566-b299-49a7-a4e4-28749752581f",resource:"Entitlements",routeTemplate:"_apis/{area}/{resource}/{userId}",responseType:i.TypeInfo.AccountEntitlement,responseIsCollection:!0,routeValues:{userId:n},apiVersion:this.entitlementsApiVersion})},t.prototype.deleteUserEntitlements=function(n){return this._beginRequest({httpMethod:"DELETE",httpResponseType:"html",area:"licensing",locationId:"6490e566-b299-49a7-a4e4-28749752581f",resource:"Entitlements",routeTemplate:"_apis/{area}/{resource}/{userId}",routeValues:{userId:n},apiVersion:this.entitlementsApiVersion})},t.prototype.assignAccountEntitlementForUser=function(n,t){return this._beginRequest({httpMethod:"PUT",area:"licensing",locationId:"6490e566-b299-49a7-a4e4-28749752581f",resource:"Entitlements",routeTemplate:"_apis/{area}/{resource}/{userId}",requestType:i.TypeInfo.AccountEntitlementUpdateModel,responseType:i.TypeInfo.TransformedAccountEntitlement,routeValues:{userId:t},apiVersion:this.entitlementsApiVersion,data:n})},t.prototype.getAccountEntitlements=function(){return this._beginRequest({httpMethod:"GET",area:"licensing",locationId:"ea37be6f-8cd7-48dd-983d-2b72d6e3da0f",resource:"Entitlements",routeTemplate:"_apis/{area}/{resource}",responseType:i.TypeInfo.TransformedAccountEntitlement,responseIsCollection:!0,apiVersion:this.entitlementsApiVersion_ea37be6f})},t.prototype.getAccountEntitlement=function(){return this._beginRequest({httpMethod:"GET",area:"licensing",locationId:"c01e9fd5-0d8c-4d5e-9a68-734bd8da6a38",resource:"Entitlements",routeTemplate:"_apis/{area}/{resource}/me",responseType:i.TypeInfo.TransformedAccountEntitlement,apiVersion:this.entitlementsApiVersion_c01e9fd5})},t.prototype.assignAvailableAccountEntitlement=function(n){var t={userId:n};return this._beginRequest({httpMethod:"POST",area:"licensing",locationId:"c01e9fd5-0d8c-4d5e-9a68-734bd8da6a38",resource:"Entitlements",routeTemplate:"_apis/{area}/{resource}/me",responseType:i.TypeInfo.TransformedAccountEntitlement,queryParams:t,apiVersion:this.entitlementsApiVersion_c01e9fd5})},t.prototype.getClientRights=function(n,t,i,r,u,f,e){var o={productVersion:t,edition:i,relType:r,includeCertificate:u,canary:f,machineId:e};return this._beginRequest({httpMethod:"GET",area:"licensing",locationId:"643c72da-eaee-4163-9f07-d748ef5c2a0c",resource:"ClientRights",routeTemplate:"_apis/{area}/{resource}/{rightName}",routeValues:{rightName:n},queryParams:o,apiVersion:this.clientRightsApiVersion})},t.prototype.getCertificate=function(){return this._beginRequest({httpMethod:"GET",httpResponseType:"application/octet-stream",area:"licensing",locationId:"2e0dbce7-a327-4bc0-a291-056139393f6d",resource:"Certificate",routeTemplate:"_apis/{area}/{resource}",apiVersion:this.certificateApiVersion})},t}(f.VssHttpClient),o,h,s,c,l,v,a;t.CommonMethods2To3=e;o=function(n){function t(t,i){n.call(this,t,i);this.certificateApiVersion=this.clientRightsApiVersion=this.entitlementsApiVersion=this.entitlementsApiVersion_ea37be6f=this.entitlementsApiVersion_c01e9fd5=this.extensionRegistrationApiVersion=this.extensionRightsApiVersion=this.msdnApiVersion=this.msdnApiVersion_69522c3f=this.serviceRightsApiVersion=this.usageApiVersion=this.usageRightsApiVersion="3.0-preview.1"}return __extends(t,n),t.prototype.assignExtensionToAllEligibleUsers=function(n){return this._beginRequest({httpMethod:"PUT",area:"licensing",locationId:"5434f182-7f32-4135-8326-9340d887c08a",resource:"ExtensionEntitlements",routeTemplate:"_apis/{area}/{resource}/all/{extensionId}",responseType:i.TypeInfo.ExtensionOperationResult,responseIsCollection:!0,routeValues:{extensionId:n},apiVersion:"3.0-preview.1"})},t.prototype.getEligibleUsersForExtension=function(n,t){var i={options:t};return this._beginRequest({httpMethod:"GET",area:"licensing",locationId:"5434f182-7f32-4135-8326-9340d887c08a",resource:"ExtensionEntitlements",routeTemplate:"_apis/{area}/{resource}/all/{extensionId}",responseIsCollection:!0,routeValues:{extensionId:n},queryParams:i,apiVersion:"3.0-preview.1"})},t.prototype.assignExtensionToUsers=function(n){return this._beginRequest({httpMethod:"PUT",area:"licensing",locationId:"8cec75ea-044f-4245-ab0d-a82dafcc85ea",resource:"ExtensionEntitlements",routeTemplate:"_apis/{area}/{resource}/{userId}",requestType:i.TypeInfo.ExtensionAssignment,responseType:i.TypeInfo.ExtensionOperationResult,responseIsCollection:!0,apiVersion:"3.0-preview.1",data:n})},t.prototype.getExtensionsAssignedToUser=function(n){return this._beginRequest({httpMethod:"GET",area:"licensing",locationId:"8cec75ea-044f-4245-ab0d-a82dafcc85ea",resource:"ExtensionEntitlements",routeTemplate:"_apis/{area}/{resource}/{userId}",responseType:i.TypeInfo.LicensingSource,responseIsCollection:!0,routeValues:{userId:n},apiVersion:"3.0-preview.1"})},t.prototype.unassignExtensionFromUsers=function(){return this._beginRequest({httpMethod:"DELETE",area:"licensing",locationId:"8cec75ea-044f-4245-ab0d-a82dafcc85ea",resource:"ExtensionEntitlements",routeTemplate:"_apis/{area}/{resource}/{userId}",requestType:i.TypeInfo.ExtensionAssignment,responseType:i.TypeInfo.ExtensionOperationResult,responseIsCollection:!0,apiVersion:"3.0-preview.1"})},t}(e);t.LicensingHttpClient3=o;h=function(n){function t(t,i){n.call(this,t,i);this.certificateApiVersion=this.clientRightsApiVersion=this.entitlementsApiVersion=this.entitlementsApiVersion_ea37be6f=this.entitlementsApiVersion_c01e9fd5=this.extensionRegistrationApiVersion=this.extensionRightsApiVersion=this.msdnApiVersion=this.msdnApiVersion_69522c3f=this.serviceRightsApiVersion=this.usageApiVersion=this.usageRightsApiVersion="2.3-preview.1"}return __extends(t,n),t}(e);t.LicensingHttpClient2_3=h;s=function(n){function t(t,i){n.call(this,t,i);this.certificateApiVersion=this.clientRightsApiVersion=this.entitlementsApiVersion=this.entitlementsApiVersion_ea37be6f=this.entitlementsApiVersion_c01e9fd5=this.extensionRegistrationApiVersion=this.extensionRightsApiVersion=this.msdnApiVersion=this.msdnApiVersion_69522c3f=this.serviceRightsApiVersion=this.usageApiVersion=this.usageRightsApiVersion="2.2-preview.1"}return __extends(t,n),t}(e);t.LicensingHttpClient2_2=s;c=function(n){function t(t,i){n.call(this,t,i);this.certificateApiVersion=this.clientRightsApiVersion=this.entitlementsApiVersion=this.entitlementsApiVersion_ea37be6f=this.entitlementsApiVersion_c01e9fd5=this.extensionRegistrationApiVersion=this.extensionRightsApiVersion=this.msdnApiVersion=this.msdnApiVersion_69522c3f=this.serviceRightsApiVersion=this.usageApiVersion=this.usageRightsApiVersion="2.1-preview.1"}return __extends(t,n),t}(e);t.LicensingHttpClient2_1=c;l=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t}(e);t.LicensingHttpClient2=l;v=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t}(o);t.LicensingHttpClient=v;a={"3.0":o,"2.3":h,"2.2":s,"2.1":c,"2.0":l};t.getClient=y});
define("Gallery/Client/Service/VSSCommerce/VSSCommerce",["require","exports","q","Gallery/Client/Service/HttpClientProvider/HttpClientProvider","Gallery/Client/Service/VSSCommerce/IVSSCommerce","Gallery/Client/Service/VSSCommerce/VSSCommerceMock","Gallery/Client/Service/VSSItem","Gallery/Client/Common/Cache","VSS/Commerce/Contracts","VSS/Commerce/RestClient","VSS/Context","VSS/Common/Contracts/Platform","VSS/Licensing/RestClient","VSS/Licensing/Contracts","VSS/Locations/RestClient","VSS/Locations","VSS/Utils/String","VSS/VSS","VSS/WebApi/Constants","VSS/Events/Services"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){var g=function(){function n(n){var t=this;this._accountLevelClients={};this._itemQuantityPromiseMap={};this._accounts=[];this._userhubRelativePath="_user";this._subscriptionsCacheId="74d241ff-ad00-4519-bb12-fcc1e629f640";this._licensingClientId="__licensingClient";this._commerceClientId="__commerceClient";this._cacheHasSubscriptionInfo=!1;this._mockVSSCommerce=new f.VSSCommerceMock;this._subscriptionsCache=o.CacheFactory.createSessionStoreCache(this._subscriptionsCacheId,30,n);d.getService().attachEvent(u.CommerceConstants.CreateNewSubscriptionEvent,function(){t._subscriptionsCache.clear()})}return Object.defineProperty(n.prototype,"commerceRestClient",{get:function(){return this._commerceRestClient||(this._commerceRestClient=r.HttpClientProvider.getHttpClient(h.CommerceHttpClient)),this._commerceRestClient},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"passThroughCommerceRestClient",{get:function(){return this._passthroughCommerceRestClient||(this._passthroughCommerceRestClient=r.HttpClientProvider.getHttpClient(h.CommerceHttpClient,u.SubscriptionConstants.EmptyGuid)),this._passthroughCommerceRestClient},enumerable:!0,configurable:!0}),n.prototype.getMsdnBaseURL=function(){var n=$.Deferred(),t="https://msdnadmin.visualstudio.com/",i=p.getCachedServiceLocation(k.ServiceInstanceTypes.SPS,l.ContextHostType.Deployment),u=r.HttpClientProvider.getHttpClient(y.LocationsHttpClient,i);return u.getServiceDefinition("VsService","00000027-0000-8888-8000-000000000000").then(function(i){if(i&&i.locationMappings){var r=i.locationMappings.filter(function(n){return n.accessMappingMoniker==="RootDomainMapping"}),u="";r&&r.length>0&&(u=r[0].location);n.resolve(u)}else n.resolve(t)},function(i){b.handleError(i,$.noop);n.resolve(t)}),n.promise()},n.prototype.getTfsAccountUrl=function(n){var i=c.getDefaultWebContext(),t={user:i.user,host:{hostType:l.ContextHostType.Application,name:n.name,id:n.id,uri:n.uri}};return t.account=t.host,p.addServiceLocation(n.uri,k.ServiceInstanceTypes.SPS,l.ContextHostType.Application),p.beginGetServiceLocation(k.ServiceInstanceTypes.TFS,l.ContextHostType.Application,t)},n.prototype.getAllAccounts=function(n,t,i){var f=this,r=$.Deferred();return this._getAllSubscriptionAccounts(n,t,i).then(function(n){for(var e=[],t,o,s,h,i=0;i<n.length;i++)t=n[i],s=n[i].serviceUrls[u.SubscriptionConstants.TFSGuid],h=n[i].serviceUrls[u.SubscriptionConstants.SPSGuid],o=n[i].serviceUrls[u.SubscriptionConstants.TFSGuid]+f._userhubRelativePath,e.push({id:t.accountId,name:t.accountName,uri:s,spsAccountUrl:h,userHubUrl:o,subscriptionId:t.subscriptionId,tenantId:t.accountTenantId,isAccountOwner:t.isAccountOwner,geoLocation:t.geoLocation});e.sort(function(n,t){return w.ignoreCaseComparer(n.name,t.name)});r.resolve(e)},function(n){b.handleError(n,$.noop);r.reject(n)}),r.promise()},n.prototype.getValidUsersCount=function(n,t){var i=$.Deferred(),r=function(n){b.handleError(n,$.noop);i.reject(n)};return this.getAccountLevelHttpClient(n,a.LicensingHttpClient,this._licensingClientId).then(function(n){n.getEligibleUsersForExtension(t,v.ExtensionFilterOptions.None).then(function(n){i.resolve(n.length)},r)},r),i.promise()},n.prototype.getLinkedSubscription=function(n,t){var i=$.Deferred();return this._getAllSubscriptionAccounts(t,!1).then(function(t){for(var r,f=null,u=0;u<t.length;u++)if(r=t[u],r.accountId===n&&r.subscriptionId){f={subscriptionId:r.subscriptionId,subscriptionName:r.subscriptionName,isPricingAvailable:r.isPricingAvailable,isPrepaidFundSubscription:r.isPrepaidFundSubscription};break}i.resolve(f)},function(n){b.handleError(n,$.noop);i.reject(n)}),i.promise()},n.prototype.getOwnedSubscriptions=function(n,t){t===void 0&&(t=null);var i=$.Deferred();return this._getAllSubscriptionAccounts(n,!0,t).then(function(n){for(var r={},u=[],t=0;t<n.length;t++)r[n[t].subscriptionId]==null&&n[t].subscriptionName&&(r[n[t].subscriptionId]=n[t].subscriptionName,u.push({subscriptionId:n[t].subscriptionId,subscriptionName:n[t].subscriptionName,isPricingAvailable:n[t].isPricingAvailable,isPrepaidFundSubscription:n[t].isPrepaidFundSubscription}));i.resolve(u)},function(n){b.handleError(n,$.noop);i.reject(n)}),i.promise()},n.prototype.getAzureSubscriptionForUser=function(n,t){var i=$.Deferred();return this.commerceRestClient.getAzureSubscriptionForUser(n,t).then(function(n){for(var r=[],t=0;t<n.length;t++)n[t].subscriptionStatus===s.SubscriptionStatus.Active&&r.push({subscriptionId:n[t].subscriptionId,subscriptionName:n[t].subscriptionName,isPricingAvailable:n[t].isPricingAvailable,isPrepaidFundSubscription:n[t].isPrepaidFundSubscription,offerCode:n[t].subscriptionOfferCode,tenantId:n[t].subscriptionTenantId,objectId:n[t].subscriptionObjectId});r.sort(function(n,t){return w.ignoreCaseComparer(n.subscriptionName,t.subscriptionName)});i.resolve(r)},function(n){b.handleError(n,$.noop);i.reject(n)}),i.promise()},n.prototype.getAzureSubscriptionForPurchase=function(n,t,i){var r=$.Deferred();return this.commerceRestClient.getAzureSubscriptionForPurchase(n,t,i).then(function(n){r.resolve({subscriptionName:n.subscriptionName,subscriptionId:n.subscriptionId,isPricingAvailable:n.isPricingAvailable,isPrepaidFundSubscription:n.isPrepaidFundSubscription,offerCode:n.subscriptionOfferCode,tenantId:n.subscriptionTenantId,objectId:n.subscriptionObjectId,failedPurchaseReason:n.failedPurchaseReason})},function(n){b.handleError(n,$.noop);r.reject(n)}),r.promise()},n.prototype.createAccount=function(n){return this._mockVSSCommerce.createAccount(n)},n.prototype.linkSubscriptionToAccount=function(n,t,r){var f=i.defer(),h,e=null,o;return this._accounts.forEach(function(t){t.accountId===n&&(e=t)}),e.subscriptionId?f.resolve(h):(o=this.commerceRestClient,e.accountTenantId===u.SubscriptionConstants.EmptyGuid&&(o=this.passThroughCommerceRestClient),o.linkAccount(t,s.AccountProviderNamespace.VisualStudioOnline,n,r).then(f.resolve,function(n){b.handleError(n,$.noop);f.reject(n)})),f.promise},n.prototype.getItemPrice=function(n,t,r,f,o,h){var l=e.ItemModelHelper.getFullyQualifiedNameForItem(n.publisherName,n.name),c=i.defer();return!t&&!r?this._mockVSSCommerce.getItemPrice(n):(this.commerceRestClient.getPurchasableOfferMeter(l,"GalleryId",r,!0,f,o,h).then(function(n){var r=u.PricingType.PerUser,t=n.meterPricing,i;n.offerMeterDefinition&&n.offerMeterDefinition.billingEntity===s.BillingProvider.AzureStoreManaged&&(r=u.PricingType.PerPlan,t&&t.length===0&&(i=n.offerMeterDefinition.fixedQuantityPlans,i&&i.forEach(function(n){t[n.quantity.toString()]=u.CommerceConstants.InvalidPrice})));c.resolve({type:r,details:t,renewalDate:n.estimatedRenewalDate,currencyCode:n.currencyCode,locale:n.localeCode})},function(n){b.handleError(n,$.noop);c.reject(n)}),c.promise)},n.prototype.getAccountScopedQuantity=function(n,t,r){var u=i.defer(),f=e.ItemModelHelper.getFullyQualifiedNameForItem(n.publisherName,n.name),o=f+t+r,s;return this._itemQuantityPromiseMap[o]?this._itemQuantityPromiseMap[o]:(s=function(n){b.handleError(n,$.noop);u.reject(n)},this._itemQuantityPromiseMap[o]=u.promise,this.getAccountLevelHttpClient(t,h.CommerceHttpClient,this._commerceClientId).then(function(n){n.getOfferSubscription(f,r).then(function(n){var t={itemId:f,quantity:0,trialEndDate:null,renewalDate:null};n&&(t.quantity=n.committedQuantity,n.isTrialOrPreview&&(t.trialEndDate=n.trialExpiryDate));u.resolve(t)},s)},s),u.promise)},n.prototype.getAccountScopedPurchaseDetails=function(n,t){var r=i.defer(),u=e.ItemModelHelper.getFullyQualifiedNameForItem(n.publisherName,n.name),f="getAccountScopedPurchaseDetails"+u+t,o;return this._itemQuantityPromiseMap[f]?this._itemQuantityPromiseMap[f]:(o=function(n){b.handleError(n,$.noop);r.reject(n)},this._itemQuantityPromiseMap[f]=r.promise,this.getAccountLevelHttpClient(t,h.CommerceHttpClient,this._commerceClientId).then(function(n){n.getOfferSubscription(u,!1).then(function(n){var t={itemId:u,quantity:0,trialEndDate:null,renewalDate:null};n&&(t.quantity=n.committedQuantity,n.isTrialOrPreview?t.trialEndDate=n.trialExpiryDate:t.renewalDate=n.resetDate);r.resolve(t)},o)},o),r.promise)},n.prototype.getOfferMeterPrice=function(n){var r=e.ItemModelHelper.getFullyQualifiedNameForItem(n.publisherName,n.name),t=i.defer();return this.commerceRestClient.getOfferMeterPrice(r).then(function(n){for(var r=[],i=0;i<n.length;i++)r.push({currencyCode:n[i].currencyCode,meterName:n[i].meterName,planName:n[i].planName,price:n[i].price,quantity:n[i].quantity,region:n[i].region});t.resolve(r)},function(n){b.handleError(n,$.noop);t.reject(n)}),t.promise},n.prototype.getSubscriptionScopedQuantity=function(n,t,r,u){var f=i.defer(),o=e.ItemModelHelper.getFullyQualifiedNameForItem(n.publisherName,n.name),h=o+t+r;return this._itemQuantityPromiseMap[h]?this._itemQuantityPromiseMap[h]:(this._itemQuantityPromiseMap[h]=f.promise,this.commerceRestClient.getOfferSubscriptionsForGalleryItem(o,t,r).then(function(n){var r={itemId:o,quantity:0},t,i;n&&n.length&&(t=s.ResourceRenewalGroup.Monthly,u&&(t=u.getUTCMonth()+1),n=n.filter(function(n){return n.renewalGroup===t}),i=n.length>0?n[0]:null,i&&(r.quantity=i.committedQuantity));f.resolve(r)},function(n){b.handleError(n,$.noop);f.reject(n)}),f.promise)},n.prototype.getAllSubscriptions=function(){var u=this,n=i.defer(),f=c.getDefaultWebContext().user,t,r;return f?(t=c.getDefaultWebContext().user.email,r=this._subscriptionsCache.getItem(t),r&&r.length>0?n.resolve(r):this.getAzureSubscriptionForUser(null,!0).then(function(i){t=c.getDefaultWebContext().user.email;i.length>0&&u._subscriptionsCache.setItem(t,i);n.resolve(i)},function(t){n.reject(t)}),n.promise):(n.resolve([]),n.promise)},n.prototype.getTenantForSubscription=function(n){var t=i.defer(),r;return this.getAllSubscriptions().then(function(i){i.forEach(function(t){if(w.ignoreCaseComparer(n,t.subscriptionId)===0){r=t.tenantId;return}});t.resolve(r)},function(n){t.reject(n)}),t.promise},n.prototype.connectServer=function(n){return this.commerceRestClient.createConnectedServer(n)},n.prototype.dispose=function(){this._subscriptionsCache.clear()},n.prototype._getAllSubscriptionAccounts=function(n,t,r){var o=this,h,f;return(n===void 0&&(n=!0),t===void 0&&(t=!0),r===void 0&&(r=null),this._getAllSubscriptionAccountsPromise)?this._getAllSubscriptionAccountsPromise:(h=r?e.ItemModelHelper.getFullyQualifiedNameForItem(r.publisherName,r.name):"",f=i.defer(),this._getAllSubscriptionAccountsPromise=f.promise,this._cacheHasSubscriptionInfo=t,this.commerceRestClient.getAccountsByIdentityForOfferId(s.AccountProviderNamespace.VisualStudioOnline,u.SubscriptionConstants.EmptyGuid,!1,!1,!0,[u.SubscriptionConstants.TFSGuid,u.SubscriptionConstants.SPSGuid],h,t,!0).then(function(n){o._accounts=[];$.map(n,function(n){t&&!n.isEligibleForPurchase&&n.subscriptionId||o._accounts.push(n)});f.resolve(o._accounts)},function(n){b.handleError(n,$.noop);f.reject(n)}),f.promise)},n.prototype.getAccountLevelHttpClient=function(n,t,f){var e=this,o=i.defer();return this._accountLevelClients[n]&&this._accountLevelClients[n][f]?o.resolve(this._accountLevelClients[n][f]):this.getSubscriptionAccount(n).then(function(i){var s=i.serviceUrls[u.SubscriptionConstants.SPSGuid];e._accountLevelClients[n]||(e._accountLevelClients[n]={});e._accountLevelClients[n][f]=r.HttpClientProvider.getHttpClient(t,s,n,i.accountTenantId);o.resolve(e._accountLevelClients[n][f])},function(n){b.handleError(n,$.noop);o.reject(n)}),o.promise},n.prototype.getSubscriptionAccount=function(n){var t=i.defer();return this._getAllSubscriptionAccounts(!0,!1,null).then(function(i){for(var u=!1,r=0;r<i.length;r++)if(n===i[r].accountId){t.resolve(i[r]);u=!0;break}u||t.reject("account not found")},t.reject),t.promise},n}();t.VSSCommerce=g});
define("Gallery/Client/Controls/ItemTile/Item.View",["require","exports","VSS/Adapters/Knockout"],function(n,t,i){var u=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(i.TemplateControl),r;t.ItemTileView=u;r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(i.TemplateControl);t.ItemBannerView=r});
define("Gallery/Client/Controls/RatingControl/RatingControl.ViewModel",["require","exports","knockout","VSS/Diag","VSS/Adapters/Knockout","Gallery/Client/URLHelper","VSS/Events/Services"],function(n,t,i,r,u,f,e){var s=function(n){function t(r){var u=this,f;n.call(this);this.fullStars=i.observable(0);this.halfStars=i.observable(0);this.isReadOnly=!0;this.fixedFullStars=i.observable(0);this._starType=o.DefaultStar;this.totalStars=r.totalStars;f=t.parseRating(r.rating,r.totalStars);this.fullStars(f.fullStars);this.halfStars(f.halfStars);this.emptyStars=i.computed(function(){var n=u.totalStars-u.fullStars()-u.halfStars();return n>=0?n:0});this.hasFullStars=i.computed(function(){return u.fixedFullStars()>0});this.fixedFullStars(f.fullStars);r.isReadOnly===!1&&(this.isReadOnly=r.isReadOnly);r.ratingStarType!==o.DefaultStar&&(this._starType=r.ratingStarType);this._setImagePath()}return __extends(t,n),t.prototype._setImagePath=function(){var n=f.GalleryURLs.getResourcePath();this._starType===o.DarkStar?(this.fullStarPath=n+"FullStar.svg",this.halfStarPath=n+"HalfStarDark.svg",this.emptyStarPath=n+"EmptyStarDark.svg"):this._starType===o.LightStar?(this.fullStarPath=n+"FullStarLight.svg",this.halfStarPath=n+"HalfStarLight.svg",this.emptyStarPath=n+"EmptyStar.svg"):(this.fullStarPath=n+"FullStar.svg",this.halfStarPath=n+"HalfStar.svg",this.emptyStarPath=n+"EmptyStar.svg")},t.parseRating=function(n,t){var e=0,i=0,u,s,f,h,o;return(n||(n="0.0"),u=parseFloat(n),u<=0)?{fullStars:0,halfStars:0}:u>=5?{fullStars:5,halfStars:0}:(s=u.toFixed(2),f=s.split("."),h=parseInt(f[0]),e=h,f.length===2&&(o=parseFloat(f[1])/100,o<.25?i=0:o<.75?i=1:e++),{fullStars:e,halfStars:i})},t.prototype.mouseOutRatingFullStars=function(){this.fullStars(this.fixedFullStars())},t.prototype.onKeyDown=function(n,i){e.getService().fire(t.EVENT_ON_KEY_PRESS,this,[{data:n,e:i}])},t.prototype.mouseOverRatingFullStars=function(n){this.fullStars(n)},t.prototype.mouseOverRatingEmptyStars=function(n){this.fullStars(this.fullStars()+n)},t.prototype.onClickRatingFullStars=function(n){this.fixedFullStars(n);this.fullStars(n)},t.prototype.onClickRatingEmptyStars=function(n){this.fixedFullStars(this.fullStars()+n);this.fullStars(this.fullStars()+n)},t.EVENT_ON_KEY_PRESS="VSS.Gallery.RatingControl.OnKeyPress",t.TOTAL_RATING_STARS=5,t}(u.TemplateViewModel),o;t.RatingControlViewModel=s,function(n){n[n.DefaultStar=0]="DefaultStar";n[n.DarkStar=1]="DarkStar";n[n.LightStar=2]="LightStar"}(t.IRatingStarType||(t.IRatingStarType={}));o=t.IRatingStarType});
define("Gallery/Client/Controls/ItemTile/ItemTile.ViewModel",["require","exports","knockout","VSS/Adapters/Knockout","Gallery/Client/Service/Item","Gallery/Client/Service/VSSItem","Gallery/Client/Controls/RatingControl/RatingControl.ViewModel","Gallery/Client/Common/Constants","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Scripts/Gallery/Resources/VSS.Resources.GalleryCommon","Gallery/Client/Common/Telemetry","Gallery/Client/Common/TelemetryInternal","VSS/Context","VSS/FeatureAvailability/Services","VSS/Gallery/Contracts","Gallery/Client/Common/Utility","Gallery/Client/Common/Utility.Common","Gallery/Client/Service/VNext/Utility"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){var k=c.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.HomePageProperties,d=function(n){function t(r){var c,u,h,l;n.call(this);this.itemClassName="";this.previewString=null;this.itemCss=i.observable("");this.showVerifiedPublisher=!1;this.showRatingReview=!1;this.useDefaultIcon=!1;this.itemVerifiedPublisherCategoryText=s.VerifiedPublisherCategory;this.title=r.item.title;this.description=r.item.shortDescription;this.imageUrl=r.item.imageUrl;this.useDefaultIcon=!this.imageUrl;this.link=r.item.link;this.itemClassName=r.itemClassName?r.itemClassName:"";this.linkTarget=r.openInNewTab?"_blank":"_self";this.publisher=r.item.publisherDisplayName;this.publisherDisplay=s.Publisher_By+r.item.publisherDisplayName;this._addBranding(r);this._addPricingTag(r.item.priceCategory);this.itemClassName==="VSTS"&&(c=v.FeatureAvailabilityService.isFeatureEnabled(o.FeatureFlag.PublisherCategoryDisplay,!1),u=r.item,this._itemType=u.itemType,c&&u.publisherFlags&y.PublisherFlags.Verified&&(this.showVerifiedPublisher=!0));(this.itemClassName==="VSTS"||this.itemClassName==="VSCode")&&(u=r.item,this._itemType=u.itemType,this.installCount=a.getPageContext().webAccessConfiguration.isHosted?b.getInstallCountString(r.item.installCount):"0",this.fullyQualifiedName=f.ItemModelHelper.getFullyQualifiedNameForItem(u.publisherName,u.name),h=v.FeatureAvailabilityService.isFeatureEnabled(o.FeatureFlag.ShowRatingAndReview,!1),w.FeatureFlagUtils.isFeatureFlagEnabled(location.href,w.FeatureFlagUtils.ratingReviewFF)&&(w.FeatureFlagUtils.setFeatureFlagCookie(w.FeatureFlagUtils.ratingReviewFF),h=!0),h&&(this.showRatingReview=!0,l={rating:u.averageRating.toString(),totalStars:t.TOTAL_RATING_STARS,ratingCount:u.ratingCount},this.ratingViewModel=new e.RatingControlViewModel(l),this.averageRatingText=p.getAverageRatingText(u.averageRating,u.ratingCount)));r.itemClickCallBack&&(this._itemClickCallback=r.itemClickCallBack)}return __extends(t,n),t.prototype._addPricingTag=function(n){this.costCategory=n;switch(n){case u.priceCategory.Free:this.pricingTag=h.Pricing_Free;break;case u.priceCategory.Preview:this.pricingTag=h.Pricing_Preview;break;case u.priceCategory.Trial:this.pricingTag=h.Pricing_Trial;break;case u.priceCategory.Paid:this.pricingTag=h.Pricing_Paid}},t.prototype.onItemTileClick=function(){return this._logTelemetryToCI(),this._itemClickCallback&&this._itemClickCallback(),!0},t.prototype._logTelemetryToCI=function(){var n="",t={};switch(this.itemClassName){case"VSTS":n=c.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.VSTS_ITEM;t[c.CustomerIntelligenceConstants.MarketPlaceIntelligencePropertyName.PRODUCT_TYPE]=f.ItemModelHelper.getItemTypeText(this._itemType?this._itemType:f.VSSItemType.VSSExtension);break;case"VSCode":n=c.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.VSCODE_ITEM;t[c.CustomerIntelligenceConstants.MarketPlaceIntelligencePropertyName.PRODUCT_TYPE]=f.ItemModelHelper.getItemTypeText(this._itemType?this._itemType:f.VSSItemType.VSCodeExtension)}n!==""&&(t[k.Id]=this.fullyQualifiedName,l.TelemetryHelper.publishEvent(n,t,!0))},t.prototype._addBranding=function(n){if(n.brandingColor){var t=n.brandingColor,i=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t);this.brandingColor=i?t:null}else this.brandingColor=null},t.TOTAL_RATING_STARS=5,t}(r.TemplateViewModel);t.ItemTileViewModel=d});
define("Gallery/Client/Controls/VSSAcquireItemReview/VSSAcquireItemReview.View",["require","exports","VSS/Adapters/Knockout"],function(n,t,i){var r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(i.TemplateControl);t.VSSAcquireItemReview=r});
define("Gallery/Client/Controls/VSSAcquireItemReview/VSSAcquireItemReview.ViewModel",["require","exports","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","knockout","VSS/Adapters/Knockout"],function(n,t,i,r,u){var f=function(n){function t(t){n.call(this);this.isValid=r.observable(!0);this.isCompleted=r.observable(!1);this.isActive=r.observable(!1);this.isHidden=r.observable(!1);this.stepId="review";this.editContainerVisible=r.observable(!1);this.headerVisible=r.observable(!0);this.acquireitemReviewHeader=null;this.scopes=r.observable([]);this.scopeHeaderText=i.ItemScopeHeader;this.eulaContent=r.observable("");this.acquireItemHelpText=r.observable(i.AcquireItemHelpText);this.showAcquiringItemExperience=r.observable(!1);this.acquiringItemMessage=r.observable("");this._options=t;t.scopes&&this.scopes(t.scopes);t.eulaContent&&this.eulaContent(t.eulaContent);t.acquireItemReviewHeader&&(this.acquireitemReviewHeader=t.acquireItemReviewHeader);t.isAlwaysEditable&&(this.isActive(!0),this.editContainerVisible(!0))}return __extends(t,n),t.prototype.reset=function(){},t.prototype.startEdit=function(){this.editContainerVisible(!0);this.isActive(!0);this.isCompleted(!0)},t.prototype.completeStep=function(){this.isCompleted(!0);this.isActive(!1)},t}(u.TemplateViewModel);t.VSSAcquireItemReviewViewModel=f});
define("Gallery/Client/Controls/AcquireItemCompletionMessage/AcquireItemCompletionMessage.View",["require","exports","VSS/Adapters/Knockout"],function(n,t,i){var r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(i.TemplateControl);t.AcquireItemCompletionMessageView=r});
define("Gallery/Client/Controls/AcquireItemCompletionMessage/AcquireItemCompletionMessage.ViewModel",["require","exports","knockout","q","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/URLHelper","VSS/Adapters/Knockout","VSS/Context"],function(n,t,i,r,u,f,e,o){var s=function(n){function t(t){n.call(this);this.quantityNotOne=i.observable(!1);this.isChecked=i.observable(!0);this.isOfferWorkFlow=i.observable(!1);this.getStartedLinkText=u.GetStartedButtonText;this.proceedToAccountText=u.ProceedToAccountButtonText;this.assignUsersButtonText=u.AssignUsersButtonText;this.downloadLinkButtonText=u.Download;this.showLinksSection=i.observable(!0);this.marketPlaceHomeLinkText=u.NavigateToMarketPlace;this.marketPlaceHomeLink=f.GalleryURLs.getHomePageURL();this.assignSubscriptionLinkText=u.Assign_Subscriptions;this.assignSubscriptionLink=t.asssignSubscriptionLink;this.mySubscriptionLinkText=u.ViewMySubscription;this.mySubscriptionLink=t.mySubscriptionLink;this.installCompletionHeaderMessage=t.installCompletionHeaderMessage;this.installCompletionDetailedMessage=t.installCompletionDetailedMessage;this.installCompletionMessageDetail=u.VSS_PurchaseOffer_Completed_Email_Message;this.installCompletionEmailDetail=this._getUserEmail();this.trialSuccessMessage=t.trialSuccessMessage;this.trialExpiryDate=t.trialExpiryDate;this.buttonText=t.buttonText;this.buttonLink=t.buttonLink;this.quantityNotOne=i.observable(t.quantityNotOne);this.isChecked=i.observable(t.isChecked);this.isOfferWorkFlow=i.observable(t.isOfferWorkFlow);this.accountName=t.accountName;this.accountUrl=t.accountUrl||"";this.accounLinks=t.accountLinks||[];this.assignSubscriptionCallback=t.assignSubscriptionCallback||this._noop;this.viewSubscriptionCallback=t.viewSubscriptionCallback||this._noop;this.acquireCompletionButtons=t.acquireCompletionButtons||[];this.youAreReadyToGoText=t.readyToGoText||u.YouAreGoodToGoText;t.showLinksSection===!1&&this.showLinksSection(!1)}return __extends(t,n),t.prototype._noop=function(){var n=r.defer();return n.resolve(null),n.promise},t.prototype._getUserEmail=function(){var n=o.getPageContext();return n.webContext.user.email},t.prototype.assignSubscriptions=function(){this.assignSubscriptionCallback()},t.prototype.viewSubscriptions=function(){this.viewSubscriptionCallback()},t}(e.TemplateViewModel);t.AcquireItemCompletionMessageViewModel=s});
define("Gallery/Client/Controls/BreadCrumb/BreadCrumb.ViewModel",["require","exports","VSS/Context","VSS/Diag","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Scripts/Gallery/Resources/VSS.Resources.GalleryCommon","VSS/Adapters/Knockout","Gallery/Client/URLHelper","Gallery/Client/Service/VSSItem"],function(n,t,i,r,u,f,e,o,s){var c=function(n){function t(t){n.call(this);this.members=t.slice()}return __extends(t,n),t}(e.TemplateViewModel),h;t.BreadCrumbViewModel=c;h=function(){function n(){}return n.getBreadCrumbOptionsForItem=function(n,t){var r=[],e,h,l,c;return n&&(e=o.GalleryURLs.getHomePageVSTSTabURL(),h=f.VSTS_Header,i.getPageContext().webAccessConfiguration.isHosted?n.itemType===s.VSSItemType.VSCodeExtension?(h=f.VSCode_Header,e=o.GalleryURLs.getHomePageVSCodeTabURL()):n.itemType===s.VSSItemType.VSSOffer&&(h=f.Subs_Header,e=o.GalleryURLs.getHomePageVSSubscriptionsTabURL()):(h=u.HeaderProductNameOnPrem,e=o.GalleryURLs.getHomePageURL()),r.push({text:h,url:e}),n.itemType!==s.VSSItemType.VSSOffer&&(l=n.itemType===s.VSSItemType.VSCodeExtension?o.GalleryURLs.getVSCodeCategoryURL:o.GalleryURLs.getVssCategoryURL,c=n.categories&&n.categories.length>0?n.categories[0]:u.OtherItemCategory,r.push({text:c,url:l(c)})),r.push({text:n.title,url:t?o.GalleryURLs.getItemDetailsURL(s.ItemModelHelper.getFullyQualifiedNameForItem(n.publisherName,n.name)):""}),t&&r.push({text:u.LicenseText,url:""})),r},n}();t.BreadCrumbVSSItemHelper=h});
define("Gallery/Client/Common/ConnectedContext",["require","exports","Gallery/Client/Common/Constants","VSS/Serialization"],function(n,t,i,r){function u(){var t={},n=r.deserializeJsonIsland($(".server-context"),null);return n&&(n=JSON.parse(n),t.targetId=n[i.ConnectedContextConstants.collectionId],t.targetServerUrl=n[i.ConnectedContextConstants.targetServerUrl],t.targetServerName=n[i.ConnectedContextConstants.targetServerName],t.targetServerVersion=n[i.ConnectedContextConstants.targetServerVersion],t.targetCollectionName=n[i.ConnectedContextConstants.targetCollectionName],t.targetHiddenAccountId=n[i.ConnectedContextConstants.targetHiddenAccountId],t.targetSubscriptionId=n[i.ConnectedContextConstants.targetSubscriptionId]),t}t.getConnectedContext=u});
define("Gallery/Client/Pages/Install/Install.View",["require","exports","Gallery/Client/Pages/Common/Base.View","Gallery/Client/Common/Constants","VSS/Controls","VSS/Events/Action","Gallery/Client/Service/VSSGallery/VSSGallery","Gallery/Client/Service/VSSExtensionManagement/VSSExtensionManagement","Gallery/Client/Service/Item","Gallery/Client/Service/VSSItem","VSS/Context","Gallery/Client/Pages/Common/ItemContext","VSS/Common/Contracts/Platform","VSS/WebApi/Constants","VSS/Adapters/Knockout","Gallery/Client/Controls/VSSAccountSelection/VSSAccountSelection","Gallery/Client/Controls/VSSAccountSelection/VSSAccountSelection.ViewModel","Gallery/Client/Controls/VSSCollectionSelection/VSSCollectionSelection","Gallery/Client/Controls/PackageCompatCheck/PackageCompatCheck.View","Gallery/Client/Controls/PackageCompatCheck/PackageCompatCheck.ViewModel","Gallery/Client/Controls/VSSCollectionSelection/VSSCollectionSelection.ViewModel","Gallery/Client/Controls/VSSRequestItem/VSSRequestItem.View","Gallery/Client/Controls/VSSRequestItem/VSSRequestItem.ViewModel","Gallery/Client/Controls/SubscriptionSelection/SubscriptionSelection.View","Gallery/Client/Controls/SubscriptionSelection/SubscriptionSelection.ViewModel","Gallery/Client/Controls/AccountBasedPurchaseDetails/AccountBasedPurchaseDetails.View","Gallery/Client/Controls/AccountBasedPurchaseDetails/AccountBasedPurchaseDetails.ViewModel","Gallery/Client/Controls/BuyCustomization/BuyCustomization.View","Gallery/Client/Controls/BuyCustomization/BuyCustomization.ViewModel","Gallery/Client/Controls/AcquireItemWizard/AcquireItemWizard.View","Gallery/Client/Controls/AcquireItemWizard/AcquireItemWizard.ViewModel","Gallery/Client/Controls/AcquireItemWizard/BuyOfferWorkflow","Gallery/Client/Controls/AcquireItemWizard/BuyExtensionWorkflowForOnPrem","Gallery/Client/Controls/AcquireItemWizard/BuyPerUserExtensionWorkflow","Gallery/Client/Controls/AcquireItemWizard/BuyPerAccountExtensionWorkflow","Gallery/Client/Controls/AcquireItemWizard/FreeExtensionWorkflow","Gallery/Client/Controls/AcquireItemWizard/OnPremExtensionWorkflow","Gallery/Client/Controls/AcquireItemWizard/OnPremConnectedFreeWorkflow","Gallery/Client/Service/VSSCommerce/VSSCommerce","Gallery/Client/Controls/ItemTile/Item.View","Gallery/Client/Controls/ItemTile/ItemTile.ViewModel","Gallery/Client/Controls/VSSAcquireItemReview/VSSAcquireItemReview.View","Gallery/Client/Controls/VSSAcquireItemReview/VSSAcquireItemReview.ViewModel","Gallery/Client/Controls/AcquireItemCompletionMessage/AcquireItemCompletionMessage.View","Gallery/Client/Controls/AcquireItemCompletionMessage/AcquireItemCompletionMessage.ViewModel","Gallery/Client/Controls/BreadCrumb/BreadCrumb.ViewModel","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/Common/Telemetry","Gallery/Client/Common/TelemetryInternal","VSS/Utils/Core","VSS/Utils/String","Gallery/Client/Common/Utility","Gallery/Client/Common/Utility.Common","Gallery/Client/Common/ConnectedContext","VSS/Context","VSS/Gallery/Contracts","VSS/Serialization","Gallery/Client/URLHelper"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri,ui,fi,ei,oi,si,hi,ci,li,ai,vi,yi,pi){var wi=oi.delegate,ki=fi.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.AcquisitionWorkFlowProperties,bi=hi.WindowWrapper,di=function(n){function t(t){n.call(this,t);this._vssCommerce=new bt.VSSCommerce;this._vssExtensionManagement=new o.VSSExtensionManagement;this._itemBannerViewModel=null;this._isFreeInstall=!1;this._isTestCommerceEnabled=!1;this._isExternalSource=!1;this._errorCount=0;this._isWorkFlowCompleted=!1;this._isPaidItem=!1;this._errorString="";this._detailedItem=null}return __extends(t,n),t.prototype.initialize=function(){var t=this,i,u;hi.FeatureFlagUtils.isModalInstallEnabled()?fi.GalleryPerformance.startScenario(fi.PerformanceConstants.LoadInstallPage):fi.GalleryPerformance.startScenarioFromNavigation(fi.PerformanceConstants.LoadInstallPage);fi.GalleryPerformance.split("Install.View.ScriptsLoaded");n.prototype.initialize.call(this);i=hi.getItemNameForInstall();this._itemId=i;this._detectURLParamSettings();this._targetId=yi.deserializeJsonIsland($(".vss-target-id"),null);this._isExternalSource&&(this._publishJobId=yi.deserializeJsonIsland($(".vss-publish-jobid"),null));u=function(){var n=pi.GalleryURLs.getItemDetailsURL(i);window.location.href=n};this._getDetailedItemPromise=this._getItemPromise(i);this._getDetailedItemPromise?this._getDetailedItemPromise.then(function(n){if(t._isPaidItem=n.priceCategory===s.priceCategory.Paid?!0:!1,t._logTelemetry(i,n.itemType,t._isPaidItem,n.isPublic),!hi.FeatureFlagUtils.isModalInstallEnabled())$(window).on("beforeunload",wi(t,t._handleAbandonment));t._populateItemScopeData(n);t._detailedItem=n;t._drawPageContent(n);f.getService().registerActionWorker(r.GalleryEvents.LAUNCH_INSTALL,function(){t._vssCommerce=new bt.VSSCommerce;t._detectURLParamSettings();t._detailedItem!==null&&t._drawPageContent(t._detailedItem)});fi.GalleryPerformance.endScenario(fi.PerformanceConstants.LoadInstallPage)},u):u()},t.prototype._logTelemetry=function(n,t,i,r){var f="",u={};f=i?this._isFreeInstall&&(hi.FeatureFlagUtils.isFirstPartyCommerceEnabled()||hi.FeatureFlagUtils.isThirdPartyCommerceEnabled())?fi.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.INITIATE_TRIAL_ITEM:fi.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.INITIATE_BUY_ITEM:fi.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.INITIATE_INSTALL_ITEM;u[ki.ProductType]=h.ItemModelHelper.getItemTypeText(t);u[ki.IsPublic]=r;u[ki.Id]=n;ei.TelemetryHelper.publishEvent(f,u)},t.prototype._detectURLParamSettings=function(){bi.getQueryString()&&bi.getQueryString().length>0&&(this._isFreeInstall=pi.GalleryURLs.isFreeInstall(bi.getQueryString()),this._isTestCommerceEnabled=pi.GalleryURLs.isTestCommerceEnabled(bi.getQueryString()),this._isExternalSource=pi.GalleryURLs.isExternalInstall(bi.getQueryString()))},t.prototype._getItemPromise=function(n){var i=this,t;return this._options.VSSDataProvider?(this._vssGallery=this._options.VSSDataProvider,this._options.VSSDataProvider instanceof e.VSSGalleryExternalProvider&&(this._externalGallery=this._options.VSSDataProvider),this._projectCollections=yi.deserializeJsonIsland($(".vss-project-collections"),null)):(t=l.getVSSJsonDataProviderInitOptions(),t&&(this._vssGallery=new e.VSSCachingProvider(t),this._projectCollections=t.projectCollections,t.extension&&(t.extension.flags&vi.PublishedExtensionFlags.Public)!==vi.PublishedExtensionFlags.Public&&(this._accountIdsFilter={},t.extension.sharedWith&&t.extension.sharedWith.forEach(function(n){i._accountIdsFilter[n.id.toLowerCase()]=!0})))),this._vssGallery.getDetailedItem(n)},t.prototype._drawPageContent=function(n){var t,i,r,u,f;this._showItemBanner(n);t=this._getUserId();i=li.getConnectedContext();i.targetServerUrl?this._showForOnPremBuyExtensionWizardControl(t,n,i):c.getPageContext().webAccessConfiguration.isHosted?this._isFreeInstall===!0&&n.priceCategory===s.priceCategory.Paid?this._showFreeExtensionWizardControl(n):n.itemType===h.VSSItemType.VSSOffer?this._showItemOfferWizardControl(t,n):h.ItemModelHelper.isThirdPartyPaidExtension(n)?(r=n.offerDetails&&n.offerDetails.hasPublicPlans,u=n.offerDetails&&n.offerDetails.hasPlans,hi.FeatureFlagUtils.isThirdPartyCommerceEnabled()&&(r||this._isTestCommerceEnabled&&u)?(f=yi.deserializeJsonIsland($(".has-extension-trial-expired"),null),!f&&this._targetId?this._showFreeExtensionWizardControl(n):this._showBuyExtensionWizardControl(t,n)):this._showFreeExtensionWizardControl(n)):(h.ItemModelHelper.isitemTypeExtension(n.itemType)||h.ItemModelHelper.isFirstPartyPaidIntegration(n))&&(n.priceCategory===s.priceCategory.Free||n.priceCategory===s.priceCategory.Preview?this._showFreeExtensionWizardControl(n):this._showBuyExtensionWizardControl(t,n)):this._isExternalSource?this._showOnPremConnectedExtensionWizardControl(n):this._showOnPremExtensionWizardControl(n)},t.prototype._getUserId=function(){var n=ai.getPageContext();return n.webContext.user.id},t.prototype._getEulaContent=function(n){var u=c.getPageContext().webAccessConfiguration.isHosted,i,r="",f=ui.TermsAndConditionsText;n.itemType===h.VSSItemType.VSSOffer?(i=ui.EulaContent_Offer_CustomLicense,f=ci.isHockeyAppOffer(n.name)?ui.HockeyAppOfferTermsAndConditionsText:ui.OfferTermsAndConditionsText,r=n.licenseUrl?n.licenseUrl:ui.Eula_AzureLicenseUrl):si.ignoreCaseComparer(n.publisherDisplayName,t.MICROSOFT_PUBLISHER_NAME)===0?n.priceCategory===s.priceCategory.Preview?u?i=n.licenseUrl?ui.EulaContent_Microsoft_Preview_CustomLicense:ui.EulaContent_Microsoft_Preview_NoCustomLicense:(r=n.licenseUrl,i=ui.EulaContent_Microsoft_Preview_CustomLicense):n.licenseUrl?(r=n.licenseUrl,i=ui.EulaContent_Microsoft_CustomLicense):i=ui.EulaContent_Microsoft_NoCustomLicense:u?n.licenseUrl?(r=n.licenseUrl,i=ui.EulaContent_NonMicrosoft_CustomLicense):i=ui.EulaContent_NonMicrosoft_NoCustomLicense:i=ui.EulaContent_OnPremThirdPartyInstall;var e=si.format("<a href='{0}' target='_blank'>"+f+"<\/a>",r),o=r?r:ui.Eula_AzureLicenseUrl,l=u?ui.EulaTargetAccount:ui.EulaTargetCollection,a=u?ui.EulaContent_OnlineServiceTerms:ui.EulaContent_MicrosoftSoftwareTerms;return si.format(i,l,o,e,a)},t.prototype._showItemOfferWizardControl=function(n,t){var i=new ct.BuyOfferWorkflow({commerceDataProvider:this._vssCommerce,userId:n,item:t,galleryDataProvider:this._vssGallery,eulaContent:this._getEulaContent(t),onError:wi(this,this._onErrorOccured)}),r={wizardWorkflow:i,eulaContent:this._getEulaContent(t),cssClassName:"buy-offer-workflow"};this._createAcquireItemWizard(r)},t.prototype._showForOnPremBuyExtensionWizardControl=function(n,t,i){var r=[{id:i.targetId,name:i.targetCollectionName,uri:"",hiddenAccountId:i.targetHiddenAccountId,subscriptionId:i.targetSubscriptionId}],u=new lt.BuyExtensionWorkflowForOnPrem({commerceDataProvider:this._vssCommerce,item:t,galleryDataProvider:this._vssGallery,extensionManagementDataProvider:this._vssExtensionManagement,collections:r,targetCollectionId:i.targetId,targetServerName:i.targetServerName,eulaContent:this._getEulaContent(t),onError:wi(this,this._onErrorOccured)}),f={wizardWorkflow:u,eulaContent:this._getEulaContent(t),cssClassName:"buy-extension-workflow"};this._createAcquireItemWizard(f)},t.prototype._showBuyExtensionWizardControl=function(n,t){var r,u,i;hi.FeatureFlagUtils.checkAndSetEnableFirstPartyCommerce()&&t.offerDetails&&t.offerDetails.isAccountBased?(r=new vt.BuyPerAccountExtensionWorkflow({commerceDataProvider:this._vssCommerce,userId:n,item:t,galleryDataProvider:this._vssGallery,extensionManagementDataProvider:this._vssExtensionManagement,createNewAccountUrl:this.getCreateNewAccountUrl(),accountIdsFilter:this._accountIdsFilter,targetAccountId:this._targetId,eulaContent:this._getEulaContent(t),onError:wi(this,this._onErrorOccured)}),i={wizardWorkflow:r,eulaContent:this._getEulaContent(t),cssClassName:"buy-extension-workflow"},this._createAcquireItemWizard(i)):(u=new at.BuyPerUserExtensionWorkflow({commerceDataProvider:this._vssCommerce,userId:n,item:t,galleryDataProvider:this._vssGallery,extensionManagementDataProvider:this._vssExtensionManagement,createNewAccountUrl:this.getCreateNewAccountUrl(),accountIdsFilter:this._accountIdsFilter,targetAccountId:this._targetId,eulaContent:this._getEulaContent(t),onError:wi(this,this._onErrorOccured)}),i={wizardWorkflow:u,eulaContent:this._getEulaContent(t),cssClassName:"buy-extension-workflow"},this._createAcquireItemWizard(i))},t.prototype._showOnPremExtensionWizardControl=function(n){var t=new pt.OnPremExtensionWorkflow({galleryDataProvider:this._vssGallery,extensionManagementDataProvider:this._vssExtensionManagement,collections:this._projectCollections,detailedItem:n,eulaContent:this._getEulaContent(n),targetCollectionId:this._targetId,onError:wi(this,this._onErrorOccured)}),i={wizardWorkflow:t,eulaContent:this._getEulaContent(n),cssClassName:"install-extension-workflow"};this._createAcquireItemWizard(i)},t.prototype._showOnPremConnectedExtensionWizardControl=function(n){var t=new wt.OnPremConnectedWorkflow({externalProvider:this._externalGallery,galleryDataProvider:this._vssGallery,extensionManagementDataProvider:this._vssExtensionManagement,collections:this._projectCollections,detailedItem:n,eulaContent:this._getEulaContent(n),targetCollectionId:this._targetId,publishJobId:this._publishJobId,onError:wi(this,this._onErrorOccured)}),i={wizardWorkflow:t,eulaContent:this._getEulaContent(n),cssClassName:"install-extension-workflow",cancelButtonLink:hi.UrlUtils.getExternalItemDetailsUrl(hi.getItemNameForInstall())};this._createAcquireItemWizard(i)},t.prototype._showFreeExtensionWizardControl=function(n){var t=new yt.FreeExtensionWorkflow({commerceDataProvider:this._vssCommerce,galleryDataProvider:this._vssGallery,extensionManagementDataProvider:this._vssExtensionManagement,createNewAccountUrl:c.getPageContext().webAccessConfiguration.isHosted?this.getCreateNewAccountUrl():"",detailedItem:n,eulaContent:this._getEulaContent(n),accountIdsFilter:this._accountIdsFilter,targetAccountId:this._targetId,onError:wi(this,this._onErrorOccured)}),i={wizardWorkflow:t,eulaContent:this._getEulaContent(n),cssClassName:"install-extension-workflow"};this._createAcquireItemWizard(i)},t.prototype._createAcquireItemWizard=function(n){var t=this,u=this.getElement().find(".acquire-item-workflow-container"),f=y.TemplateControl.applyRegisteredBinding("acquire-item-wizard-template",u,n),i,r;if(this._acquireItemWizardViewModel=f.getViewModel(),i=function(){t._acquireItemWizardViewModel.hasNonRecoverableError||(t._isWorkFlowCompleted=!0,t._itemBannerViewModel&&t._itemBannerViewModel.itemCss("acquire-item-completed"))},this._acquireItemWizardViewModel.subscribe(this._acquireItemWizardViewModel.workflowCompleted,i),hi.FeatureFlagUtils.isModalInstallEnabled()){r=$(".cancel-button");r.on("mousedown",wi(this,this._handleAbandonment));r.on("keyup",function(n){var i=n.which?n.which:n.keyCode;i===13&&t._handleAbandonment()})}this._acquireItemWizardViewModel.workflowAlreadyComplete&&this._acquireItemWizardViewModel.subscribe(this._acquireItemWizardViewModel.workflowAlreadyComplete,i)},t.prototype._onErrorOccured=function(n){if(this._errorCount++,n){var t=JSON.stringify(n),i="Error"+this._errorCount+":";this._errorString+=" "+i+t}},t.prototype._handleAbandonment=function(){if(!this._isWorkFlowCompleted){var t="",n={};this._errorCount>0?(t=this._isPaidItem&&this._isFreeInstall&&(hi.FeatureFlagUtils.isFirstPartyCommerceEnabled()||hi.FeatureFlagUtils.isThirdPartyCommerceEnabled())?fi.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.TRIAL_WORKFLOW_ERRORS:this._isPaidItem?fi.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.BUY_WORKFLOW_ERRORS:fi.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.INSTALL_WORKFLOW_ERRORS,n.ErrorCount=this._errorCount,n.ErrorStep=this._acquireItemWizardViewModel.currentStep()):(t=this._isPaidItem&&this._isFreeInstall&&(hi.FeatureFlagUtils.isFirstPartyCommerceEnabled()||hi.FeatureFlagUtils.isThirdPartyCommerceEnabled())?fi.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.TRIAL_WORKFLOW_ABANDON:this._isPaidItem?fi.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.BUY_WORKFLOW_ABANDON:fi.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.INSTALL_WORKFLOW_ABANDON,n.AbandonStep=this._acquireItemWizardViewModel.currentStep());n[ki.ProductType]=h.ItemModelHelper.getItemTypeText(this._detailedItem.itemType);n.ItemId=this._itemId;n.ErrorString=this._errorString;n.Referrer=document.referrer;ei.TelemetryHelper.publishEvent(t,n,!0)}},t.prototype._showItemBanner=function(n){var t=null,i=null;n.properties[e.ItemConstants.PROPERTY_BRANDING_COLOR]&&ci.isHockeyAppOffer(n.name)&&(t=n.properties[e.ItemConstants.PROPERTY_BRANDING_COLOR]);n.properties[e.ItemConstants.PROPERTY_BRANDING_THEME]&&(i=n.properties[e.ItemConstants.PROPERTY_BRANDING_THEME]);var r=this.getElement().find(".install-page-item-banner"),u={item:n,brandingColor:t,brandingTheme:i},f=y.TemplateControl.applyRegisteredBinding("item-banner-template",r,u);this._itemBannerViewModel=f.getViewModel()},t.prototype._populateItemScopeData=function(n){var t=$.parseJSON($(".vss-item-scope").html()),i=[];t&&$.each(t,function(n,t){i.push({title:t.Title,description:t.Description,value:t.Value})});n.scopes=i},t.prototype.getCreateNewAccountUrl=function(){var n=pi.GalleryURLs.CampaignWorkflowQueryParam+"&"+pi.GalleryURLs.CampaignWorkflowCreateContextQueryParam+"&account=true&createproject=none&reply_to="+encodeURIComponent(document.URL),t=c.getPageContext().serviceLocations.locations[v.ServiceInstanceTypes.SPS],i=t[a.ContextHostType.Deployment];return i+"profile/account?"+n},t.prototype.registerControls=function(){n.prototype.registerControls.call(this);y.TemplateControl.registerBinding("item-banner-template",kt.ItemBannerView,function(n){return new dt.ItemTileViewModel(n)});y.TemplateControl.registerBinding("vss-collection-selection-template",b.VSSCollectionSelection,function(n){return new g.VSSCollectionSelectionViewModel(n)});c.getPageContext().webAccessConfiguration.isHosted?y.TemplateControl.registerBinding("vss-account-selection-template",p.VSSAccountSelection,function(n){return new w.VSSAccountSelectionViewModel(n)}):y.TemplateControl.registerBinding("package-compat-check-template",k.PackageCompatCheck,function(n){return new d.PackageCompatCheckViewModel(n)});y.TemplateControl.registerBinding("vss-request-item-template",nt.VSSRequestItem,function(n){return new tt.VSSRequestItemViewModel(n)});y.TemplateControl.registerBinding("subscription-selection-template",it.SubscriptionSelection,function(n){return new rt.SubscriptionSelectionViewModel(n)});y.TemplateControl.registerBinding("account-based-purchase-details-template",ut.AccountBasedPurchaseDetailsView,function(n){return new ft.AccountBasedPurchaseDetailsViewModel(n)});y.TemplateControl.registerBinding("buy-customization-template",et.BuyCustomization,function(n){return new ot.BuyCustomizationViewModel(n)});y.TemplateControl.registerBinding("acquire-item-wizard-template",st.AcquireItemWizard,function(n){return new ht.AcquireItemWizardViewModel(n)});y.TemplateControl.registerBinding("acquire-item-completion-message",ti.AcquireItemCompletionMessageView,function(n){return new ii.AcquireItemCompletionMessageViewModel(n)});y.TemplateControl.registerBinding("bread-crumb-template",y.TemplateControl,function(n){return new ri.BreadCrumbViewModel(n)});y.TemplateControl.registerBinding("vss-acquireitem-review-template",gt.VSSAcquireItemReview,function(n){return new ni.VSSAcquireItemReviewViewModel(n)})},t.TESTMANAGER_EXTENSION_NAME="vss-testmanager-web",t.MICROSOFT_PUBLISHER_NAME="Microsoft",t}(i.BaseView);t.InstallView=di;u.Enhancement.registerEnhancement(di,".main-section")});
define("Gallery/Client/Controls/VSSItemDetails/VSSItemDetails.View",["require","exports","VSS/Controls","VSS/Controls/Dialogs","VSS/Events/Action","VSS/Adapters/Knockout","VSS/Navigation/Services","VSS/Utils/UI","Gallery/Client/Common/Telemetry","Gallery/Client/Common/TelemetryInternal","Gallery/Client/Common/Constants","Gallery/Client/URLHelper","Gallery/Client/Pages/Install/Install.View","Gallery/Client/Service/VSSItem","Gallery/Client/Common/Utility"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){var w=function(){function n(n){this.imageUrl=n}return n}(),p,b;t.ItemScreenshotViewModel=w;p=s.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.ItemDetailsProperties;b=function(n){function t(){n.apply(this,arguments);this._isInstallControlInitialized=!1}return __extends(t,n),t.prototype.initialize=function(){n.prototype.initialize.call(this);this.getViewModel().showMinimalView||this._drawCarousel();$(".ux-itemdetails-left a").attr("target","_blank");$(".ux-itemdetails-left a").attr("rel","noreferrer noopener");this._showDownloadDialogIfNeeded();this._initializeInstallDialog();this._addClickHandlersForSocialLinks();y.clearRedirectionCookie()},t.prototype._showDownloadDialogIfNeeded=function(){var t=this.getViewModel(),n;t.initiateDownloadonPageLoad&&(n=$("#download-pop-up"),n.modal(),this.updateQueryParam("download"))},t.prototype._addClickHandlersForSocialLinks=function(){var i=this,n=this.getElement().find(".item-share-container .social-link");n&&n.length>0&&n.click(function(n){var f=$(n.target),u="",e=i.getViewModel(),r;f.hasClass(t.SHARE_TWITTER_CLASS)?u=s.CustomerIntelligenceConstants.SocialNetworkConstants.TWITTER:f.hasClass(t.SHARE_FACEBOOK_CLASS)?u=s.CustomerIntelligenceConstants.SocialNetworkConstants.FACEBOOK:f.hasClass(t.SHARE_EMAIL_CLASS)&&(u=s.CustomerIntelligenceConstants.SocialNetworkConstants.EMAIL);r={};r[p.SectionName]=u;r[p.Id]=e.fullyQualifiedItemName;r[p.ProductType]=v.ItemModelHelper.getItemTypeText(e.vssDetailedItem.itemType);h.TelemetryHelper.publishEvent(s.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.SOCIAL_EVENT_CLICK,r)})},t.prototype._initializeInstallDialog=function(){var n=this,t=this.getViewModel(),f=t.getExternalDataProvider(),r;if(t.showModalInstall){this.updateQueryParam(l.GalleryURLs.AuthRedirectQueryParam);$("#install-pop-up").on("show.bs.modal",function(t){n.updateQueryParam("install",!0);var r=t&&t.relatedTarget&&(t.relatedTarget.className==="freeinstall-button-container"||t.relatedTarget.className==="trial-button-container");r&&n.updateQueryParam("freeInstall",!0);n._isInstallControlInitialized?u.getService().performAction(c.GalleryEvents.LAUNCH_INSTALL,{isFreeInstall:r}):(i.Enhancement.registerEnhancement(a.InstallView,"#install-pop-up",{VSSDataProvider:f}),n._isInstallControlInitialized=!0)});$("#install-pop-up").on("hide.bs.modal",function(){n._clearInstallQueryParams();y.clearRedirectionCookie()});t.initiateInstall&&(r=$("#install-pop-up"),r.modal({backdrop:"static",keyboard:!0}))}},t.prototype._clearInstallQueryParams=function(){var n=this;l.GalleryURLs.getInstallQueryParams().forEach(function(t){n.updateQueryParam(t)})},t.prototype._drawCarousel=function(){var e=this,s=this.getElement(),i=s.find(".item-carousel"),u=[],n=this.getViewModel().screenshotUrls,t;if(n&&n.length>0){for(t=0;t<n.length;t++)u.push(new w(n[t]));var h={itemTemplate:"item-tile-screenshot-template",items:u,showIndicators:!0,numberOfItemsToDisplay:1,autoPlay:!1,noShadow:!0},c=f.TemplateControl.applyRegisteredBinding("carousel-template",i,h),l=c.getViewModel(),a=i.find(".carousel");this._bind(a,"click",function(){var t=$(o.domElem("img")),i;t.attr("src",n[l.selectedIndicatorIndex()]);i=r.show(r.Dialog,{content:t,resizable:!1});setTimeout(function(){e._adjustPopupDimensions(i)},0)})}},t.prototype._adjustPopupDimensions=function(n){var f=$(window).width()*.8,e=$(window).height()*.8,i=n.getElement(),t,r,u;i.css("max-width",f+"px");i.css("max-height",e+"px");i.css("width","");i.css("height","");t=i.closest(".ui-dialog");t.css("width","auto");t.css("height","auto");t.addClass("item-details-screenshot-popup");r=t.width();t.css("left","50%");t.css("margin-left","-"+r/2+"px");u=t.height();t.css("top","50%");t.css("margin-top","-"+u/2+"px")},t.prototype.updateQueryParam=function(n,t){t===void 0&&(t=null);var r=e.getHistoryService(),i=r.getCurrentState();i=i||{};n&&(i[n]=t,r.replaceHistoryPoint("",i,null,!0))},t.SHARE_TWITTER_CLASS="share-twitter-button",t.SHARE_FACEBOOK_CLASS="share-facebook-button",t.SHARE_EMAIL_CLASS="share-email-button",t}(f.TemplateControl);t.VSSItemDetailsView=b});
define("Gallery/Client/Service/VSSItemHelper",["require","exports","VSS/Context","Gallery/Client/Service/VSSItem","Gallery/Client/Service/Item"],function(n,t,i,r,u){var f=function(){function n(){}return n.isItemDownloadable=function(t){return t?n.supportsConnectedInstall(t)&&!t.doNotDownload:!1},n.supportsConnectedInstall=function(n){if(n){var t=i.getPageContext().webAccessConfiguration.isHosted;return t&&n.itemType===r.VSSItemType.VSSExtension&&n.isPublic&&!n.isBuiltIn&&n.priceCategory!==u.priceCategory.Paid}return!1},n}();t.VSSItemHelper=f});
/**
 * marked - a markdown parser
 * Copyright (c) 2011-2014, Christopher Jeffrey. (MIT Licensed)
 * https://github.com/chjj/marked
 */
(function(){var block={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:noop,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:noop,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n(?!def)[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:noop,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};block.bullet=/(?:[*+-]|\d+\.)/;block.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/;block.item=replace(block.item,"gm")(/bull/g,block.bullet)();block.list=replace(block.list)(/bull/g,block.bullet)("hr","\\n+(?=\\1?(?:[-*_] *){3,}(?:\\n+|$))")("def","\\n+(?="+block.def.source+")")();block.blockquote=replace(block.blockquote)("def",block.def)();block._tag="(?!(?:"+"a|em|strong|small|s|cite|q|dfn|abbr|data|time|code"+"|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo"+"|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b";block.html=replace(block.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,block._tag)();block.paragraph=replace(block.paragraph)("hr",block.hr)("heading",block.heading)("lheading",block.lheading)("blockquote",block.blockquote)("tag","<"+block._tag)("def",block.def)();block.normal=merge({},block);block.gfm=merge({},block.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/});block.gfm.paragraph=replace(block.paragraph)("(?!","(?!"+block.gfm.fences.source.replace("\\1","\\2")+"|"+block.list.source.replace("\\1","\\3")+"|")();block.tables=merge({},block.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/});function Lexer(options){this.tokens=[];this.tokens.links={};this.options=options||marked.defaults;this.rules=block.normal;if(this.options.gfm){if(this.options.tables){this.rules=block.tables}else{this.rules=block.gfm}}}Lexer.rules=block;Lexer.lex=function(src,options){var lexer=new Lexer(options);return lexer.lex(src)};Lexer.prototype.lex=function(src){src=src.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n");return this.token(src,true)};Lexer.prototype.token=function(src,top,bq){var src=src.replace(/^ +$/gm,""),next,loose,cap,bull,b,item,space,i,l;while(src){if(cap=this.rules.newline.exec(src)){src=src.substring(cap[0].length);if(cap[0].length>1){this.tokens.push({type:"space"})}}if(cap=this.rules.code.exec(src)){src=src.substring(cap[0].length);cap=cap[0].replace(/^ {4}/gm,"");this.tokens.push({type:"code",text:!this.options.pedantic?cap.replace(/\n+$/,""):cap});continue}if(cap=this.rules.fences.exec(src)){src=src.substring(cap[0].length);this.tokens.push({type:"code",lang:cap[2],text:cap[3]});continue}if(cap=this.rules.heading.exec(src)){src=src.substring(cap[0].length);this.tokens.push({type:"heading",depth:cap[1].length,text:cap[2]});continue}if(top&&(cap=this.rules.nptable.exec(src))){src=src.substring(cap[0].length);item={type:"table",header:cap[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:cap[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:cap[3].replace(/\n$/,"").split("\n")};for(i=0;i<item.align.length;i++){if(/^ *-+: *$/.test(item.align[i])){item.align[i]="right"}else if(/^ *:-+: *$/.test(item.align[i])){item.align[i]="center"}else if(/^ *:-+ *$/.test(item.align[i])){item.align[i]="left"}else{item.align[i]=null}}for(i=0;i<item.cells.length;i++){item.cells[i]=item.cells[i].split(/ *\| */)}this.tokens.push(item);continue}if(cap=this.rules.lheading.exec(src)){src=src.substring(cap[0].length);this.tokens.push({type:"heading",depth:cap[2]==="="?1:2,text:cap[1]});continue}if(cap=this.rules.hr.exec(src)){src=src.substring(cap[0].length);this.tokens.push({type:"hr"});continue}if(cap=this.rules.blockquote.exec(src)){src=src.substring(cap[0].length);this.tokens.push({type:"blockquote_start"});cap=cap[0].replace(/^ *> ?/gm,"");this.token(cap,top,true);this.tokens.push({type:"blockquote_end"});continue}if(cap=this.rules.list.exec(src)){src=src.substring(cap[0].length);bull=cap[2];this.tokens.push({type:"list_start",ordered:bull.length>1});cap=cap[0].match(this.rules.item);next=false;l=cap.length;i=0;for(;i<l;i++){item=cap[i];space=item.length;item=item.replace(/^ *([*+-]|\d+\.) +/,"");if(~item.indexOf("\n ")){space-=item.length;item=!this.options.pedantic?item.replace(new RegExp("^ {1,"+space+"}","gm"),""):item.replace(/^ {1,4}/gm,"")}if(this.options.smartLists&&i!==l-1){b=block.bullet.exec(cap[i+1])[0];if(bull!==b&&!(bull.length>1&&b.length>1)){src=cap.slice(i+1).join("\n")+src;i=l-1}}loose=next||/\n\n(?!\s*$)/.test(item);if(i!==l-1){next=item.charAt(item.length-1)==="\n";if(!loose)loose=next}this.tokens.push({type:loose?"loose_item_start":"list_item_start"});this.token(item,false,bq);this.tokens.push({type:"list_item_end"})}this.tokens.push({type:"list_end"});continue}if(cap=this.rules.html.exec(src)){src=src.substring(cap[0].length);this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:cap[1]==="pre"||cap[1]==="script"||cap[1]==="style",text:cap[0]});continue}if(!bq&&top&&(cap=this.rules.def.exec(src))){src=src.substring(cap[0].length);this.tokens.links[cap[1].toLowerCase()]={href:cap[2],title:cap[3]};continue}if(top&&(cap=this.rules.table.exec(src))){src=src.substring(cap[0].length);item={type:"table",header:cap[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:cap[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:cap[3].replace(/(?: *\| *)?\n$/,"").split("\n")};for(i=0;i<item.align.length;i++){if(/^ *-+: *$/.test(item.align[i])){item.align[i]="right"}else if(/^ *:-+: *$/.test(item.align[i])){item.align[i]="center"}else if(/^ *:-+ *$/.test(item.align[i])){item.align[i]="left"}else{item.align[i]=null}}for(i=0;i<item.cells.length;i++){item.cells[i]=item.cells[i].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */)}this.tokens.push(item);continue}if(top&&(cap=this.rules.paragraph.exec(src))){src=src.substring(cap[0].length);this.tokens.push({type:"paragraph",text:cap[1].charAt(cap[1].length-1)==="\n"?cap[1].slice(0,-1):cap[1]});continue}if(cap=this.rules.text.exec(src)){src=src.substring(cap[0].length);this.tokens.push({type:"text",text:cap[0]});continue}if(src){throw new Error("Infinite loop on byte: "+src.charCodeAt(0))}}return this.tokens};var inline={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:noop,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:noop,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};inline._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/;inline._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/;inline.link=replace(inline.link)("inside",inline._inside)("href",inline._href)();inline.reflink=replace(inline.reflink)("inside",inline._inside)();inline.normal=merge({},inline);inline.pedantic=merge({},inline.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/});inline.gfm=merge({},inline.normal,{escape:replace(inline.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:replace(inline.text)("]|","~]|")("|","|https?://|")()});inline.breaks=merge({},inline.gfm,{br:replace(inline.br)("{2,}","*")(),text:replace(inline.gfm.text)("{2,}","*")()});function InlineLexer(links,options){this.options=options||marked.defaults;this.links=links;this.rules=inline.normal;this.renderer=this.options.renderer||new Renderer;this.renderer.options=this.options;if(!this.links){throw new Error("Tokens array requires a `links` property.")}if(this.options.gfm){if(this.options.breaks){this.rules=inline.breaks}else{this.rules=inline.gfm}}else if(this.options.pedantic){this.rules=inline.pedantic}}InlineLexer.rules=inline;InlineLexer.output=function(src,links,options){var inline=new InlineLexer(links,options);return inline.output(src)};InlineLexer.prototype.output=function(src){var out="",link,text,href,cap;while(src){if(cap=this.rules.escape.exec(src)){src=src.substring(cap[0].length);out+=cap[1];continue}if(cap=this.rules.autolink.exec(src)){src=src.substring(cap[0].length);if(cap[2]==="@"){text=cap[1].charAt(6)===":"?this.mangle(cap[1].substring(7)):this.mangle(cap[1]);href=this.mangle("mailto:")+text}else{text=escape(cap[1]);href=text}out+=this.renderer.link(href,null,text);continue}if(!this.inLink&&(cap=this.rules.url.exec(src))){src=src.substring(cap[0].length);text=escape(cap[1]);href=text;out+=this.renderer.link(href,null,text);continue}if(cap=this.rules.tag.exec(src)){if(!this.inLink&&/^<a /i.test(cap[0])){this.inLink=true}else if(this.inLink&&/^<\/a>/i.test(cap[0])){this.inLink=false}src=src.substring(cap[0].length);out+=this.options.sanitize?escape(cap[0]):cap[0];continue}if(cap=this.rules.link.exec(src)){src=src.substring(cap[0].length);this.inLink=true;out+=this.outputLink(cap,{href:cap[2],title:cap[3]});this.inLink=false;continue}if((cap=this.rules.reflink.exec(src))||(cap=this.rules.nolink.exec(src))){src=src.substring(cap[0].length);link=(cap[2]||cap[1]).replace(/\s+/g," ");link=this.links[link.toLowerCase()];if(!link||!link.href){out+=cap[0].charAt(0);src=cap[0].substring(1)+src;continue}this.inLink=true;out+=this.outputLink(cap,link);this.inLink=false;continue}if(cap=this.rules.strong.exec(src)){src=src.substring(cap[0].length);out+=this.renderer.strong(this.output(cap[2]||cap[1]));continue}if(cap=this.rules.em.exec(src)){src=src.substring(cap[0].length);out+=this.renderer.em(this.output(cap[2]||cap[1]));continue}if(cap=this.rules.code.exec(src)){src=src.substring(cap[0].length);out+=this.renderer.codespan(escape(cap[2],true));continue}if(cap=this.rules.br.exec(src)){src=src.substring(cap[0].length);out+=this.renderer.br();continue}if(cap=this.rules.del.exec(src)){src=src.substring(cap[0].length);out+=this.renderer.del(this.output(cap[1]));continue}if(cap=this.rules.text.exec(src)){src=src.substring(cap[0].length);out+=escape(this.smartypants(cap[0]));continue}if(src){throw new Error("Infinite loop on byte: "+src.charCodeAt(0))}}return out};InlineLexer.prototype.outputLink=function(cap,link){var href=escape(link.href),title=link.title?escape(link.title):null;return cap[0].charAt(0)!=="!"?this.renderer.link(href,title,this.output(cap[1])):this.renderer.image(href,title,escape(cap[1]))};InlineLexer.prototype.smartypants=function(text){if(!this.options.smartypants)return text;return text.replace(/--/g,"—").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…")};InlineLexer.prototype.mangle=function(text){var out="",l=text.length,i=0,ch;for(;i<l;i++){ch=text.charCodeAt(i);if(Math.random()>.5){ch="x"+ch.toString(16)}out+="&#"+ch+";"}return out};function Renderer(options){this.options=options||{}}Renderer.prototype.code=function(code,lang,escaped){if(this.options.highlight){var out=this.options.highlight(code,lang);if(out!=null&&out!==code){escaped=true;code=out}}if(!lang){return"<pre><code>"+(escaped?code:escape(code,true))+"\n</code></pre>"}return'<pre><code class="'+this.options.langPrefix+escape(lang,true)+'">'+(escaped?code:escape(code,true))+"\n</code></pre>\n"};Renderer.prototype.blockquote=function(quote){return"<blockquote>\n"+quote+"</blockquote>\n"};Renderer.prototype.html=function(html){return html};Renderer.prototype.heading=function(text,level,raw){return"<h"+level+' id="'+this.options.headerPrefix+raw.toLowerCase().replace(/[^\w]+/g,"-")+'">'+text+"</h"+level+">\n"};Renderer.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"};Renderer.prototype.list=function(body,ordered){var type=ordered?"ol":"ul";return"<"+type+">\n"+body+"</"+type+">\n"};Renderer.prototype.listitem=function(text){return"<li>"+text+"</li>\n"};Renderer.prototype.paragraph=function(text){return"<p>"+text+"</p>\n"};Renderer.prototype.table=function(header,body){return"<table>\n"+"<thead>\n"+header+"</thead>\n"+"<tbody>\n"+body+"</tbody>\n"+"</table>\n"};Renderer.prototype.tablerow=function(content){return"<tr>\n"+content+"</tr>\n"};Renderer.prototype.tablecell=function(content,flags){var type=flags.header?"th":"td";var tag=flags.align?"<"+type+' style="text-align:'+flags.align+'">':"<"+type+">";return tag+content+"</"+type+">\n"};Renderer.prototype.strong=function(text){return"<strong>"+text+"</strong>"};Renderer.prototype.em=function(text){return"<em>"+text+"</em>"};Renderer.prototype.codespan=function(text){return"<code>"+text+"</code>"};Renderer.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"};Renderer.prototype.del=function(text){return"<del>"+text+"</del>"};Renderer.prototype.link=function(href,title,text){if(this.options.sanitize){try{var prot=decodeURIComponent(unescape(href)).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return""}if(prot.indexOf("javascript:")===0){return""}}var out='<a href="'+href+'"';if(title){out+=' title="'+title+'"'}out+=">"+text+"</a>";return out};Renderer.prototype.image=function(href,title,text){var out='<img src="'+href+'" alt="'+text+'"';if(title){out+=' title="'+title+'"'}out+=this.options.xhtml?"/>":">";return out};function Parser(options){this.tokens=[];this.token=null;this.options=options||marked.defaults;this.options.renderer=this.options.renderer||new Renderer;this.renderer=this.options.renderer;this.renderer.options=this.options}Parser.parse=function(src,options,renderer){var parser=new Parser(options,renderer);return parser.parse(src)};Parser.prototype.parse=function(src){this.inline=new InlineLexer(src.links,this.options,this.renderer);this.tokens=src.reverse();var out="";while(this.next()){out+=this.tok()}return out};Parser.prototype.next=function(){return this.token=this.tokens.pop()};Parser.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0};Parser.prototype.parseText=function(){var body=this.token.text;while(this.peek().type==="text"){body+="\n"+this.next().text}return this.inline.output(body)};Parser.prototype.tok=function(){switch(this.token.type){case"space":{return""}case"hr":{return this.renderer.hr()}case"heading":{return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,this.token.text)}case"code":{return this.renderer.code(this.token.text,this.token.lang,this.token.escaped)}case"table":{var header="",body="",i,row,cell,flags,j;cell="";for(i=0;i<this.token.header.length;i++){flags={header:true,align:this.token.align[i]};cell+=this.renderer.tablecell(this.inline.output(this.token.header[i]),{header:true,align:this.token.align[i]})}header+=this.renderer.tablerow(cell);for(i=0;i<this.token.cells.length;i++){row=this.token.cells[i];cell="";for(j=0;j<row.length;j++){cell+=this.renderer.tablecell(this.inline.output(row[j]),{header:false,align:this.token.align[j]})}body+=this.renderer.tablerow(cell)}return this.renderer.table(header,body)}case"blockquote_start":{var body="";while(this.next().type!=="blockquote_end"){body+=this.tok()}return this.renderer.blockquote(body)}case"list_start":{var body="",ordered=this.token.ordered;while(this.next().type!=="list_end"){body+=this.tok()}return this.renderer.list(body,ordered)}case"list_item_start":{var body="";while(this.next().type!=="list_item_end"){body+=this.token.type==="text"?this.parseText():this.tok()}return this.renderer.listitem(body)}case"loose_item_start":{var body="";while(this.next().type!=="list_item_end"){body+=this.tok()}return this.renderer.listitem(body)}case"html":{var html=!this.token.pre&&!this.options.pedantic?this.inline.output(this.token.text):this.token.text;return this.renderer.html(html)}case"paragraph":{return this.renderer.paragraph(this.inline.output(this.token.text))}case"text":{return this.renderer.paragraph(this.parseText())}}};function escape(html,encode){return html.replace(!encode?/&(?!#?\w+;)/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function unescape(html){return html.replace(/&([#\w]+);/g,function(_,n){n=n.toLowerCase();if(n==="colon")return":";if(n.charAt(0)==="#"){return n.charAt(1)==="x"?String.fromCharCode(parseInt(n.substring(2),16)):String.fromCharCode(+n.substring(1))}return""})}function replace(regex,opt){regex=regex.source;opt=opt||"";return function self(name,val){if(!name)return new RegExp(regex,opt);val=val.source||val;val=val.replace(/(^|[^\[])\^/g,"$1");regex=regex.replace(name,val);return self}}function noop(){}noop.exec=noop;function merge(obj){var i=1,target,key;for(;i<arguments.length;i++){target=arguments[i];for(key in target){if(Object.prototype.hasOwnProperty.call(target,key)){obj[key]=target[key]}}}return obj}function marked(src,opt,callback){if(callback||typeof opt==="function"){if(!callback){callback=opt;opt=null}opt=merge({},marked.defaults,opt||{});var highlight=opt.highlight,tokens,pending,i=0;try{tokens=Lexer.lex(src,opt)}catch(e){return callback(e)}pending=tokens.length;var done=function(err){if(err){opt.highlight=highlight;return callback(err)}var out;try{out=Parser.parse(tokens,opt)}catch(e){err=e}opt.highlight=highlight;return err?callback(err):callback(null,out)};if(!highlight||highlight.length<3){return done()}delete opt.highlight;if(!pending)return done();for(;i<tokens.length;i++){(function(token){if(token.type!=="code"){return--pending||done()}return highlight(token.text,token.lang,function(err,code){if(err)return done(err);if(code==null||code===token.text){return--pending||done()}token.text=code;token.escaped=true;--pending||done()})})(tokens[i])}return}try{if(opt)opt=merge({},marked.defaults,opt);return Parser.parse(Lexer.lex(src,opt),opt)}catch(e){e.message+="\nPlease report this to https://github.com/chjj/marked.";if((opt||marked.defaults).silent){return"<p>An error occured:</p><pre>"+escape(e.message+"",true)+"</pre>"}throw e}}marked.options=marked.setOptions=function(opt){merge(marked.defaults,opt);return marked};marked.defaults={gfm:true,tables:true,breaks:false,pedantic:false,sanitize:false,smartLists:false,silent:false,highlight:null,langPrefix:"lang-",smartypants:false,headerPrefix:"",renderer:new Renderer,xhtml:false};marked.Parser=Parser;marked.parser=Parser.parse;marked.Renderer=Renderer;marked.Lexer=Lexer;marked.lexer=Lexer.lex;marked.InlineLexer=InlineLexer;marked.inlineLexer=InlineLexer.output;marked.parse=marked;if(typeof module!=="undefined"&&typeof exports==="object"){module.exports=marked}else if(typeof define==="function"&&define.amd){define("Gallery/Client/3rdParty/marked",function(){return marked})}else{this.marked=marked}}).call(function(){return this||(typeof window!=="undefined"?window:global)}());
// Copyright (C) Microsoft Corporation. All rights reserved.
define("Gallery/Client/Controls/ReadMore/ReadMore.ViewModel",["require","exports","knockout","VSS/Adapters/Knockout","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","VSS/Diag"],function(n,t,i,r,u,f){var e=function(n){function t(t){var r=this;n.call(this);this._isExpanded=i.observable(!0);this._lessText=i.observable("");this.setExpanded=function(){r._isExpanded(!0)};t&&(this.fullText=t.fullText,this.characterLimit=t.characterLimit,this.readMoreText=t.readMoreText?t.readMoreText:u.ReadMore);this._initializeReadMoreDetails()}return __extends(t,n),t.prototype.getFullText=function(){return this.fullText},t.prototype.getLessText=function(){return this.fullText.length>this.characterLimit?this._lessText():this.fullText},t.prototype._initializeReadMoreDetails=function(){this.fullText.length>this.characterLimit&&(this._isExpanded(!1),this._lessText(this.fullText.substr(0,this.characterLimit-1)+t.READ_MORE_DOTS))},t.READ_MORE_DOTS="...",t}(r.TemplateViewModel);t.ReadMoreViewModel=e});
define("VSS/Utils/Html",["require","exports","VSS/Utils/String","VSS/Utils/Url","VSS/VSS"],function(n,t,i,r,u){var f,e,c;(function(n){function e(n,t){if($.isArray(t))for(var i=0;i<t.length;i++)n[t[i].toUpperCase()]=0}function w(n){e(s,n)}function t(n,t){var i={};u[n.toUpperCase()]=i;e(i,t)}function l(n){if($.isArray(n))for(var i=0;i<n.length;i++)t(n[i])}function b(n){if($.isArray(n))for(var t=0;t<n.length;t++)o[n[t].toUpperCase()]=0}function a(){u||(u={},t("a",["charset","href","hreflang","name","rel","rev","shape","tabindex","type"]),t("blockquote",["cite"]),t("br",["clear"]),t("caption",["align"]),t("col",["align","char","charoff","span","valign","width"]),t("colgroup",["align","char","charoff","span","valign","width"]),t("del",["cite","datetime"]),t("dir",["compact"]),t("div",["align"]),t("dl",["compact"]),t("font",["color","face","size"]),t("h1",["align"]),t("h2",["align"]),t("h3",["align"]),t("h4",["align"]),t("h5",["align"]),t("h6",["align"]),t("hr",["align","size","width"]),t("img",["align","alt","border","height","hspace","ismap","longdesc","name","src","usemap","vspace","width","alt2","src2"]),t("ins",["cite","datetime"]),t("li",["type","value"]),t("map",["name"]),t("menu",["compact"]),t("ol",["compact","start","type"]),t("p",["align"]),t("pre",["width"]),t("q",["cite"]),t("table",["align","border","cellpadding","cellspacing","frame","rules","summary","width","caption"]),t("tbody",["align","char","charoff","valign"]),t("td",["abbr","align","axis","char","charoff","colspan","headers","height","nowrap","rowspan","scope","valign","width"]),t("tfoot",["align","char","charoff","valign"]),t("th",["abbr","align","axis","char","charoff","colspan","headers","height","nowrap","rowspan","scope","valign","width"]),t("thead",["align","char","charoff","valign"]),t("tr",["align","char","charoff","valign"]),t("ul",["compact","type"]),t("dd",[]),t("dt",[]),l(["abbr","acronym","address","b","bdo","big","center","cite","code","dfn","em","i"]),l(["kbd","s","samp","small","span","strike","strong","sub","sup","tt","u","var"]))}function v(){var t,r,n;if(!i){for(i={},t=["b","i","u","em","small","strong","sub","sup","ins","del","mark","font","h1","h2","h3","h4","h5","h6","strike","ul","ol","dl"],r=["li","dt","dd"],n=0;n<t.length;n++)i[t[n].toUpperCase()]="";for(n=0;n<r.length;n++)i[r[n].toUpperCase()]="p"}}function k(){o||(o={},b(["script","style","option","select","textarea"]))}function d(){s||(s={},w(["dir","lang","title","style","id","class","contenteditable"]))}function g(){f||(f={},e(f,["src","href","cite","longdesc"]),e(f,["background-image","list-style-image"]))}function nt(){h||(h={},h.DATA=function(n,t,i){return n&&n.toUpperCase()==="IMG"&&t&&t.toUpperCase()==="SRC"?i.toUpperCase().search("DATA:IMAGE/\\w+;")===0:!1})}function tt(){c||(c={},e(c,["background","background-attachment","background-color","background-image","background-position","background-repeat","border","border-bottom","border-bottom-color","border-bottom-style","border-bottom-width","border-collapse","border-color","border-left","border-left-color","border-left-style","border-left-width","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-style","border-top-width","border-width","caption-side","clear","color","float","font","font-family","font-size","font-style","font-variant","font-weight","height","letter-spacing","line-height","list-style","list-style-image","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","padding","padding-bottom","padding-left","padding-right","padding-top","table-layout","text-align","text-decoration","text-indent","text-transform","vertical-align","white-space","width","word-spacing"]))}function it(n,t){return n&&t?n.toUpperCase()===t.toUpperCase():!1}function rt(n){return n?(a(),n.toUpperCase()in u):!1}function ut(n){if(n){v();var t=i[n.toUpperCase()];if(t!==undefined&&t.length===0)return!0}return!1}function ft(n){if(n){v();var t=i[n.toUpperCase()];if(t&&t.length>0)return t}return null}function et(n){return n?(k(),n.toUpperCase()in o):!1}function ot(n,t,i,r){var f,e;if(t){if(d(),f=t.toUpperCase(),i&&r&&f in i&&f in r)throw new Error(f+" is specified in additionalInvalidAttributes and additionalValidAttributes. Attributes may only appear in either the whitelist or blacklist.");if(r&&f in r)return!0;if(f in s)return i&&f in i?!1:!0;if(n&&(a(),e=u[n.toUpperCase()],e))return f in e}return!1}function y(n){return n&&(g(),n.toUpperCase()in f)?!0:!1}function p(n,t,i){var u,f,e;return(f=i.indexOf(":"),f<0||r.isSafeProtocol(i))?!0:(nt(),e=i.substr(0,f),u=h[e.toUpperCase()],$.isFunction(u)&&u(n,t,i)===!0)?!0:!1}function st(n){return n&&(tt(),n.toUpperCase()in c)?!0:!1}function ht(n){var t=n;return t?(t=t.replace("&","&amp;"),t=t.replace('"',"&quot;"),t=t.replace(">","&gt;"),t.replace("<","&lt;")):""}function ct(n,t,i){i=i||'"';var r=$("<div bogusAttribute="+i+t+i+">");return r.attr("bogusAttribute")}function lt(n,t){var f=[],i,r,u;return $.each(t.split(";")||[],function(t,u){u=$.trim(u);u&&(i=u.split(":",2),r=$.trim(i[0]),i.length===2&&st(r)&&(!y(r)||p(n,r,$.trim(i[1])))&&f.push(u))}),u=f.join(";"),u?'style="'+ht(u)+'"':""}function at(n,t){if(n&&t){var i=decodeURI(t),r=encodeURI(i);return n.replace(t,r)}return n}function vt(n,t,i,r,u,f){var e;return y(t)?(e=i.substr(r,u),p(n,t,$.trim(ct(t,e,f)))?at(i,e):""):t.toUpperCase()==="STYLE"?lt(n,i.substr(r,u)):i}var u,o,s,f,h,c,i;n.areTagsEqual=it;n.isAllowedTag=rt;n.isFormattingRemovalTag=ut;n.getFormattingReplacementTag=ft;n.isSpecialTag=et;n.isAllowedAttribute=ot;n.cleanAttribute=vt})(f||(f={})),function(n){function s(n){return n>="0"&&n<="9"||n>="A"&&n<="Z"||n>="a"&&n<="z"?!0:!1}function i(n,t){u.lastIndex=t;var i=u.exec(n);return i?i.index:n.length}function h(n,t){e.lastIndex=t;var i=e.exec(n);return i?i.index:n.length}function t(n,t,i){var r=n.indexOf(i,t);return r>=0?r+i.length:n.length}function r(n,t){o.lastIndex=t;var i=o.exec(n);return i?{offset:i.index,name:n.substr(t,i.index-t)}:{offset:n.length,name:n.substr(t,n.length-t)}}function c(n,u,e,o,c,l){var v,a,b,y,k,nt,it,w,p,et,rt,d,ut,g,ft,tt;for(e===void 0&&(e=!1),o===void 0&&(o=null),c===void 0&&(c=null),l===void 0&&(l=!1),v=n.length,a=0;a<v;){if(y=a,a=n.indexOf("<",a),a<0&&(a=v),a>y){u.writeText(n,y,a-y);continue}if(y=a++,b=n.charAt(a),a<v&&b==="!"){if(a++,a+1<v&&n.substr(a,2)==="--"){a+=2;a=t(n,a,"-->");continue}if(a+6<v&&n.substr(a,7)==="[CDATA["){a+=7;a=t(n,a,"]\]>");continue}a=t(n,a,">");continue}if(a<v&&b==="?"){a++;a=t(n,a,">");continue}if(it=!1,a<v&&b==="/"&&(it=!0,a++),a=i(n,a),w=r(n,a),a=w.offset,p=w.name,f.isSpecialTag(p)){for(a=t(n,a,">");a<v;)if(a=t(n,a,"<"),a+2<v&&n.substr(a,3)==="!--")a=t(n,a,"-->");else if(a<v&&n.charAt(a)==="/"){if(a++,a=i(n,a),w=r(n,a),a=w.offset,et=w.name,f.areTagsEqual(p,et)){a=t(n,a,">");break}}else a<v&&a++;continue}if(!f.isAllowedTag(p)||l&&f.isFormattingRemovalTag(p))if(e){u.writeEncodedText(n,y,a-y);continue}else{a=t(n,a,">");continue}for(g=p,ft=a-y,l&&(tt=f.getFormattingReplacementTag(p),tt&&tt.length!==0&&(g=tt,ft=a-(y-(p.length-g.length)))),u.writeTag(n,y,ft,g,it);a<v;){if(y=a,a=i(n,a),a<v&&n.charAt(a)==="/"&&a++,a<v&&n.charAt(a)===">"){a++;u.writeEndOfTag(n,y,a-y,g);break}if(a<v&&s(n.charAt(a))){if(w=r(n,a),a=w.offset,rt=w.name,a=i(n,a),k=0,nt=0,a<v&&n.charAt(a)==="=")if(a++,a=i(n,a),k=a,b=n.charAt(a),d=null,a<v&&(b==="'"||b==='"')){for(d=b,a++,k=a;a<v&&n.charAt(a)!==d;)a++;nt=a;a<v&&n.charAt(a)===d&&a++}else a=h(n,a),nt=a;f.isAllowedAttribute(p,rt,o,c)&&(ut=f.cleanAttribute(p,rt,n.substr(y,a-y),k-y,nt-k,d),ut&&u.writeAttribute(ut));continue}a<v&&n.charAt(a)!==">"&&a++}}}var u=/\S/g,e=/[\s|>]/g,o=/[^\w\:\-]/g;n.parse=c}(e||(e={}));var s=function(){function n(n){this.text=n}return n.prototype.render=function(n){n.append(this.text)},n}(),o=function(){function n(n,t){this.tag=n.toUpperCase();this.root=t===!0}return n._getEmptyTags=function(){if(!n._emptyTags){var t={};t.AREA=!0;t.BASE=!0;t.BASEFONT=!0;t.BGSOUND=!0;t.BR=!0;t.COL=!0;t.EMBED=!0;t.FRAME=!0;t.HR=!0;t.IMG=!0;t.INPUT=!0;t.ISINDEX=!0;t.LINK=!0;t.META=!0;t.PARAM=!0;t.WBR=!0;t.IFRAME=!1;t.MARQUEE=!1;n._emptyTags=t}return n._emptyTags},n.hasEndTag=function(n){var t=this._getEmptyTags(),i=!0;return n in t&&(i=!t[n]),i},n.canTagHaveChild=function(n){var t=this._getEmptyTags();return!(n in t)},n.prototype.getChildren=function(){return this._children||(this._children=[]),this._children},n.prototype.getAttributes=function(){return this._attributes||(this._attributes=[]),this._attributes},n.prototype.getHasClosingTag=function(){return this.empty===!0?!1:n.hasEndTag(this.tag)},n.prototype.getCanHaveChildren=function(){return this.tagClosed===!0?!1:n.canTagHaveChild(this.tag)},n.prototype.render=function(n){var t,i,u,r,f=!1;if(this.tag)for(n.append("<"),n.append(this.tag),u=this.getAttributes(),t=0,i=u.length;t<i;t++)n.append(" "),n.append($.trim(u[t]));if(r=this.getChildren(),r.length>0)for(f=!0,this.tag&&n.append(">"),t=0,i=r.length;t<i;t++)r[t].render(n);this.tag&&(f?(n.append("<\/"),n.append(this.tag),n.append(">")):this.getHasClosingTag()?(n.append("><\/"),n.append(this.tag),n.append(">")):n.append("/>"))},n}(),l=function(){function n(){this._strings=[]}return n.prototype.append=function(n){var t=this._strings;return n&&(t[t.length]=n),this},n.prototype.clear=function(){return this._strings=[],this},n.prototype.toString=function(){return this._strings.join("")},n}(),h=function(){function n(){this.root=new o("",!0);this.elements=[]}return n.prototype.writeText=function(n,t,i){var r=this.elements;r[r.length]=new s(n.substr(t,i))},n.prototype.writeEncodedText=function(n,t,r){var u=this.elements;u[u.length]=new s(i.htmlEncode(n.substr(t,r)))},n.prototype.writeTag=function(n,t,i,r,u){var f,c,l=this.elements,h,e,a=r.toUpperCase();if(u===!0){for(e=[];l.length>0;)if(c=l.pop(),c instanceof s)e[e.length]=c;else if(f=c,f.tag!==a||f.tagClosed){if(f.getCanHaveChildren())for(h=c.getChildren();e.length>0;)h[h.length]=e.pop();e[e.length]=f;f=null}else break;for(f||(f=new o(r)),h=f.getChildren();e.length>0;)h[h.length]=e.pop()}else f=new o(r);f.tagClosed=u;l[l.length]=f},n.prototype.writeEndOfTag=function(n,t,i,r){var u,f,e=this.elements,s=r.toUpperCase();i>1&&(f=n.substr(t,i),f.charAt(f.length-2)==="/"&&e.length>0&&(u=e[e.length-1],u instanceof o&&u.tag===s&&(u.empty=!0,u.tagClosed=!0)))},n.prototype.writeAttribute=function(n){var t,i=this.elements;i.length>0&&(t=i[i.length-1],t instanceof o&&t.getAttributes().push(n))},n.prototype.finish=function(){for(var t,u=this.elements,f=this.root,n=[],i,r;u.length>0;)if(t=u.pop(),t instanceof s)n[n.length]=t;else{if(t.getCanHaveChildren())for(i=t.getChildren();n.length>0;)i[i.length]=n.pop();n[n.length]=t}for(r=f.getChildren();n.length>0;)r[r.length]=n.pop()},n.prototype.toString=function(){var n=new l;return this.root.render(n),n.toString()},n}(),a;(function(n){function t(t){return n.normalizeStripAttributes(t,null)}function i(n,t,i){var f=new h,o=null,r,u;if(t)for(o={},r=0;r<t.length;r++)o[t[r].toUpperCase()]=0;return u=null,i&&(u={},i.forEach(function(n){u[n.toUpperCase()]=0})),e.parse(n,f,!1,o,u),f.finish(),f.toString()}function r(n){var t=new h;return e.parse(n,t,!1,{CLASS:0,STYLE:0},null,!0),t.finish(),t.toString()}function u(n){var t=new h;return e.parse(n,t,!0),t.finish(),t.toString()}n.normalize=t;n.normalizeStripAttributes=i;n.removeFormatting=r;n.sanitize=u})(a=t.HtmlNormalizer||(t.HtmlNormalizer={}));c=function(){function n(){}return n._replaceSimpleTemplateTokens=function(t,i){for(var r=t,e=/\$\{([^\$\}]+)\}/ig,u,o,f;(u=e.exec(r))!==null;)o=u[1],f=n._getEncodedTextPropertyValue(i,o),r=n._replaceMatch(r,u,f),e.lastIndex=u.index+f.length;return r},n._replaceUnencodedTemplateTokens=function(t,i){for(var r=t,e=/\{\{html ([^\$\}]+)\}\}/ig,u,o,f;(u=e.exec(r))!==null;)o=u[1],f=n._getTextPropertyValue(i,o),r=n._replaceMatch(r,u,f),e.lastIndex=u.index+f.length;return r},n._replaceForEachTemplateTokens=function(t,i){for(var f=t,a=/\{\{each \s*([^ \}]+)\}\}((?:.|\r|\n)*)\{\{\/each\}\}/ig,c=/\$\{\$value(?:\.([^\}]+))?\}/ig,r,v,y,e,o,s,p,l,u,h,w;(r=a.exec(f))!==null;){if(v=r[1],y=r[2],e="",o=n._getPropertyValue(i,v),$.isArray(o))for(h=0,w=o.length;h<w;h+=1){for(u=y,c.lastIndex=0;(s=c.exec(u))!==null;)p=s[1],l=n._getEncodedTextPropertyValue(o[h],p),u=n._replaceMatch(u,s,l),c.lastIndex=s.index+l.length;e+=u}f=n._replaceMatch(f,r,e);a.lastIndex=r.index+e.length}return f},n._replaceMatch=function(n,t,i){return n.substring(0,t.index)+i+n.substring(t.index+t[0].length)},n._getEncodedTextPropertyValue=function(t,r){var u=n._getPropertyValue(t,r);return u===undefined?"":i.htmlEncode(u.toString())},n._getTextPropertyValue=function(t,i){var r=n._getPropertyValue(t,i);return r===undefined?"":r.toString()},n._getPropertyValue=function(n,t){if(t===undefined||t.length===0)return n;for(var r=t.split("."),i=n;r.length>0&&i!==undefined;)i=i[r.shift()];return i},n.tmpl=function(t,i){var r=t;return r=n._replaceSimpleTemplateTokens(r,i),r=n._replaceUnencodedTemplateTokens(r,i),n._replaceForEachTemplateTokens(r,i)},n}();t.TemplateEngine=c;u.tfsModuleLoaded("VSS.Html",t)});
define("Gallery/Client/Controls/RatingAndReviewDetails/RatingAndReviewDetails.ViewModel",["require","exports","q","knockout","Gallery/Client/Common/Constants","Gallery/Client/Common/Constants","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Scripts/Gallery/Resources/VSS.Resources.GalleryCommon","Gallery/Client/Controls/RatingControl/RatingControl.ViewModel","Gallery/Client/Controls/ReadMore/ReadMore.ViewModel","Gallery/Client/URLHelper","Gallery/Client/Common/Utility","Gallery/Client/Common/Utility.Common","Gallery/Client/Service/VSSItem","VSS/Context","VSS/Events/Action","VSS/Events/Services","VSS/FeatureAvailability/Services","VSS/Gallery/Contracts","VSS/Serialization","VSS/Adapters/Knockout","VSS/Utils/Date","VSS/Utils/String","VSS/Utils/Url","VSS/Utils/Html","Gallery/Client/Common/Telemetry","Gallery/Client/Common/TelemetryInternal"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft){var et=l.WindowWrapper,st=rt.HtmlNormalizer,ot=function(n){function t(i){n.call(this);this.totalReviewCount=r.observable(0);this.hasMoreReviews=r.observable(!1);this.isEditReview=r.observable(!1);this.newReviewText=r.observable("");this.newRatingDetails=null;this.avgRatingDetails=null;this.avgRatingDetailsOnBanner=null;this.reviewFormHeaderText="";this.seeMoreString=o.SeeMore;this.reportReviewText=e.ReportReviewText;this.writeReviewButtonText=e.WriteReviewButtonText;this.editReviewButtonText=e.EditReviewButtonText;this.requestRatingAndReviewMessage=e.RequestRatingAndReviewMessage;this.noReviewsYetMessage=e.NoReviewsYetMessage;this.feedbackPopupHeaderMessage=e.FeedbackPopupHeaderMessage;this.feedbackPopupContentMessage=e.FeedbackPopupContentMessage;this.closeButtonText=e.CancelAddUserButtonText;this.cancelButtonText=e.CancelButtonText;this.submitButtonText=e.SubmitButtonText;this.userReviewText=e.UserReviewText;this.reviewFormDefaultText=tt.format(e.ReviewFormDefaultText,t.MAX_REVIEWTEXT_CHAR);this.itemReviewsDetails=r.observableArray([]);this.showUserAvatar=!1;this.privacyText="";this.isUserAuthenticated=!1;this.reviewReportedSuccessfully=!0;this.averageRatingText=r.observable("");this.waitForWriteReview=r.observable(!1);this.waitForSeeMore=r.observable(!1);this.waitForReportReview=r.observable(!1);this._publisherReplyFormPrivacyText="";this._koPublisherReplyText=r.observable("");this._koWaitForPublisherReply=r.observable(!1);this._publisherImageUrl="";this._publisherDisplayName="";this._prevAvgRating=0;this._publisherReplyButtonText=e.PublisherReplyButtonText;this._publisherReplyEditButtonText=e.PublisherReplyEditButtonText;this._replyFormPlaceholderText=tt.format(e.ReplyFormPlaceholderText,t.MAX_REVIEWREPLYTEXT_CHAR);this._publisherReplyFeatureFlag=!1;this._koPublisherReplyFormUserImageSrcLink=r.observable("");this._koPublisherReplyFormUserName=r.observable("");this._koPublisherReplyFormReviewUpdatedDate=r.observable("");this._hasPermissionsForPublisherReply=!1;this._koPublisherReplyFormUserRating=r.observable(null);this._koPublisherReplyFormReviewText=r.observable("");i.itemInfo!=null&&(this._vssDetailedItem=i.itemInfo,this.reviewFormHeaderText=e.ReviewText+" - "+this._vssDetailedItem.title);this._pageSize=i.pageSize;this._filterOptions=i.filterOptions;this._vssGalleryDataProvider=i.vssGalleryDataProvider;this.isUserAuthenticated=y.getDefaultWebContext().user?!0:!1;this._prevAvgRating=this._vssDetailedItem.averageRating;this._ratingStarType=i.ratingStarType;this._initializeItemReviewsDetails(i.reviewResults)}return __extends(t,n),t.prototype._initializeItemReviewsDetails=function(n){for(var i=n.reviews.length,r=n.reviews,t=0;t<i;t++)this._insertItemReviewDetailsRear(r[t]);this.concernCategories=[e.RatingAndReviewSpamText,e.RatingAndReviewProfaneText,e.RatingAndReviewOffensiveText];this.totalReviewCount(n.totalReviewCount);this.hasMoreReviews(n.hasMoreReviews);this._initializeWriteReviewModalDialog();this._initializePublisherReplyModalDialog();this._publisherImageUrl=this._vssDetailedItem.brandingImageUrl||this._vssDetailedItem.imageUrl;this._publisherDisplayName=this._vssDetailedItem.publisherDisplayName;this._hasPermissionsForPublisherReply=d.deserializeJsonIsland($(".can-update-extension"),null);this.showUserAvatar=b.FeatureAvailabilityService.isFeatureEnabled(f.FeatureFlag.ShowUserAvatar,!0);this._publisherReplyFeatureFlag=this.setPublisherReplyFeatureFlagValue();this.averageRatingText(l.getAverageRatingText(this._vssDetailedItem.averageRating,this.totalReviewCount()))},t.prototype.setPublisherReplyFeatureFlagValue=function(){var n=b.FeatureAvailabilityService.isFeatureEnabled(f.FeatureFlag.PublisherReply,!1);return n===!0?n:(a.FeatureFlagUtils.isFeatureFlagEnabled(location.href,a.FeatureFlagUtils.showPublisherReply)&&(a.FeatureFlagUtils.setFeatureFlagCookie(a.FeatureFlagUtils.showPublisherReply),n=!0),n)},t.prototype._initializeWriteReviewModalDialog=function(){var o=this,n=0,t={rating:this._vssDetailedItem.averageRating.toString(),totalStars:s.RatingControlViewModel.TOTAL_RATING_STARS,ratingCount:this._vssDetailedItem.ratingCount},r,f;this.avgRatingDetails=new s.RatingControlViewModel(t);r=$.extend(t,{ratingStarType:this._ratingStarType});this.avgRatingDetailsOnBanner=new s.RatingControlViewModel(r);this.isUserAuthenticated&&(this._currentUserReview=d.deserializeJsonIsland($(".pinned-user-review"),k.TypeInfo.Review),this._currentUserReview&&!this._currentUserReview.isDeleted&&(n=this._currentUserReview.rating*1,this.newReviewText(this._currentUserReview.text),this.isEditReview(!0)),this.privacyText=tt.format(e.RatingPrivacyText,y.getDefaultWebContext().user.name),p.getService().registerActionWorker(u.GalleryEvents.PAGE_LOAD,function(){o._showReviewDialogIfNeeded()}));f={rating:n.toString(),totalStars:s.RatingControlViewModel.TOTAL_RATING_STARS,ratingCount:0,isReadOnly:!1};this.newRatingDetails=new s.RatingControlViewModel(f);this.moreReviewsLoaded=i.defer();this.reviewsCreated=i.defer();this.reviewsEdited=i.defer();this.violationSubmited=i.defer();this._publisherReplyCreated=i.defer()},t.prototype._initializePublisherReplyModalDialog=function(){this._publisherReplyFormPrivacyText=tt.format(e.PublisherReplyPrivacyText,this._vssDetailedItem.publisherDisplayName)},t.prototype._insertItemReviewDetailsFront=function(n,i){var r={rating:n.rating.toString(),totalStars:s.RatingControlViewModel.TOTAL_RATING_STARS,ratingCount:0},u={fullText:n.text,characterLimit:t.READ_MORE_CHARACTER_LIMIT},f=new h.ReadMoreViewModel(u),e=new s.RatingControlViewModel(r);this.itemReviewsDetails.unshift({userImageSrcLink:c.GalleryURLs.getUserAvatarUrl(n.userId),userName:i,ratingViewModelDetails:e,updatedDate:n.updatedDate,readMoreData:f,reviewId:n.id,publisherReply:this._getPublisherReplyFromReview(n)})},t.prototype._getPublisherReplyFromReview=function(n){if(n.reply===undefined||n.reply===null)return null;var i={fullText:n.reply.replyText,characterLimit:t.READ_MORE_CHARACTER_LIMIT},r=new h.ReadMoreViewModel(i);return{publisherReplyReadMore:r,replyId:n.reply.id,updatedDate:n.reply.updatedDate}},t.prototype._insertItemReviewDetailsRear=function(n){var i={rating:n.rating.toString(),totalStars:s.RatingControlViewModel.TOTAL_RATING_STARS,ratingCount:0},r={fullText:n.text,characterLimit:t.READ_MORE_CHARACTER_LIMIT},u=new h.ReadMoreViewModel(r),f=new s.RatingControlViewModel(i);this.itemReviewsDetails.push({userImageSrcLink:c.GalleryURLs.getUserAvatarUrl(n.userId),userName:n.userDisplayName,ratingViewModelDetails:f,updatedDate:n.updatedDate,readMoreData:u,reviewId:n.id,publisherReply:this._getPublisherReplyFromReview(n)})},t.prototype._removeUserOldReview=function(n){for(var i=this.itemReviewsDetails().length,t=0;t<i;t++)if(this.itemReviewsDetails()[t].reviewId===n.id){this.itemReviewsDetails.remove(this.itemReviewsDetails()[t]);break}},t.prototype._logTelemetry=function(n,t,i,r){i?ft.TelemetryHelper.publishEvent(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.RATING,{Event:n,Error:r,ExtensionName:this._vssDetailedItem.title,PublisherName:this._vssDetailedItem.publisherName},t):ft.TelemetryHelper.publishEvent(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.RATING,{Event:n,ExtensionName:this._vssDetailedItem.title,PublisherName:this._vssDetailedItem.publisherName},t)},t.prototype.editReview=function(){var n=this,r,u,i=this.newRatingDetails.fixedFullStars(),f=this._currentUserReview.rating,e=this.newReviewText(),o=this._currentUserReview.id;return u={id:null,isDeleted:!1,productVersion:this._vssDetailedItem.version,rating:i,text:e,title:null,updatedDate:null,userId:y.getDefaultWebContext().user.id,userDisplayName:null,reply:null},r={operation:k.ReviewPatchOperation.UpdateReview,reportedConcern:null,reviewItem:u},this.waitForWriteReview(!0),this._vssGalleryDataProvider.updateReview(r,this._vssDetailedItem.publisherName,this._vssDetailedItem.name,o).then(function(r){var e=n.totalReviewCount(),u,o,s;n._prevAvgRating=n._prevAvgRating?n._prevAvgRating:n.avgRatingDetails.fullStars();u=(e*n._prevAvgRating+i-f)/e;n._prevAvgRating=u;n._updateAvgRatingStars(u);n._removeUserOldReview(n._currentUserReview);n._currentUserReview=r.reviewItem;n._currentUserReview.text&&(o=y.getDefaultWebContext().user.name,n._insertItemReviewDetailsFront(n._currentUserReview,o));s={Event:ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.CLICK_EDIT_REVIEW_SUBMIT,ExtensionName:n._vssDetailedItem.title,PublisherName:n._vssDetailedItem.publisherName,NumberofReviews:n.totalReviewCount(),AverageRating:u,Rating:i,HasReviewText:n.newReviewText()?!0:!1,ProductType:v.ItemModelHelper.getItemTypeText(n._vssDetailedItem.itemType)};ft.TelemetryHelper.publishEvent(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.RATING,s,!1);n.waitForWriteReview(!1);w.getService().fire(t.EVENT_ON_WRITE_REVIEW_COMPLETE);n.reviewsEdited.resolve(null)},function(i){n._logTelemetry(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.ERROR_EDIT_REVIEW_SUBMIT,!1,!0,i.message);n.waitForWriteReview(!1);w.getService().fire(t.EVENT_ON_WRITE_REVIEW_COMPLETE);n.reviewsEdited.reject(i);alert(i.message)}),this.reviewsEdited.promise},t.prototype._showReviewDialogIfNeeded=function(){var n=it.Uri.parse(et.getCurrentUrl());n.getQueryParam(t.SHOW_REVIEW_DIALOG)==="true"&&a.getCookie(f.RatingConstants.showWriteDialogBox)==="true"&&(a.setCookie(f.RatingConstants.showWriteDialogBox,"false"),this.onWriteReview())},t.prototype.onWriteReview=function(){this.isUserAuthenticated&&this._logTelemetry(this.isEditReview()?ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.CLICK_EDIT_REVIEW:ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.CLICK_WRITE_REVIEW,!0,!1);w.getService().fire(t.EVENT_ON_WRITE_REVIEW)},t.prototype.cancelReview=function(){this._logTelemetry(this.isEditReview()?ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.CLICK_EDIT_REVIEW_CANCEL:ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.CLICK_WRITE_REVIEW_CANCEL,!1,!1)},t.prototype.onPublisherReplyFormCancel=function(){this._logTelemetry(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.CLICK_PUBLISHER_REPLY_FORM_CANCEL_BUTTON,!1,!1)},t.prototype.createPublisherReply=function(){var i=this,n=this.itemReviewsDetails()[this._publisherReplyReviewIndex],r,u;return r={id:n.reviewId,isDeleted:!1,productVersion:this._vssDetailedItem.version,rating:n.ratingViewModelDetails.fullStars(),text:null,title:null,updatedDate:null,userId:null,userDisplayName:null,reply:{id:0,isDeleted:!1,productVersion:this._vssDetailedItem.version,replyText:this._koPublisherReplyText(),reviewId:n.reviewId,title:null,updatedDate:null,userId:y.getDefaultWebContext().user.id}},u={operation:k.ReviewPatchOperation.ReplyToReview,reportedConcern:null,reviewItem:r},this._koWaitForPublisherReply(!0),this._vssGalleryDataProvider.updateReview(u,this._vssDetailedItem.publisherName,this._vssDetailedItem.name,n.reviewId).then(function(r){var o={fullText:r.reviewItem.reply.replyText,characterLimit:t.READ_MORE_CHARACTER_LIMIT},s=new h.ReadMoreViewModel(o),u,f,e;u={replyId:r.reviewItem.reply.id,publisherReplyReadMore:s,updatedDate:r.reviewItem.reply.updatedDate};f={reviewId:n.reviewId,ratingViewModelDetails:n.ratingViewModelDetails,readMoreData:n.readMoreData,updatedDate:n.updatedDate,userName:n.userName,userImageSrcLink:n.userImageSrcLink,publisherReply:u};i.itemReviewsDetails.replace(n,f);i._koWaitForPublisherReply(!1);w.getService().fire(t.EVENT_ON_PUBLISHER_REPLY_COMPLETE);e={Event:ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.CLICK_PUBLISHER_REPLY_FORM_SUBMIT_BUTTON,ExtensionName:i._vssDetailedItem.title,PublisherName:i._vssDetailedItem.publisherName,NumberofReviews:null,AverageRating:null,Rating:null,HasReviewText:null,ProductType:v.ItemModelHelper.getItemTypeText(i._vssDetailedItem.itemType)};ft.TelemetryHelper.publishEvent(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.RATING,e,!1);i._publisherReplyCreated.resolve(null)},function(n){i._koWaitForPublisherReply(!1);w.getService().fire(t.EVENT_ON_PUBLISHER_REPLY_COMPLETE);i._logTelemetry(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.ERROR_PUBLISHER_REPLY_SUBMIT,!1,!0,n.message);i._publisherReplyCreated.reject(n);alert(n.message)}),this._publisherReplyCreated.promise},t.prototype.createReview=function(){var n=this,i;if(this._currentUserReview&&this._currentUserReview.isDeleted)this.editReview();else return i=void 0,i={id:null,isDeleted:!1,productVersion:this._vssDetailedItem.version,rating:this.newRatingDetails.fixedFullStars(),text:this.newReviewText(),title:null,updatedDate:null,userId:y.getDefaultWebContext().user.id,userDisplayName:null,reply:null},this.waitForWriteReview(!0),this._vssGalleryDataProvider.createReview(i,this._vssDetailedItem.publisherName,this._vssDetailedItem.name).then(function(i){var f,r,u,e;i.text&&(f=y.getDefaultWebContext().user.name,n._insertItemReviewDetailsFront(i,f));n.isEditReview(!0);n._currentUserReview=i;r=n.totalReviewCount();u=(r*n._prevAvgRating+i.rating)/(r+1);n._prevAvgRating=u;n.totalReviewCount(r+1);n._updateAvgRatingStars(u);n.waitForWriteReview(!1);w.getService().fire(t.EVENT_ON_WRITE_REVIEW_COMPLETE);e={Event:ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.CLICK_WRITE_REVIEW_SUBMIT,ExtensionName:n._vssDetailedItem.title,PublisherName:n._vssDetailedItem.publisherName,NumberofReviews:n.totalReviewCount(),AverageRating:u,Rating:i.rating,HasReviewText:n.newReviewText()?!0:!1,ProductType:v.ItemModelHelper.getItemTypeText(n._vssDetailedItem.itemType)};ft.TelemetryHelper.publishEvent(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.RATING,e,!1);n.reviewsCreated.resolve(null)},function(i){n._logTelemetry(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.ERROR_WRITE_REVIEW_SUBMIT,!1,!0,i.message);n.waitForWriteReview(!1);w.getService().fire(t.EVENT_ON_WRITE_REVIEW_COMPLETE);n.reviewsCreated.reject(i);alert(i.message)}),this.reviewsCreated.promise},t.prototype._updateAvgRatingStars=function(n){n=n*1;var t=s.RatingControlViewModel.parseRating(n.toString(),s.RatingControlViewModel.TOTAL_RATING_STARS);this.avgRatingDetails.fullStars(t.fullStars);this.avgRatingDetails.halfStars(t.halfStars);this.avgRatingDetailsOnBanner.fullStars(t.fullStars);this.avgRatingDetailsOnBanner.halfStars(t.halfStars);this.averageRatingText(l.getAverageRatingText(n,this.totalReviewCount()))},t.prototype._getConcernTextAndCategory=function(n){var t;return t=n===0?k.ConcernCategory.Spam:k.ConcernCategory.Abusive,{category:t,concernText:tt.format(e.RatingAndReviewReportText,this.concernCategories[n])}},t.prototype.restoreWriteReviewFormData=function(){this._currentUserReview?(this.newReviewText(this._currentUserReview.text),this.newRatingDetails.fullStars(this._currentUserReview.rating)):(this.newReviewText(""),this.newRatingDetails.fullStars(0),this.newRatingDetails.fixedFullStars(0))},t.prototype.getFriendlyDateString=function(n){return nt.friendly(n)},t.prototype.onSeeMoreClick=function(){var n=this,i=this.itemReviewsDetails().length,r;return i>0&&(r=this.itemReviewsDetails()[i-1],this.waitForSeeMore(!0),this._vssGalleryDataProvider.getReviews(this._vssDetailedItem.publisherName,this._vssDetailedItem.name,this._pageSize,this._filterOptions,r.updatedDate).then(function(i){for(var u=i.reviews.length,f=i.reviews,r=0;r<u;r++)n._insertItemReviewDetailsRear(f[r]);n.totalReviewCount(i.totalReviewCount);n.hasMoreReviews(i.hasMoreReviews);n.waitForSeeMore(!1);n._logTelemetry(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.CLICK_SEE_MORE,!1,!1);w.getService().fire(t.EVENT_ON_SEE_MORE_CLICK);n.moreReviewsLoaded.resolve(null)},function(t){n.waitForSeeMore(!1);n._logTelemetry(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.ERROR_SEE_MORE,!1,!0,t.message);n.moreReviewsLoaded.reject(t);alert(t.message)})),this.moreReviewsLoaded.promise},t.prototype.flaggedReviewIndex=function(n){this.flagReviewIndex=n;w.getService().fire(t.EVENT_ON_REPORT_REVIEW,this);this.isUserAuthenticated&&this._logTelemetry(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.CLICK_REPORT_ABUSE,!1,!1)},t.prototype.cancelViolationDetails=function(){this._logTelemetry(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.CLICK_VIOLATION_CANCEL,!1,!1)},t.prototype.submitViolationDetails=function(n){var i=this,r,u,e=this.itemReviewsDetails()[this.flagReviewIndex].reviewId,f=this._getConcernTextAndCategory(n);return u={category:f.category,concernText:f.concernText,reviewId:null,submittedDate:new Date,userId:y.getDefaultWebContext().user.id},r={operation:k.ReviewPatchOperation.FlagReview,reportedConcern:u,reviewItem:null},this.waitForReportReview(!0),this._vssGalleryDataProvider.updateReview(r,this._vssDetailedItem.publisherName,this._vssDetailedItem.name,e).then(function(){i.reviewReportedSuccessfully=!0;i.waitForReportReview(!1);i._logTelemetry(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.CLICK_VIOLATION_SUBMIT,!1,!1);w.getService().fire(t.EVENT_ON_REVIEW_REPORTED,i);i.violationSubmited.resolve(null)},function(n){i._logTelemetry(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.ERROR_SUBMIT_VIOLATION,!1,!0,n.message);i.reviewReportedSuccessfully=!1;i.waitForReportReview(!1);w.getService().fire(t.EVENT_ON_REVIEW_REPORTED,i);i.violationSubmited.reject(n);alert(n.message)}),this.violationSubmited.promise},t.prototype.onPublisherReplyButtonClick=function(n){this.isUserAuthenticated&&(this.setupDataForPublisherReplyDialog(n),w.getService().fire(t.EVENT_ON_PUBLISHER_REPLY_OR_EDIT_BUTTON_CLICK),this._logTelemetry(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.CLICK_PUBLISHER_REPLY_BUTTON,!1,!1))},t.prototype.onPublisherReplyEditButtonClick=function(n){if(this.isUserAuthenticated){this.setupDataForPublisherReplyDialog(n);var i=this.itemReviewsDetails()[n];i.publisherReply!==undefined&&i.publisherReply!==null&&this._koPublisherReplyText(i.publisherReply.publisherReplyReadMore.getFullText());w.getService().fire(t.EVENT_ON_PUBLISHER_REPLY_OR_EDIT_BUTTON_CLICK);this._logTelemetry(ut.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.RatingAndReviewProperties.CLICK_PUBLISHER_REPLY_EDIT_BUTTON,!1,!1)}},t.prototype.setupDataForPublisherReplyDialog=function(n){this._publisherReplyReviewIndex=n;var t=this.itemReviewsDetails()[n];this._koPublisherReplyFormUserImageSrcLink(t.userImageSrcLink);this._koPublisherReplyFormUserName(t.userName);this._koPublisherReplyFormReviewUpdatedDate(this.getFriendlyDateString(t.updatedDate));this._koPublisherReplyFormReviewText(t.readMoreData.getLessText());this._koPublisherReplyFormUserRating(t.ratingViewModelDetails);this._koPublisherReplyText("")},t.prototype.canShowPublisherReplyButton=function(n){return this._hasPermissionsForPublisherReply&&!this.publisherReplyExistsForReview(n)},t.prototype.canShowPublisherReplyEditButton=function(n){return this._hasPermissionsForPublisherReply&&this.publisherReplyExistsForReview(n)},t.prototype.publisherReplyExistsForReview=function(n){var t=!1,i=this.itemReviewsDetails()[n];return i.publisherReply!==undefined&&i.publisherReply!==null&&(t=!0),t},t.EVENT_ON_WRITE_REVIEW="VSS.Gallery.RatingReview.OnWriteReview",t.EVENT_ON_REPORT_REVIEW="VSS.Gallery.RatingReview.OnReportReview",t.EVENT_ON_REVIEW_REPORTED="VSS.Gallery.RatingReview.OnReviewReported",t.EVENT_ON_WRITE_REVIEW_COMPLETE="VSS.Gallery.RatingReview.OnWriteReviewComplete",t.EVENT_AFTER_REVIEW_REPORTED="VSS.Gallery.RatingReview.AfterReviewReported",t.EVENT_ON_SEE_MORE_CLICK="VSS.Gallery.RatingReview.OnSeeMoreClick",t.EVENT_ON_PUBLISHER_REPLY_OR_EDIT_BUTTON_CLICK="VSS.Gallery.RatingReview.OnPublisherReplyOrEditButtonClick",t.EVENT_ON_PUBLISHER_REPLY_COMPLETE="VSS.Gallery.RatingReview.OnPublisherReplyComplete",t.SHOW_REVIEW_DIALOG="showReviewDialog",t.SHOW_REPORT_REVIEW_DIALOG="showReportReviewDialog",t.MAX_REVIEWTEXT_CHAR=2e3,t.MAX_REVIEWREPLYTEXT_CHAR=t.MAX_REVIEWTEXT_CHAR,t.READ_MORE_CHARACTER_LIMIT=200,t}(g.TemplateViewModel);t.RatingAndReviewDetailsViewModel=ot});
define("VSS/Contributions/Services",["require","exports","q","VSS/Common/Constants/Platform","VSS/WebApi/Constants","VSS/Context","VSS/Common/Contracts/Platform","VSS/Contributions/Contracts","VSS/Diag","VSS/FeatureAvailability/Services","VSS/Locations","VSS/Resources/VSS.Resources.Platform","VSS/Serialization","VSS/Service","VSS/Telemetry/Services","VSS/Utils/File","VSS/Utils/String","VSS/VSS"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){function rt(n,t){return b.requireModules(["VSS/Contributions/RestClient"]).spread(function(i){var h=n.getWebContext(),r,s,o;return!f.getPageContext().navigation.area&&f.getPageContext().webAccessConfiguration.isHosted&&(h.host.hostType&e.ContextHostType.Application)!=0?(r=$.extend(!0,{},h),r.host.relativeUri="/DefaultCollection/",r.host.hostType=e.ContextHostType.ProjectCollection,r.host.uri=r.host.uri+"DefaultCollection/",r.host.name="DefaultCollection",r.collection={id:r.host.id,name:r.host.name,relativeUri:r.host.relativeUri,uri:r.host.uri},s=f.getPageContext().serviceLocations,s&&s.locations&&(o=s.locations[u.ServiceInstanceTypes.SPS],o&&o[e.ContextHostType.Application]&&!o[e.ContextHostType.ProjectCollection]&&(o[e.ContextHostType.ProjectCollection]=o[e.ContextHostType.Application]+"DefaultCollection/")),v.getCollectionClient(i.ContributionsHttpClient,r,t)):n.getHttpClient(i.ContributionsHttpClient,t)})}var tt,d,k,nt,it,g;(function(n){n.CONTRIBUTIONS_AREA="Microsoft.VisualStudio.Services.Contributions";n.CONTRIBUTIONS_USAGE_FEATURE="ContributionUsage";n.CONTRIBUTIONS_ACTION="Action";n.CONTRIBUTIONS_ACTION_EXECUTE="Execute"})(tt=t.CustomerIntelligenceConstants||(t.CustomerIntelligenceConstants={})),function(n){n[n.IncludeRoot=1]="IncludeRoot";n[n.IncludeDirectTargets=2]="IncludeDirectTargets";n[n.IncludeRecursiveTargets=4]="IncludeRecursiveTargets";n[n.IncludeAll=7]="IncludeAll"}(t.ContributionQueryOptions||(t.ContributionQueryOptions={}));d=t.ContributionQueryOptions,function(n){n[n.None=0]="None";n[n.Include=1]="Include";n[n.Recurse=2]="Recurse";n[n.IncludeAndRecurse=3]="IncludeAndRecurse"}(t.ContributionQueryCallbackResult||(t.ContributionQueryCallbackResult={}));k=t.ContributionQueryCallbackResult;nt=function(n){function t(){n.call(this);this._extensions={};this._contributionsById={};this._contributionsByTargetId={};this._targetsByUnresolvedContributionId={};this._loadedContributionTargets={};this._contributionQueryPromises={}}return __extends(t,n),t.prototype.initializeConnection=function(t){n.prototype.initializeConnection.call(this,t);this._webPageDataService=this.getConnection().getService(it);f.getDefaultWebContext()===t.getWebContext()&&this._processJsonIsland()},t.prototype.registerExtension=function(n){var t=this;this._extensions[n.publisherId+"."+n.extensionId]=n;n.contributions&&n.contributions.forEach(function(i){i.extension=n;t._contributionsById[i.id]=i;var r=t._targetsByUnresolvedContributionId[i.id];r&&r.length>0&&(r.forEach(function(n){t._registerContributionTarget(i,n)}),delete t._targetsByUnresolvedContributionId[i.id]);i.targets&&i.targets.forEach(function(n){t._registerContributionTarget(i,n)});i.includes&&i.includes.forEach(function(n){var u=t._contributionsById[n],r;u?t._registerContributionTarget(u,i.id):(r=t._targetsByUnresolvedContributionId[n],r||(r=[],t._targetsByUnresolvedContributionId[n]=r),r.push(i.id))});i.properties||(i.properties={})})},t.prototype.getContribution=function(n){return this.getContributions([n],!0,!1).then(function(t){if(t.length===0)throw w.format("Contribution with id '{0}' could not be found.",n);else return t[0]})},t.prototype.getContributionsForTarget=function(n,t){return this.getContributions([n],!1,!0,!1,t)},t.prototype.getContributionsForTargets=function(n,t){return this.getContributions(n,!1,!0,!1,t)},t.prototype.getContributions=function(n,t,i,r,u){r===void 0&&(r=!1);u===void 0&&(u=null);var f=0;return t&&(f|=d.IncludeRoot),i&&(f|=d.IncludeDirectTargets),r&&(f|=d.IncludeRecursiveTargets),this.queryContributions(n,f,u)},t.prototype.getExtensionForContribution=function(n){return this._extensions[g.getPublisherId(n)+"."+g.getExtensionId(n)]},t.prototype.queryContributions=function(n,r,u,f){var e=this,c;if(h.FeatureAvailabilityService.isFeatureEnabled(t._testExecutionFeatureFlag,!1))return i.resolve([]);var o=this._getUnqueriedContributions(n),s=i.defer(),l=this._getPendingLoadPromises(n),a=function(){l.length>0?i.all(l).then(function(){e._resolveContributions(s,e._getLoadedContributions(n,r,u,f))},s.reject):e._resolveContributions(s,e._getLoadedContributions(n,r,u,f))};return o.length>0?(c=rt(this.getConnection()).then(function(n){return n.getInstalledExtensions(o,!1)}),$.each(o,function(n,t){e._contributionQueryPromises[t]=c}),c.then(function(n){$.each(o,function(n,t){e._loadedContributionTargets[t]=!0});$.each(n,function(n,t){e.registerExtension(t);e._registerLoadedContributionTargets(t.contributions)});$.each(o,function(n,t){delete e._contributionQueryPromises[t]});a()},function(n){$.each(o,function(n,t){delete e._contributionQueryPromises[t]});s.reject(n)})):a(),s.promise},t.prototype.isExtensionActive=function(n){var t=n.split(".");return rt(this.getConnection()).then(function(n){return n.getInstalledExtensionByName(t[0],t[1]).then(function(n){return n!==null},function(){return!1})})},t.prototype._resolveContributions=function(n,t){if(!t.length){n.resolve(t);return}var i=this._getLoadedContributions(t.map(function(n){return n.id}),d.IncludeAll,r.DataProviderConstants.DataProviderContributionTypeId);i.length?this._webPageDataService.ensureDataProvidersResolved(i).then(function(){n.resolve(t)},n.reject):n.resolve(t)},t.prototype._getUnqueriedContributions=function(n){var t=this;return $.grep(n,function(n){return t._loadedContributionTargets[n]||t._contributionQueryPromises[n]?!1:!0})},t.prototype._getPendingLoadPromises=function(n){var i=this,t=[];return $.each(n,function(n,r){var u=i._contributionQueryPromises[r];u&&t.push(u)}),t},t.prototype._getLoadedContributions=function(n,t,i,r){var e=this,u=[],f={},o=[],s;return $.each(n,function(n,s){var c=e._contributionsById[s],h;c&&!f[s]&&(h=k.None,r==null?((t&d.IncludeRoot)!=0&&(h|=k.Include),((t&d.IncludeDirectTargets)!=0||(t&d.IncludeRecursiveTargets)!=0)&&(h|=k.Recurse)):h=r(c),f[s]=!0,(h&k.Include)!=0&&(!i||g.isContributionOfType(c,i))&&u.push(c),(h&k.Recurse)!=0&&o.push(s))}),s=r==null?(t&d.IncludeRecursiveTargets)!=0?function(){return k.IncludeAndRecurse}:function(){return k.Include}:r,$.each(o,function(n,t){e._fetchTargetingContributions(t,u,f,s,i)}),u},t.prototype._fetchTargetingContributions=function(n,t,i,r,u){var e=this,f=this._contributionsByTargetId[n];f&&$.each(f,function(n,f){var o=f.id,s;i[o]||(i[o]=!0,s=r(f),(s&k.Include)!=0&&(!u||g.isContributionOfType(f,u))&&t.push(f),(s&k.Recurse)!=0&&e._fetchTargetingContributions(o,t,i,r,u))})},t.prototype._registerLoadedContributionTargets=function(n){var t=this;$.each(n,function(n,i){t._loadedContributionTargets[i.id]=!0})},t.prototype._processJsonIsland=function(){var i=this,n=a.deserializeJsonIsland($(".vss-contribution-data"),null),t;n&&(t=a.ContractSerializer.deserialize(n.extensions,o.TypeInfo.InstalledExtension,!1),t&&t.length&&$.each(t,function(n,t){i.registerExtension(t);i._registerLoadedContributionTargets(t.contributions)}),n.queriedContributionIds&&$.each(n.queriedContributionIds,function(n,t){i._loadedContributionTargets[t]=!0}))},t.prototype._registerContributionTarget=function(n,t){var i=this._contributionsByTargetId[t];i||(i=[],this._contributionsByTargetId[t]=i);i.indexOf(n)<0&&i.push(n)},t._testExecutionFeatureFlag="VisualStudio.Services.Contribution.TestExecution",t}(v.VssService);t.ExtensionService=nt;it=function(n){function t(){n.apply(this,arguments);this._resolvedProviders={};this._contributionPromises={};this._contributionIdsByDataType={}}return __extends(t,n),t.prototype._ensureInitialized=function(){var n,t,u,f;return this._initializationPromise||(this._localData={},n=a.deserializeJsonIsland($(".vss-web-page-data"),null),n?(t=[],u=a.deserializeJsonIsland($(".vss-contribution-data"),null),u&&(f=a.ContractSerializer.deserialize(u.extensions,o.TypeInfo.InstalledExtension,!1),f&&f.forEach(function(n){n.contributions.forEach(function(n){w.equals(n.type,r.DataProviderConstants.DataProviderContributionTypeId,!0)&&t.push(n)})})),this._initializationPromise=this._handleDataProviderResult(n,t)):this._initializationPromise=i.resolve(null)),this._initializationPromise},t.prototype._handleDataProviderResult=function(n,u){var f=this,e,o;return n.resolvedProviders&&n.resolvedProviders.forEach(function(n){f._resolvedProviders[n.id]=n;n.error&&s.logWarning(w.format(l.DataProviderFailureMessageFormat,n.id,n.error))}),e=[],n.data&&(o={},$.each(u,function(n,t){t.properties&&t.properties[r.DataProviderConstants.ContributionDataTypeProperty]&&(o[t.id]=t.properties[r.DataProviderConstants.ContributionDataTypeProperty])}),$.each(n.data,function(n,i){var l=f._localData[n],s,a,h=o[n],u,c;h?(u=f._contributionIdsByDataType[h],u||(u=[],f._contributionIdsByDataType[h]=u),u.push(n),s=t._resolveDataPlugins[h]):n===r.ContributedServiceContextData.ContributedServiceContextDataKey&&(s=f._compatServiceContextPlugin.bind(f));s&&(a=s(n,i,l));c=f._mergeDataValueResult(n,i,a,l,!0);c&&e.push(c)})),i.allSettled(e)},t.prototype._compatServiceContextPlugin=function(n,t){var r=a.ContractSerializer.deserialize(t,e.TypeInfo.ContributedServiceContext),u;return r&&$.isArray(r)?(u=[],$.each(r,function(n,t){t&&u.push(f.processContributedServiceContext(t))}),i.allSettled(u)):null},t.prototype._mergeDataValueResult=function(n,t,r,u,f){var o=this,e;return f&&i.isPromise(r)?r.then(function(i){o._mergeDataValueResult(n,t,i,u,!1)}):(e=typeof r=="undefined"?t:r,e&&($.isArray(u)&&$.isArray(e)?e=[].concat(u,e):typeof u=="object"&&typeof e=="object"&&(e=$.extend(u,e))),this._localData[n]=e,null)},t.addResolutionPlugin=function(n,i){t._resolveDataPlugins[n]=i},t.removeResolutionPlugin=function(n){delete t._resolveDataPlugins[n]},t.prototype.getPageData=function(n,t){this._ensureInitialized();var i=this._localData[n];return i&&t?a.ContractSerializer.deserialize(i,t,!1):i},t.prototype.getPageDataByDataType=function(n,t){var e={},r,i,u,f;if(this._ensureInitialized(),r=this._contributionIdsByDataType[n],r)for(i=0,u=r;i<u.length;i++)f=u[i],e[f]=this.getPageData(f,t);return e},t.prototype.ensureDataProvidersResolved=function(n){var t=this;return this._ensureInitialized().then(function(){var f={},u;return n=n.filter(function(n){return!t._resolvedProviders[n.id]}),u=[],n.forEach(function(n){var o=t._contributionPromises[n.id],e,i;o?u.push(o):(e=(n.properties[r.DataProviderConstants.ContributionInstanceTypeProperty]||"").toLowerCase(),i=f[e],i||(i=[],f[e]=i),i.push(n))}),$.each(f,function(n,i){var r=t.fetchPageDataForService(n,i);i.forEach(function(n){t._contributionPromises[n.id]=r});u.push(r)}),i.allSettled(u)})},t.prototype.fetchPageDataForService=function(n,t){var u=this,i=f.getPageContext(),r=f.getHubsContext(),e={contributionPaths:i.moduleLoaderConfig.contributionPaths?Object.keys(i.moduleLoaderConfig.contributionPaths):null,diagnostics:i.diagnostics,navigation:i.navigation,project:i.webContext.project,selectedHubGroupId:r?r.selectedHubGroupId:null,selectedHubId:r?r.selectedHubId:null,team:i.webContext.team,url:window.location.href},o={contributionIds:t.map(function(n){return n.id}),context:{properties:{pageSource:e}}};return rt(this.getConnection(),n).then(function(n){return n.queryDataProviders(o).then(function(n){return u._handleDataProviderResult(n,t)})})},t._resolveDataPlugins={},t}(v.VssService);t.WebPageDataService=it;it.addResolutionPlugin(r.ContributedServiceContextData.ContributedServiceDataProviderType,function(n,t){if(t){var i=a.ContractSerializer.deserialize(t,e.TypeInfo.ContributedServiceContext);return f.processContributedServiceContext(i)}});g=function(){function n(){}return n.getFullContributionId=function(n){return n.id},n.getExtensionId=function(n){return n.id.split(".")[1]},n.getPublisherId=function(n){return n.id.split(".")[0]},n.isContributionOfType=function(n,t){return w.equals(n.type,t,!0)},n.isContributionTrusted=function(n){var t=v.getService(nt).getExtensionForContribution(n);return(t.flags&o.ExtensionFlags.Trusted)!=0},n.hasInternalContent=function(t){return n.isContributionTrusted(t)&&!!t.properties.content},n.hasContent=function(t,i){return i===void 0&&(i="uri"),!!t.properties[i]||n.hasInternalContent(t)},n._registerHandlebarHelpers=function(t){t.registerHelper("ServiceUrl",function(t,i){var o,r=f.getDefaultWebContext(),l=r.host.hostType,h=function(n){return w.localeIgnoreCaseComparer(n,"Deployment")===0?e.ContextHostType.Deployment:w.localeIgnoreCaseComparer(n,"Application")===0?e.ContextHostType.Application:w.localeIgnoreCaseComparer(n,"ProjectCollection")===0?e.ContextHostType.ProjectCollection:undefined},s;return i&&typeof i=="string"?i=h(i):t&&typeof t=="string"?(i=h(t),i&&(t=undefined)):(t=undefined,i=undefined),i=i||l,t=t||this[u.ExtensionTemplateContextItemNames.ServiceInstanceType],o=t&&f.getPageContext().webAccessConfiguration.isHosted?c.getCachedServiceLocation(t,i,r)||"":i===e.ContextHostType.ProjectCollection&&r.collection?n.resolveDefaultHostUri(r,r.collection):i===e.ContextHostType.Application&&r.account?n.resolveDefaultHostUri(r,r.account):n.resolveDefaultHostUri(r,r.host),o?o:(s=n._asyncReplacementCounter++,n._asyncReplacementPromises[s]=v.VssConnection.getConnection().beginGetServiceUrl(t,i,!0),n._asyncReplacementIndicator+s+";")})},n.resolveDefaultHostUri=function(n,t){return f.getPageContext().webAccessConfiguration.isHosted||window.top!==window.self?t.uri:p.combinePaths(window.location.protocol+"//"+window.location.host,encodeURI(t.relativeUri))},n.handleAsyncReplacements=function(t,i,r,u){i===r?u.resolve(t):n._asyncReplacementPromises[i].then(function(f){t=t.replace(n._asyncReplacementIndicator+i+";",f);n.handleAsyncReplacements(t,i+1,r,u)},function(){u.resolve(t)})},n.resolveTemplateString=function(t,r){var u=i.defer();return t?(r||(r={}),r&&t.indexOf("{{")>=0?b.using(["handlebars"],function(i){n._handlebarHelpersRegistered||(n._handlebarHelpersRegistered=!0,n._registerHandlebarHelpers(i));var f=n._asyncReplacementCounter;try{t=i.compile(t)(r)}catch(e){}n.handleAsyncReplacements(t,f,n._asyncReplacementCounter,u)}):u.resolve(t),u.promise):i.resolve(t)},n.resolveUriTemplate=function(t,r,u){var f=i.defer();return this.resolveTemplateString(t,r).then(function(t){n._httpUrlRegex.test(t)||!u?f.resolve(t):n.resolveTemplateString(u,r).then(function(n){f.resolve(p.combinePaths(n,t))},f.reject)},f.reject),f.promise},n.resolveUriTemplateProperty=function(t,r,f){var o,e;return f===void 0&&(f="uri"),o=t.properties[f],typeof o=="undefined"?i.resolve(null):(e=v.getService(nt).getExtensionForContribution(t),e)?(e.serviceInstanceType&&(r=r||{},r[u.ExtensionTemplateContextItemNames.ServiceInstanceType]=e.serviceInstanceType),n.resolveUriTemplate(o,r,e.baseUri)):i.resolve(o)},n.publishTraceData=function(t,i,r){t?n.publishData(t,i):r&&v.getService(nt).getContribution(r).then(function(t){t&&n.publishData(t,i)})},n.publishData=function(t,i){var r=n.getPublisherId(t),u={Action:tt.CONTRIBUTIONS_ACTION_EXECUTE,PublisherId:r,ExtensionId:r+"."+n.getExtensionId(t),ContributionId:t.id,ContributionData:i,Type:t.type};y.publishEvent(new y.TelemetryEventData(tt.CONTRIBUTIONS_AREA,tt.CONTRIBUTIONS_USAGE_FEATURE,u))},n._httpUrlRegex=/^[a-z][a-z0-9+.-]*:/i,n._handlebarHelpersRegistered=!1,n._asyncReplacementIndicator="__AsyncReplacement__",n._asyncReplacementCounter=0,n._asyncReplacementPromises={},n}();t.ExtensionHelper=g;b.tfsModuleLoaded("VSS.Contributions",t)});
define("VSS/Controls/Notifications",["require","exports","VSS/Controls","VSS/Diag","VSS/Events/Services","VSS/Resources/VSS.Resources.Platform","VSS/Utils/Core","VSS/Utils/String","VSS/Utils/UI","VSS/LoaderPlugins/Css!VSS.Controls"],function(n,t,i,r,u,f,e,o,s){var w=e.delegate,h=s.domElem,c,a,l,v,y,p;(function(n){n[n.None=0]="None";n[n.Info=1]="Info";n[n.Warning=2]="Warning";n[n.Error=3]="Error"})(t.MessageAreaType||(t.MessageAreaType={}));c=t.MessageAreaType;a=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({closeable:!0,expanded:!1,showIcon:!1,showDetailsLink:!0,showHeader:!0,noHeaderNoLinkJustIcon:!1},t))},t.prototype.initialize=function(){var t,e=this,n,r,u,i,f;this.getElement().addClass("message-area-control");this.getElement().addClass("bowtie");n=this._options.message?this._options.message.type:this._options.type;this._options.showIcon&&n!=c.None&&n!=c.Error&&(r=$(h("div")).appendTo(this.getElement()).addClass("message-icon"),u=$("<span>").addClass("icon").appendTo(r),n==c.Info?i="icon-info":n==c.Warning&&(i="bowtie-icon bowtie-status-warning"),u.addClass(i));this._options.showHeader&&(t=$(h("div")).appendTo(this.getElement()).addClass("message-header"),this._errorHeader=$(h("span")).appendTo(t));this._options.showDetailsLink&&(this._showErrorLink=$(h("a")).appendTo(t).addClass("linkAction show-details-action").attr("href","#").click(function(){return e._toggle(),!1}));f=$(h("div")).appendTo(this.getElement()).addClass("close-action bowtie-icon bowtie-navigate-close ").click(w(this,this.clear));s.accessible(f);this._errorContent=$(h("div")).appendTo(this.getElement());this._options.noHeaderNoLinkJustIcon||this._errorContent.addClass("error-content");this.getElement().hide();this._messageType=c.None;this._options.message&&this.setMessage(this._options.message);this._options.fillVertical&&this.getElement().css("height","100%")},t.prototype.setMessage=function(n,t){(typeof n=="string"||n&&n.jquery)&&(n={header:n});n.type||(n.type=t||c.Error);this._setDisplayMessage(n)},t.prototype.setError=function(n,t){(typeof n=="string"||n&&n.jquery)&&(n={header:n});n.type=c.Error;!n.click&&$.isFunction(t)&&(n.click=t);this.setMessage(n)},t.prototype.getMessageType=function(){return this._messageType},t.prototype.clear=function(){this._clear(!0)},t.prototype._setDisplayMessage=function(n){var i=this,t;this._options.closeable?this.getElement().addClass("closeable"):this.getElement().removeClass("closeable");this._clear(!1);this._messageType=this._options.message&&this._options.message.type?this._options.message.type:n.type;this._options.showHeader&&(n.header&&n.header.jquery?this._errorHeader.append(n.header):this._errorHeader.text(n.header));n.content?(n.content.jquery?this._errorContent.append(n.content):this._errorContent.text(n.content),this._options.showDetailsLink&&(this.setErrorDetailsVisibility(this._options.expanded),this._showErrorLink.show())):(this._errorContent.hide(),this._options.showDetailsLink&&this._showErrorLink.hide());switch(this._messageType){case c.Info:this.getElement().addClass("info-message");break;case c.Warning:this.getElement().addClass("warning-message");break;case c.Error:this.getElement().addClass("error-message")}this._options.hidden||(this.getElement().addClass("visible"),this.getElement().show());n.click&&(t=function(){n.click();i.clear()},this._errorHeader.addClass("clickable"),this._errorHeader.click(t),this._errorHeader.keydown(function(n){if(n.keyCode===s.KeyCode.ENTER)return t(),!1}));this._raiseDisplayComplete()},t.prototype._toggle=function(){this._errorContent.is(":visible")?(this.setErrorDetailsVisibility(!1),this._fire(l.ERROR_DETAILS_TOGGLED,{show:!1})):(this.setErrorDetailsVisibility(!0),this._fire(l.ERROR_DETAILS_TOGGLED,{show:!0}));this._raiseDisplayComplete()},t.prototype.setErrorDetailsVisibility=function(n){n?(this._showErrorLink.text(f.HideDetails),this._errorContent.show()):(this._showErrorLink.text(f.ShowDetails),this._errorContent.hide())},t.prototype._clear=function(n){if(this._options.showHeader){if(this._errorHeader.text().length===0)return;this._errorHeader.text("");this._errorHeader.unbind("click");this._errorHeader.removeClass("clickable")}switch(this._messageType){case c.Info:this.getElement().removeClass("info-message");break;case c.Warning:this.getElement().removeClass("warning-message");break;case c.Error:this.getElement().removeClass("error-message")}this._messageType=c.None;this._errorContent.text("");this.getElement().removeClass("visible");this.getElement().hide();n&&this._raiseDisplayComplete();this._fire(l.EVENT_DISPLAY_CLEARED);u.getService().fire(l.EVENT_DISPLAY_CLEARED)},t.prototype._raiseDisplayComplete=function(){this._fire(l.EVENT_DISPLAY_COMPLETE)},t.EVENT_DISPLAY_COMPLETE="event-display-complete",t.EVENT_DISPLAY_CLEARED="event-display-cleared",t.ERROR_DETAILS_TOGGLED="error-details-toggled",t}(i.Control);t.MessageAreaControlO=a;l=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(a);t.MessageAreaControl=l;v=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.initializeOptions=function(t){t&&(this._collapsed=!!t.collapsed);n.prototype.initializeOptions.call(this,$.extend({coreCssClass:"information-area-control",expandedIconClass:"content-expanded",collapsedIconClass:"content-collapsed"},t))},t.prototype.initialize=function(){var n=this,i=this,t=$(h("div","information-header")).appendTo(this.getElement()).click(function(){n._updateCollapsedState(!n._collapsed)});this._$collapseIndicator=$(h("div","icon collapse-indicator")).appendTo(t);this._$caption=$(h("div","information-caption")).appendTo(t).text(this._options.caption);this._$content=$(h("div","information-content")).appendTo(this.getElement());this._updateCollapsedState(this._collapsed)},t.prototype.appendDetailHeaderContent=function(n){$(h("div","detail-header")).appendTo(this._$content).append(n)},t.prototype.appendDetailContent=function(n){$(h("div","detail-content")).appendTo(this._$content).append(n)},t.prototype.appendCodeContent=function(n){$(h("div","code-content")).appendTo(this._$content).append(n)},t.prototype.appendDetailHeaderHtml=function(n){$(h("div","detail-header")).appendTo(this._$content).html(n)},t.prototype.appendDetailHtml=function(n){$(h("div","detail-content")).appendTo(this._$content).html(n)},t.prototype.appendCodeHtml=function(n){$(h("div","code-content")).appendTo(this._$content).html(n)},t.prototype._updateCollapsedState=function(n){n?(this._$collapseIndicator.removeClass(this._options.expandedIconClass),this._$collapseIndicator.addClass(this._options.collapsedIconClass),this._$content.hide()):(this._$collapseIndicator.removeClass(this._options.collapsedIconClass),this._$collapseIndicator.addClass(this._options.expandedIconClass),this._$content.show());this._collapsed=n},t}(i.Control);t.InformationAreaControlO=v;y=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(v);t.InformationAreaControl=y;p=function(n){function t(t){n.call(this,t)}return __extends(t,n),t.prototype.initialize=function(){var t=this,n=this.getElement(),r;n.hide();this._processOptions();r=$("<div>").appendTo(n);this._messageArea=i.Enhancement.enhance(l,r,{closeable:!1,fillVertical:!0});this._toasting=!1;this._bind(n,"mouseover",function(){t._delayedFunction.cancel();n.stop(!0);n.fadeIn(0)});this._bind(n,"mouseout",function(){t._delayedFunction=e.delay(t,t._toastTime,function(){n.fadeOut(t._fadeOutTime,function(){t._toasting=!1})})})},t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({coreCssClass:"toast-notification"},t))},t.prototype._processOptions=function(){var n=this._getOptions(),t=this.getElement();t.width(n.width);t.css("min-height",n.minHeight);this._fadeInTime=n.fadeInTime;this._fadeOutTime=n.fadeOutTime;this._toastTime=n.toastTime},t.prototype._getOptions=function(){return $.extend(this._getDefaultOptions(),this._options)},t.prototype._getDefaultOptions=function(){return{width:280,fadeInTime:1e3,fadeOutTime:1e3,toastTime:5e3}},t.prototype.toast=function(n,t){var r=this,i;t===void 0&&(t=c.Info);this._ensureNoActiveToast();this._toasting=!0;this._messageArea.setMessage(n,t);i=this.getElement();i.fadeIn(this._fadeInTime);this._delayedFunction=e.delay(this,this._toastTime,function(){i.fadeOut(r._fadeOutTime,function(){r._toasting=!1})})},t.prototype._ensureNoActiveToast=function(){this._toasting&&(this.getElement().stop().hide(),this._delayedFunction.cancel())},t}(i.BaseControl);t.ToastNotification=p});
define("VSS/SDK/Host",["require","exports","VSS/Context","VSS/Contributions/Services","q","VSS/Service","VSS/VSS"],function(n,t,i,r,u,f,e){var o=function(){function n(n){this._serviceOptions=n}return n.prototype.getContribution=function(n){return f.getService(r.ExtensionService).getContribution(n)},n.prototype.getContributionsForTarget=function(n){return f.getService(r.ExtensionService).getContributionsForTarget(n)},n.prototype.getServiceContribution=function(n){var t=this;return this.getContribution(n).then(function(n){return $.extend({getInstance:function(i,r){return t.getBackgroundContributionInstance(n,i,r)}},n)})},n.prototype.getServiceContributions=function(n){var t=this;return this.getContributionsForTarget(n).then(function(n){return $.map(n,function(n){return $.extend({getInstance:function(i,r){return t.getBackgroundContributionInstance(n,i,r)}},n)})})},n.prototype.getBackgroundContributionInstance=function(n,t,r){var f=this;return u.Promise(function(u,o){e.using(["VSS/Contributions/Controls"],function(e){e.getBackgroundInstance(n,t||n.id,$.extend(r,{hostManagementServiceOptions:f._serviceOptions}),i.getPageContext().webContext).then(u,o)})})},n}();t.HostManagementService=o});
define("VSS/Contributions/Controls",["require","exports","q","VSS/Authentication/Services","VSS/Context","VSS/Common/Contracts/Platform","VSS/Common/Constants/Platform","VSS/Contributions/Services","VSS/Controls","VSS/Diag","VSS/FeatureAvailability/Services","VSS/Locations","VSS/Controls/Notifications","VSS/Resources/VSS.Resources.Platform","VSS/SDK/Host","VSS/SDK/Shim","VSS/SDK/XDM","VSS/Service","VSS/Controls/StatusIndicator","VSS/Utils/Core","VSS/Utils/File","VSS/Utils/String","VSS/Utils/UI","VSS/Resources/VSS.Resources.Platform","VSS/VSS"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt){function vt(n,t,i,r,u,f){return r===void 0&&(r=null),f===void 0&&(f=null),u||(u="__contributedControlInstance"+at++,i=$.extend({},i,{contributedControlInstanceId:u})),et(n,t,i||{},r,null,null,"uri",!1,f).then(function(n){return n.getRegisteredInstance(u)})}function et(n,t,i,r,f,e,s,h,c){r===void 0&&(r=null);e===void 0&&(e=null);s===void 0&&(s="uri");h===void 0&&(h=!1);c===void 0&&(c=null);r||(r=u.getDefaultWebContext());e||(e=r);var l=function(t){return o.ExtensionHelper.resolveUriTemplateProperty(t,e,s).then(function(r){return ot(n,r,t,i,f,h,c)})};return typeof t=="string"?b.getService(o.ExtensionService,r).getContribution(t).then(function(n){return l(n)}):l(t)}function ot(n,t,i,r,u,f,e){return f===void 0&&(f=!1),e===void 0&&(e=null),ht(n,i,t,r,u,!1,f,e)}function st(n,t,i,r){t===void 0&&(t=null);i===void 0&&(i=null);r===void 0&&(r="uri");t||(t=u.getDefaultWebContext());i||(i=t);var f=function(n){return o.ExtensionHelper.resolveUriTemplateProperty(n,i,r).then(function(t){return ht(null,n,t,null,null,!0,!1,null)})};return typeof n=="string"?b.getService(o.ExtensionService,t).getContribution(n).then(function(n){return f(n)}):f(n)}function yt(n,t,r,u,f,e,o,s){u===void 0&&(u=null);o===void 0&&(o=null);s===void 0&&(s="uri");var h=st(n,u,o,s).then(function(n){return n.getRegisteredInstance(t,r)});return f>0&&(h=i.timeout(h,f,e)),h}function ht(n,t,i,r,u,f,e,h){var l=o.ExtensionHelper.isContributionTrusted(t),c=!1;if(l&&t.properties.content)c=!0;else if(!i)throw new Error('No uri was specified for contribution "'+t.id+'". Cannot create extension host.');return f?lt.getHost(i,t,c,r,u):c?new ft(t,r,n):s.create(ut,n,{uri:i,contribution:t,interactive:!t.properties.external,initialConfig:r,postContent:u,contributionHostBehavior:h})}var ut=function(n){function t(i){n.call(this,i);this.setEnhancementOptions({coreCssClass:"external-content-host"});this._contributions=[];this._contributionHostBehavior={showErrorIndicator:!0,showLoadingIndicator:!0,slowWarningDurationMs:t.DEFAULT_SLOW_LOAD_DURATION}}return __extends(t,n),t.prototype.getLoadPromise=function(){return this._loadedDeferred.promise},t.prototype.initialize=function(){var n=this;this._options.contributionHostBehavior&&(this._options.contributionHostBehavior.showErrorIndicator!==undefined&&this._options.contributionHostBehavior.showErrorIndicator!==null&&(this._contributionHostBehavior.showErrorIndicator=this._options.contributionHostBehavior.showErrorIndicator),this._options.contributionHostBehavior.showLoadingIndicator!==undefined&&this._options.contributionHostBehavior.showLoadingIndicator!==null&&(this._contributionHostBehavior.showLoadingIndicator=this._options.contributionHostBehavior.showLoadingIndicator),this._options.contributionHostBehavior.slowWarningDurationMs!==undefined&&this._options.contributionHostBehavior.slowWarningDurationMs!==null&&(this._contributionHostBehavior.slowWarningDurationMs=this._options.contributionHostBehavior.slowWarningDurationMs));this._$container=$("<div />").addClass("external-content-host-container").appendTo(this._element);this._loadedDeferred=i.defer();u.getPageContext().webAccessConfiguration.isHosted||!tt.BrowserCheckUtils.isLessThanOrEqualToIE9()||c.FeatureAvailabilityService.isFeatureEnabled(e.WebPlatformFeatureFlags.VisualStudioServicesContributionUnSecureBrowsers,!1)?this._getInDomPromise().then(function(){n._finishInitialization()}):this._showExtensionMessage(a.MessageAreaType.Warning,it.ExtensionsNotAvailableOnpremOldIE,!1,null,!1)},t.prototype._finishInitialization=function(){var n=this,i,r="externalContentHost"+s.getId();this._options.postContent&&(i=$("<form />").attr("method","post").attr("target",r).attr("action",this._options.uri).appendTo(this._$container),$("<input />").attr("type","hidden").attr("name","requestJson").attr("value",JSON.stringify(this._options.postContent)).appendTo(i));this._$iframe=$("<iframe frameborder='0' src=\"javascript:''\" />").addClass("external-content-iframe").attr("id",r).attr("name",r).appendTo(this._$container);this._options.interactive&&(this._$iframe.hide(),this._$iframe.addClass("loading"),this._contributionHostBehavior.showLoadingIndicator&&(this._$statusContainer=$("<div />").addClass("status-container").appendTo(this._$container),this._statusControl=s.BaseControl.createIn(k.StatusIndicator,this._$statusContainer,{center:!0,imageClass:"big-status-progress",message:v.ExternalControlLoading}),this._statusControl.start()),this._contributionHostBehavior.slowWarningDurationMs>0&&this.delayExecute("slowLoadTimeout",this._contributionHostBehavior.slowWarningDurationMs,!0,function(){n._disposed||n._loadFailed||n._receivedLoadedEvent||n._showExtensionMessage(a.MessageAreaType.Warning,v.ExternalContentSlowLoadFormat,!0)}));this._$iframe.load(function(){n._options.interactive?n._receivedHandshake||n._receivedLoadedEvent||n._loadFailed||n._disposed||n.delayExecute("waitForHandshake",t.MAX_WAIT_FOR_HANDSHAKE_EVENT,!0,function(){this._receivedHandshake||this._receivedLoadedEvent||this._loadFailed||this._disposed||this._handleLoadError(null)}):n._loadedDeferred.resolve(null)});u.getPageContext().webAccessConfiguration.isHosted||!this._isSameOrigin(this._options.uri)||c.FeatureAvailabilityService.isFeatureEnabled(e.WebPlatformFeatureFlags.VisualStudioServicesContributionUnSecureBrowsers,!1)&&tt.BrowserCheckUtils.isLessThanOrEqualToIE9()||(this._$iframe.attr("sandbox","allow-forms allow-modals allow-pointer-lock allow-popups allow-scripts allow-top-navigation"),this._sandboxedIframe=!0);this._options.postContent?i[0].submit():this._$iframe.attr("src",this._options.uri);this._options.interactive&&this.ensureXdmChannelIntialized()},t.prototype._isSameOrigin=function(n){var t=nt.format("{0}//{1}",window.location.protocol,window.location.host).toLowerCase();return n&&n.toLowerCase().indexOf(t)===0&&(t.length===n.length||n[t.length]===":"||n[t.length]==="/")},t.prototype._handleLoadSuccess=function(){this._receivedLoadedEvent=!0;this._hideLoadingIndicator();this._loadedDeferred.resolve(null)},t.prototype._handleLoadError=function(n){if(this._loadFailed=!0,this._hideLoadingIndicator(),this._loadedDeferred.reject(n),this._contributionHostBehavior.showErrorIndicator){var t=n&&n.message?n.message:n;this._showExtensionMessage(a.MessageAreaType.Error,v.ExternalContentErrorFormat,!1,t)}},t.prototype._hideLoadingIndicator=function(){this._$iframe.removeClass("loading");this._statusControl&&(this._statusControl.dispose(),this._$statusContainer.remove(),this._statusControl=null,this._$statusContainer=null)},t.prototype._getExtensionUrl=function(){if(!this._galleryUrlPromise){var n=this._options.contribution,t=i.defer();this._galleryUrlPromise=t.promise;rt.using(["VSS/Gallery/RestClient"],function(i){l.beginGetServiceLocation(i.GalleryHttpClient.serviceInstanceId,f.ContextHostType.Deployment).then(function(i){t.resolve(g.combinePaths(i,"items/"+o.ExtensionHelper.getPublisherId(n)+"."+o.ExtensionHelper.getExtensionId(n)))})})}return this._galleryUrlPromise},t.prototype._showExtensionMessage=function(n,i,r,u,f){var e=this,l,y;f===void 0&&(f=!0);var c=b.getService(o.ExtensionService).getExtensionForContribution(this._options.contribution),p=nt.format(v.ExtensionDisplayNameFormat,c.extensionName,c.publisherName),h=$("<div />");$("<span />").appendTo(h).text(nt.format(i,p));f&&this._getExtensionUrl().then(function(n){var t=$("<span />").addClass("help-text").appendTo(h).html(v.ExternalContentErrorLearnMoreContent);t.find("a").attr("href",n).attr("target","_blank");e._handleMessageAreaResize()});this._showingErrorDetails=!!u;this._showingErrorDetails&&(l=$("<div />").text(u));y={type:n,header:h,content:l};this._messageArea&&this._messageArea.dispose();this._messageArea=s.Enhancement.enhance(a.MessageAreaControl,$("<div />").prependTo(this._element),{closeable:r,showIcon:!0,expanded:!!u,showDetailsLink:!1,message:y});this._handleMessageAreaResize();this._messageArea._bind(a.MessageAreaControl.EVENT_DISPLAY_COMPLETE,function(){e._handleMessageAreaResize();e._fire(t.Events.EXTENSION_MESSAGE_RESIZED,[e])});this._messageArea._bind(a.MessageAreaControl.EVENT_DISPLAY_CLEARED,function(){e._messageArea=null;e._handleMessageAreaResize();e._fire(t.Events.EXTENSION_MESSAGE_RESIZED,[e])});this._fire(t.Events.EXTENSION_MESSAGE_RESIZED,[this]);this._errorResizeDelegate||(this._errorResizeDelegate=function(){e._handleMessageAreaResize()},$(window).bind("resize",this._errorResizeDelegate))},t.prototype.dispose=function(){n.prototype.dispose.call(this);this._errorResizeDelegate&&$(window).unbind("resize",this._errorResizeDelegate)},t.prototype._handleMessageAreaResize=function(){var n="0";this._messageArea&&(n=this._messageArea._element.outerHeight()+(this._showingErrorDetails?20:0)+"px");this._$container.css("padding-top",n);this._$statusContainer&&this._$statusContainer.css("top",n)},t.prototype.getXdmChannel=function(){return this.ensureXdmChannelIntialized(),this._xdmChannel},t.prototype.ensureXdmChannelIntialized=function(){if(!this._xdmChannel){var n=b.getService(o.ExtensionService).getExtensionForContribution(this._options.contribution);this._xdmChannel=w.channelManager.addChannel(this._$iframe[0].contentWindow,this._options.uri);this._xdmChannel.getObjectRegistry().register("VSS.HostControl",this.getHostControl());this._xdmChannel.getObjectRegistry().register("vss.hostManagement",new y.HostManagementService({baseUri:n.baseUri,publisherId:n.publisherId,extensionId:n.extensionId,version:n.version,registrationId:n.registrationId}))}},t.prototype.getRegisteredInstance=function(n,t){var r=this;return this._loadedDeferred.promise.then(function(){return i.Promise(function(i,u){var f,s=!1,o,e;r.getXdmChannel().getRemoteObjectProxy(n,t).then(function(n){s=!0;f&&(f.cancel(),f=null);i(n)},function(n){s=!0;f||u(n)});o=r._options.contribution.id.split(".");e=n.split(".");o.length>=2&&e.length>=2&&o[0]===e[0]&&o[1]===e[1]&&(f=d.delay(r,250,function(){var n=e.slice(2).join(".");r.getXdmChannel().getRemoteObjectProxy(n,t).then(function(n){f&&(f=null,i(n))},function(n){f=null;s&&u(n)})}))})})},t.prototype.reuseHost=function(n){var t=this;this._loadedDeferred.promise.then(function(){t._contributions.indexOf(n)<0&&($.isFunction(t._extensionReusedCallback)&&t._extensionReusedCallback(n),t._contributions.push(n))})},t.prototype.getHostControl=function(){var n=this;return{resize:function(t,i){n._$iframe.width(t).height(i);p.VSS.resize()},initialHandshake:function(i){var f,s;n._receivedHandshake=!0;n._$iframe.show();i&&(i.notifyLoadSucceeded&&window.setTimeout(function(){n._handleLoadSuccess()},0),n._extensionReusedCallback=i.extensionReusedCallback);var e=n._options.contribution,r=b.getService(o.ExtensionService).getExtensionForContribution(e),h=u.getPageContext();if(n._contributions.push(e),f={pageContext:h,initialConfig:n._options.initialConfig,extensionContext:{extensionId:r.extensionId,publisherId:r.publisherId,version:r.version,baseUri:r.baseUri},contribution:e},n._sandboxedIframe&&r.publisherId){f.sandboxedStorage={};try{s=window.localStorage.getItem(t.SANDBOXED_STORAGE_SETTINGS_PREFIX+r.publisherId);s&&(f.sandboxedStorage=JSON.parse(s))}catch(c){}}return f},notifyLoadSucceeded:function(){n._handleLoadSuccess()},notifyLoadFailed:function(t){n._handleLoadError(t)},getAccessToken:function(){var t=b.getService(o.ExtensionService).getExtensionForContribution(n._options.contribution),i=!o.ExtensionHelper.isContributionTrusted(n._options.contribution);return r.getToken(t.registrationId,null,null,i)},getAppToken:function(){var t=b.getService(o.ExtensionService).getExtensionForContribution(n._options.contribution);return r.getAppToken(t.registrationId)},updateSandboxedStorage:function(n){var i,r;n&&this._sandboxedIframe&&window.localStorage&&(i=b.getService(o.ExtensionService).getExtensionForContribution(this._options.contribution),i&&i.publisherId&&(r=JSON.stringify(n),r.length>25e4?h.logWarning("Failed to update sandboxed storage for extension publisher "+i.publisherId+". The overall storage size "+r.length+" exceeds the maximum limit of "+t.SANDBOXED_STORAGE_SIZE_LIMIT+"."):window.localStorage.setItem(t.SANDBOXED_STORAGE_SETTINGS_PREFIX+i.publisherId,r)))}}},t.DEFAULT_SLOW_LOAD_DURATION=1e4,t.MAX_WAIT_FOR_HANDSHAKE_EVENT=5e3,t.EXTENSION_FLAGS_TRUSTED=2,t.SANDBOXED_STORAGE_SETTINGS_PREFIX="extension-data:",t.SANDBOXED_STORAGE_SIZE_LIMIT=25e4,t.Events={SLOW_LOAD_WARNING:"external-content-host-slow-load-warning",EXTENSION_MESSAGE_RESIZED:"external-content-host-message-resized"},t}(s.Control),ft=function(){function n(n,t,i){this._loadContribution(n,t,i)}return n.prototype._loadContribution=function(n,t,i){var r=this,u=n.properties.content||{},f=u.require||[];t||(t={});this._loadPromise=this._getRequiredModules(f).then(function(){var f=u.initialize,e,o,n;if(f){if(i&&(e=$('<div class="internal-content-host" />').appendTo(i)),o={$container:e,options:t,registerInstance:r._registerLocalInstance.bind(r)},n=p.VSS.getRegisteredObject(f,o),n&&$.isFunction(n.then))return n.then(function(n){t.contributedControlInstanceId&&p.VSS.register(t.contributedControlInstanceId,n)});n&&t.contributedControlInstanceId&&p.VSS.register(t.contributedControlInstanceId,n)}})},n.prototype._registerLocalInstance=function(n,t){this._localRegistry||(this._localRegistry=w.createObjectRegistry());this._localRegistry.register(n,t)},n.prototype._getRequiredModules=function(n){if(!n||!n.length)return i.resolve(null);var t=i.defer();return rt.using(n,function(){t.resolve(null)}),t.promise},n.prototype.getLoadPromise=function(){return this._loadPromise},n.prototype.getRegisteredInstance=function(n,t){var i=this;return this._loadPromise.then(function(){var r;return i._localRegistry&&(r=i._localRegistry.getInstance(n,t)),r||(r=p.VSS.getRegisteredObject(n,t)),r})},n}(),at=0,ct,lt;t.createContributedControl=vt;t.createExtensionHost=et;t.createExtensionHostForContribution=ot;t.getBackgroundHost=st;t.getBackgroundInstance=yt;ct=function(){function n(){this._hosts={}}return n.prototype.getHostsContainer=function(){return this._hostsContainer||(this._hostsContainer=$("<div/>").addClass("vs-app-hosts-container").prependTo(document.body)),this._hostsContainer},n.prototype.getHost=function(n,t,i,r,u){if(!n&&!i)throw new Error(nt.format("Could not resolve the uri for contribution {0}",t.id));var e=(i?"int.":"ext.")+(n||"").toLowerCase(),f=this._hosts[e];return f?(f.reuseHost(t),f):this.createBackgroundHost(e,n,t,i,r,u)},n.prototype.createBackgroundHost=function(n,t,i,r,u,f){if(r)return new ft(i,u,this.getHostsContainer());var e=s.create(ut,this.getHostsContainer(),{uri:t,contribution:i,interactive:!0,initialConfig:u,postContent:f});return this._hosts[n]=e,e},n}();lt=new ct});
define("VSS/Controls/Menus",["require","exports","q","VSS/Context","VSS/Contributions/Controls","VSS/Contributions/Services","VSS/Controls","VSS/Diag","VSS/Events/Action","VSS/Events/Handlers","VSS/Resources/VSS.Resources.Platform","VSS/Service","VSS/Utils/Array","VSS/Utils/Core","VSS/Utils/UI","VSS/VSS","VSS/Telemetry/Services","VSS/LoaderPlugins/Css!VSS.Controls"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){function lt(n){var t;return n&&(t=n.state|k.None,n.disabled&&(t=t|k.Disabled),n.hidden&&(t=t|k.Hidden),n.toggled&&(t=t|k.Toggled)),t}function dt(n){return wt.sort(n,function(n,t){var i=n.rank?n.rank:9999,r=t.rank?t.rank:9999;return i-r})}var b=v.delegate,tt=y.domElem,nt=y.KeyCode,bt=p.handleError,kt=p.getErrorMessage,ut,g,k,d,at,ft,it,vt,rt,et,ot,st,yt,ht,ct,pt,wt;(function(n){function t(t){return t==="vertical"?n.Vertical:n.Horizontal}n.Horizontal=0;n.Vertical=1;n.parse=t})(ut||(ut={})),function(n){function t(t){switch(t){case"static":return n.Static;case"popup":return n.Popup;case"dropdown":return n.DropDown;case"chevron":return n.Chevron}return n.Normal}n.None=0;n.Normal=1;n.Static=2;n.Popup=3;n.DropDown=4;n.Chevron=5;n.SubMenu=6;n.parse=t}(g||(g={})),function(n){n[n.None=0]="None";n[n.Disabled=1]="Disabled";n[n.Hidden=2]="Hidden";n[n.Toggled=4]="Toggled"}(t.MenuItemState||(t.MenuItemState={}));k=t.MenuItemState,function(n){function t(t){switch(t){case"right-bottom":return n.RightBottom;case"left-bottom":return n.LeftBottom;case"left-top":return n.LeftTop}return n.RightJustify}n.RightBottom=0;n.RightJustify=1;n.LeftBottom=2;n.LeftTop=3;n.parse=t}(d||(d={}));at=function(){function n(){this._commandStates={}}return n.prototype.getCommandState=function(n,t){var i=this._commandStates&&this._commandStates[n];return $.isFunction(i)?i.call(t,n,t):i},n.prototype.updateCommandStates=function(n){var t=this;n&&$.each(n,function(n,i){t._commandStates[i.id]=lt(i)})},n.prototype.executeCommand=function(n){this._fireEvent(this._executeEvent,this,n)},n.prototype.attachExecuteCommand=function(n){this.attachEvent(this._executeEvent,n)},n.prototype.detachExecuteCommand=function(n){this.detachEvent(this._executeEvent,n)},n.prototype.fire=function(n,t,i){return this._fireEvent(n,t,i)},n.prototype._fireEvent=function(n,t,i){var r;if(this._events&&(this._events.invokeHandlers(n,t,i,function(n){if(n===!1)return r=!0,!0}),r))return!1},n.prototype.attachEvent=function(n,t){this._events||(this._events=new h.NamedEventCollection);this._events.subscribe(n,t)},n.prototype.detachEvent=function(n,t){this._events&&this._events.unsubscribe(n,t)},n}();p.initClassPrototype(at,{_executeEvent:"execute-command",_commandStates:null});t.menuManager=new at;ft=function(n){function t(t){n.call(this,t);this._type=g.parse(this._options.type);this._children=[]}return __extends(t,n),t.prototype.getOwner=function(){return this._parent?this._parent.getOwner():this},t.prototype.getParent=function(){return this._parent},t.prototype.getParentMenu=function(){return undefined},t.prototype.getContextInfo=function(){return this._options.contextInfo},t.prototype.getActionArguments=function(){var n=this._options.arguments||this.actionArguments;return typeof n=="string"?{url:n}:$.isFunction(n)?n.call(this,this.getOwner().getContextInfo()):n},t.prototype.getMenuType=function(){return this._type},t.prototype.updateCommandStates=function(n){this._updateCommandStates(n)},t.prototype.isMenuBar=function(){return this._type===g.Static},t.prototype._fireUpdateCommandStates=function(n){(n=n||this,typeof this._options.updateCommandStates!="function"||this._options.updateCommandStates.call(n,n)!==!1)&&this._parent&&this._parent._fireUpdateCommandStates(n)},t.prototype._clear=function(){for(var t=this._children.length,n=0;n<t;n++)this._children[n]._clear(),this._children[n].dispose();this._children=[]},t.prototype._updateCommandStates=function(n){var t=this;this._commandStates||(this._commandStates={});n&&$.each(n,function(n,i){t._commandStates[i.id]=lt(i)})},t.prototype._updateContributedMenuItems=function(n){this._children&&this._children.forEach(function(t){t._updateContributedMenuItems(n)})},t}(e.Control);t.MenuBase=ft;p.initClassPrototype(ft,{_type:null,_parent:null,_children:null,_commandStates:null,actionArguments:null});it=function(n){function i(t){n.call(this,t);this.setEnhancementOptions({role:"menuitem",coreCssClass:"menu-item",tagName:"li"});this._item=this._options.item||{};try{this.actionArguments=this._item.arguments}catch(i){}this._align=d.parse(this._options.align)}return __extends(i,n),i.getScopedCommandId=function(n,t){return t?t+"-"+n:n},i.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,t)},i.prototype.getParentMenu=function(){return this._parent instanceof rt&&this._parent},i.prototype.getCommandId=function(){return i.getScopedCommandId(this._item.id,this._item.scope)},i.prototype.getPinningOptions=function(){return this._item.pinningOptions},i.prototype.getAction=function(){var n=this._item.idIsAction;return n===!1?this._item.action:this._item.action||this.getCommandId()},i.prototype.hasAction=function(){var n=this.getAction();return n!==null&&typeof n!="undefined"},i.prototype.hasSubMenu=function(){return!this.isDefault()&&this._item.childItems},i.prototype.isDecorated=function(){return this._item.decorated===!0},i.prototype.isDefault=function(){return this._type===g.None},i.prototype.isSeparator=function(){return this._item.separator===!0},i.prototype.isLabel=function(){return this.isSeparator()&&this._item.isLabel},i.prototype.isSelected=function(){return this._item.selected===!0},i.prototype.getCommandState=function(n,i){var r=null;return n=n||this._item.id,i=i||this,typeof this._options.getCommandState=="function"&&(r=this._options.getCommandState.call(this,n,i)),(r===null||typeof r=="undefined")&&this._parent&&$.isFunction(this._parent.getCommandState)&&(r=this._parent.getCommandState(n,i)),(r===null||typeof r=="undefined")&&(r=t.menuManager.getCommandState(n,i)),(r===null||typeof r=="undefined")&&this._item.id===n&&(r=lt(i._item)),$.isFunction(r)&&(r=r.call(this,n,this)),r},i.prototype.getIndex=function(){return this._index},i.prototype.setIndex=function(n){this._index=n},i.prototype.isHidden=function(){var n=this._item,t;return n.pinningOptions&&n.pinningOptions.isPinnable&&this._parent&&this._parent.getPinningOptions()&&((t=this._parent.getPinningOptions(),t.hidePinnedItems&&this._isPinned&&!n.pinningOptions.neverHide)||t.hideUnpinnedItems&&!this._isPinned&&!n.pinningOptions.neverHide)?!0:Boolean((this.getCommandState()&k.Hidden)===k.Hidden||this._type===g.None||this.isSeparator()&&this._item.hidden)},i.prototype.isEnabled=function(){var n=!1;return this.isSeparator()||(n=(this.getCommandState()&(k.Disabled|k.Hidden))===k.None),n},i.prototype.isToggled=function(){var n=!1;return this.isSeparator()||this.isHidden()||(n=(this.getCommandState()&k.Toggled)===k.Toggled),n},i.prototype.initialize=function(){var f=this,t,i,u,r;n.prototype.initialize.call(this);this._item.pinningOptions&&this._item.pinningOptions.isPinnable&&(t=this.getParentMenu(),i=t&&t.getPinningOptions(),i&&i.isPinningSource?(u=t.getParentMenu(),r=a.first(u._menuItems,function(n){return n._item&&n._item.id===f._item.id}),this._isPinned=r?r._isPinned:!!this._item.pinningOptions.isPinned):this._isPinned=!!this._item.pinningOptions.isPinned);this._decorate()},i.prototype.update=function(n){this._clear();this._item=n;this._item.decorated=!1;this._element.empty();this._unbind("click mouseover mouseout mousedown mouseup");this._decorate()},i.prototype.updateItems=function(n){this._clear();this._item.childItems=n},i.prototype._decorate=function(){var n=this._element,a=this.getOwner()._options.showIcon===!0,h=this.hasSubMenu(),o,v=this._item.showText!==!1,p=this._item.showHtml!==!1,f,i,r,u,c=!1,l=!1,s=!1,t;n.attr("id","mi_"+e.getId());this.isDecorated()?u=n.children(".drop").eq(0):(o=this._item.title,o||this._item.encoded||(o=this._item.text),n.addClass(this._options.cssCoreClass).addClass(this._options.cssClass).attr("title",o),this._item.id&&n.attr("command",this._item.id),this._item.cssClass&&this._element.addClass(this._item.cssClass),this._item.hidden&&n.addClass("invisible"),this.isSeparator()?(this._element.addClass("menu-item-separator"),this._element.attr("role","separator"),f=this._createSeparatorElement(),this._item.text&&(f.text(this._item.text),f.removeClass("separator"),f.addClass("text-separator")),n.append(f)):(a&&!this._item.noIcon&&(typeof this._item.icon=="string"&&this._item.icon.match(/^https?:\/\//)?this._item.icon=this._getExternalIcon.bind(this,this._item.icon):typeof this._item.icon=="string"&&this._item.icon.match(/^css:\/\//)&&(this._item.icon=this._item.icon.substr(6)),t=this._createIconElement(),$.isFunction(this._item.icon)?t.append(this._item.icon.call(this,t)):this._item.icon&&t.addClass(this._item.icon),t.hasClass("bowtie-icon")&&t.removeClass("icon"),n.append(t),c=!0),v&&(i=this._createTextElement(),this._item.encoded?i[0].innerHTML=this._item.text||"":typeof this._item.text=="string"?i.text(this._item.text):$.isFunction(this._item.text)&&i.text(this._item.text.call(this)||""),this._item.textClass&&i.addClass(this._item.textClass),l=!0,n.append(i)),p&&(s=!0,r=this._createHtmlElement(),this._item.html instanceof jQuery?r.append(this._item.html):typeof this._item.html=="string"?r.html(this._item.html):$.isFunction(this._item.html)?r.html(this._item.html.call(this)||""):s=!1,this._item.htmlClass&&r.addClass(this._item.htmlClass),n.append(r)),s||l||!c||n.addClass("icon-only"),h&&!this._item.hideDrop&&(u=this._createDropElement(),n.append(u),n.addClass("drop-visible"),n.attr("aria-haspopup","true")),this._item.pinningOptions&&this._item.pinningOptions.isPinnable&&!this._item.pinningOptions.hidePin&&(n.addClass("pin-visible"),this._pinElement=$("<i class='pin bowtie-icon' />"),this._pinElement.click(this._onPinClick.bind(this)),n.append(this._pinElement))));this._updateState();n.toggleClass("selected",this.isSelected());this.isDefault()||this.isSeparator()?this.isSeparator()&&this._bind("click",function(n){n.stopPropagation()}):(this._bind("click",b(this,this._onClick)),this._bind("mouseover",b(this,this._onMouseOver)),this._bind("mouseout",b(this,this._onMouseOut)),this._bind("mousedown",b(this,this._onMouseDown)),this._bind("mouseup",b(this,this._onMouseUp)),h&&u&&u.length>0&&this._bind(u,"click",b(this,this._onDropClick)));this.getOwner()._options.markUnselectable===!0&&y.makeElementUnselectable(n[0])},i.prototype._getExternalIcon=function(n){return $("<img/>").attr("src",n)},i.prototype.select=function(){this._parent._selectItem(this);this._parent._clearTimeouts()},i.prototype.deselect=function(){this._parent._selectItem(null)},i.prototype.escaped=function(){this.select()},i.prototype.execute=function(n){n;var t=this.getOwner();return this.collapse({immediate:!0}),t.escaped(),this.deselect(),t.isMenuBar()&&n&&n.keepHighlight&&this.showHoverHighlight(),t._proceedBlur(),this.hasAction()?this.executeAction($.extend({},t.getActionArguments(),this.getActionArguments()),n?n.e:null):void 0},i.prototype.executeAction=function(n,i){var r=this.getAction(),f=this.getOwner(),u;if(r){if(n.telemetry&&n.telemetry.area&&n.telemetry.feature&&w.publishEvent(new w.TelemetryEventData(n.telemetry.area,n.telemetry.feature,{CommandId:this.getCommandId()||"Unknown",GroupId:this._item.groupId})),$.isFunction(r))return r.apply(this,[n]);if(r==="navigate"&&n.url){try{u=null;n.target?u=n.target:i&&i.ctrlKey&&(u="_blank");u?s.getService().performAction(s.CommonActions.ACTION_WINDOW_OPEN,{url:n.url,target:n.target}):s.getService().performAction(s.CommonActions.ACTION_WINDOW_NAVIGATE,{url:n.url})}catch(i){}return!1}return f?f.executeAction(new h.CommandEventArgs(r,n,this)):t.menuManager.executeCommand(new h.CommandEventArgs(r,n,this))}},i.prototype.collapse=function(n){for(var t=this._parent,i=n&&n.immediate===!0;t;)$.isFunction(t.hide)&&t.hide({immediate:i}),t=t._parent;this.getOwner().ownFocus()},i.prototype.setFocus=function(){var n=this._element;!n||!this.isEnabled()||this.isSeparator()||this.isDefault()||n.addClass("focus")},i.prototype.removeFocus=function(){var n=this._element;!n||!this.isEnabled()||this.isSeparator()||this.isDefault()||n.removeClass("focus")},i.prototype.showHoverHighlight=function(){this._highlightHover=!0;this._updateState()},i.prototype.showPressedHighlight=function(){this.hasSubMenu()&&this.getSubMenu()._visible||(this._highlightPressed=!0,this._updateState())},i.prototype.removePressedHighlight=function(){this._highlightPressed&&(this._highlightPressed=!1,this._updateState())},i.prototype.removeHighlight=function(){this._highlightHover=!1;this._highlightPressed=!1;this._updateState()},i.prototype.updateTitle=function(n){var t;typeof n=="string"?t=n:this._item&&$.isFunction(this._item.attr("title"))&&(t=this._item.text.call(this));t&&(this._element.attr("title",t),this._options.item&&(this._options.item.title=t))},i.prototype.updateText=function(n){var t;typeof n=="string"?t=n:this._item&&$.isFunction(this._item.text)&&(t=this._item.text.call(this));t&&this._element.children("span.text").text(t)},i.prototype.getSubMenu=function(){var n=null,t;return this.hasSubMenu()&&(this._children.length===0?(t=this._parent&&this._parent._parent&&this._parent._parent._element||this._element,n=e.create(rt,t,$.extend({},this._options,this._item.childOptions,{earlyInitialize:!1,items:this._item.childItems,type:"submenu",cssCoreClass:"menu sub-menu",tagName:"ul"})),n._element.addClass("menu"),n._element.attr("data-parent",this._element.attr("id")),n._parent=this,n._type=g.SubMenu,this._children.push(n)):n=this._children[0]),n},i.prototype.tryShowSubMenu=function(n){var t=n&&n.immediate;return!this.isDefault()&&this.isEnabled()&&this.getSubMenu()?(this.showSubMenu({immediate:t}),!0):!1},i.prototype.showSubMenu=function(n){var i=n&&n.immediate===!0,t=this.getSubMenu(),r=this._item.splitDropItem?this._item.splitDropItem:this;t.show({immediate:i,element:r._element,align:this._align})},i.prototype.hideSubMenu=function(n){if(this.hasSubMenu()){var i=n&&n.immediate===!0,t=this.getSubMenu();t._parent===this&&t.hide({immediate:i})}},i.prototype.hideSiblings=function(n){this._parent.hideChildren(this,n)},i.prototype._attachMenuEvents=function(){},i.prototype._createIconElement=function(){return $(tt("span","icon menu-item-icon"))},i.prototype._createTextElement=function(){return $(tt("span","text"))},i.prototype._createHtmlElement=function(){return $(tt("span","html"))},i.prototype._createDropElement=function(){return $(tt("div","drop"))},i.prototype._createSeparatorElement=function(){return $(tt("div","separator"))},i.prototype._updateState=function(){var n=this._element,t;!n||this.isSeparator()||this.isDefault()||(t=(this._item.splitDrop||this._item.splitDropItem||{})._element,this.isEnabled()?(n.toggleClass("hover",this._highlightHover),n.toggleClass("pressed",this._highlightPressed),n.removeAttr("disabled"),n.removeClass("disabled"),t&&t.toggleClass("split-drop-hover",this._highlightHover)):(n.attr("disabled","disabled"),n.addClass("disabled"),n.removeClass("hover"),n.removeClass("pressed")),n.toggleClass("toggle-on",this.isToggled()));n&&!this.isDefault()&&n.toggleClass("invisible",this.isHidden());this._pinElement&&(this._pinElement.toggleClass(i.PinnedIconClass,this._isPinned),this._pinElement.toggleClass(i.UnpinnedIconClass,!this._isPinned))},i.prototype._updateContributedMenuItems=function(t){var i=[this._item],r=function(n,i,u){for(var f,o=!1,e=0,s=t;e<s.length;e++)if(f=s[e],n.id===f.id&&n.sourceExtensionId===f.sourceExtensionId){u[i]=f;o=!0;break}!o&&$.isArray(n.childItems)&&n.childItems.forEach(r)};i.forEach(r);i[0]!==this._item?this.update(i[0]):n.prototype._updateContributedMenuItems.call(this,t)},i.prototype._onMouseOver=function(n){o.logTracePoint("MenuItem._onMouseOver.start");var t=this.getOwner(),i,r;t._active?(r=t._subMenuVisible,this.hideSiblings({immediate:this._options.immediateShowHide}),this.select(),(t!==this._parent||r)&&(t._subMenuVisible=r,this.isEnabled()&&this.hasSubMenu()&&(i=this.getSubMenu(),i._parent===this&&(i._visible||(this.showSubMenu({immediate:this._options.immediateShowHide}),i.selectDefaultItem()))))):this.showHoverHighlight();n.stopPropagation()},i.prototype._onMouseOut=function(n){var i=this.getOwner(),t;i._active?i!==this._parent?this.hasSubMenu()?(t=this.getSubMenu(),t._parent===this?t._visible||(this.deselect(),t._clearTimeouts()):this.deselect()):this.deselect():this.hasSubMenu()&&!this.getSubMenu()._visible&&this.removeHighlight():this.removeHighlight();n.stopPropagation()},i.prototype._onMouseDown=function(){this.showPressedHighlight()},i.prototype._onMouseUp=function(){this.removePressedHighlight()},i.prototype._onClick=function(n){var t,i=this.actionArguments;if(i||(i={}),i.clickArguments||(i.clickArguments={}),$.extend(i.clickArguments,n),this.isEnabled()){if(this.hasSubMenu()&&this._item.clickOpensSubMenu!==!1)t=this.getSubMenu(),t._parent===this&&t._visible?(this.getOwner().activate(),this._options.clickToggles===!0?(t.hide({immediate:!0}),this.select()):t.ownFocus()):(this.getOwner().activate(),this.hideSiblings({immediate:!0}),this.showSubMenu({immediate:!0}),t.selectDefaultItem());else if(this.hasAction())return this.select(),this.execute({e:n,keepHighlight:this._parent.getMenuType()!==g.SubMenu})===!0}else this.getOwner().activate(),this.hideSiblings({immediate:!0}),this.select();return!1},i.prototype._onDropClick=function(){var n;return this.isEnabled()&&(this.getOwner().activate(),this.hasSubMenu()&&(n=this.getSubMenu(),n._parent===this&&n._visible?this._options.clickToggles===!0?(n.hide({immediate:!0}),this.select()):n.ownFocus():(this.hideSiblings({immediate:!0}),this.showSubMenu({immediate:!0}),n.selectDefaultItem()))),!1},i.prototype._onPinClick=function(n){var f,u,i,e,c,o,l,r,s,h,a,t,v;if(n.stopPropagation(),this._isPinned=!this._isPinned,this._updateState(),f=this.getParentMenu(),u=f&&f.getPinningOptions(),u&&u.isPinningSource)i=f.getParentMenu();else if(u&&u.isPinningTarget)for(e=0,c=this._parent._menuItems;e<c.length;e++)if(t=c[e],t.hasSubMenu()&&(o=t.getSubMenu(),l=o&&o.getPinningOptions(),l&&l.isPinningSource)){i=o;break}if(i){for(r=void 0,s=void 0,h=0,a=i._menuItems;h<a.length;h++)t=a[h],t._item.pinningOptions&&t._item.pinningOptions.isPinnable&&(s=t),t._item.id===this._item.id&&(r=t);r&&(r._isPinned=this._isPinned,r._updateState(),s&&i.getPinningOptions().pinItemsToEnd&&i.moveMenuItemAfter(r,s))}if(v=this.getParentMenu(),v.getParent()&&v.hide({immediate:!0}),this._item.pinningOptions.onPinnedChanged)this._item.pinningOptions.onPinnedChanged(this,this._isPinned)},i.prototype._onKeyDown=function(n){var t=function(){return!n.ctrlKey&&!n.altKey&&!n.shiftKey};switch(n.keyCode){case nt.DOWN:if(t())return this._parent.selectDown(),!1;break;case nt.UP:if(t())return this._parent.selectUp(),!1;break;case nt.RIGHT:if(t())return this._parent.selectRight(),!1;break;case nt.LEFT:if(t())return this._parent.selectLeft(),!1;break;case nt.ENTER:return this.isEnabled()&&(this.hasAction()?this.execute({e:n}):this.hasSubMenu()&&(this.hideSiblings({immediate:!0}),this.showSubMenu({immediate:!0}),this.getSubMenu().selectFirstItem())),!1;case nt.ESCAPE:if(this._parent.escape())return!1;break;case nt.TAB:if(this.getOwner()===this._parent){if(n.shiftKey){if(this._parent.selectPrevItem())return!1}else if(this._parent.selectNextItem())return!1}else return this.collapse(!0),this.getOwner()._selectedItem._onKeyDown(n)}},i.enhancementTypeName="tfs.menu.item",i.PinnedIconClass="bowtie-pin-pinned-fill",i.UnpinnedIconClass="bowtie-pin-unpin-fill",i}(ft);t.MenuItem=it;p.initClassPrototype(it,{_item:null,_align:null,_index:0,_highlightHover:!1,_highlightPressed:!1});vt=function(){function n(n,t,i,r,u,f){this._menu=n;this._webContext=t;this._contributionIds=i;this._contributionType=r;this._getMenuActionContext=u;this._options=f||{}}return n.prototype._getContributions=function(){var n=this;return this._contributionsPromise||(this._contributionsPromise=this._contributionIds&&this._contributionIds.length?l.getService(f.ExtensionService).getContributionsForTargets(this._contributionIds,this._contributionType).then(function(t){var r=i.defer(),u=[];return t.forEach(function(t){var i=n._getContributionWithSource(t);i&&u.push(i)}),i.allSettled(u).then(function(n){var t=[];n.forEach(function(n){n.value&&t.push(n.value)});r.resolve(t)},r.reject),r.promise}):i.resolve([])),this._contributionsPromise},n.prototype._getContributionWithSource=function(t){var r=t.id||"";return r&&f.ExtensionHelper.hasContent(t)?u.getBackgroundInstance(t,t.properties.registeredObjectId||r,this._webContext,this._webContext,n._contributionSourceTimeout,"Timed-out waiting for menu source provider for contribution: "+r).then(function(n){return{contribution:t,source:n}}):t.properties.targetUri?i.resolve({contribution:t}):null},n.prototype._makeThennable=function(n){return n&&$.isFunction(n.then)?n:i.resolve(n)},n.prototype._contributionToMenuItems=function(t,r){var e=this,f=t.contribution.id||"",u;return t.source?(u=i.defer(),$.isFunction(t.source.getMenuItems)?(r=$.extend({updateMenuItems:function(n){e._updateContributedMenuItems(n,t)}},r),this._makeThennable(t.source.getMenuItems(r)).then(function(n){n&&n.length?i.all(n.map(function(n){return e._updateContributedMenuFromSource(n,t.contribution,t.source)})).then(function(n){u.resolve(n)}):u.resolve(n)},u.reject)):this._getBasicMenuItemFromContribution(f,t.contribution,t.source).then(function(n){u.resolve([n])}),i.timeout(u.promise,n._contributionGetItemsTimeout,"Timed-out waiting for getMenuItems call from contribution: "+f)):t.contribution.properties.targetUri?this._getBasicMenuItemFromContribution(f,t.contribution,null).then(function(n){return[n]}):i.resolve([])},n._getMenuItemFromContributedMenuItem=function(t){return{id:t.id,text:t.text,title:t.title,separator:t.separator,disabled:t.disabled,hidden:t.hidden,icon:t.icon,noIcon:t.noIcon,childItems:$.isArray(t.childItems)?t.childItems.map(function(t){return n._getMenuItemFromContributedMenuItem(t)}):null,groupId:t.groupId,action:t.action}},n.prototype._updateContributedMenuFromSource=function(t,u,e,o){var a=this,s,h,c;return o===void 0&&(o=!0),s=o?n._getMenuItemFromContributedMenuItem(t):t,s.action=this._getMenuAction(u,e,s.action),h=null,c=l.getService(f.ExtensionService).getExtensionForContribution(u),typeof s.icon=="string"&&(h=f.ExtensionHelper.resolveUriTemplate(s.icon,r.getDefaultWebContext(),c.baseUri)),s.isContribution=!0,s.sourceExtensionId=c.publisherId+"."+c.extensionId,s.title&&!s.text&&s.text!==""?this._options.defaultTextToTitle===!1&&s.icon?(s.showText=!1,s.showHtml=!1):s.text=s.title:s.text&&!s.title&&s.title!==""&&(s.title=s.text),o&&!s.groupId&&(s.groupId=u.properties.groupId),$.isArray(s.childItems)&&s.childItems.forEach(function(n){a._updateContributedMenuFromSource(n,u,e,!1)}),h?h.then(function(n){return s.icon=n,s}):i.resolve(s)},n.prototype._getBasicMenuItemFromContribution=function(n,t,i){var o=this,e=t.properties.text||null,u=t.properties.title||null,s=this._makeThennable("");return typeof t.properties.icon=="string"&&(s=f.ExtensionHelper.resolveUriTemplateProperty(t,r.getDefaultWebContext(),"icon")),s.then(function(r){var s={id:n,text:e,title:u,icon:r,groupId:t.properties.groupId,action:o._getMenuAction(t,i,null),isContribution:!0,sourceExtensionId:f.ExtensionHelper.getPublisherId(t)+"."+f.ExtensionHelper.getExtensionId(t)};return e===null&&u?o._options.defaultTextToTitle===!1&&r?(s.showText=!1,s.showHtml=!1):s.text=u:u===null&&(s.title=e),s})},n.prototype._getMenuAction=function(n,t,i){var r=this,u;return $.isFunction(i)?function(){f.ExtensionHelper.publishTraceData(n);i(r._getMenuActionContext())}:n.properties.targetUri?function(){var t=l.getService(f.ExtensionService).getExtensionForContribution(n),i=f.ExtensionHelper.resolveUriTemplate(n.properties.targetUri,r._getMenuActionContext(),t.baseUri);i.then(function(t){f.ExtensionHelper.publishTraceData(n,t);window.location.href=t})}:t&&$.isFunction(t.execute)?function(){f.ExtensionHelper.publishTraceData(n);t.execute(r._getMenuActionContext())}:u},n.prototype._updateContributedMenuItems=function(n,t){var r=this;i.all(n.map(function(n){return r._updateContributedMenuFromSource(n,t.contribution,t.source)})).then(function(n){r._menu.updateContributedMenuItems(n)})},n.prototype.getContributedMenuItems=function(n){var r=this,t=i.defer();return this._getContributions().then(function(u){var f=[];u.forEach(function(t){f.push(r._contributionToMenuItems(t,n))});i.allSettled(f).then(function(n){var i=[];n.forEach(function(n){n.value&&n.value.length&&n.value.forEach(function(n){i.push(n)})});t.resolve(i)},t.reject)}),t.promise},n._contributionSourceTimeout=5e3,n._contributionGetItemsTimeout=2e3,n}();rt=function(n){function i(t){n.call(this,t);this._mouseIsDown=!1;this.setEnhancementOptions({role:"menu",coreCssClass:"menu"+(this._options.useBowtieStyle?" bowtie-menus":""),tagName:"ul"});this._menuItems=[];this._initializeItemsSource()}return __extends(i,n),i.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,t)},i.prototype.initialize=function(){n.prototype.initialize.call(this);this._options.suppressInitContributions||this.refreshContributedItems();this._decorate()},i.prototype._initializeItemsSource=function(){this._itemsSource=this._options.items},i.prototype._decorate=function(){this._element.addClass(this._options.cssCoreClass).addClass(this._options.cssClass);this._bind("mousedown",b(this,this._onMouseDown));this._itemsSource=this.getGroupedItems();this._ensureChildren()},i.prototype.getItem=function(n){for(var i,t=0,r=this._menuItems.length;t<r;t++)if(i=this._menuItems[t],i&&n===i.getCommandId())return i;return null},i.prototype.getItems=function(){return this._menuItems},i.prototype.getItemByTag=function(n){for(var i,t=0,r=this._menuItems.length;t<r;t++)if(i=this._menuItems[t],i&&n===i._item.tag)return i;return null},i.prototype.getMenuItemSpecs=function(){return this._items},i.prototype.getParentMenu=function(){return this._parent&&this._parent._parent instanceof i&&this._parent._parent},i.prototype.getPinningOptions=function(){var n=this._options.item;return n&&n.pinningMenuOptions?n.pinningMenuOptions:this._options.pinningMenuOptions},i.prototype.getCommandState=function(n,t){t=t||this;var i=null;return $.isFunction(this._options.getCommandState)&&(i=this._options.getCommandState.call(t,n,t)),(i===null||typeof i=="undefined")&&(i=this._commandStates&&this._commandStates[n]),(i===null||typeof i=="undefined")&&this._parent&&$.isFunction(this._parent.getCommandState)&&(i=this._parent.getCommandState(n,t)),$.isFunction(i)&&(i=i.call(t,n,t)),i},i.prototype.updateCommandStates=function(t){n.prototype.updateCommandStates.call(this,t);this._skipUpdateMenuItemStates||this._updateMenuItemStates()},i.prototype.updateItems=function(n){this._updateItemsWithContributions(n,this._contributedItems);this._refreshContributedMenuItems()},i.prototype._updateItemsWithContributions=function(n,t){this._fire("menuUpdatingContributedItems",{source:this,existingItems:n,contributedItems:t});n||(n=[]);$.isArray(n)&&(n=$.grep(n,function(n){return!n.isContribution}),t&&t.length&&(n=n.concat(t)));this._contributedItems=t;this._updateCombinedSource(n)},i.prototype._updateCombinedSource=function(n){this._clear();this._itemsSource=n;this._initialized&&(this._itemsSource=this.getGroupedItems(),this._ensureChildren(),this.updateMenuItemStates(),$.isFunction(this._positioningRoutine)&&this._positioningRoutine.call(this))},i.prototype.getGroupedItems=function(){var n,t,i;if(!$.isArray(this._itemsSource)||(n=[],t={__ungrouped__:[]},this._itemsSource.forEach(function(n){n.groupId&&(!n.separator||n.separator&&n.text)?t[n.groupId]?t[n.groupId].push(n):t[n.groupId]=[n]:t.__ungrouped__.push(n)}),t.__ungrouped__.length===this._itemsSource.length))return this._itemsSource;for(i=null,t.__ungrouped__=t.__ungrouped__.reduce(function(n,t,r,u){return t.separator&&!t.text&&(i&&i.separator||n.length===0||r===u.length-1)||n.push(t),i=t,n},[]),$.each(t,function(t,i){if(t==="__ungrouped__")return!0;Array.prototype.push.apply(n,i);n.push({separator:!0})}),Array.prototype.push.apply(n,t.__ungrouped__),t.__ungrouped__.length===0&&n.splice(n.length-1,1);n.length>0&&n[n.length-1].separator;)n.splice(n.length-1,1);return n},i.prototype.appendItems=function(n){$.isArray(n)&&n.length&&this.updateItems((this._itemsSource||[]).slice(0).concat(n))},i.prototype.appendItem=function(n){this._createChildMenuItem(n);this._items.push(n)},i.prototype.moveMenuItemAfter=function(n,t){if(n===t)return!0;var i=this._children.indexOf(n),r=this._menuItems.indexOf(n),u=this._items.indexOf(n._item),f=this._children.indexOf(t),e=this._menuItems.indexOf(t),o=this._items.indexOf(t._item);return i<0||r<0||u<0||f<0||e<0||o<0?!1:(this._children.splice(i,1),this._menuItems.splice(r,1),this._items.splice(u,1),this._children.splice(f+1,0,n),this._menuItems.splice(e+1,0,n),this._items.splice(o+1,0,n._item),n._element.detach(),n._element.insertAfter(t._element),!0)},i.prototype.removeItem=function(n){for(var i,t=0,r=this._children;t<r.length;t++)if(i=r[t],i instanceof it&&i._item===n)return this.removeMenuItem(i);return!1},i.prototype.removeMenuItem=function(n){var t=this._children.indexOf(n),i=this._menuItems.indexOf(n),r=this._items.indexOf(n._item);return t<0||r<0?!1:(this._children.splice(t,1),i>=0&&this._menuItems.splice(i,1),this._items.splice(r,1),n.dispose(),!0)},i.prototype._enhance=function(t){n.prototype._enhance.call(this,t);this._enhanceChildren()},i.prototype._getMenuItemType=function(){return it},i.prototype.getMenuItemOptions=function(n,t){return $.extend({earlyInitialize:!1,item:n,align:this.getMenuItemAlignment(),overflow:this._options.overflow},t)},i.prototype._getFirstMenuItem=function(){return this._getNextEnabledItem(0)},i.prototype._selectItem=function(n,t){this._parent&&this._parent.select();this._selectedItem&&(this._selectedItem.removeHighlight(),this._selectedItem.removeFocus());n||(n=this._getDefaultMenuItem());n.showHoverHighlight();this._selectedItem=n;this._selectedItem.setFocus();this.getOwner()._updateAriaAttribute(n);t||(this.getOwner()._focusItem=n)},i.prototype.selectDefaultItem=function(n){this._selectItem(null,n)},i.prototype.selectFirstItem=function(){var n=this._getFirstMenuItem();return n?(this._selectItem(n),!0):!1},i.prototype.selectNextItem=function(){var t=0,r=this._menuItems,i=this._selectedItem,n;return r.length>0&&(i&&(t=i.getIndex()+1),n=this._getNextEnabledItem(t),n)?(n.select(),!0):!1},i.prototype.selectPrevItem=function(){var t=-1,r=this._menuItems,i=this._selectedItem,n;return r.length>0&&(i&&(t=i.getIndex()-1),n=this._getPrevEnabledItem(t),n)?(n.select(),!0):!1},i.prototype.selectDown=function(){var n;return this._menuItems.length>0&&(n=this._getNextEnabledItem(this._selectedItem.getIndex()+1,{rollOver:!0}),n)?(n.select(),this._ensureVisible(n),!0):!1},i.prototype.selectUp=function(){var n;return this._menuItems.length>0&&(n=this._getPrevEnabledItem(this._selectedItem.getIndex()-1,{rollOver:!0}),n)?(n.select(),this._ensureVisible(n),!0):!1},i.prototype.selectRight=function(){return this._selectedItem.tryShowSubMenu({immediate:!0})?(this._selectedItem.getSubMenu().selectFirstItem(),!0):this.getOwner().selectRight({redirected:!0})},i.prototype.selectLeft=function(){return this._parent&&this._parent._parent!==this.getOwner()?(this.hide({immediate:!0}),this._parent.select(),!0):this.getOwner().selectLeft({redirected:!0})},i.prototype.show=function(n){var r=n&&n.immediate===!0,t=n?n.element:null,i=n?n.align:d.RightJustify;return r?this._showPopup(t,i):this._startShowTimeout(t,i),!0},i.prototype.hide=function(n){var t=n&&n.immediate===!0;t?this._hidePopup():this._startHideTimeout()},i.prototype.hideChildren=function(n,t){var i,f,r,u=this._children,e=t&&t.immediate===!0,o=n&&n._item&&n._item.splitDrop;if($.isArray(u))for(i=0,f=u.length;i<f;i++)r=u[i],r!==n&&r!==o&&r.hideSubMenu({immediate:e})},i.prototype.escape=function(){return this.hide({immediate:!0}),this._parent&&this._parent.escaped(),!0},i.prototype.ownFocus=function(){this._selectItem(this._selectedItem)},i.prototype.attach=function(n){this._parent!==n&&this._visible&&this.hide({immediate:!0});this._parent=n},i.prototype.getMenuItemAlignment=function(){return"right-justify"},i.prototype.updateMenuItemStates=function(){try{this._skipUpdateMenuItemStates=!0;this._fireUpdateCommandStates(this)}finally{this._skipUpdateMenuItemStates=!1}this._updateMenuItemStates()},i.prototype.executeAction=function(n){var i;return $.isFunction(this._options.executeAction)&&(i=this._options.executeAction.call(this,n)),i!==!1&&(i=t.menuManager.executeCommand(n)),i},i.prototype._ensureVisible=function(n){if(n&&n.getElement()){var i,r,u,f=n.getElement(),t=this.getElement();u=f.outerHeight(!0);i=n.getIndex()*u;r=i+u;i<t.scrollTop()?t.scrollTop(i):r-t.height()>t.scrollTop()&&t.scrollTop(r-t.height())}},i.prototype._getItems=function(){var n=this,i,t=!1;return this._items||(this._itemsSource?$.isFunction(this._itemsSource)?(i=this._itemsSource.call(this,this.getOwner().getContextInfo(),function(i){t?n._disposed||n.updateItems(i):(t=!0,n._items=i||[])},function(i){var r=[{text:kt(i),icon:"icon-tfs-build-failed"}];t?n._disposed||n.updateItems(r):(t=!0,n._items=r);bt(i)}),t||(t=!0,i||(i=[{text:c.MenuItemsLoading}]),this._items=i)):this._items=this._itemsSource:this._items=[]),this._items},i.prototype._clear=function(){n.prototype._clear.call(this);this._defaultMenuItem=null;this._menuItems=[];this._items=null;this._childrenCreated=!1},i.prototype._createChildMenuItem=function(n,t){var i,r;return r=this.getMenuItemOptions(n,n?n.extraOptions:undefined),i=t?e.Enhancement.enhance(this._getMenuItemType(),t,r):e.BaseControl.createIn(this._getMenuItemType(),this._element,r),i._parent=this,this._children.push(i),i._item.separator||(i.setIndex(this._menuItems.length),this._menuItems.push(i)),n.splitDropOptions&&(n.childItems||n.splitDropOptions.childItems)&&this._createSplitDropMenuItem(n,i),i.initialize(),i},i.prototype._createSplitDropMenuItem=function(n,t){var i=$.extend(n.splitDropOptions,{splitDropItem:t,childItems:n.splitDropOptions.childItems||n.childItems,showText:!1,showHtml:!1,toggled:n.toggled,disabled:n.disabled,noIcon:n.splitDropOptions.noIcon!==undefined?n.splitDropOptions.noIcon:!0,cssClass:n.splitDropOptions.cssClass||"split-drop",splitDropOptions:null});n.splitDrop=this._createChildMenuItem(i);n.childItems=null;t._element.addClass("split-drop-item")},i.prototype._ensureChildren=function(){var n=this;this._childrenCreated||($.each(this._getItems(),function(t,i){n._createChildMenuItem(i)}),this._childrenCreated=!0)},i.prototype._enhanceChildren=function(){var n=this,t=this._getItems();this._element.children("li").each(function(i,r){n._createChildMenuItem($.extend({},t[i],{decorated:!0}),$(r))});this._childrenCreated=!0},i.prototype._getDefaultMenuItem=function(){if(!this._defaultMenuItem){var n=new it;n._type=g.None;n._parent=this;n._align=d.RightBottom;n.setIndex(-1);this._children.push(n);this._defaultMenuItem=n}return this._defaultMenuItem},i.prototype._getNextEnabledItem=function(n,t){function u(n,t){for(var u,i=n;i<=t;i++)if(u=r[i],u.isEnabled())return u;return null}var f=t&&t.rollOver===!0,i,r=this._menuItems;return(n=n||0,i=u(n,r.length-1),i)?i:f&&(i=u(0,n),i)?i:null},i.prototype._getPrevEnabledItem=function(n,t){function u(n,t){for(var u,i=t;i>=n;i--)if(u=r[i],u.isEnabled())return u;return null}var f=t&&t.rollOver===!0,i,r=this._menuItems;return(n=n||0,i=u(0,n),i)?i:f&&(i=u(n,r.length-1),i)?i:null},i.prototype._ensurePopup=function(){this._ensureInitialized()&&(this._popupElement=this._element);this._ensureChildren()},i.prototype._getPopupAlign=function(n){switch(n){case d.RightJustify:return["left-top","right-top"];case d.RightBottom:return["right-top","right-bottom"];case d.LeftTop:return["left-bottom","left-top"]}return["left-top","left-bottom"]},i.prototype._showPopup=function(n,t){var u=this,r;this._clearTimeouts();this._ensurePopup();this._pinElement=n;v.delay(this,300,function(){u._attachAncestorScroll(n)});this.updateMenuItemStates();r=this._getPopupAlign(t);this._element.show();this._positioningRoutine=function(){var f,e,o,t,u;(this._options.alignToMarkerVertical||this._options.alignToMarkerHorizontal)&&($.isFunction(this._options.getAlignmentMarkers)?(o=this._options.getAlignmentMarkers.call(this,this._element,n),f=o.elementAlignmentMarker,e=o.baseAlignmentMarker):(f=this._element.find(".alignment-marker").first(),e=n.find(".alignment-marker:not(.sub-menu .alignment-marker)").first()));t=this._options.overflow;t||(u=this._parent&&this._parent._parent,t=!(u instanceof i)||u instanceof ct||u instanceof st?"fit-flip":"flip-flip");y.Positioning.position(this._element,n,{elementAlign:r[0],baseAlign:r[1],overflow:t,supportScroll:!0,scrollByMarker:this._options.scrollByMarker,alignToMarkerHorizontal:this._options.alignToMarkerHorizontal,alignToMarkerVertical:this._options.alignToMarkerVertical,elementAlignmentMarker:f,baseAlignmentMarker:e})};this._positioningRoutine.call(this);this._visible=!0;this.getOwner()._updateSubMenuVisibleState();this.ownFocus()},i.prototype._hidePopup=function(){this._visible&&this._options.item.dynamic&&this._clear();this._clearTimeouts();this._visible=!1;this._pinElement&&(this._detachAncestorScroll(this._pinElement),this._pinElement=null);this._popupElement&&this._popupElement.hide();delete this._positioningRoutine;this.hideChildren(null,{immediate:!0});this.getOwner()._updateSubMenuVisibleState()},i.prototype._updateMenuItemStates=function(){function e(){t&&t.isHidden()===r&&t.update($.extend(t._item,{separator:!0,hidden:!r}))}for(var n,f=this._children,t,r=!1,i=0,u=f.length;i<u;i++)n=f[i],n.isSeparator()&&!n.isLabel()?(e(),t=n,r=!1):(t&&!n.isHidden()&&(r=!0),n._updateState(),n.updateText());e()},i.prototype._startShowTimeout=function(n,t){this._clearTimeouts();this.delayExecute("show",this.getOwner()._options.showTimeout,!0,b(this,this._showPopup,[n,t]))},i.prototype._startHideTimeout=function(){this._clearTimeouts();this.delayExecute("hide",this.getOwner()._options.hideTimeout,!0,this._hidePopup)},i.prototype._clearTimeouts=function(){this.cancelDelayedFunction("show");this.cancelDelayedFunction("hide")},i.prototype._attachAncestorScroll=function(n){this._bind($(n).parents(),"scroll",b(this,this._onParentScroll))},i.prototype._detachAncestorScroll=function(n){this._unbind($(n).parents(),"scroll")},i.prototype._dispose=function(){this._pinElement&&this._detachAncestorScroll(this._pinElement);n.prototype._dispose.call(this)},i.prototype._onParentScroll=function(){y.BrowserCheckUtils.isEdge()&&this._mouseIsDown||this._hidePopup()},i.prototype._onMouseDown=function(n){var t=this;n.which===1&&this._blockBlurUntilTimeout();y.BrowserCheckUtils.isEdge()&&(this._mouseIsDown=!0,this._bind(window.document,"mouseup",function(){t._mouseIsDown=!1;t._unbind(window.document,"mouseup")},!0))},i.prototype._blockBlurUntilTimeout=function(){this._blockBlur=!0;this.delayExecute("blockBlur",200,!0,function(){this._blockBlur=!1})},i.prototype.refreshContributedItems=function(){!this._menuContributionProvider&&this._options.contributionIds&&(this._menuContributionProvider=new vt(this,r.getDefaultWebContext(),this._options.contributionIds,this._options.contributionType,this._getContributionContext.bind(this),this._contributionProviderOptions));this._refreshContributedMenuItems()},i.prototype._refreshContributedMenuItems=function(){var n=this;this._menuContributionProvider&&(this._contributionPromise=this._menuContributionProvider.getContributedMenuItems(this._getContributionContext()).then(function(t){t&&t.length&&n._updateItemsWithContributions(n._itemsSource,t)}))},i.prototype.updateContributedMenuItems=function(n){var t=this;this._contributionPromise.then(function(){var i=[];(function r(n){Array.prototype.push.apply(i,n);n.forEach(function(n){n.childItems&&n.childItems.length>0&&r(n.childItems)})})(n);i=i.filter(function(n){return!!n.id});t._updateContributedMenuItems(i)})},i.prototype._getContributionContext=function(){var n=this._options.contextInfo?$.extend({},this._options.contextInfo.item):{};return $.isFunction(n.getContributionContext)?n=n.getContributionContext():$.isFunction(this._options.getContributionContext)&&(n=this._options.getContributionContext()),n},i.enhancementTypeName="tfs.menu.menu",i}(ft);t.Menu=rt;p.initClassPrototype(rt,{_items:null,_itemsSource:null,_menuItems:null,_defaultMenuItem:null,_selectedItem:null,_focusItem:null,_childrenCreated:!1,_popupElement:null,_visible:!1,_active:!1,_blockBlur:!1,_skipUpdateMenuItemStates:!1,_positioningRoutine:null,_pinElement:null});et=function(n){function t(t){n.call(this,t);this._align=d.parse(this._options.align)}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({markUnselectable:!0,showIcon:!0,showTimeout:500,hideTimeout:500},t))},t.prototype.setShowIcon=function(n){this._options.showIcon=n},t.prototype.initialize=function(){n.prototype.initialize.call(this);this._fire("menuInitialized",{menu:this})},t.prototype._decorate=function(){var t;n.prototype._decorate.call(this);this._focusElement=t=$(tt("div","menu-focus-receiver")).attr("tabIndex",0).attr("role","menu");this._bind(t,"keydown",b(this,this._onKeyDown));this._bind(t,"focus",b(this,this._onFocus));this._bind(t,"blur",b(this,this._onBlur));this._bind(t,"contextmenu",b(this,this._onContextMenu));this._element.append($(tt("li","menu-focus-container")).append(t))},t.prototype.getMenuItemAlignment=function(){return this._options.popupAlign||n.prototype.getMenuItemAlignment.call(this)},t.prototype.getMenuItemOptions=function(t,i){return n.prototype.getMenuItemOptions.call(this,t,$.extend({immediateShowHide:!0,clickToggles:!0,type:"static"},i))},t.prototype.escape=function(){return!1},t.prototype.escaped=function(){},t.prototype.isActive=function(){return this._active},t.prototype.activate=function(){if(!this._activating){this._activating=!0;try{this._clearBlurTimeout();this._active=!0;y.tryFocus(this._focusElement);$.isFunction(this._options.onActivate)&&this._options.onActivate.call(this)}finally{this._activating=!1}}},t.prototype._updateAriaAttribute=function(n){n&&n._element&&this._focusElement.attr("aria-activedescendant",n._element.attr("id"))},t.prototype._hide=function(){this._active&&(this.hide({immediate:!0}),this.ownFocus())},t.prototype._blur=function(){this._clearBlurTimeout();this.hide({immediate:!0});this._disposed||this._selectItem(null);this._active=!1;$.isFunction(this._options.onDeactivate)&&this._options.onDeactivate.call(this)},t.prototype._updateSubMenuVisibleState=function(){var n,u,t,i=this._menuItems,r;if(this._subMenuVisible=!1,$.isArray(i))for(n=0,u=i.length;n<u;n++)if(t=i[n],t.hasSubMenu()&&(r=t.getSubMenu(),r._parent===t&&r._visible)){this._subMenuVisible=!0;break}},t.prototype._onKeyDown=function(n){if(this._focusItem&&this._focusItem._onKeyDown(n)===!1)return!1;if(n.keyCode===nt.TAB)this._immediateBlur=!0;else if(n.keyCode===nt.F10&&n.shiftKey)return this._onContextMenu(n)},t.prototype._onFocus=function(){this.activate();(!this._selectedItem||this._selectedItem&&this._selectedItem.getIndex()<0)&&this.selectFirstItem()},t.prototype._onBlur=function(){this._immediateBlur?(this._immediateBlur=!1,this._blur()):this._blockBlur?this._startBlurTimeout():this._blur()},t.prototype._proceedBlur=function(){this._canBlur=!0},t.prototype._startBlurTimeout=function(){this.delayExecute("blur",y.Constants.BlurTimeout,!0,function(){this._canBlur?(this._canBlur=!1,this._blur()):this.activate()})},t.prototype._clearBlurTimeout=function(){this.cancelDelayedFunction("blur")},t.prototype._onParentScroll=function(){this._hide()},t.prototype._onResize=function(){this._hide()},t.prototype._onContextMenu=function(){return this.showSubMenuOnFocusedItem()},t.prototype.showSubMenuOnFocusedItem=function(){var n=this._focusItem;return n&&n.tryShowSubMenu({immediate:!0}),!1},t}(rt);t.MenuOwner=et;p.initClassPrototype(et,{_focusItem:null,_focusElement:null,_activating:!1,_subMenuVisible:!1,_align:null,_canBlur:!1,_immediateBlur:!1});ot=function(n){function t(t){n.call(this,t);this.setEnhancementOptions({role:"menubar",coreCssClass:"menu-bar"+(this._options.useBowtieStyle?" bowtie-menus":"")});this._orientation=ut.parse(this._options.orientation);this._type=g.Static;this._contributionProviderOptions={defaultTextToTitle:!1}}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,t)},t.prototype.getMenuItemAlignment=function(){return this._orientation===ut.Horizontal?"left-bottom":"right-justify"},t.prototype.selectUp=function(t){return n.prototype.selectLeft.call(this,t)},t.prototype.selectDown=function(t){return n.prototype.selectRight.call(this,t)},t.prototype.selectLeft=function(){var t=this._subMenuVisible;return(this.hideChildren(null,{immediate:!0}),n.prototype.selectUp.call(this),t&&(this._subMenuVisible=!0,this._selectedItem.tryShowSubMenu({immediate:!0})))?(this._selectedItem.getSubMenu().selectFirstItem(),!0):!1},t.prototype.selectRight=function(){var t=this._subMenuVisible;return(this.hideChildren(null,{immediate:!0}),n.prototype.selectDown.call(this),t&&(this._subMenuVisible=!0,this._selectedItem.tryShowSubMenu({immediate:!0})))?(this._selectedItem.getSubMenu().selectFirstItem(),!0):!1},t.enhancementTypeName="tfs.menu.menubar",t}(et);t.MenuBarO=ot;st=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.tryActivate=function(n){var t=this._getMenuBar(n);return t?(t.focus(),!0):!1},t.tryShowSubMenu=function(n){var t=this._getMenuBar(n);return t?(t.focus(),v.delay(this,0,function(){t.showSubMenuOnFocusedItem()}),!0):!1},t.prototype.focus=function(){this.activate()},t._getMenuBar=function(n){var i=$(n);return e.Enhancement.getInstance(t,i)},t}(ot);t.MenuBar=st;p.initClassPrototype(ot,{_orientation:ut.Horizontal});yt=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.escaped=function(){n.prototype.escaped.call(this);this._parent.escaped()},t}(it);ht=function(n){function t(t){n.call(this,t);this.setEnhancementOptions({coreCssClass:"menu-popup"+(this._options.useBowtieStyle?" bowtie-menus":""),hidden:!0});this._type=g.Popup;this._hidden=this._options.hidden===!0;this._onHide=this._options.onHide}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,t)},t.prototype._getMenuItemType=function(){return yt},t.prototype._decorate=function(){n.prototype._decorate.call(this);this._hidden===!0&&this._element.addClass("invisible")},t.prototype.popup=function(n,t){var r=this;if(this._escapeFocusReceiver=n,this._popupPinElement=t,this._floating=!0,this._active)this.escaped();else{var i=null,f=!1,u=function(){i&&(i.cancel(),i=null);r._active||f||(r.activate(),r._showPopupMenu(),f=!0)};this._contributionPromise?(this._contributionPromise.then(u),i=v.delay(this,500,u)):u()}},t.prototype._showPopupMenu=function(){var t=this._getFirstMenuItem(),n=t.getSubMenu();n&&(n.show({immediate:!0,element:this._popupPinElement,align:this._align}),n.selectDefaultItem())},t.prototype._updateItemsWithContributions=function(n,t){if(this._contributedItems=t,n&&n.length>0&&n[0].childItems){var i=$.grep(n[0].childItems,function(n){return!n.isContribution});n[0].childItems=i.concat(t)}else n=[{childItems:t}];this._updateCombinedSource(n)},t.prototype._updateCombinedSource=function(t){n.prototype._updateCombinedSource.call(this,t);this._active&&this._showPopupMenu()},t.prototype.selectUp=function(){return!0},t.prototype.selectDown=function(t){var i=t&&t.redirected;return!i&&this._align!==d.RightJustify?n.prototype.selectRight.call(this):!1},t.prototype.selectLeft=function(){return!0},t.prototype.selectRight=function(t){var i=t&&t.redirected;return!i&&this._align===d.RightJustify?n.prototype.selectRight.call(this):!1},t.prototype.escaped=function(){this._floating&&(this._floating=!1,this._escapeFocusReceiver&&(this._escapeFocusReceiver.focus(),this._escapeFocusReceiver=null,$.isFunction(this._options.onPopupEscaped)&&this._options.onPopupEscaped.call(this)))},t.prototype._hidePopup=function(){this._onHide&&this._onHide(this._escapeFocusReceiver);n.prototype._hidePopup.call(this)},t.enhancementTypeName="tfs.menu.popup",t}(et);t.PopupMenuO=ht;ct=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(ht);t.PopupMenu=ct;p.initClassPrototype(ht,{_align:d.RightJustify,_floating:!1,_hidden:!1,_escapeFocusReceiver:null});pt=function(n){function i(t){n.call(this,t)}return __extends(i,n),i.prototype.initialize=function(){var t=this._element.data();n.prototype.initialize.call(this);this._bind(t.commandAction||"click",b(this,this.onCommandExecute));t.commandCompleteEvent&&this._bind(window,t.commandCompleteEvent,b(this,this.onCommandComplete))},i.prototype.onCommandExecute=function(){var n=this._element.data();return n.commandName&&(this._element.prop("disabled",!0),t.menuManager.executeCommand(new h.CommandEventArgs(n.commandName,n.commandArg,this))),!1},i.prototype.onCommandComplete=function(){this._element.removeAttr("disabled")},i}(e.BaseControl);e.Enhancement.registerEnhancement(st,".menu-bar.enhance");e.Enhancement.registerEnhancement(ct,".menu-popup.enhance");e.Enhancement.registerEnhancement(pt,".single-command");t.sortMenuItems=dt;wt=function(){function n(){}return n.msort=function(n,t,i){var u=i-t,r;u<2||(r=t+Math.floor(u/2),this.msort(n,t,r),this.msort(n,r,i),this.merge(n,t,r,i))},n.merge_sort=function(n){this.msort(n,0,n.length)},n.merge=function(n,t,i,r){for(;t<i;++t)if(this.cmpFunc(n[t],n[i])>0){var u=n[t];n[t]=n[i];this.insert(n,i,r,u)}},n.arr_swap=function(n,t,i){var r=n[t];n[t]=n[i];n[i]=r},n.insert=function(n,t,i,r){while(t+1<i&&this.cmpFunc(n[t+1],r)<0)this.arr_swap(n,t,t+1),++t;n[t]=r},n.sort=function(n,t){var i=n.slice(0);return this.cmpFunc=t,this.merge_sort(i),i},n}();p.tfsModuleLoaded("VSS.UI.Controls.Menus",t)});
define("Gallery/Client/Controls/RatingAndReviewDetails/RatingAndReviewDetails.View",["require","exports","Gallery/Client/Controls/RatingAndReviewDetails/RatingAndReviewDetails.ViewModel","Gallery/Client/Common/Utility","Gallery/Client/Common/Utility.Common","Gallery/Client/Common/Constants","VSS/Controls/Menus","VSS/Controls","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","VSS/Utils/String","VSS/Events/Services","VSS/Adapters/Knockout","VSS/Utils/Core"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){var v=a.delegate,y=r.WindowWrapper,p=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.initialize=function(){var t=this;n.prototype.initialize.call(this);this._writeReviewCallback=v(this,this._onWriteReview);this._writeReviewCompleteCallback=v(this,this._writeReviewComplete);this._seeMoreClickCallback=v(this,this._onSeeMoreClick);this._onReportReviewCallback=v(this,this._onReportReview);this._onReviewReportedCallback=v(this,this._onReviewReported);this._publisherReplyButtonClickCallback=v(this,this._onPublisherReplyButtonClick);this._publisherReplyCompleteCallback=v(this,this._onPublisherReplyComplete);c.getService().attachEvent(i.RatingAndReviewDetailsViewModel.EVENT_ON_WRITE_REVIEW,this._writeReviewCallback);c.getService().attachEvent(i.RatingAndReviewDetailsViewModel.EVENT_ON_WRITE_REVIEW_COMPLETE,this._writeReviewCompleteCallback);c.getService().attachEvent(i.RatingAndReviewDetailsViewModel.EVENT_ON_SEE_MORE_CLICK,this._seeMoreClickCallback);c.getService().attachEvent(i.RatingAndReviewDetailsViewModel.EVENT_ON_REPORT_REVIEW,this._onReportReviewCallback);c.getService().attachEvent(i.RatingAndReviewDetailsViewModel.EVENT_ON_REVIEW_REPORTED,this._onReviewReportedCallback);c.getService().attachEvent(i.RatingAndReviewDetailsViewModel.EVENT_ON_PUBLISHER_REPLY_OR_EDIT_BUTTON_CLICK,this._publisherReplyButtonClickCallback);c.getService().attachEvent(i.RatingAndReviewDetailsViewModel.EVENT_ON_PUBLISHER_REPLY_COMPLETE,this._publisherReplyCompleteCallback);$(window).bind("scroll",function(){t._disposeExistingPopup()})},t.prototype._writeReviewComplete=function(){this._closeReviewDialog()},t.prototype._disposeExistingPopup=function(){this._popupMenu&&(this._popupMenu.dispose(),delete this._popupMenu)},t.prototype._createPopupMenu=function(n,t){this._disposeExistingPopup();var i=o.BaseControl.createIn(e.PopupMenu,n,{align:"right-bottom",showIcon:!1,items:[{childItems:this._getMenuItems(t)}]});i.getElement().addClass("menu-popup");i.popup(n,n);this._popupMenu=i},t.prototype._getMenuItems=function(n){var i=this,t=[];return $.each(n,function(n,r){var u={title:r.elementHoverText,showText:!0,action:function(){i.getViewModel().submitViolationDetails(n)}};r.elementLabel&&(u.text=r.elementLabel);t.push(u)}),t},t.prototype._onWriteReview=function(){this.getViewModel().isUserAuthenticated?this._openReviewDialog():(u.setCookie(f.RatingConstants.showWriteDialogBox,"true"),this._redirectToSignInPage(i.RatingAndReviewDetailsViewModel.SHOW_REVIEW_DIALOG))},t.prototype._onPublisherReplyButtonClick=function(){if(this.getViewModel().isUserAuthenticated){var n=$("#publisher-reply-control-container");n.modal({keyboard:!0})}},t.prototype._onPublisherReplyComplete=function(){this._closePublisherReplyDialog()},t.prototype._closePublisherReplyDialog=function(){var n=$("#publisher-reply-control-container");n.modal("hide")},t.prototype._closeReviewDialog=function(){var n=$("#write-review-control-container");n.modal("hide")},t.prototype._openReviewDialog=function(){this.getViewModel().restoreWriteReviewFormData();$("html, body").scrollTop($(".user-reviews-section-header").offset().top);var n=$("#write-review-control-container");n.modal({keyboard:!0})},t.prototype._createMenuElements=function(){return[{elementHoverText:h.format(s.RatingAndReviewReportText,this.getViewModel().concernCategories[0]),elementLabel:h.format(s.RatingAndReviewReportText,this.getViewModel().concernCategories[0])},{elementHoverText:h.format(s.RatingAndReviewReportText,this.getViewModel().concernCategories[1]),elementLabel:h.format(s.RatingAndReviewReportText,this.getViewModel().concernCategories[1])},{elementHoverText:h.format(s.RatingAndReviewReportText,this.getViewModel().concernCategories[2]),elementLabel:h.format(s.RatingAndReviewReportText,this.getViewModel().concernCategories[2])}]},t.prototype._onReportReview=function(n){var t=this.getViewModel(),r,u;t.isUserAuthenticated?n===t&&(r=this._createMenuElements(),u=$(".flag-review").eq(t.flagReviewIndex),this._createPopupMenu(u,r)):this._redirectToSignInPage(i.RatingAndReviewDetailsViewModel.SHOW_REPORT_REVIEW_DIALOG)},t.prototype._onReviewReported=function(n){var i=this,r=this.getViewModel(),t;n===r&&r.reviewReportedSuccessfully&&(t=$("#feedback-popup-control-container"),this._bind(t,"shown.bs.modal",function(){a.delay(i,10,function(){t.find(".feedback-popup-close-button").focus();i._unbind(t,"shown.bs.modal")})}),t.modal("show"))},t.prototype._redirectToSignInPage=function(n){var t=r.UrlUtils.setReplyToParameterInLoginRedirectUrl(n,"true");y.open(t,"_self")},t.prototype._onSeeMoreClick=function(){$("html,body").animate({scrollTop:$(".see-more-reviews").offset().top},"slow")},t.prototype.dispose=function(){$(window).unbind("scroll");n.prototype.dispose.call(this)},t.prototype._cleanup=function(){this._disposeExistingPopup();c.getService().detachEvent(i.RatingAndReviewDetailsViewModel.EVENT_ON_WRITE_REVIEW,this._writeReviewCallback);c.getService().detachEvent(i.RatingAndReviewDetailsViewModel.EVENT_ON_WRITE_REVIEW_COMPLETE,this._writeReviewCompleteCallback);c.getService().detachEvent(i.RatingAndReviewDetailsViewModel.EVENT_ON_SEE_MORE_CLICK,this._seeMoreClickCallback);c.getService().detachEvent(i.RatingAndReviewDetailsViewModel.EVENT_ON_REPORT_REVIEW,this._onReportReviewCallback);c.getService().detachEvent(i.RatingAndReviewDetailsViewModel.EVENT_ON_REVIEW_REPORTED,this._onReviewReportedCallback);n.prototype._cleanup.call(this)},t}(l.TemplateControl);t.RatingAndReviewDetailsView=p});
define("Gallery/Client/Controls/MetaDataList/MetaDataList.ViewModel",["require","exports","VSS/Adapters/Knockout"],function(n,t,i){var r=function(n){function t(t){n.call(this);t&&(this.metaDataListGroups=t.metaDataListGroups)}return __extends(t,n),t}(i.TemplateViewModel);t.MetaDataListViewModel=r});
define("Gallery/Client/Controls/VSSItemDownload/VSSItemDownload.ViewModel",["require","exports","VSS/Diag","VSS/Adapters/Knockout","knockout","VSS/Utils/String","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/URLHelper"],function(n,t,i,r,u,f,e,o){var s=function(n){function t(t){n.call(this);this._startDownload=u.observable(!1);this._downloadLink=u.observable("");this._managePageExampleUrlString="("+e.ForExample+", http://someserver:8080/tfs/_gallery/manage)";this._item=t.item;t.postDownloadCallback&&(this._postDownloadCallback=t.postDownloadCallback);this._vssGallery=t.vssGalleryProvider;this._initialize(t.startDownloadOnInit)}return __extends(t,n),t.prototype._initialize=function(n){this._downloadLink(o.GalleryURLs.getPackageDownloadURL(this._item.publisherName,this._item.name,this._item.version));n?this.initiateDownload():this.resetDownload();this._downloadStarted=f.format(e.DownloadStartedMessage,this._item.title);this._instructionSetTitleHtml=f.format(e.DownloadInstructionsTitle,this._item.title);this._instructionNavigateToServerString=e.PostDownload_NavigateToServer;this._instructionUploadFileHtml=f.format(e.PostDownload_UploadExtension,"<strong>"+e.Publisher_View_UploadActionText+"<\/strong>");this._instructionInstallHtml=f.format(e.PostDownload_InstallExtension,"<strong>"+e.ItemInstall+"<\/strong>")},t.prototype.initiateDownload=function(){this.resetDownload();this._startDownload(!0);this._postDownloadCallback&&this._postDownloadCallback()},t.prototype.resetDownload=function(){this._startDownload(!1)},t}(r.TemplateViewModel);t.VssItemDownloadViewModel=s});
define("Gallery/Client/Service/GitHubServiceProvider/GitHubServiceProvider",["require","exports","q","VSS/Utils/String"],function(n,t,i,r){var f=function(){function n(){}return n.prototype.getGitHubRepositoryDetails=function(n,t){var f=i.defer();return $.when($.ajax(r.format(u.ITEM_DETAILS_PULL_REQUEST_API_LINK,n,t)),$.ajax(r.format(u.ITEM_DETAILS_REPO_DETAILS_API_LINK,n,t)),$.ajax(r.format(u.ITEM_DETAILS_LAST_COMMIT_API_LINK,n,t))).done(function(n,t,i){var r={itemDetailsPullRequestCount:n[0].length?n[0].length:0,itemDetailsOpenIssuesCount:t[0].open_issues-n[0].length?t[0].open_issues-n[0].length:0,itemDetailsLastPushedAtDateString:i[0][0].commit.author.date};f.resolve(r)}).fail(function(n,t,i){f.reject("error1: "+n+" error2: "+t+" error3: "+i)}),f.promise},n}(),u;t.GitHubServiceProvider=f;u=function(){function n(){}return n.ITEM_DETAILS_PULL_REQUEST_LINK="https://github.com/{0}/{1}/pulls",n.ITEM_DETAILS_OPEN_ISSUES_LINK="https://github.com/{0}/{1}/issues",n.ITEM_DETAILS_LAST_COMMIT_LINK="https://github.com/{0}/{1}/commits",n.ITEM_DETAILS_PULL_REQUEST_API_LINK="https://api.github.com/repos/{0}/{1}/pulls",n.ITEM_DETAILS_REPO_DETAILS_API_LINK="https://api.github.com/repos/{0}/{1}",n.ITEM_DETAILS_LAST_COMMIT_API_LINK="https://api.github.com/repos/{0}/{1}/commits",n}();t.ItemConstants=u});
define("Gallery/Client/Controls/VSSItemDetails/VSSItemDetails.ViewModel",["require","exports","knockout","q","Gallery/Client/Controls/BreadCrumb/BreadCrumb.ViewModel","Gallery/Client/Common/Constants","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/Common/Telemetry","Gallery/Client/Common/TelemetryInternal","Gallery/Client/Service/VSSItemHelper","Gallery/Client/Service/Item","Gallery/Client/3rdParty/marked","Gallery/Client/Controls/RatingAndReviewDetails/RatingAndReviewDetails.View","Gallery/Client/Controls/RatingAndReviewDetails/RatingAndReviewDetails.ViewModel","Gallery/Client/Controls/RatingControl/RatingControl.ViewModel","Gallery/Client/Controls/MetaDataList/MetaDataList.ViewModel","Gallery/Client/URLHelper","Gallery/Client/Common/Utility","Gallery/Client/Common/Utility.Common","Gallery/Client/Service/VSSGallery/VSSGallery","Gallery/Client/Service/VSSItem","Gallery/Client/Controls/VSSItemDownload/VSSItemDownload.ViewModel","Gallery/Client/Service/GitHubServiceProvider/GitHubServiceProvider","VSS/Context","VSS/Diag","VSS/FeatureAvailability/Services","VSS/Gallery/Contracts","VSS/Adapters/Knockout","VSS/Serialization","VSS/Utils/Html","VSS/Utils/String","VSS/Utils/Url","VSS/Utils/Date"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt){var at=o.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.ItemDetailsProperties,vt=function(n){function t(t){n.call(this);this.brandingTheme="light";this.previewString=null;this.publisherLink=null;this.downloads=0;this.downloadsText="";this.separatorText="";this.showDownloads=!1;this.showVerifiedPublisher=!1;this.showRatingReview=!1;this.reviewResultsLoaded=i.observable(!1);this.trialLinkNewTab=!1;this.actionLinkNewTab=!1;this.alreadyInstalled=!1;this.freeInstallHtml=null;this.freeInstallLink=null;this.installButtonText=e.InstallButtonText;this.trialButtonText=e.StartTrialText;this.showTrial=!1;this.trialLink="";this._testCommerce=!1;this.downloadButtonText=e.DownloadButtonText;this.downloadLink=null;this.itemDownloadViewModel=null;this.initiateDownloadonPageLoad=!1;this.isVSCode=!1;this.VSCodeCopyCommandOptions=i.observable(null);this.offersCost=null;this.offersCostText=null;this.itemTags=[];this.itemCategories=[];this.closeDialogText=e.CloseButtonText;this.showModalInstall=!1;this.initiateInstall=!1;this.getStartedLink=null;this.itemDetailsLearnLink=null;this.itemDetailsSupportLink=null;this.itemDetailsFeedbackLink=null;this.itemDetailsLicenseLink=null;this.itemPublisherKey=e.PublisherText;this.itemPublishedDateKey=e.PublishedDateText;this.itemGetStartedKey=e.ItemGetStarted;this.itemUpdateDateKey=e.ItemLastUpdatedDate;this.itemVersionKey=e.ItemVersion;this.itemDetailsShareKey=e.ItemDetailsShare;this.itemDetailsLearnString=e.ItemDetailsLearn;this.itemDetailsSupportString=e.ItemDetailsSupport;this.itemDetailsFeedbackString=e.ItemDetailsFeedBack;this.itemDetailsLicenseString=e.LicenseText;this.itemTabOverviewString=e.ItemTabOverview;this.itemPricingString=e.ItemPricing;this.reportAbuseString=e.ItemDetailsReportAbuseLinkText;this.itemMoreInfoText=e.MoreInfoText;this.itemResourcesText=e.ResourcesText;this.itemProjectDetailsText=e.ProjectDetailsText;this.itemVerifiedPublisherCategoryText=e.VerifiedPublisherCategory;this.startPlanInfoText="";this.pricePerMonthText=e.PricePerMonthText;this.usersText=e.UsersText;this.showOfferPlans=!1;this.planBasedPricing=!1;this.itemDetailsGitHubLink=i.observable(null);this.itemDetailsPullRequestLink=null;this.itemDetailsOpenIssuesLink=null;this.itemDetailsLastCommitLink=null;this.itemDetailsGitHubString=null;this.itemDetailsPullRequestString=i.observable(null);this.itemDetailsOpenIssuesString=i.observable(null);this.itemDetailsLastCommitString=i.observable(null);this.vssDetailedItem=t.vssDetailedItem;this._gitHubServiceProvider=t.gitHubServiceProvider;this._vssGallery=t.vssGalleryProvider;t.vssDownloadVsixFlag&&(this.initiateDownloadonPageLoad=t.intiateDownloadOnPageLoad,this._initializeDownloadOptions(),this.freeInstallHtml=ht.format(e.VSS_Extension_Download_Help,"<strong>"+e.ItemInstall+"<\/strong>","<strong>"+e.Download+"<\/strong>"));this.initiateInstall=t.intiateInstall;this.showMinimalView=t.showMinimalView;this.itemLoaded=r.defer();this.ratingControl=a.RatingAndReviewDetailsView;this._testCommerce=w.GalleryURLs.isTestCommerceEnabled(b.WindowWrapper.getQueryString());this.fullyQualifiedItemName=g.ItemModelHelper.getFullyQualifiedNameForItem(this.vssDetailedItem.publisherName,this.vssDetailedItem.name);this._initialize()}return __extends(t,n),t.prototype._initialize=function(){this._initializeMarkedOptions();this._initializeControlBindings();this._publishTelemetryEvent()},t.prototype.onItemLoaded=function(){return this.itemLoaded.promise},t.prototype._initializeDownloadOptions=function(){var n=this,r=it.getDefaultWebContext().user,i;r?(this.downloadLink="#download-pop-up",i={item:this.vssDetailedItem,vssGalleryProvider:this._vssGallery,startDownloadOnInit:this.initiateDownloadonPageLoad,postDownloadCallback:function(){var t={};t[at.Id]=g.ItemModelHelper.getFullyQualifiedNameForItem(n.vssDetailedItem.publisherName,n.vssDetailedItem.name);t[at.ProductType]=g.ItemModelHelper.getItemTypeText(n.vssDetailedItem.itemType);s.TelemetryHelper.publishEvent(o.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.ITEM_DOWNLOAD,t);var i=$(".download-control-container").eq(0),r=parseInt(i.css("width")),u=$(window).width()/2-r/2;i.css("left",u+"px")}},this.itemDownloadViewModel=new nt.VssItemDownloadViewModel(i)):this.downloadLink=b.UrlUtils.setReplyToParameterInLoginRedirectUrl(t.QUERY_PARAM_DOWNLOAD,"true")},t.prototype.getExternalDataProvider=function(){return this._vssGallery&&this._vssGallery instanceof d.VSSGalleryExternalProvider?this._vssGallery:null},t.prototype._publishTelemetryEvent=function(){var n={};n[at.Id]=g.ItemModelHelper.getFullyQualifiedNameForItem(this.vssDetailedItem.publisherName,this.vssDetailedItem.name);n[at.ProductType]=g.ItemModelHelper.getItemTypeText(this.vssDetailedItem.itemType);n[at.PriceCategory]=c.priceCategory[this.vssDetailedItem.priceCategory];n[at.IsPublic]=this.vssDetailedItem.isPublic;s.TelemetryHelper.publishEvent(o.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.ITEMDETAILSPAGE,n)},t.prototype._initializeMarkedOptions=function(){var n=this;this.markedOptions={gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1};this.markedOptions.renderer=new l.Renderer;this.markedOptions.renderer._image=this.markedOptions.renderer.image;this.markedOptions.renderer.image=function(t,i,r){var u=n.getItemAssetSourceURL(t);return n.markedOptions.renderer._image(u,i,r)};this.markedOptions.renderer._link=this.markedOptions.renderer.link;this.markedOptions.renderer.link=function(t,i,r){var u=n.getItemAssetSourceURL(t);return n.markedOptions.renderer._link(u,i,r)}},t.prototype.getItemAssetSourceURL=function(n){var t=n;return n&&n.length>0&&(n.charAt(0)==="/"&&(n=n.substr(1)),b.UrlUtils.isAbsoluteUrl(n)||(t=this._vssGallery.getItemAssetSourceURL(this.vssDetailedItem.id,this.vssDetailedItem.version,n))),t},t.prototype._initializeControlBindings=function(){this._initializeBreadCrumb();this._initializeItemBanner();this._initalizeItemDetails()},t.prototype._initializeItemBanner=function(){var n=this,t,r,u,i;if(this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_BRANDING_COLOR]?(t=this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_BRANDING_COLOR],r=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t),this.brandingColor=r?t:null):this.brandingColor=null,this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_BRANDING_THEME]&&(this.brandingTheme=ht.ignoreCaseComparer(this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_BRANDING_THEME],"dark")===0?"dark":"light"),this.itemName=this.vssDetailedItem.title,this.vssDetailedItem.offerDetails&&ut.FeatureAvailabilityService.isFeatureEnabled(f.FeatureFlag.EnableThirdPartyCommerce,!1)&&g.ItemModelHelper.isThirdPartyPaidExtension(this.vssDetailedItem)?this.previewString=e.ItemPaidPreview:this.vssDetailedItem.priceCategory===c.priceCategory.Preview&&(this.previewString=e.ItemPreview),this.itemImageUrl=this.vssDetailedItem.brandingImageUrl||this.vssDetailedItem.imageUrl,this.downloads=this.vssDetailedItem.installCount,this.downloadsText=this.downloads===1?ht.format(e.ItemInstallText,this.downloads):ht.format(e.ItemInstallsText,this.downloads),this.separatorText=e.SeparatorText,this.showDownloads=this.vssDetailedItem.isBuiltIn||this.vssDetailedItem.itemType===g.VSSItemType.VSSOffer||this.downloads<1||!it.getPageContext().webAccessConfiguration.isHosted?!1:!0,(this.vssDetailedItem.itemType===g.VSSItemType.VSSIntegration||this.vssDetailedItem.itemType===g.VSSItemType.VSSExtension)&&this.isPublisherVerified(this.vssDetailedItem.publisherFlags)&&(u=ut.FeatureAvailabilityService.isFeatureEnabled(f.FeatureFlag.PublisherCategoryDisplay,!1),u&&(this.showVerifiedPublisher=!0)),i=ut.FeatureAvailabilityService.isFeatureEnabled(f.FeatureFlag.ShowRatingAndReview,!1),k.FeatureFlagUtils.isFeatureFlagEnabled(location.href,k.FeatureFlagUtils.ratingReviewFF)&&(k.FeatureFlagUtils.setFeatureFlagCookie(k.FeatureFlagUtils.ratingReviewFF),i=!0),i&&this.vssDetailedItem.itemType!==g.VSSItemType.VSSOffer){this.showRatingReview=!0;var o=5,s=ft.ReviewFilterOptions.FilterEmptyReviews|ft.ReviewFilterOptions.FilterEmptyUserNames,h=y.IRatingStarType.DarkStar;ht.equals(this.brandingTheme,"dark")&&(h=y.IRatingStarType.LightStar);this._vssGallery.getReviews(this.vssDetailedItem.publisherName,this.vssDetailedItem.name,o,s).then(function(t){var i={reviewResults:t,pageSize:o,filterOptions:s,itemInfo:n.vssDetailedItem,vssGalleryDataProvider:n._vssGallery,ratingStarType:h};n.ratingAndReviewDetailsData=new v.RatingAndReviewDetailsViewModel(i);n.reviewResultsLoaded(!0);n.itemLoaded.resolve(null)},function(n){alert(n.message)})}this.itemDescription=this.vssDetailedItem.longDescription||this.vssDetailedItem.shortDescription;this.publisherDisplayName=this.vssDetailedItem.publisherDisplayName;it.getPageContext().webAccessConfiguration.isHosted&&(this.publisherLink=w.GalleryURLs.getSearchPageUrlForPublisherQuery(this.publisherDisplayName));this.publisherDisplay=e.Publisher_By+this.vssDetailedItem.publisherDisplayName;this._setShouldShowTrialAndInstallButtonText();this.showModalInstall=b.FeatureFlagUtils.isModalInstallEnabled();this._initializeAction()},t.prototype._setShouldShowTrialAndInstallButtonText=function(){if(b.FeatureFlagUtils.isThirdPartyCommerceEnabled()){var n=this.vssDetailedItem.offerDetails;if(!ht.equals(this.vssDetailedItem.publisherName,"ms",!0)&&this.vssDetailedItem.priceCategory===c.priceCategory.Paid&&it.getPageContext().webAccessConfiguration.isHosted){if(this.vssDetailedItem.offerDetails&&this.vssDetailedItem.offerDetails.hasPublicPlans||this.vssDetailedItem.offerDetails&&this.vssDetailedItem.offerDetails.hasPlans&&this._testCommerce){this.showTrial=!0;return}this.installButtonText=e.InstallPreviewText}}if(b.FeatureFlagUtils.checkAndSetEnableFirstPartyCommerce()&&g.ItemModelHelper.isFirstPartyPaidExtension(this.vssDetailedItem)&&it.getPageContext().webAccessConfiguration.isHosted){this.showTrial=!0;return}this.showTrial=!1},t.prototype._needsAADAuth=function(){var n=$(".needs-aad-auth").html();return n&&ht.ignoreCaseComparer(n,"true")===0?!0:!1},t.prototype._connectedInstallEnabled=function(){var n=it.getPageContext().webAccessConfiguration.isHosted,t=b.FeatureFlagUtils.isOnPremConnectedEnabled();return n&&t},t.prototype._isAvailableForConnectedInstall=function(){return h.VSSItemHelper.supportsConnectedInstall(this.vssDetailedItem)},t.prototype._getInstallLink=function(n){n===void 0&&(n=!1);var t=location.protocol+"//"+location.host,i=g.ItemModelHelper.getFullyQualifiedNameForItem(this.vssDetailedItem.publisherName,this.vssDetailedItem.name),r=it.getDefaultWebContext().user,f=this._connectedInstallEnabled(),u=ot.deserializeJsonIsland($(".onprem-redirect-url"),null);return f&&this._isAvailableForConnectedInstall()&&Boolean(u)?t=u:this.showModalInstall?n?t=r?"#install-pop-up":t+w.GalleryURLs.getFreeInstallItemURLForDetailsPage(i):(t=t+w.GalleryURLs.getInstallItemURLForDetailsPage(i),r&&!this._needsAADAuth()&&(t="#install-pop-up")):t=n?t+w.GalleryURLs.getFreeInstallItemURL(i):t+w.GalleryURLs.getInstallItemURL(i),encodeURI(t)},t.prototype._initializeAction=function(){var n=this._getInstallLink(),u,i,r;this.vssDetailedItem.itemType===g.VSSItemType.VSSOffer?(this.actionButtonText=e.ItemBuy,this.actionLink=n,this._setCostForOffers(),u=this.vssDetailedItem):this.vssDetailedItem.itemType===g.VSSItemType.VSSIntegration?(this.vssDetailedItem.properties&&this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_INSTALL_LINK]?(this.actionButtonText=e.ItemInstall,this.actionLink=this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_INSTALL_LINK]):this.vssDetailedItem.properties&&this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_GET_STARTED_LINK]?(this.actionButtonText=e.ItemGetStarted,this.actionLink=this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_GET_STARTED_LINK]):(this.actionButtonText=e.ItemGetStarted,this.actionLink=location.href,this.alreadyInstalled=!0),this.actionLinkNewTab=!0,this._setAcquisitionOptionsForPaidIntegrations(n)):this.vssDetailedItem.itemType===g.VSSItemType.VSCodeExtension?(this.actionButtonText=e.ItemGetStarted,this.actionLink=ht.format(e.CodeExtensionGetStartedLink,this.vssDetailedItem.publisherName,this.vssDetailedItem.name),this.actionLinkNewTab=!0):(this.actionLink=n,this.trialLink=this._getInstallLink(!0),this._testCommerce&&(this.showModalInstall||(i=ct.Uri.parse(this.actionLink),i.addQueryParam(w.GalleryURLs.TestCommerceQueryParam,"true"),this.actionLink=i.absoluteUri,r=ct.Uri.parse(this.trialLink),r.addQueryParam(w.GalleryURLs.TestCommerceQueryParam,"true"),this.trialLink=r.absoluteUri)),this.vssDetailedItem.isBuiltIn?(this.actionButtonText=e.ItemAlreadyInstalled,this.actionLink=location.href,this.actionLinkNewTab=!1,this.alreadyInstalled=!0):this.actionButtonText=this.vssDetailedItem.priceCategory===c.priceCategory.Preview?e.ItemInstall:this.vssDetailedItem.priceCategory===c.priceCategory.Free?e.ItemInstall:g.ItemModelHelper.isFirstPartyPublisher(this.vssDetailedItem.publisherDisplayName)?e.ItemBuy:this.showTrial?e.ItemBuy:e.ItemInstall);this.vssDetailedItem.name===t.TESTMANAGER_EXTENSION_NAME&&(this.freeInstallLink=b.FeatureFlagUtils.isModalInstallEnabled()?this._getInstallLink(!0):location.protocol+"//"+location.host+w.GalleryURLs.getFreeInstallItemURL(g.ItemModelHelper.getFullyQualifiedNameForItem(this.vssDetailedItem.publisherName,this.vssDetailedItem.name)),this.freeInstallHtml=e.VSS_Extension_FreeInstall,b.FeatureFlagUtils.checkAndSetEnableFirstPartyCommerce()&&(this.freeInstallHtml=null,this.freeInstallLink=null));this.vssDetailedItem.itemType===g.VSSItemType.VSCodeExtension&&(this.isVSCode=!0,this.VSCodeCopyCommandOptions({itemName:this.vssDetailedItem.name,publisherName:this.vssDetailedItem.publisherName,brandingTheme:this.brandingTheme,actionLink:this.actionLink,actionLinkNewTab:this.actionLinkNewTab}))},t.prototype._getToLocalStringForPrice=function(n,t){return b.isLessThanIE11()?"$"+n.toString():n.toLocaleString("en",{style:"currency",currency:t})},t.prototype._getToLocalStringForNumber=function(n){return b.isLessThanIE11()?n.toString():n.toLocaleString()},t.prototype._setAcquisitionOptionsForPaidIntegrations=function(n){g.ItemModelHelper.isFirstPartyPaidIntegration(this.vssDetailedItem)&&b.FeatureFlagUtils.checkAndSetEnableFirstPartyCommerce()&&(this.showTrial=!0,this.trialButtonText=e.ItemInstall,this.trialLink=this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_INSTALL_LINK],this.trialLinkNewTab=!0,this.actionLink=n,this.actionLinkNewTab=!1,this.actionButtonText=e.ItemBuy)},t.prototype._setCostForOffers=function(){switch(this.vssDetailedItem.name){case"vs-enterprise-annual":this.offersCost=e.VSEnterpriseAnnualCost;this.offersCostText=e.VSEnterpriseNote;break;case"vs-professional-annual":this.offersCost=e.VSProfessionalAnnualCost;this.offersCostText=e.VSProfessionalNote;break;case"vs-enterprise-monthly":this.offersCost=e.VSEnterpriseMonthlyCost;break;case"vs-professional-monthly":this.offersCost=e.VSProfessionalMonthlyCost;break;case"hockeyapp-business-monthly-small":this.offersCost=e.HockeyApp15Apps+" - "+e.HockeyApp15AppsCost;break;case"hockeyapp-business-monthly-medium":this.offersCost=e.HockeyApp45Apps+" - "+e.HockeyApp45AppsCost;break;case"hockeyapp-business-monthly-large":this.offersCost=e.HockeyApp120Apps+" - "+e.HockeyApp120AppsCost;break;case"hockeyapp-business-monthly-xlarge":this.offersCost=e.HockeyApp250Apps+" - "+e.HockeyApp250AppsCost;break;case"hockeyapp-business-monthly-2xlarge":this.offersCost=e.HockeyApp500Apps+" - "+e.HockeyApp500AppsCost;break;case"hockeyapp-free":this.actionButtonText=e.ItemGetStarted;this.actionLink=e.HockeyApp_SignIn}},t.prototype._initializeBreadCrumb=function(){var n=u.BreadCrumbVSSItemHelper.getBreadCrumbOptionsForItem(this.vssDetailedItem);this.breadCrumbViewModel=new u.BreadCrumbViewModel(n)},t.prototype._initalizeItemDetails=function(){this._initializeItemOverView();this._initializeItemPricing();this._initializeItemMedia();this._initializeItemTagsAndCategories();this._initializeItemLinks();this._initializeProjectDetails();this._initializeItemAdditionalDetails()},t.prototype._initializeProjectDetails=function(){var t=this,n;n=/^(?:https?:\/\/|www\.)github\.com\/([A-Za-z0-9-]+)\/([[A-Za-z0-9-]+)(?:\.git)?/i.exec(this.itemDetailsGitHubLink());n?(this._getGitHubRepositoryDetailsPromise=this._gitHubServiceProvider.getGitHubRepositoryDetails(n[1],n[2]),this._getGitHubRepositoryDetailsPromise.then(function(n){t.itemDetailsPullRequestString(ht.format(e.ItemDetailsPullRequestString,n.itemDetailsPullRequestCount?n.itemDetailsPullRequestCount:e.ItemDetailsNo));t.itemDetailsOpenIssuesString(ht.format(e.ItemDetailsOpenIssuesString,n.itemDetailsOpenIssuesCount?n.itemDetailsOpenIssuesCount:e.ItemDetailsNo));t.itemDetailsLastCommitString(ht.format(e.ItemDetailsLastCommitString,lt.ago(new Date(n.itemDetailsLastPushedAtDateString),new Date)))},function(){t.itemDetailsGitHubLink(null)}),this.itemDetailsGitHubLink&&(this.itemDetailsPullRequestLink=ht.format(tt.ItemConstants.ITEM_DETAILS_PULL_REQUEST_LINK,n[1],n[2]),this.itemDetailsOpenIssuesLink=ht.format(tt.ItemConstants.ITEM_DETAILS_OPEN_ISSUES_LINK,n[1],n[2]),this.itemDetailsGitHubString=ht.format(e.ItemDetailsGitHubString,n[1],n[2]),this.itemDetailsLastCommitLink=ht.format(tt.ItemConstants.ITEM_DETAILS_LAST_COMMIT_LINK,n[1],n[2]))):this.itemDetailsGitHubLink(null)},t.prototype._initializeItemOverView=function(){var n="",t;n=this.vssDetailedItem.itemDetailsMarkdown==null||this.vssDetailedItem.itemDetailsMarkdown===""?e.ItemOverviewAbsentString:this.vssDetailedItem.itemDetailsMarkdown;t=l(n,this.markedOptions);this.itemDetailsContent=st.HtmlNormalizer.normalize(t)},t.prototype._initializeItemPricing=function(){var n=this.vssDetailedItem.priceCategory===c.priceCategory.Paid;this.showItemPricing=!1;n&&(this.showOfferPlans=b.FeatureFlagUtils.checkAndSetShowOfferPlans(),g.ItemModelHelper.isFirstPartyPublisher(this.vssDetailedItem.publisherDisplayName)?this._initializeItemPricingForUserBased():(this.planBasedPricing=!0,this._initializeItemPricingForPlanBased()))},t.prototype._initializeItemPricingForUserBased=function(){if(this.vssDetailedItem.itemPricingMarkdown&&(this.itemPricingContent=st.HtmlNormalizer.normalize(l(this.vssDetailedItem.itemPricingMarkdown,this.markedOptions)),this.showItemPricing=!0,this.showTrial&&this.showOfferPlans&&this.vssDetailedItem.offerMeterPrices&&this.vssDetailedItem.offerMeterPrices.length)){var n=this.vssDetailedItem.offerMeterPrices,t=e.StartPriceInfoForUserBased;this.vssDetailedItem.offerDetails&&this.vssDetailedItem.offerDetails.isAccountBased&&(t=e.StartPriceInfoForAccountBased);this.startPlanInfoText=ht.format(t,this._getToLocalStringForPrice(n[0].price,n[0].currencyCode))}},t.prototype._initializeItemPricingForPlanBased=function(){var n,t;if(this.showTrial&&this.showOfferPlans&&this.vssDetailedItem.offerMeterPrices&&this.vssDetailedItem.offerMeterPrices.length){n=this.vssDetailedItem.offerMeterPrices;n.sort(function(n,t){return n.price-t.price});var i=[],u=n.length,r=1;for(t=0;t<u;t++)i.push({price:this._getToLocalStringForPrice(n[t].price,n[t].currencyCode),noOfUsers:this._getRangeOfUsers(r,n[t].quantity)}),r=n[t].quantity+1;this.itemPricePlanDetails=i;this.startPlanInfoText=ht.format(e.StartPlanInfoText,this.itemPricePlanDetails[0].price);this.showItemPricing=!0}},t.prototype._getRangeOfUsers=function(n,t){var i=this._getToLocalStringForNumber(n),r=this._getToLocalStringForNumber(t);return ht.format(e.RangeOfUsersText,i,r)},t.prototype._initializeItemMedia=function(){this.screenshotUrls=this.vssDetailedItem.screenshotUrls},t.prototype._initializeItemTagsAndCategories=function(){var n={metaDataListGroups:[]},r=w.GalleryURLs.getVssCategoryURL,t,i;this.vssDetailedItem.itemType===g.VSSItemType.VSCodeExtension&&(r=w.GalleryURLs.getVSCodeCategoryURL);this.vssDetailedItem.categories&&(t=[],$.each(this.vssDetailedItem.categories,function(n,i){t.push({name:i,link:r(i),openInNewTab:!1})}),n.metaDataListGroups.push({headerName:e.Categories,metaDataList:t}));this.vssDetailedItem.tags&&(i=[],$.each(this.vssDetailedItem.tags,function(n,t){var r=null;it.getPageContext().webAccessConfiguration.isHosted&&(r=w.GalleryURLs.getSearchPageUrlForTagQuery(t));i.push({name:t,link:r,openInNewTab:!1})}),n.metaDataListGroups.push({headerName:e.ItemTags,metaDataList:i}));this.metaDataListViewModel=new p.MetaDataListViewModel(n)},t.prototype._initializeItemLinks=function(){this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_GITHUB_REPOSITORY_LINK]&&b.FeatureFlagUtils.checkAndSetExternalMetadataForItemDetails()&&this.itemDetailsGitHubLink(this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_GITHUB_REPOSITORY_LINK]);this.vssDetailedItem.properties&&this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_GET_STARTED_LINK]&&(this.getStartedLink=this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_GET_STARTED_LINK]);this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_LEARN_LINK]&&(this.itemDetailsLearnLink=this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_LEARN_LINK]);this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_SUPPORT_LINK]&&(this.itemDetailsSupportLink=this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_SUPPORT_LINK]);this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_FEEDBACK_LINK]&&(this.itemDetailsFeedbackLink=this.vssDetailedItem.properties[d.ItemConstants.PROPERTY_FEEDBACK_LINK]);this.vssDetailedItem.licenseUrl?this.itemDetailsLicenseLink=this.vssDetailedItem.licenseUrl:this.vssDetailedItem.itemType===g.VSSItemType.VSSOffer&&(this.itemDetailsLicenseLink=e.Eula_AzureLicenseUrl);this.showReportAbuseLink=g.ItemModelHelper.isFirstPartyPublisher(this.vssDetailedItem.publisherDisplayName)&&it.getPageContext().webAccessConfiguration.isHosted;var n=ht.format(t.REPORT_ABUSE_SUBJECT,this.vssDetailedItem.publisherDisplayName,this.vssDetailedItem.title),i=location.href+"\r\n"+e.ItemDetailsReportAbuseContentText;this.reportAbuseLink=encodeURI(ht.format(t.MAIL_TO,t.REPORT_ABUSE_EMAIL,n,i))},t.prototype._initializeItemAdditionalDetails=function(){var n;if(this.version=this.vssDetailedItem.version,this.itemUpdatedDate=this.vssDetailedItem.updatedDate,this.itemPublishedDate=this.vssDetailedItem.publishedDate,this.itemShareDetails=null,it.getPageContext().webAccessConfiguration.isHosted){n=this.vssDetailedItem.itemType===g.VSSItemType.VSSOffer?e.ItemShareOffer:e.ItemShareExtension;var i=ht.format(e.ItemShareEmailSubject,this.vssDetailedItem.title),r=ht.format(e.ItemShareEmailContents,n,location.href),u=encodeURIComponent(ht.format(e.ItemShareTwitterContents,location.href)),f=encodeURIComponent(ht.format(location.href));this.itemShareDetails={linkFacebook:ht.format(e.ItemShareFacebookUrl,f),linkTwitter:ht.format(e.ItemShareTwitterUrl,u),linkEmail:ht.format(t.MAIL_TO,"",encodeURI(i),encodeURIComponent(r))}}},t.prototype.isPublisherVerified=function(n){return(n&ft.PublisherFlags.Verified)!=0},t.prototype.startDownload=function(){return this.itemDownloadViewModel&&this.itemDownloadViewModel.initiateDownload(),!0},t.prototype.onDownloadDialogClose=function(){if(this.itemDownloadViewModel)return this.itemDownloadViewModel.resetDownload(),!0},t.prototype.onClick=function(n){var t="",i={},r;return this.vssDetailedItem.itemType===g.VSSItemType.VSSIntegration&&(r=$(n.target).text(),ht.equals(r,e.ItemGetStarted,!0)?t=o.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.GET_STARTED_ITEM:ht.equals(r,e.ItemInstall,!0)&&(t=o.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.INITIATE_INSTALL_ITEM),i[at.ProductType]=g.ItemModelHelper.getItemTypeText(this.vssDetailedItem.itemType),i[at.IsPublic]=this.vssDetailedItem.isPublic),i[at.Id]=g.ItemModelHelper.getFullyQualifiedNameForItem(this.vssDetailedItem.publisherName,this.vssDetailedItem.name),t&&t.length>0&&s.TelemetryHelper.publishEvent(t,i,!0),!0},t.MAIL_TO="mailto:{0}?subject={1}&Body={2}",t.REPORT_ABUSE_SUBJECT="Report abuse - {0} / {1}",t.REPORT_ABUSE_EMAIL="vsmarketplace@microsoft.com",t.TESTMANAGER_EXTENSION_NAME="vss-testmanager-web",t.QUERY_PARAM_DOWNLOAD="download",t.QUERY_PARAM_INSTALL="install",t}(et.TemplateViewModel);t.VSSItemDetailsViewModel=vt});
define("Gallery/Client/Controls/RatingControl/RatingControl.View",["require","exports","Gallery/Client/Controls/RatingControl/RatingControl.ViewModel","Gallery/Client/Common/Utility","VSS/Events/Services","VSS/Adapters/Knockout","VSS/Utils/Core","VSS/Utils/UI"],function(n,t,i,r,u,f,e,o){var s=e.delegate,c=r.WindowWrapper,h=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.initialize=function(){n.prototype.initialize.call(this);this._keyPressCallback=s(this,this.onKeyPress);u.getService().attachEvent(i.RatingControlViewModel.EVENT_ON_KEY_PRESS,this._keyPressCallback)},t.prototype.onKeyPress=function(n,t){var u;if(n===this.getViewModel()){var r=this.getViewModel(),f=t[0].data,e=t[0].e,i,s=String.fromCharCode(e.which);if(e.which===o.KeyCode.ENTER)u=f.index,f.isFullStar?(r.fullStars(u),i=u):(i=r.fullStars()+u,r.fixedFullStars(i),r.fullStars(i));else switch(s){case"1":case"2":case"3":case"4":case"5":i=parseInt(s);r.fullStars(i);r.fixedFullStars(i)}this.getElement().find(".star")[i-1].focus()}},t.prototype._cleanup=function(){u.getService().detachEvent(i.RatingControlViewModel.EVENT_ON_KEY_PRESS,this._keyPressCallback);n.prototype._cleanup.call(this)},t}(f.TemplateControl);t.RatingControlView=h});
define("Gallery/Client/Controls/VSCodeCopyCommand/VSCodeCopyCommand.ViewModel",["require","exports","VSS/Adapters/Knockout","VSS/Utils/String","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","VSS/Events/Services","VSS/Utils/UI","Gallery/Client/Common/Telemetry","Gallery/Client/Common/TelemetryInternal","Gallery/Client/Service/VSSItem"],function(n,t,i,r,u,f,e,o,s,h){var c=o.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.VSCodeCopyCommandProperties,l=function(n){function t(t){n.call(this);this.itemName=null;this.copyCommand=null;this.installTitle=null;this.installInstructions=null;this.iscopySupported=!1;this.isFlashSupported=!1;this.textAreaID=null;this.copyButtonID=null;this.copiedAnimationID=null;this.copiedAnimationText=null;this.actionButtonText=null;this.actionLink=null;this.actionLinkNewTab=!1;this.brandingTheme=null;this.copyButtonTooltip=null;this.copyButtonText=null;this.isFlahUsed=!1;this.copyCommandLength=null;this.publisherName=null;this.itemName=t.itemName;this.publisherName=t.publisherName;this.actionLink=t.actionLink;this.actionLinkNewTab=t.actionLinkNewTab;this.brandingTheme=t.brandingTheme;this.copyCommand=r.format(u.VSCodeInstallCommand,this.itemName);this.copyCommandLength=Math.min(this.copyCommand.length,100).toString();this.installTitle=r.format(u.VSCodeInstallationHeader);this.copiedAnimationText=r.format(u.VSCodeCopiedAnimationText);this.copyButtonText=r.format(u.VSCodeCopyButtonText);this.copyButtonTooltip=r.format(u.VSCodeCopyButtonTooptip);var i="Ctrl";navigator.appVersion.indexOf("Mac")!=-1&&(i="⌘");this.installInstructions=r.format(u.VSCodeInstallInstructions,i);this.actionButtonText=r.format(u.MoreInfoText);this.iscopySupported=document.queryCommandSupported("copy");this.isFlashSupported=this._detectFlash();this.textAreaID="vscode-command-input";this.copyButtonID="copy-to-clipboard-button";this.copiedAnimationID="copied-animation";this.iscopySupported||this.isFlashSupported||this.publishTelemetryEvent_CopyButtonDisabled();this.isFlahUsed=!this.iscopySupported&&this.isFlashSupported}return __extends(t,n),t.prototype._detectFlash=function(){try{if(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))return!0}catch(i){var n=navigator.mimeTypes,t="application/x-shockwave-flash";if(n&&n[t]&&n[t].enabledPlugin)return!0}return!1},t.prototype.copyOnClick=function(){f.getService().fire(t.EVENT_ON_COPY,this)},t.prototype.copyOnEnter=function(n,i){var r=i.keyCode?i.keyCode:i.which;r==e.KeyCode.ENTER&&f.getService().fire(t.EVENT_ON_COPY,this)},t.prototype.selectTextOnClick=function(n,t){t.target.select();this.publishTelemetryEvent_TextBoxClicked()},t.prototype.publishTelemetryEvent_Copy=function(n){var t=o.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.VSCODE_COPY,i={};return i[c.Id]=h.ItemModelHelper.getFullyQualifiedNameForItem(this.publisherName,this.itemName),i[c.IsFlashUsed]=n,t&&t.length>0&&s.TelemetryHelper.publishEvent(t,i,!0),!0},t.prototype.publishTelemetryEvent_MoreInfo=function(){var n=o.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.VSCODE_MORE_INFO,t={};return t[c.Id]=h.ItemModelHelper.getFullyQualifiedNameForItem(this.publisherName,this.itemName),n&&n.length>0&&s.TelemetryHelper.publishEvent(n,t,!0),!0},t.prototype.publishTelemetryEvent_TextBoxClicked=function(){var n=o.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.VSCODE_COMMAND_TEXT_BOX_CLICK,t={};return t[c.Id]=h.ItemModelHelper.getFullyQualifiedNameForItem(this.publisherName,this.itemName),n&&n.length>0&&s.TelemetryHelper.publishEvent(n,t,!0),!0},t.prototype.publishTelemetryEvent_CopyButtonDisabled=function(){var n=o.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.VSCODE_COPY_BUTTON_DISABLED,t={};return t[c.Id]=h.ItemModelHelper.getFullyQualifiedNameForItem(this.publisherName,this.itemName),n&&n.length>0&&s.TelemetryHelper.publishEvent(n,t,!0),!0},t.EVENT_ON_FLASH_INITIALIZE="VSS.Gallery.VSCodeCommandCopy.onFlashInitialize",t.EVENT_ON_COPY="VSS.Gallery.VSCodeCommandCopy.onCopy",t.swfFileURL="//cdnjs.cloudflare.com/ajax/libs/zeroclipboard/2.2.0/ZeroClipboard.swf",t}(i.TemplateViewModel);t.VSCodeCopyCommandViewModel=l});
/*!
 * ZeroClipboard
 * The ZeroClipboard library provides an easy way to copy text to the clipboard using an invisible Adobe Flash movie and a JavaScript interface.
 * Copyright (c) 2009-2014 Jon Rohan, James M. Greene
 * Licensed MIT
 * http://zeroclipboard.org/
 * v2.2.0
 */
!function(a,b){"use strict";var c,d,e,f=a,g=f.document,h=f.navigator,i=f.setTimeout,j=f.clearTimeout,k=f.setInterval,l=f.clearInterval,m=f.getComputedStyle,n=f.encodeURIComponent,o=f.ActiveXObject,p=f.Error,q=f.Number.parseInt||f.parseInt,r=f.Number.parseFloat||f.parseFloat,s=f.Number.isNaN||f.isNaN,t=f.Date.now,u=f.Object.keys,v=f.Object.defineProperty,w=f.Object.prototype.hasOwnProperty,x=f.Array.prototype.slice,y=function(){var a=function(a){return a};if("function"==typeof f.wrap&&"function"==typeof f.unwrap)try{var b=g.createElement("div"),c=f.unwrap(b);1===b.nodeType&&c&&1===c.nodeType&&(a=f.unwrap)}catch(d){}return a}(),z=function(a){return x.call(a,0)},A=function(){var a,c,d,e,f,g,h=z(arguments),i=h[0]||{};for(a=1,c=h.length;c>a;a++)if(null!=(d=h[a]))for(e in d)w.call(d,e)&&(f=i[e],g=d[e],i!==g&&g!==b&&(i[e]=g));return i},B=function(a){var b,c,d,e;if("object"!=typeof a||null==a||"number"==typeof a.nodeType)b=a;else if("number"==typeof a.length)for(b=[],c=0,d=a.length;d>c;c++)w.call(a,c)&&(b[c]=B(a[c]));else{b={};for(e in a)w.call(a,e)&&(b[e]=B(a[e]))}return b},C=function(a,b){for(var c={},d=0,e=b.length;e>d;d++)b[d]in a&&(c[b[d]]=a[b[d]]);return c},D=function(a,b){var c={};for(var d in a)-1===b.indexOf(d)&&(c[d]=a[d]);return c},E=function(a){if(a)for(var b in a)w.call(a,b)&&delete a[b];return a},F=function(a,b){if(a&&1===a.nodeType&&a.ownerDocument&&b&&(1===b.nodeType&&b.ownerDocument&&b.ownerDocument===a.ownerDocument||9===b.nodeType&&!b.ownerDocument&&b===a.ownerDocument))do{if(a===b)return!0;a=a.parentNode}while(a);return!1},G=function(a){var b;return"string"==typeof a&&a&&(b=a.split("#")[0].split("?")[0],b=a.slice(0,a.lastIndexOf("/")+1)),b},H=function(a){var b,c;return"string"==typeof a&&a&&(c=a.match(/^(?:|[^:@]*@|.+\)@(?=http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),c&&c[1]?b=c[1]:(c=a.match(/\)@((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),c&&c[1]&&(b=c[1]))),b},I=function(){var a,b;try{throw new p}catch(c){b=c}return b&&(a=b.sourceURL||b.fileName||H(b.stack)),a},J=function(){var a,c,d;if(g.currentScript&&(a=g.currentScript.src))return a;if(c=g.getElementsByTagName("script"),1===c.length)return c[0].src||b;if("readyState"in c[0])for(d=c.length;d--;)if("interactive"===c[d].readyState&&(a=c[d].src))return a;return"loading"===g.readyState&&(a=c[c.length-1].src)?a:(a=I())?a:b},K=function(){var a,c,d,e=g.getElementsByTagName("script");for(a=e.length;a--;){if(!(d=e[a].src)){c=null;break}if(d=G(d),null==c)c=d;else if(c!==d){c=null;break}}return c||b},L=function(){var a=G(J())||K()||"";return a+"ZeroClipboard.swf"},M=function(){return null==a.opener&&(!!a.top&&a!=a.top||!!a.parent&&a!=a.parent)}(),N={bridge:null,version:"0.0.0",pluginType:"unknown",disabled:null,outdated:null,sandboxed:null,unavailable:null,degraded:null,deactivated:null,overdue:null,ready:null},O="11.0.0",P={},Q={},R=null,S=0,T=0,U={ready:"Flash communication is established",error:{"flash-disabled":"Flash is disabled or not installed. May also be attempting to run Flash in a sandboxed iframe, which is impossible.","flash-outdated":"Flash is too outdated to support ZeroClipboard","flash-sandboxed":"Attempting to run Flash in a sandboxed iframe, which is impossible","flash-unavailable":"Flash is unable to communicate bidirectionally with JavaScript","flash-degraded":"Flash is unable to preserve data fidelity when communicating with JavaScript","flash-deactivated":"Flash is too outdated for your browser and/or is configured as click-to-activate.\nThis may also mean that the ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity.\nMay also be attempting to run Flash in a sandboxed iframe, which is impossible.","flash-overdue":"Flash communication was established but NOT within the acceptable time limit","version-mismatch":"ZeroClipboard JS version number does not match ZeroClipboard SWF version number","clipboard-error":"At least one error was thrown while ZeroClipboard was attempting to inject your data into the clipboard","config-mismatch":"ZeroClipboard configuration does not match Flash's reality","swf-not-found":"The ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity"}},V=["flash-unavailable","flash-degraded","flash-overdue","version-mismatch","config-mismatch","clipboard-error"],W=["flash-disabled","flash-outdated","flash-sandboxed","flash-unavailable","flash-degraded","flash-deactivated","flash-overdue"],X=new RegExp("^flash-("+W.map(function(a){return a.replace(/^flash-/,"")}).join("|")+")$"),Y=new RegExp("^flash-("+W.slice(1).map(function(a){return a.replace(/^flash-/,"")}).join("|")+")$"),Z={swfPath:L(),trustedDomains:a.location.host?[a.location.host]:[],cacheBust:!0,forceEnhancedClipboard:!1,flashLoadTimeout:3e4,autoActivate:!0,bubbleEvents:!0,containerId:"global-zeroclipboard-html-bridge",containerClass:"global-zeroclipboard-container",swfObjectId:"global-zeroclipboard-flash-bridge",hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",forceHandCursor:!1,title:null,zIndex:999999999},$=function(a){if("object"==typeof a&&null!==a)for(var b in a)if(w.call(a,b))if(/^(?:forceHandCursor|title|zIndex|bubbleEvents)$/.test(b))Z[b]=a[b];else if(null==N.bridge)if("containerId"===b||"swfObjectId"===b){if(!nb(a[b]))throw new Error("The specified `"+b+"` value is not valid as an HTML4 Element ID");Z[b]=a[b]}else Z[b]=a[b];{if("string"!=typeof a||!a)return B(Z);if(w.call(Z,a))return Z[a]}},_=function(){return Tb(),{browser:C(h,["userAgent","platform","appName"]),flash:D(N,["bridge"]),zeroclipboard:{version:Vb.version,config:Vb.config()}}},ab=function(){return!!(N.disabled||N.outdated||N.sandboxed||N.unavailable||N.degraded||N.deactivated)},bb=function(a,d){var e,f,g,h={};if("string"==typeof a&&a)g=a.toLowerCase().split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof d)for(e in a)w.call(a,e)&&"string"==typeof e&&e&&"function"==typeof a[e]&&Vb.on(e,a[e]);if(g&&g.length){for(e=0,f=g.length;f>e;e++)a=g[e].replace(/^on/,""),h[a]=!0,P[a]||(P[a]=[]),P[a].push(d);if(h.ready&&N.ready&&Vb.emit({type:"ready"}),h.error){for(e=0,f=W.length;f>e;e++)if(N[W[e].replace(/^flash-/,"")]===!0){Vb.emit({type:"error",name:W[e]});break}c!==b&&Vb.version!==c&&Vb.emit({type:"error",name:"version-mismatch",jsVersion:Vb.version,swfVersion:c})}}return Vb},cb=function(a,b){var c,d,e,f,g;if(0===arguments.length)f=u(P);else if("string"==typeof a&&a)f=a.split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof b)for(c in a)w.call(a,c)&&"string"==typeof c&&c&&"function"==typeof a[c]&&Vb.off(c,a[c]);if(f&&f.length)for(c=0,d=f.length;d>c;c++)if(a=f[c].toLowerCase().replace(/^on/,""),g=P[a],g&&g.length)if(b)for(e=g.indexOf(b);-1!==e;)g.splice(e,1),e=g.indexOf(b,e);else g.length=0;return Vb},db=function(a){var b;return b="string"==typeof a&&a?B(P[a])||null:B(P)},eb=function(a){var b,c,d;return a=ob(a),a&&!vb(a)?"ready"===a.type&&N.overdue===!0?Vb.emit({type:"error",name:"flash-overdue"}):(b=A({},a),tb.call(this,b),"copy"===a.type&&(d=Db(Q),c=d.data,R=d.formatMap),c):void 0},fb=function(){var a=N.sandboxed;if(Tb(),"boolean"!=typeof N.ready&&(N.ready=!1),N.sandboxed!==a&&N.sandboxed===!0)N.ready=!1,Vb.emit({type:"error",name:"flash-sandboxed"});else if(!Vb.isFlashUnusable()&&null===N.bridge){var b=Z.flashLoadTimeout;"number"==typeof b&&b>=0&&(S=i(function(){"boolean"!=typeof N.deactivated&&(N.deactivated=!0),N.deactivated===!0&&Vb.emit({type:"error",name:"flash-deactivated"})},b)),N.overdue=!1,Bb()}},gb=function(){Vb.clearData(),Vb.blur(),Vb.emit("destroy"),Cb(),Vb.off()},hb=function(a,b){var c;if("object"==typeof a&&a&&"undefined"==typeof b)c=a,Vb.clearData();else{if("string"!=typeof a||!a)return;c={},c[a]=b}for(var d in c)"string"==typeof d&&d&&w.call(c,d)&&"string"==typeof c[d]&&c[d]&&(Q[d]=c[d])},ib=function(a){"undefined"==typeof a?(E(Q),R=null):"string"==typeof a&&w.call(Q,a)&&delete Q[a]},jb=function(a){return"undefined"==typeof a?B(Q):"string"==typeof a&&w.call(Q,a)?Q[a]:void 0},kb=function(a){if(a&&1===a.nodeType){d&&(Lb(d,Z.activeClass),d!==a&&Lb(d,Z.hoverClass)),d=a,Kb(a,Z.hoverClass);var b=a.getAttribute("title")||Z.title;if("string"==typeof b&&b){var c=Ab(N.bridge);c&&c.setAttribute("title",b)}var e=Z.forceHandCursor===!0||"pointer"===Mb(a,"cursor");Rb(e),Qb()}},lb=function(){var a=Ab(N.bridge);a&&(a.removeAttribute("title"),a.style.left="0px",a.style.top="-9999px",a.style.width="1px",a.style.height="1px"),d&&(Lb(d,Z.hoverClass),Lb(d,Z.activeClass),d=null)},mb=function(){return d||null},nb=function(a){return"string"==typeof a&&a&&/^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(a)},ob=function(a){var b;if("string"==typeof a&&a?(b=a,a={}):"object"==typeof a&&a&&"string"==typeof a.type&&a.type&&(b=a.type),b){b=b.toLowerCase(),!a.target&&(/^(copy|aftercopy|_click)$/.test(b)||"error"===b&&"clipboard-error"===a.name)&&(a.target=e),A(a,{type:b,target:a.target||d||null,relatedTarget:a.relatedTarget||null,currentTarget:N&&N.bridge||null,timeStamp:a.timeStamp||t()||null});var c=U[a.type];return"error"===a.type&&a.name&&c&&(c=c[a.name]),c&&(a.message=c),"ready"===a.type&&A(a,{target:null,version:N.version}),"error"===a.type&&(X.test(a.name)&&A(a,{target:null,minimumVersion:O}),Y.test(a.name)&&A(a,{version:N.version})),"copy"===a.type&&(a.clipboardData={setData:Vb.setData,clearData:Vb.clearData}),"aftercopy"===a.type&&(a=Eb(a,R)),a.target&&!a.relatedTarget&&(a.relatedTarget=pb(a.target)),qb(a)}},pb=function(a){var b=a&&a.getAttribute&&a.getAttribute("data-clipboard-target");return b?g.getElementById(b):null},qb=function(a){if(a&&/^_(?:click|mouse(?:over|out|down|up|move))$/.test(a.type)){var c=a.target,d="_mouseover"===a.type&&a.relatedTarget?a.relatedTarget:b,e="_mouseout"===a.type&&a.relatedTarget?a.relatedTarget:b,h=Nb(c),i=f.screenLeft||f.screenX||0,j=f.screenTop||f.screenY||0,k=g.body.scrollLeft+g.documentElement.scrollLeft,l=g.body.scrollTop+g.documentElement.scrollTop,m=h.left+("number"==typeof a._stageX?a._stageX:0),n=h.top+("number"==typeof a._stageY?a._stageY:0),o=m-k,p=n-l,q=i+o,r=j+p,s="number"==typeof a.movementX?a.movementX:0,t="number"==typeof a.movementY?a.movementY:0;delete a._stageX,delete a._stageY,A(a,{srcElement:c,fromElement:d,toElement:e,screenX:q,screenY:r,pageX:m,pageY:n,clientX:o,clientY:p,x:o,y:p,movementX:s,movementY:t,offsetX:0,offsetY:0,layerX:0,layerY:0})}return a},rb=function(a){var b=a&&"string"==typeof a.type&&a.type||"";return!/^(?:(?:before)?copy|destroy)$/.test(b)},sb=function(a,b,c,d){d?i(function(){a.apply(b,c)},0):a.apply(b,c)},tb=function(a){if("object"==typeof a&&a&&a.type){var b=rb(a),c=P["*"]||[],d=P[a.type]||[],e=c.concat(d);if(e&&e.length){var g,h,i,j,k,l=this;for(g=0,h=e.length;h>g;g++)i=e[g],j=l,"string"==typeof i&&"function"==typeof f[i]&&(i=f[i]),"object"==typeof i&&i&&"function"==typeof i.handleEvent&&(j=i,i=i.handleEvent),"function"==typeof i&&(k=A({},a),sb(i,j,[k],b))}return this}},ub=function(a){var b=null;return(M===!1||a&&"error"===a.type&&a.name&&-1!==V.indexOf(a.name))&&(b=!1),b},vb=function(a){var b=a.target||d||null,f="swf"===a._source;switch(delete a._source,a.type){case"error":var g="flash-sandboxed"===a.name||ub(a);"boolean"==typeof g&&(N.sandboxed=g),-1!==W.indexOf(a.name)?A(N,{disabled:"flash-disabled"===a.name,outdated:"flash-outdated"===a.name,unavailable:"flash-unavailable"===a.name,degraded:"flash-degraded"===a.name,deactivated:"flash-deactivated"===a.name,overdue:"flash-overdue"===a.name,ready:!1}):"version-mismatch"===a.name&&(c=a.swfVersion,A(N,{disabled:!1,outdated:!1,unavailable:!1,degraded:!1,deactivated:!1,overdue:!1,ready:!1})),Pb();break;case"ready":c=a.swfVersion;var h=N.deactivated===!0;A(N,{disabled:!1,outdated:!1,sandboxed:!1,unavailable:!1,degraded:!1,deactivated:!1,overdue:h,ready:!h}),Pb();break;case"beforecopy":e=b;break;case"copy":var i,j,k=a.relatedTarget;!Q["text/html"]&&!Q["text/plain"]&&k&&(j=k.value||k.outerHTML||k.innerHTML)&&(i=k.value||k.textContent||k.innerText)?(a.clipboardData.clearData(),a.clipboardData.setData("text/plain",i),j!==i&&a.clipboardData.setData("text/html",j)):!Q["text/plain"]&&a.target&&(i=a.target.getAttribute("data-clipboard-text"))&&(a.clipboardData.clearData(),a.clipboardData.setData("text/plain",i));break;case"aftercopy":wb(a),Vb.clearData(),b&&b!==Jb()&&b.focus&&b.focus();break;case"_mouseover":Vb.focus(b),Z.bubbleEvents===!0&&f&&(b&&b!==a.relatedTarget&&!F(a.relatedTarget,b)&&xb(A({},a,{type:"mouseenter",bubbles:!1,cancelable:!1})),xb(A({},a,{type:"mouseover"})));break;case"_mouseout":Vb.blur(),Z.bubbleEvents===!0&&f&&(b&&b!==a.relatedTarget&&!F(a.relatedTarget,b)&&xb(A({},a,{type:"mouseleave",bubbles:!1,cancelable:!1})),xb(A({},a,{type:"mouseout"})));break;case"_mousedown":Kb(b,Z.activeClass),Z.bubbleEvents===!0&&f&&xb(A({},a,{type:a.type.slice(1)}));break;case"_mouseup":Lb(b,Z.activeClass),Z.bubbleEvents===!0&&f&&xb(A({},a,{type:a.type.slice(1)}));break;case"_click":e=null,Z.bubbleEvents===!0&&f&&xb(A({},a,{type:a.type.slice(1)}));break;case"_mousemove":Z.bubbleEvents===!0&&f&&xb(A({},a,{type:a.type.slice(1)}))}return/^_(?:click|mouse(?:over|out|down|up|move))$/.test(a.type)?!0:void 0},wb=function(a){if(a.errors&&a.errors.length>0){var b=B(a);A(b,{type:"error",name:"clipboard-error"}),delete b.success,i(function(){Vb.emit(b)},0)}},xb=function(a){if(a&&"string"==typeof a.type&&a){var b,c=a.target||null,d=c&&c.ownerDocument||g,e={view:d.defaultView||f,canBubble:!0,cancelable:!0,detail:"click"===a.type?1:0,button:"number"==typeof a.which?a.which-1:"number"==typeof a.button?a.button:d.createEvent?0:1},h=A(e,a);c&&d.createEvent&&c.dispatchEvent&&(h=[h.type,h.canBubble,h.cancelable,h.view,h.detail,h.screenX,h.screenY,h.clientX,h.clientY,h.ctrlKey,h.altKey,h.shiftKey,h.metaKey,h.button,h.relatedTarget],b=d.createEvent("MouseEvents"),b.initMouseEvent&&(b.initMouseEvent.apply(b,h),b._source="js",c.dispatchEvent(b)))}},yb=function(){var a=Z.flashLoadTimeout;if("number"==typeof a&&a>=0){var b=Math.min(1e3,a/10),c=Z.swfObjectId+"_fallbackContent";T=k(function(){var a=g.getElementById(c);Ob(a)&&(Pb(),N.deactivated=null,Vb.emit({type:"error",name:"swf-not-found"}))},b)}},zb=function(){var a=g.createElement("div");return a.id=Z.containerId,a.className=Z.containerClass,a.style.position="absolute",a.style.left="0px",a.style.top="-9999px",a.style.width="1px",a.style.height="1px",a.style.zIndex=""+Sb(Z.zIndex),a},Ab=function(a){for(var b=a&&a.parentNode;b&&"OBJECT"===b.nodeName&&b.parentNode;)b=b.parentNode;return b||null},Bb=function(){var a,b=N.bridge,c=Ab(b);if(!b){var d=Ib(f.location.host,Z),e="never"===d?"none":"all",h=Gb(A({jsVersion:Vb.version},Z)),i=Z.swfPath+Fb(Z.swfPath,Z);c=zb();var j=g.createElement("div");c.appendChild(j),g.body.appendChild(c);var k=g.createElement("div"),l="activex"===N.pluginType;k.innerHTML='<object id="'+Z.swfObjectId+'" name="'+Z.swfObjectId+'" width="100%" height="100%" '+(l?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'type="application/x-shockwave-flash" data="'+i+'"')+">"+(l?'<param name="movie" value="'+i+'"/>':"")+'<param name="allowScriptAccess" value="'+d+'"/><param name="allowNetworking" value="'+e+'"/><param name="menu" value="false"/><param name="wmode" value="transparent"/><param name="flashvars" value="'+h+'"/><div id="'+Z.swfObjectId+'_fallbackContent">&nbsp;</div></object>',b=k.firstChild,k=null,y(b).ZeroClipboard=Vb,c.replaceChild(b,j),yb()}return b||(b=g[Z.swfObjectId],b&&(a=b.length)&&(b=b[a-1]),!b&&c&&(b=c.firstChild)),N.bridge=b||null,b},Cb=function(){var a=N.bridge;if(a){var d=Ab(a);d&&("activex"===N.pluginType&&"readyState"in a?(a.style.display="none",function e(){if(4===a.readyState){for(var b in a)"function"==typeof a[b]&&(a[b]=null);a.parentNode&&a.parentNode.removeChild(a),d.parentNode&&d.parentNode.removeChild(d)}else i(e,10)}()):(a.parentNode&&a.parentNode.removeChild(a),d.parentNode&&d.parentNode.removeChild(d))),Pb(),N.ready=null,N.bridge=null,N.deactivated=null,c=b}},Db=function(a){var b={},c={};if("object"==typeof a&&a){for(var d in a)if(d&&w.call(a,d)&&"string"==typeof a[d]&&a[d])switch(d.toLowerCase()){case"text/plain":case"text":case"air:text":case"flash:text":b.text=a[d],c.text=d;break;case"text/html":case"html":case"air:html":case"flash:html":b.html=a[d],c.html=d;break;case"application/rtf":case"text/rtf":case"rtf":case"richtext":case"air:rtf":case"flash:rtf":b.rtf=a[d],c.rtf=d}return{data:b,formatMap:c}}},Eb=function(a,b){if("object"!=typeof a||!a||"object"!=typeof b||!b)return a;var c={};for(var d in a)if(w.call(a,d))if("errors"===d){c[d]=a[d]?a[d].slice():[];for(var e=0,f=c[d].length;f>e;e++)c[d][e].format=b[c[d][e].format]}else if("success"!==d&&"data"!==d)c[d]=a[d];else{c[d]={};var g=a[d];for(var h in g)h&&w.call(g,h)&&w.call(b,h)&&(c[d][b[h]]=g[h])}return c},Fb=function(a,b){var c=null==b||b&&b.cacheBust===!0;return c?(-1===a.indexOf("?")?"?":"&")+"noCache="+t():""},Gb=function(a){var b,c,d,e,g="",h=[];if(a.trustedDomains&&("string"==typeof a.trustedDomains?e=[a.trustedDomains]:"object"==typeof a.trustedDomains&&"length"in a.trustedDomains&&(e=a.trustedDomains)),e&&e.length)for(b=0,c=e.length;c>b;b++)if(w.call(e,b)&&e[b]&&"string"==typeof e[b]){if(d=Hb(e[b]),!d)continue;if("*"===d){h.length=0,h.push(d);break}h.push.apply(h,[d,"//"+d,f.location.protocol+"//"+d])}return h.length&&(g+="trustedOrigins="+n(h.join(","))),a.forceEnhancedClipboard===!0&&(g+=(g?"&":"")+"forceEnhancedClipboard=true"),"string"==typeof a.swfObjectId&&a.swfObjectId&&(g+=(g?"&":"")+"swfObjectId="+n(a.swfObjectId)),"string"==typeof a.jsVersion&&a.jsVersion&&(g+=(g?"&":"")+"jsVersion="+n(a.jsVersion)),g},Hb=function(a){if(null==a||""===a)return null;if(a=a.replace(/^\s+|\s+$/g,""),""===a)return null;var b=a.indexOf("//");a=-1===b?a:a.slice(b+2);var c=a.indexOf("/");return a=-1===c?a:-1===b||0===c?null:a.slice(0,c),a&&".swf"===a.slice(-4).toLowerCase()?null:a||null},Ib=function(){var a=function(a){var b,c,d,e=[];if("string"==typeof a&&(a=[a]),"object"!=typeof a||!a||"number"!=typeof a.length)return e;for(b=0,c=a.length;c>b;b++)if(w.call(a,b)&&(d=Hb(a[b]))){if("*"===d){e.length=0,e.push("*");break}-1===e.indexOf(d)&&e.push(d)}return e};return function(b,c){var d=Hb(c.swfPath);null===d&&(d=b);var e=a(c.trustedDomains),f=e.length;if(f>0){if(1===f&&"*"===e[0])return"always";if(-1!==e.indexOf(b))return 1===f&&b===d?"sameDomain":"always"}return"never"}}(),Jb=function(){try{return g.activeElement}catch(a){return null}},Kb=function(a,b){var c,d,e,f=[];if("string"==typeof b&&b&&(f=b.split(/\s+/)),a&&1===a.nodeType&&f.length>0)if(a.classList)for(c=0,d=f.length;d>c;c++)a.classList.add(f[c]);else if(a.hasOwnProperty("className")){for(e=" "+a.className+" ",c=0,d=f.length;d>c;c++)-1===e.indexOf(" "+f[c]+" ")&&(e+=f[c]+" ");a.className=e.replace(/^\s+|\s+$/g,"")}return a},Lb=function(a,b){var c,d,e,f=[];if("string"==typeof b&&b&&(f=b.split(/\s+/)),a&&1===a.nodeType&&f.length>0)if(a.classList&&a.classList.length>0)for(c=0,d=f.length;d>c;c++)a.classList.remove(f[c]);else if(a.className){for(e=(" "+a.className+" ").replace(/[\r\n\t]/g," "),c=0,d=f.length;d>c;c++)e=e.replace(" "+f[c]+" "," ");a.className=e.replace(/^\s+|\s+$/g,"")}return a},Mb=function(a,b){var c=m(a,null).getPropertyValue(b);return"cursor"!==b||c&&"auto"!==c||"A"!==a.nodeName?c:"pointer"},Nb=function(a){var b={left:0,top:0,width:0,height:0};if(a.getBoundingClientRect){var c=a.getBoundingClientRect(),d=f.pageXOffset,e=f.pageYOffset,h=g.documentElement.clientLeft||0,i=g.documentElement.clientTop||0,j=0,k=0;if("relative"===Mb(g.body,"position")){var l=g.body.getBoundingClientRect(),m=g.documentElement.getBoundingClientRect();j=l.left-m.left||0,k=l.top-m.top||0}b.left=c.left+d-h-j,b.top=c.top+e-i-k,b.width="width"in c?c.width:c.right-c.left,b.height="height"in c?c.height:c.bottom-c.top}return b},Ob=function(a){if(!a)return!1;var b=m(a,null),c=r(b.height)>0,d=r(b.width)>0,e=r(b.top)>=0,f=r(b.left)>=0,g=c&&d&&e&&f,h=g?null:Nb(a),i="none"!==b.display&&"collapse"!==b.visibility&&(g||!!h&&(c||h.height>0)&&(d||h.width>0)&&(e||h.top>=0)&&(f||h.left>=0));return i},Pb=function(){j(S),S=0,l(T),T=0},Qb=function(){var a;if(d&&(a=Ab(N.bridge))){var b=Nb(d);A(a.style,{width:b.width+"px",height:b.height+"px",top:b.top+"px",left:b.left+"px",zIndex:""+Sb(Z.zIndex)})}},Rb=function(a){N.ready===!0&&(N.bridge&&"function"==typeof N.bridge.setHandCursor?N.bridge.setHandCursor(a):N.ready=!1)},Sb=function(a){if(/^(?:auto|inherit)$/.test(a))return a;var b;return"number"!=typeof a||s(a)?"string"==typeof a&&(b=Sb(q(a,10))):b=a,"number"==typeof b?b:"auto"},Tb=function(b){var c,d,e,f=N.sandboxed,g=null;if(b=b===!0,M===!1)g=!1;else{try{d=a.frameElement||null}catch(h){e={name:h.name,message:h.message}}if(d&&1===d.nodeType&&"IFRAME"===d.nodeName)try{g=d.hasAttribute("sandbox")}catch(h){g=null}else{try{c=document.domain||null}catch(h){c=null}(null===c||e&&"SecurityError"===e.name&&/(^|[\s\(\[@])sandbox(es|ed|ing|[\s\.,!\)\]@]|$)/.test(e.message.toLowerCase()))&&(g=!0)}}return N.sandboxed=g,f===g||b||Ub(o),g},Ub=function(a){function b(a){var b=a.match(/[\d]+/g);return b.length=3,b.join(".")}function c(a){return!!a&&(a=a.toLowerCase())&&(/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(a)||"chrome.plugin"===a.slice(-13))}function d(a){a&&(i=!0,a.version&&(l=b(a.version)),!l&&a.description&&(l=b(a.description)),a.filename&&(k=c(a.filename)))}var e,f,g,i=!1,j=!1,k=!1,l="";if(h.plugins&&h.plugins.length)e=h.plugins["Shockwave Flash"],d(e),h.plugins["Shockwave Flash 2.0"]&&(i=!0,l="2.0.0.11");else if(h.mimeTypes&&h.mimeTypes.length)g=h.mimeTypes["application/x-shockwave-flash"],e=g&&g.enabledPlugin,d(e);else if("undefined"!=typeof a){j=!0;try{f=new a("ShockwaveFlash.ShockwaveFlash.7"),i=!0,l=b(f.GetVariable("$version"))}catch(m){try{f=new a("ShockwaveFlash.ShockwaveFlash.6"),i=!0,l="6.0.21"}catch(n){try{f=new a("ShockwaveFlash.ShockwaveFlash"),i=!0,l=b(f.GetVariable("$version"))}catch(o){j=!1}}}}N.disabled=i!==!0,N.outdated=l&&r(l)<r(O),N.version=l||"0.0.0",N.pluginType=k?"pepper":j?"activex":i?"netscape":"unknown"};Ub(o),Tb(!0);var Vb=function(){return this instanceof Vb?void("function"==typeof Vb._createClient&&Vb._createClient.apply(this,z(arguments))):new Vb};v(Vb,"version",{value:"2.2.0",writable:!1,configurable:!0,enumerable:!0}),Vb.config=function(){return $.apply(this,z(arguments))},Vb.state=function(){return _.apply(this,z(arguments))},Vb.isFlashUnusable=function(){return ab.apply(this,z(arguments))},Vb.on=function(){return bb.apply(this,z(arguments))},Vb.off=function(){return cb.apply(this,z(arguments))},Vb.handlers=function(){return db.apply(this,z(arguments))},Vb.emit=function(){return eb.apply(this,z(arguments))},Vb.create=function(){return fb.apply(this,z(arguments))},Vb.destroy=function(){return gb.apply(this,z(arguments))},Vb.setData=function(){return hb.apply(this,z(arguments))},Vb.clearData=function(){return ib.apply(this,z(arguments))},Vb.getData=function(){return jb.apply(this,z(arguments))},Vb.focus=Vb.activate=function(){return kb.apply(this,z(arguments))},Vb.blur=Vb.deactivate=function(){return lb.apply(this,z(arguments))},Vb.activeElement=function(){return mb.apply(this,z(arguments))};var Wb=0,Xb={},Yb=0,Zb={},$b={};A(Z,{autoActivate:!0});var _b=function(a){var b=this;b.id=""+Wb++,Xb[b.id]={instance:b,elements:[],handlers:{}},a&&b.clip(a),Vb.on("*",function(a){return b.emit(a)}),Vb.on("destroy",function(){b.destroy()}),Vb.create()},ac=function(a,d){var e,f,g,h={},i=Xb[this.id],j=i&&i.handlers;if(!i)throw new Error("Attempted to add new listener(s) to a destroyed ZeroClipboard client instance");if("string"==typeof a&&a)g=a.toLowerCase().split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof d)for(e in a)w.call(a,e)&&"string"==typeof e&&e&&"function"==typeof a[e]&&this.on(e,a[e]);if(g&&g.length){for(e=0,f=g.length;f>e;e++)a=g[e].replace(/^on/,""),h[a]=!0,j[a]||(j[a]=[]),j[a].push(d);if(h.ready&&N.ready&&this.emit({type:"ready",client:this}),h.error){for(e=0,f=W.length;f>e;e++)if(N[W[e].replace(/^flash-/,"")]){this.emit({type:"error",name:W[e],client:this});break}c!==b&&Vb.version!==c&&this.emit({type:"error",name:"version-mismatch",jsVersion:Vb.version,swfVersion:c})}}return this},bc=function(a,b){var c,d,e,f,g,h=Xb[this.id],i=h&&h.handlers;if(!i)return this;if(0===arguments.length)f=u(i);else if("string"==typeof a&&a)f=a.split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof b)for(c in a)w.call(a,c)&&"string"==typeof c&&c&&"function"==typeof a[c]&&this.off(c,a[c]);if(f&&f.length)for(c=0,d=f.length;d>c;c++)if(a=f[c].toLowerCase().replace(/^on/,""),g=i[a],g&&g.length)if(b)for(e=g.indexOf(b);-1!==e;)g.splice(e,1),e=g.indexOf(b,e);else g.length=0;return this},cc=function(a){var b=null,c=Xb[this.id]&&Xb[this.id].handlers;return c&&(b="string"==typeof a&&a?c[a]?c[a].slice(0):[]:B(c)),b},dc=function(a){if(ic.call(this,a)){"object"==typeof a&&a&&"string"==typeof a.type&&a.type&&(a=A({},a));var b=A({},ob(a),{client:this});jc.call(this,b)}return this},ec=function(a){if(!Xb[this.id])throw new Error("Attempted to clip element(s) to a destroyed ZeroClipboard client instance");a=kc(a);for(var b=0;b<a.length;b++)if(w.call(a,b)&&a[b]&&1===a[b].nodeType){a[b].zcClippingId?-1===Zb[a[b].zcClippingId].indexOf(this.id)&&Zb[a[b].zcClippingId].push(this.id):(a[b].zcClippingId="zcClippingId_"+Yb++,Zb[a[b].zcClippingId]=[this.id],Z.autoActivate===!0&&lc(a[b]));var c=Xb[this.id]&&Xb[this.id].elements;-1===c.indexOf(a[b])&&c.push(a[b])}return this},fc=function(a){var b=Xb[this.id];if(!b)return this;var c,d=b.elements;a="undefined"==typeof a?d.slice(0):kc(a);for(var e=a.length;e--;)if(w.call(a,e)&&a[e]&&1===a[e].nodeType){for(c=0;-1!==(c=d.indexOf(a[e],c));)d.splice(c,1);var f=Zb[a[e].zcClippingId];if(f){for(c=0;-1!==(c=f.indexOf(this.id,c));)f.splice(c,1);0===f.length&&(Z.autoActivate===!0&&mc(a[e]),delete a[e].zcClippingId)}}return this},gc=function(){var a=Xb[this.id];return a&&a.elements?a.elements.slice(0):[]},hc=function(){Xb[this.id]&&(this.unclip(),this.off(),delete Xb[this.id])},ic=function(a){if(!a||!a.type)return!1;if(a.client&&a.client!==this)return!1;var b=Xb[this.id],c=b&&b.elements,d=!!c&&c.length>0,e=!a.target||d&&-1!==c.indexOf(a.target),f=a.relatedTarget&&d&&-1!==c.indexOf(a.relatedTarget),g=a.client&&a.client===this;return b&&(e||f||g)?!0:!1},jc=function(a){var b=Xb[this.id];if("object"==typeof a&&a&&a.type&&b){var c=rb(a),d=b&&b.handlers["*"]||[],e=b&&b.handlers[a.type]||[],g=d.concat(e);if(g&&g.length){var h,i,j,k,l,m=this;for(h=0,i=g.length;i>h;h++)j=g[h],k=m,"string"==typeof j&&"function"==typeof f[j]&&(j=f[j]),"object"==typeof j&&j&&"function"==typeof j.handleEvent&&(k=j,j=j.handleEvent),"function"==typeof j&&(l=A({},a),sb(j,k,[l],c))}}},kc=function(a){return"string"==typeof a&&(a=[]),"number"!=typeof a.length?[a]:a},lc=function(a){if(a&&1===a.nodeType){var b=function(a){(a||(a=f.event))&&("js"!==a._source&&(a.stopImmediatePropagation(),a.preventDefault()),delete a._source)},c=function(c){(c||(c=f.event))&&(b(c),Vb.focus(a))};a.addEventListener("mouseover",c,!1),a.addEventListener("mouseout",b,!1),a.addEventListener("mouseenter",b,!1),a.addEventListener("mouseleave",b,!1),a.addEventListener("mousemove",b,!1),$b[a.zcClippingId]={mouseover:c,mouseout:b,mouseenter:b,mouseleave:b,mousemove:b}}},mc=function(a){if(a&&1===a.nodeType){var b=$b[a.zcClippingId];if("object"==typeof b&&b){for(var c,d,e=["move","leave","enter","out","over"],f=0,g=e.length;g>f;f++)c="mouse"+e[f],d=b[c],"function"==typeof d&&a.removeEventListener(c,d,!1);delete $b[a.zcClippingId]}}};Vb._createClient=function(){_b.apply(this,z(arguments))},Vb.prototype.on=function(){return ac.apply(this,z(arguments))},Vb.prototype.off=function(){return bc.apply(this,z(arguments))},Vb.prototype.handlers=function(){return cc.apply(this,z(arguments))},Vb.prototype.emit=function(){return dc.apply(this,z(arguments))},Vb.prototype.clip=function(){return ec.apply(this,z(arguments))},Vb.prototype.unclip=function(){return fc.apply(this,z(arguments))},Vb.prototype.elements=function(){return gc.apply(this,z(arguments))},Vb.prototype.destroy=function(){return hc.apply(this,z(arguments))},Vb.prototype.setText=function(a){if(!Xb[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Vb.setData("text/plain",a),this},Vb.prototype.setHtml=function(a){if(!Xb[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Vb.setData("text/html",a),this},Vb.prototype.setRichText=function(a){if(!Xb[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Vb.setData("application/rtf",a),this},Vb.prototype.setData=function(){if(!Xb[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Vb.setData.apply(this,z(arguments)),this},Vb.prototype.clearData=function(){if(!Xb[this.id])throw new Error("Attempted to clear pending clipboard data from a destroyed ZeroClipboard client instance");return Vb.clearData.apply(this,z(arguments)),this},Vb.prototype.getData=function(){if(!Xb[this.id])throw new Error("Attempted to get pending clipboard data from a destroyed ZeroClipboard client instance");return Vb.getData.apply(this,z(arguments))},"function"==typeof define&&define.amd?define("Gallery/Client/3rdParty/zeroclipboard",function(){return Vb}):"object"==typeof module&&module&&"object"==typeof module.exports&&module.exports?module.exports=Vb:a.ZeroClipboard=Vb}(function(){return this||window}());
//# sourceMappingURL=ZeroClipboard.min.map
// Copyright (C) Microsoft Corporation. All rights reserved.
define("Gallery/Client/Controls/VSCodeCopyCommand/VSCodeCopyCommand.View",["require","exports","Gallery/Client/Controls/VSCodeCopyCommand/VSCodeCopyCommand.ViewModel","Gallery/Client/3rdParty/zeroclipboard","VSS/Adapters/Knockout","VSS/Utils/Core","VSS/Events/Services"],function(n,t,i,r,u,f,e){var o=f.delegate,s=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.initialize=function(){n.prototype.initialize.call(this);this._copyCallback=o(this,this._onCopy);e.getService().attachEvent(i.VSCodeCopyCommandViewModel.EVENT_ON_COPY,this._copyCallback);this._onInitializeFlash()},t.prototype._onCopy=function(n){var r=n.textAreaID,u=n.copiedAnimationID,t=$("#"+r).get(0),i;t.select();try{i=document.execCommand("copy");i&&(this._copiedAnimation(u),n.publishTelemetryEvent_Copy(!1))}catch(f){}t.focus();t.blur()},t.prototype._copiedAnimation=function(n){var t=$("#"+n);t.fadeIn(1e3);t.delay(200);t.fadeOut(10)},t.prototype._onInitializeFlash=function(){var n=this.getViewModel(),e=this,u,f,t;if(n.isFlahUsed){u=n.copyButtonID;f=n.copiedAnimationID;r.config({swfPath:i.VSCodeCopyCommandViewModel.swfFileURL});t=new r($("#"+u));t.on("ready",function(){t.on("aftercopy",function(){n.publishTelemetryEvent_Copy(!0);e._copiedAnimation(f)})})}},t.prototype._cleanup=function(){e.getService().detachEvent(i.VSCodeCopyCommandViewModel.EVENT_ON_COPY,this._copyCallback);n.prototype._cleanup.call(this)},t}(u.TemplateControl);t.VSCodeCopyCommandView=s});
define("Gallery/Client/Pages/VSSItemDetails/VSSItemDetails.View",["require","exports","Gallery/Client/Controls/AcquireItemWizardError/AcquireItemWizardError.View","Gallery/Client/Controls/AcquireItemWizardError/AcquireItemWizardError.ViewModel","Gallery/Client/Pages/Common/Base.View","VSS/Context","VSS/Controls","VSS/Diag","VSS/Events/Action","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Client/Common/Telemetry","Gallery/Client/Common/TelemetryInternal","Gallery/Client/Pages/Common/ItemContext","Gallery/Client/Controls/VSSItemDetails/VSSItemDetails.View","Gallery/Client/Controls/VSSItemDetails/VSSItemDetails.ViewModel","Gallery/Client/Service/VSSGallery/VSSGallery","Gallery/Client/Service/Item","Gallery/Client/Service/VSSItem","Gallery/Client/Service/VSSItemHelper","VSS/Adapters/Knockout","Gallery/Client/Controls/ItemTile/Item.View","VSS/Utils/String","Gallery/Client/Controls/ItemTile/ItemTile.ViewModel","Gallery/Client/Service/VSSCommerce/VSSCommerce","Gallery/Client/Common/Utility","Gallery/Client/Common/Constants","Gallery/Client/URLHelper","VSS/Utils/Url","VSS/FeatureAvailability/Services","Gallery/Client/Controls/RatingControl/RatingControl.ViewModel","Gallery/Client/Controls/RatingControl/RatingControl.View","Gallery/Client/Controls/VSCodeCopyCommand/VSCodeCopyCommand.ViewModel","Gallery/Client/Controls/VSCodeCopyCommand/VSCodeCopyCommand.View","Gallery/Client/Service/GitHubServiceProvider/GitHubServiceProvider"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at){var yt=c.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.ItemDetailsProperties,vt=c.CustomerIntelligenceConstants.MarketPlaceIntelligenceProperties.VSSErrorProperties,wt=c.CustomerIntelligenceConstants.MarketPlaceIntelligencePropertyName,pt=function(n){function t(){n.call(this);this._isHosted=f.getPageContext().webAccessConfiguration.isHosted}return __extends(t,n),t.prototype.initialize=function(){if(c.GalleryPerformance.startScenarioFromNavigation(c.PerformanceConstants.LoadVSSItemDetails),c.GalleryPerformance.split("VSSItemDetails.View.ScriptsLoaded"),n.prototype.initialize.call(this),o.logTracePoint("VSSItemDetails.loading.start"),this.unFixHeader(),this._showItem(),$.fn.button.noConflict){var t=$.fn.button.noConflict();$.fn.bootstrapBtn=t}},t.prototype._showItem=function(){var n=this,r=function(t){var i=n._element;d.TemplateControl.applyRegisteredBinding("item-details-view-template",i,t);o.logTracePoint("VSSItemDetails.loading.end");n._itemDetailsViewModel.onItemLoaded().then(function(){s.getService().performAction(ut.GalleryEvents.PAGE_LOAD)})},i;this._fullyQualifiedItemName=this._getItemNameFromUrl(location.href);var f=et.Uri.parse(location.href),h=ft.GalleryURLs.isExternalInstall(location.search),e=a.getVSSJsonDataProviderInitOptions(),v=ot.FeatureAvailabilityService.isFeatureEnabled(ut.FeatureFlag.OnPremConnected),t=v&&h&&!this._isHosted,y=e||t;y?(this._vssGallery=t?new p.VSSGalleryExternalProvider(rt.UrlUtils.getExternalSourceUrl()):this._options.VSSDataProvider||new p.VSSCachingProvider(e),this._vssCommerce=this._options.VSSCommerce||new it.VSSCommerce,this._gitHubServiceProvider=this._options.GitHubServiceProvider||new at.GitHubServiceProvider,this._vssGallery.getDetailedItem(this._fullyQualifiedItemName).then(function(i){var o,e;n._detailedItem=i;t&&(document.title=n._getPageTitle(i.title));o=k.VSSItemHelper.isItemDownloadable(i);i.itemType===b.VSSItemType.VSCodeExtension?u.BaseView.setSearchContext(ut.SearchConstants.VSCodeProductText):u.BaseView.setSearchContext(ut.SearchConstants.VSTSProductText);var h=nt.ignoreCaseComparer(f.getQueryParam("download"),"true")===0,a=nt.ignoreCaseComparer(f.getQueryParam("install"),"true")===0,s={vssDetailedItem:i,vssGalleryProvider:n._vssGallery,gitHubServiceProvider:n._gitHubServiceProvider,vssDownloadVsixFlag:o,intiateDownloadOnPageLoad:h,intiateInstall:a,showMinimalView:t};i.priceCategory===w.priceCategory.Free||i.priceCategory===w.priceCategory.Preview?(r(s),c.GalleryPerformance.endScenario(c.PerformanceConstants.LoadVSSItemDetails)):(e=function(n){i.pricing=n;r(s);c.GalleryPerformance.endScenario(c.PerformanceConstants.LoadVSSItemDetails)},n._vssCommerce.getItemPrice(i).then(function(n){e(n)},function(n){var t={};t[vt.FailedAPI]="IVSSCommerce.getItemPrice";t[vt.ErrorMessage]="Error retrieving pricing details";t[vt.ItemID]=i.id;t[vt.Reason]=JSON.stringify(n);t[wt.PRODUCT_TYPE]=b.ItemModelHelper.getItemTypeText(i.itemType);l.ErrorLog.logVSSError(t);e(null)}))},function(t){var i={};i[vt.FailedAPI]="IVSSGallery.getDetailedItem";i[vt.ErrorMessage]="Error retrieving item details";i[vt.ItemName]=n._fullyQualifiedItemName;i[vt.Reason]=JSON.stringify(t);l.ErrorLog.logVSSError(i);n._showInvalidItemError()})):(this._showInvalidItemError(),i={},i[vt.FailedAPI]="VSSItemDetails._showItem",i[vt.ErrorMessage]="Retrieved item is invalid.",i[vt.ItemName]=this._fullyQualifiedItemName)},t.prototype._getPageTitle=function(n){return this._isHosted?nt.format("{0} | {1}",n,h.PageTitle):nt.format("{0} | {1}",n,h.OnPremGalleryPageTitle)},t.prototype._addClickHandlersForSocialLinks=function(){var i=this,n=this.getElement().find(".item-share-container .social-link");n&&n.length>0&&n.click(function(){var u=$(event.target),r="",n;u.hasClass(t.SHARE_TWITTER_CLASS)?r=c.CustomerIntelligenceConstants.SocialNetworkConstants.TWITTER:u.hasClass(t.SHARE_FACEBOOK_CLASS)?r=c.CustomerIntelligenceConstants.SocialNetworkConstants.FACEBOOK:u.hasClass(t.SHARE_EMAIL_CLASS)&&(r=c.CustomerIntelligenceConstants.SocialNetworkConstants.EMAIL);n={};n[yt.SectionName]=r;n[yt.Id]=i._fullyQualifiedItemName;n[yt.ProductType]=b.ItemModelHelper.getItemTypeText(i._detailedItem.itemType);l.TelemetryHelper.publishEvent(c.CustomerIntelligenceConstants.MarketPlaceIntelligenceFeature.SOCIAL_EVENT_CLICK,n)})},t.prototype._getItemNameFromUrl=function(n){var t=et.Uri.parse(n);return t.getQueryParam("itemName")},t.prototype._showInvalidItemError=function(){this._element.empty();var n=rt.HtmlHelper.getReturntoHomePageHtml(this._isHosted),t=nt.format(h.ErrorDiagnosisReturnToHome,n),i={errorText:h.ErrorPageNotAvailable,errorDiagnosisHtml:t};u.BaseView._showError(i,this._element)},t.prototype.registerControls=function(){var t=this;n.prototype.registerControls.call(this);d.TemplateControl.registerBinding("item-details-view-template",v.VSSItemDetailsView,function(n){var i=new y.VSSItemDetailsViewModel(n);return t._itemDetailsViewModel=i,i});d.TemplateControl.registerBinding("item-banner-template",g.ItemBannerView,function(n){return new tt.ItemTileViewModel(n)});d.TemplateControl.registerBinding("rating-control-page-template",ht.RatingControlView,function(n){return new st.RatingControlViewModel(n)});d.TemplateControl.registerBinding("vscode-copy-command-template",lt.VSCodeCopyCommandView,function(n){return new ct.VSCodeCopyCommandViewModel(n)});d.TemplateControl.registerBinding("acquire-item-wizard-error",i.AcquireItemWizardErrorView,function(n){return new r.AcquireItemWizardErrorViewModel(n)})},t.SHARE_TWITTER_CLASS="share-twitter-button",t.SHARE_FACEBOOK_CLASS="share-facebook-button",t.SHARE_EMAIL_CLASS="share-email-button",t}(u.BaseView);t.VSSItemDetails=pt;e.Enhancement.registerEnhancement(pt,".item-details-main-content")});

if (window.performance && window.performance.mark) { window.performance.mark('endLoadBundleInner-view'); }